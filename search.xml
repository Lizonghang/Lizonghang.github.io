<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[CORS跨站请求与https服务器配置]]></title>
      <url>http://lizonghang.github.io/2016/09/27/CORS%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%B8%8Ehttps%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/</url>
      <content type="html"><![CDATA[<h1 id="CORS跨站资源共享"><a href="#CORS跨站资源共享" class="headerlink" title="CORS跨站资源共享"></a>CORS跨站资源共享</h1><h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><p>很多习惯了自己做网站的后台开发者在初次与前端或移动端合作开发时，常常遇到这么一个问题: 后台所开发出的 API 都是经过 Postman 或其他接口测试工具测试过，确认提供的这些 API 并没有异常后，将这些 API 整理成文档发给前端，但是前端的小伙伴并不能成功访问到这些接口，而是会报错: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XMLHttpRequest cannot load http://www.desckie.com/iwantrent/getAllProduct</span><br><span class="line">/. No &apos;Access-Control-Allow-Origin&apos; header is present on the requested re</span><br><span class="line">source. Origin &apos;http://www.puahome.com&apos; is therefore not allowed access.</span><br></pre></td></tr></table></figure>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>这是由于浏览器安全的基石是”同源政策”，同源指是协议相同、域名相同、端口相同。同源政策的目的是为了保证用户信息的安全，防止恶意网站窃取数据。因此现在我们用 JS 或 AJAX 进行跨站请求时，由于浏览器的同源原则，使得 <code>XMLHttpRequest</code> 不能跨域通讯。</p>
<p>为了实现跨域有多种做法，其中一种较为优雅的是使用 <code>JSONP</code> 方案，但 <code>JSONP</code> 仅限于 <code>GET</code> 方法，局限性较大。</p>
<p>报错信息中有这么一句话: <code>No ‘Access-Control-Allow-Origin’ header is present on the requested resource.</code>。请求的资源中没有 <code>‘Access-Control-Allow-Origin’</code> 请求头，它指定服务器端允许进行跨域资源访问的来源域，允许任何域的 Javascript 访问资源的方式为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Accesss-Control-Allow-Origin: *</span><br></pre></td></tr></table></figure>
<p>或指定具体的域可访问，如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http://foo.example.com</span><br></pre></td></tr></table></figure>
<p>如此一来，除了 foo.example.com ，其他站点都不能跨站访问本站的资源。那么如何添加请求头呢？</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="直接处理请求头"><a href="#直接处理请求头" class="headerlink" title="直接处理请求头"></a>直接处理请求头</h3><p>在 Django 后台中我们可以通过简单的方式添加请求头，如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response[&apos;Access-Control-Allow-Origin&apos;] = &apos;*&apos;</span><br><span class="line">return response</span><br></pre></td></tr></table></figure>
<p>这也是实现跨站登录最基本的实现，但不推荐这种跨站访问方式。</p>
<h3 id="CORS跨站资源共享-1"><a href="#CORS跨站资源共享-1" class="headerlink" title="CORS跨站资源共享"></a>CORS跨站资源共享</h3><p>在 Django 中有CORS-header开源的中间件，利用这些现成的中间件，我们只需要在 settings.py 中做一些简单的配置即可实现 CORS 跨站资源共享，使得服务器端 API 完全开放，使得前后台能够较为独立的工作。</p>
<p>django-cors-headers开源项目地址为: <a href="https://github.com/ottoyiu/django-cors-headers/" target="_blank" rel="external">https://github.com/ottoyiu/django-cors-headers/</a></p>
<p>使用方法如下:</p>
<ol>
<li>安装django-cors-headers</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install django-cors-headers</span><br></pre></td></tr></table></figure>
<ol>
<li>将 corsheaders 加入 installed apps:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = (</span><br><span class="line">    ...</span><br><span class="line">    &apos;corsheaders&apos;,</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>添加中间件类</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE_CLASSES = (</span><br><span class="line">    ...</span><br><span class="line">    &apos;corsheaders.middleware.CorsMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.common.CommonMiddleware&apos;,</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>: CorsMiddleware needs to come before Django’s CommonMiddleware if you are using Django’s <code>USE_ETAGS = True</code> setting, otherwise the CORS headers will be lost from the 304 not-modified responses, causing errors in some browsers.</p>
<ol>
<li>添加配置</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CORS_ORIGIN_ALLOW_ALL = True</span><br><span class="line">CORS_URLS_REGEX = r&apos;^/api/.*$&apos;</span><br><span class="line">CORS_ALLOW_METHODS = (&apos;GET&apos;, &apos;POST&apos;)</span><br></pre></td></tr></table></figure>
<p>生产环境中推荐使用白名单，此处为测试才设为全域。按照需要可以设置其他配置，具体设置见 <a href="https://github.com/ottoyiu/django-cors-headers/#configuration。" target="_blank" rel="external">https://github.com/ottoyiu/django-cors-headers/#configuration。</a></p>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>重新用 JS 或 AJAX 跨站访问，没有出现 No ‘Access-Control-Allow-Origin’ header 报错。</p>
<h1 id="HTTPS-Nginx服务器部署"><a href="#HTTPS-Nginx服务器部署" class="headerlink" title="HTTPS Nginx服务器部署"></a>HTTPS Nginx服务器部署</h1><h2 id="现象-1"><a href="#现象-1" class="headerlink" title="现象"></a>现象</h2><p>跨站访问的问题解决了，再次测试又出现了新的错误，错误信息如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[blocked] The page at https://www.baidu.com/… was not allowed to display insecure content from http://www.desckie.com/iwantrent/getAllProduct/.</span><br></pre></td></tr></table></figure>
<h2 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h2><p>从报错信息上我们可以判断出，请求的网页被作为不安全的网页给浏览器阻塞了，原因就出在使用的协议为 http 协议。http 协议传输的数据在网络上为明文传输，容易被中间人窃取导致用户信息泄露，因此 http 协议实际上是不安全的。https 协议是 http 的安全版，即 http 下加入 SSL 层。要解决这个问题我们需要将协议更改为 https 协议。以 Nginx 服务器为例。</p>
<h2 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="申请-SSL-证书"><a href="#申请-SSL-证书" class="headerlink" title="申请 SSL 证书"></a>申请 SSL 证书</h3><p>这里我们使用自行颁发的免费 SSL 证书，它虽然能实现加密传输功能，但这类证书是不受浏览器信任的。用户在进入该网站时可能会出现提示: 此网站的安全证书有问题。但向专业机构申请 SSL 证书不仅需要出示相关证件，而且还要付费，所以我们这里就使用自行颁发的 SSL 证书。</p>
<ol>
<li>openssl genrsa -des3 -out api.bz.key 1024</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-96-46-ubuntu:~$ openssl genrsa -des3 -out api.bz.key 1024</span><br><span class="line">Generating RSA private key, 1024 bit long modulus</span><br><span class="line">............................++++++</span><br><span class="line">..............++++++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase for api.bz.key:</span><br><span class="line">Verifying - Enter pass phrase for api.bz.key:输入密码</span><br></pre></td></tr></table></figure>
<ol>
<li>openssl req -new -key api.bz.key -out api.bz.csr</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-96-46-ubuntu:~$ openssl req -new -key api.bz.key -out api.bz.csr</span><br><span class="line">Enter pass phrase for api.bz.key: 刚刚设置的密码</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN</span><br><span class="line">State or Province Name (full name) [Some-State]:Beijing</span><br><span class="line">Locality Name (eg, city) []:Beijing</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:API.BZ</span><br><span class="line">Organizational Unit Name (eg, section) []:API.BZ</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:*.api.bz</span><br><span class="line">Email Address []:admin@api.bz</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []: 回车</span><br><span class="line">An optional company name []: 回车</span><br></pre></td></tr></table></figure>
<ol>
<li>openssl rsa -in api.bz.key -out api.bz_nopass.key</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-96-46-ubuntu:~$ openssl rsa -in api.bz.key -out api.bz_nopass.key</span><br><span class="line">Enter pass phrase for api.bz.key:</span><br><span class="line">writing RSA key</span><br></pre></td></tr></table></figure>
<ol>
<li>openssl req -new -x509 -days 3650 -key api.bz_nopass.key -out api.bz.crt</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-96-46-ubuntu:~$ openssl req -new -x509 -days 3650 -key api.bz_nopass.key -out api.bz.crt</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN</span><br><span class="line">State or Province Name (full name) [Some-State]:Beijing</span><br><span class="line">Locality Name (eg, city) []:Beijing</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:API.BZ</span><br><span class="line">Organizational Unit Name (eg, section) []:API.BZ</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:*.api.bz</span><br><span class="line">Email Address []:admin@api.bz</span><br></pre></td></tr></table></figure>
<p>到这里 SSL 证书就申请好了，此时应该有四个文件，如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-96-46-ubuntu:~$ ls</span><br><span class="line">api.bz.crt  api.bz.csr  api.bz.key  api.bz_nopass.key ...</span><br></pre></td></tr></table></figure>
<p>我们要用的是 <code>api.bz.crt</code> 和 <code>api.bz_nopass.key</code> 两个文件。</p>
<h3 id="更改-Nginx-配置"><a href="#更改-Nginx-配置" class="headerlink" title="更改 Nginx 配置"></a>更改 Nginx 配置</h3><p>在配置文件 nginx.conf 中的 server 字段中有这么一段被注释的 HTTPS 配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># HTTPS server</span><br><span class="line">#</span><br><span class="line"># server &#123;</span><br><span class="line">#   listen 443;</span><br><span class="line">#   server_name localhost;</span><br><span class="line">#</span><br><span class="line">#   root html;</span><br><span class="line">#   index index.html index.htm;</span><br><span class="line">#</span><br><span class="line">#   ssl on;</span><br><span class="line">#   ssl_certificate cert.pem;</span><br><span class="line">#   ssl_certificate_key cert.key;</span><br><span class="line">#</span><br><span class="line">#   ssl_session_timeout 5m;</span><br><span class="line">#</span><br><span class="line">#   ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">#   ssl_ciphers &quot;HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES&quot;;</span><br><span class="line">#   ssl_prefer_server_ciphers on;</span><br><span class="line">#</span><br><span class="line">#   location / &#123;</span><br><span class="line">#       try_files $uri $uri/ =404;</span><br><span class="line">#   &#125;</span><br><span class="line">#&#125;</span><br></pre></td></tr></table></figure>
<p>我们不需要使用其中所有的配置，根据 SSL 证书的路径修改相应的配置项(省去了注释项):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 443;</span><br><span class="line">        server_name sms.api.bz;</span><br><span class="line"></span><br><span class="line">        ssl on;</span><br><span class="line">        ssl_certificate /root/api.bz.crt;</span><br><span class="line">        ssl_certificate_key /root/api.bz_nopass.key;</span><br><span class="line">        </span><br><span class="line">        location / &#123;</span><br><span class="line">                include /etc/nginx/uwsgi_params;</span><br><span class="line">                uwsgi_pass 127.0.0.1:8077;</span><br><span class="line">                include /etc/nginx/mime.types;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~* \.*(gif|png|jpg|jpeg|css|js|ttf|less)$ &#123;</span><br><span class="line">                root /root/RentMe;</span><br><span class="line">                access_log /root/nginx_access.log;</span><br><span class="line">                error_log /root/nginx_error.log;</span><br><span class="line">                include /etc/nginx/mime.types;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 location 可以从 HTTP 的配置项中复制过来。修改完成后，验证配置文件有效性并重启 nginx 服务器:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@iZ28zgwg61iZ:~# /usr/sbin/nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">root@iZ28zgwg61iZ:~# /usr/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>
<p>随后使用 https 方式进入你的网站，会先提示网站的安全证书有问题，无需理会。到这里网站就从 http 协议更换成 https 协议了，之后就可以用 https 方式更安全的访问网站。</p>
<h2 id="效果-1"><a href="#效果-1" class="headerlink" title="效果"></a>效果</h2><p>下图是从 leancloud.cn 通过 js 跨站访问的截图，没有出现跨站访问错误和安全警告，如图:</p>
<p><img src="/images/https.png" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Getting Started With Videos]]></title>
      <url>http://lizonghang.github.io/2016/08/16/Getting-Started-With-Videos/</url>
      <content type="html"><![CDATA[<h1 id="Capture-Video-from-Camera"><a href="#Capture-Video-from-Camera" class="headerlink" title="Capture Video from Camera"></a>Capture Video from Camera</h1><p>To capture a video, you need to create a VideoCapture object. Its argument can be either the device index or the name of a video file. Device index is just the number to specify which camera. Normally one camera will be connected (as in my case). So I simply pass 0 (or -1). You can select the second camera by passing 1 and so on. After that, you can capture frame-by-frame. But at the end, don’t forget to release the capture. You can press ESC to quit.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">cap = cv2.VideoCapture(0)</span><br><span class="line">while True:</span><br><span class="line">    ret, frame = cap.read()</span><br><span class="line">    cv2.imshow(&apos;recording&apos;, frame)</span><br><span class="line">    if cv2.waitKey(25) == 27:</span><br><span class="line">        break</span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p><code>cap.read()</code> returns a bool (True/False). If frame is read correctly, it will be True. So you can check end of the video by checking this return value.</p>
<p>Sometimes, <code>cap</code> may not have initialized the capture. In that case, this code shows error. You can check whether it is initialized or not by the method <code>cap.isOpened()</code>. Otherwise open it using <code>cap.open()</code>.</p>
<p>You can also access some of the features of this video using <code>cap.get(propId)</code> method where propId is a number from 0 to 18. Each number denotes a property of the video (if it is applicable to that video) and full details can be seen in  <a href="http://docs.opencv.org/2.4/modules/highgui/doc/reading_and_writing_images_and_video.html#videocapture-get" target="_blank" rel="external">Property Identifier</a>. Some of these values can be modified using <code>cap.set(propId, value)</code>. Value is the new value you want.</p>
<p>For example, I can check the frame width and height by <code>cap.get(3)</code> and <code>cap.get(4)</code>. It gives me 640x480 by default. But I want to modify it to 320x240. Just use <code>ret = cap.set(3,320)</code> and <code>ret = cap.set(4,240)</code>.</p>
<p><strong>Note</strong>：If you are getting error, make sure camera is working fine using any other camera application (like Cheese in Linux).</p>
<h1 id="Playing-Video-from-file"><a href="#Playing-Video-from-file" class="headerlink" title="Playing Video from file"></a>Playing Video from file</h1><p>It is same as capturing from Camera, just change camera index with video file name. Also while displaying the frame, use appropriate time for cv2.waitKey(). If it is too less, video will be very fast and if it is too high, video will be slow (Well, that is how you can display videos in slow motion). 25 milliseconds will be OK in normal cases.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">cap = cv2.VideoCapture(&apos;video.mp4&apos;)</span><br><span class="line">while cap.isOpened():</span><br><span class="line">    ret, frame = cap.read()</span><br><span class="line">    cv2.imshow(&apos;playing&apos;, frame)</span><br><span class="line">    if cv2.waitKey(25) == 27:</span><br><span class="line">        break</span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>：Make sure proper versions of ffmpeg or gstreamer is installed. Sometimes, it is a headache to work with Video Capture mostly due to wrong installation of ffmpeg/gstreamer.</p>
<p><strong>Note</strong>：On Mac, you may get trouble while reading frame from a video file or writing frame to file, With no exception occurred but no data read out or write in. I have installed ffmpeg by homebrew, however not work for me. The OpenCV version on my Mac is 2.4.13. I have no idea about it. However, I tried it on Linux and it works without ffmpeg. The OpenCV version on Linux is 2.4.8. If you get the same trouble, maybe you can try uninstall OpenCV and install OpenCV3.x or OpenCV 2.4.8, it may works.</p>
<h1 id="Saving-a-Video"><a href="#Saving-a-Video" class="headerlink" title="Saving a Video"></a>Saving a Video</h1><p>Create a <code>VideoWriter</code> object and specify the output filename. Then specify the FourCC code. Then number of frames per second (fps) and frame size should be passed. And last one is isColor flag. If it is True, encoder expect color frame, otherwise it works with grayscale frame.</p>
<p>FourCC is a 4-byte code used to specify the video codec. The list of available codes can be found in <a href="http://www.fourcc.org/codecs.php" target="_blank" rel="external">fourcc.org</a>. It is platform dependent. </p>
<p>FourCC code is passed as below：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># for OpenCV 2.4.x version</span><br><span class="line">cv2.cv.CV_FOURCC(&apos;M&apos;,&apos;J&apos;,&apos;P&apos;,&apos;G&apos;)</span><br><span class="line">cv2.cv.CV_FOURCC(*&apos;M‌​JPG&apos;)</span><br><span class="line"># for OpenCV 3.0 version</span><br><span class="line">cv2.VideoWriter_fourcc(&apos;M&apos;,&apos;J&apos;,&apos;P&apos;,&apos;G&apos;)</span><br><span class="line">cv2.VideoWriter_fourcc(*&apos;MJPG&apos;)</span><br></pre></td></tr></table></figure>
<p>Below code capture from video file and saves part of it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">cap = cv2.VideoCapture(&apos;video.avi&apos;)</span><br><span class="line">fourcc = cv2.cv.CV_FOURCC(*&apos;XVID&apos;)</span><br><span class="line">fps = 25</span><br><span class="line">ret, frame = cap.read()</span><br><span class="line">height, width = frame.shape[:2]</span><br><span class="line">out = cv2.VideoWriter(&apos;output.avi&apos;, fourcc, fps, (width, height))</span><br><span class="line"></span><br><span class="line">startTime = 60 # start at 60s</span><br><span class="line">endTime = 70 # end at 70s</span><br><span class="line"></span><br><span class="line">totalTime = cap.get(cv2.cv.CV_CAP_PROP_FRAME_COUNT) / fps</span><br><span class="line">if startTime &gt;= totalTime or endTime &gt; totalTime or startTime &gt; endTime:</span><br><span class="line">    print &apos;Invalid time settings&apos;</span><br><span class="line">    sys.exit(0)</span><br><span class="line"></span><br><span class="line">startFrame = startTime * fps</span><br><span class="line">stopFrame = endTime * fps</span><br><span class="line">cap.set(cv2.cv.CV_CAP_PROP_POS_FRAMES, startFrame) # read from startFrame</span><br><span class="line">duration = stopFrame - startFrame</span><br><span class="line"></span><br><span class="line">while duration and cap.isOpened():</span><br><span class="line">    ret, frame = cap.read()</span><br><span class="line">    cv2.imshow(&apos;preview&apos;, frame)</span><br><span class="line">    out.write(frame)</span><br><span class="line">    if cv2.waitKey(1000/fps) == 27:</span><br><span class="line">        break</span><br><span class="line">    duration -= 1</span><br><span class="line"></span><br><span class="line">cap.release()</span><br><span class="line">out.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Image Thresholding]]></title>
      <url>http://lizonghang.github.io/2016/08/15/Image-Thresholding/</url>
      <content type="html"><![CDATA[<h1 id="Simple-Thresholding"><a href="#Simple-Thresholding" class="headerlink" title="Simple Thresholding"></a>Simple Thresholding</h1><p>Here, the matter is straight forward. If pixel value is greater than a threshold value, it is assigned one value (may be white), else it is assigned another value (may be black). The function used is <code>cv2.threshold</code>. First argument is the source image, which should be a grayscale image. Second argument is the threshold value which is used to classify the pixel values. Third argument is the maxVal which represents the value to be given if pixel value is more than (sometimes less than) the threshold value. OpenCV provides different styles of thresholding and it is decided by the fourth parameter of the function. Different types are:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cv2.THRESH_BINARY</span><br><span class="line">cv2.THRESH_BINARY_INV</span><br><span class="line">cv2.THRESH_TRUNC</span><br><span class="line">cv2.THRESH_TOZERO</span><br><span class="line">cv2.THRESH_TOZERO_INV</span><br></pre></td></tr></table></figure>
<p>Two outputs are obtained. First one is a retval, Second output is thresholded image.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;origin.png&apos;)</span><br><span class="line">im = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)</span><br><span class="line">ret, thresh1 = cv2.threshold(im, 127, 255, cv2.THRESH_BINARY)</span><br><span class="line">ret, thresh2 = cv2.threshold(im, 127, 255, cv2.THRESH_BINARY_INV)</span><br><span class="line">ret, thresh3 = cv2.threshold(im, 127, 255, cv2.THRESH_TRUNC)</span><br><span class="line">ret, thresh4 = cv2.threshold(im, 127, 255, cv2.THRESH_TOZERO)</span><br><span class="line">ret, thresh5 = cv2.threshold(im, 127, 255, cv2.THRESH_TOZERO_INV)</span><br><span class="line"></span><br><span class="line">titles = [&apos;Origin&apos;, &apos;BINARY&apos;, &apos;BINARY_INV&apos;, &apos;TRUNC&apos;, &apos;TOZERO&apos;, &apos;TOZERO_INV&apos;]</span><br><span class="line">images = [im, thresh1, thresh2, thresh3, thresh4, thresh5]</span><br><span class="line">for i in range(6):</span><br><span class="line">    plt.subplot(2,3,i+1)</span><br><span class="line">    plt.imshow(images[i], &apos;gray&apos;)</span><br><span class="line">    plt.title(titles[i])</span><br><span class="line">    plt.xticks([]), plt.yticks([])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>：To plot multiple images, we have used plt.subplot() function. Please checkout Matplotlib docs for more details.</p>
<p>Result is given below：</p>
<p><img src="/images/simple-thresholding.png" style="width: 500px;height: 350px"></p>
<h1 id="Adaptive-Thresholding"><a href="#Adaptive-Thresholding" class="headerlink" title="Adaptive Thresholding"></a>Adaptive Thresholding</h1><p>In the previous section, we used a global value as threshold value. But it may not be good in all the conditions where image has different lighting conditions in different areas. In that case, we go for adaptive thresholding. In this, the algorithm calculate the threshold for a small regions of the image. So we get different thresholds for different regions of the same image and it gives us better results for images with varying illumination.</p>
<p>It has three ‘special’ input params and one output argument.</p>
<p><strong>Adaptive Method</strong> - It decides how thresholding value is calculated.</p>
<ul>
<li><code>cv2.ADAPTIVE_THRESH_MEAN_C</code>：threshold value is the mean of neighbourhood area.</li>
<li><code>cv2.ADAPTIVE_THRESH_GAUSSIAN_C</code>：threshold value is weighted sum of neighbourhood values where weights are a gaussian window.</li>
</ul>
<p><strong>Block Size</strong> - It decides the size of neighbourhood area.</p>
<p><strong>C</strong> - A constant which is subtracted from the mean or weighted mean calculated.</p>
<p>Below piece of code compares global thresholding and adaptive thresholding for an image with varying illumination:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;origin.png&apos;)</span><br><span class="line">im = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)</span><br><span class="line">ret, thresh1 = cv2.threshold(im, 127, 255, cv2.THRESH_BINARY)</span><br><span class="line">thresh2 = cv2.adaptiveThreshold(im, 255, cv2.ADAPTIVE_THRESH_MEAN_C, cv2.THRESH_BINARY, 11, 2)</span><br><span class="line">thresh3 = cv2.adaptiveThreshold(im, 255, cv2.ADAPTIVE_THRESH_GAUSSIAN_C, cv2.THRESH_BINARY, 11, 2)</span><br><span class="line"></span><br><span class="line">titles = [&apos;Origin&apos;, &apos;Global Thresholding(v=127)&apos;, &apos;Adaptive Mean Thresholding&apos;, &apos;Adaptive Gaussian Thresholding&apos;]</span><br><span class="line">images = [im, thresh1, thresh2, thresh3]</span><br><span class="line">for i in range(4):</span><br><span class="line">    plt.subplot(2,2,i+1)</span><br><span class="line">    plt.imshow(images[i], &apos;gray&apos;)</span><br><span class="line">    plt.title(titles[i])</span><br><span class="line">    plt.xticks([]), plt.yticks([])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>Result：</p>
<p><img src="/images/adaptive-thresholding.png" style="width: 500px;height: 350px"></p>
<h1 id="Otsu’s-Binarization"><a href="#Otsu’s-Binarization" class="headerlink" title="Otsu’s Binarization"></a>Otsu’s Binarization</h1><p>What is <code>retVal</code>? Consider a bimodal image (In simple words, bimodal image is an image whose histogram has two peaks). For that image, we can approximately take a value in the middle of those peaks as threshold value. That is what Otsu binarization does. So in simple words, it automatically calculates a threshold value from image histogram for a bimodal image. (For images which are not bimodal, binarization won’t be accurate.)</p>
<p>For this, <code>cv2.threshold()</code> function is used, but pass an extra flag <code>cv2.THRESH_OTSU</code>. For threshold value, simply pass zero. Then the algorithm finds the optimal threshold value and returns as the output <code>retVal</code>. If Otsu thresholding is not used, retVal is same as the threshold value you used.</p>
<p>Input image is a noisy image. In first case, applied global thresholding for a value of 127. In second case, applied Otsu’s thresholding directly. In third case, filtered image with a 5x5 gaussian kernel to remove the noise, then applied Otsu thresholding. See how noise filtering improves the result.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;origin.png&apos;)</span><br><span class="line">im = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)</span><br><span class="line"># Global Thresholding</span><br><span class="line">ret1, thresh1 = cv2.threshold(im, 127, 255, cv2.THRESH_BINARY)</span><br><span class="line"># Otsu&apos;s Thresholding</span><br><span class="line">ret2, thresh2 = cv2.threshold(im, 0, 255, cv2.THRESH_BINARY+cv2.THRESH_OTSU)</span><br><span class="line"># Otsu&apos;s Thresholding after Gaussian Filter</span><br><span class="line">blur = cv2.GaussianBlur(im, (5,5), 0)</span><br><span class="line">ret3, thresh3 = cv2.threshold(im, 0, 255, cv2.THRESH_BINARY+cv2.THRESH_OTSU)</span><br><span class="line"></span><br><span class="line">titles = [&apos;Origin Noisy Image&apos;, &apos;Histogram&apos;, &apos;Global Thresholding(v=127)&apos;,</span><br><span class="line">          &apos;Origin Noisy Image&apos;, &apos;Histogram&apos;, &apos;Otsu\&apos;s Thresholding&apos;,</span><br><span class="line">          &apos;Gussian filtered Image&apos;, &apos;Histogram&apos;, &apos;Otsu\&apos;s Thresholding&apos;]</span><br><span class="line">images = [im, 0, thresh1,</span><br><span class="line">          im, 0, thresh2,</span><br><span class="line">          blur, 0, thresh3]</span><br><span class="line">for i in range(3):</span><br><span class="line">    # first subplot</span><br><span class="line">    plt.subplot(3,3,i*3+1)</span><br><span class="line">    plt.imshow(images[i*3], &apos;gray&apos;)</span><br><span class="line">    plt.title(titles[i*3])</span><br><span class="line">    plt.xticks([]), plt.yticks([])</span><br><span class="line">    # second subplot</span><br><span class="line">    plt.subplot(3,3,i*3+2)</span><br><span class="line">    plt.hist(images[i*3].ravel(), 256)</span><br><span class="line">    plt.title(titles[i*3+2])</span><br><span class="line">    plt.xticks([]), plt.yticks([])</span><br><span class="line">    # third subplot</span><br><span class="line">    plt.subplot(3,3,i*3+3)</span><br><span class="line">    plt.imshow(images[i*3+2], &apos;gray&apos;)</span><br><span class="line">    plt.title(titles[i*3+2])</span><br><span class="line">    plt.xticks([]), plt.yticks([])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>Result：</p>
<p><img src="/images/otsu-thresholding.png" style="width: 500px;height: 350px"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Geometric Transformations of Images]]></title>
      <url>http://lizonghang.github.io/2016/08/15/Geometric-Transformations-of-Images/</url>
      <content type="html"><![CDATA[<p>OpenCV provides two transformation functions, <code>cv2.warpAffine</code> and <code>cv2.warpPerspective</code>, with which you can have all kinds of transformations. <code>cv2.warpAffine</code> takes a 2x3 transformation matrix while <code>cv2.warpPerspective</code> takes a 3x3 transformation matrix as input.</p>
<h1 id="Scaling"><a href="#Scaling" class="headerlink" title="Scaling"></a>Scaling</h1><p>Scaling is just resizing of the image. OpenCV comes with a function <code>cv2.resize()</code> for this purpose. The size of the image can be specified manually, or you can specify the scaling factor. Different interpolation methods are used. Preferable interpolation methods are <code>cv2.INTER_AREA</code> for shrinking and <code>cv2.INTER_CUBIC</code> (slow) &amp; <code>cv2.INTER_LINEAR</code> for zooming. By default, interpolation method used is <code>cv2.INTER_LINEAR</code> for all resizing purposes. You can resize an input image either of following methods:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;test.png&apos;)</span><br><span class="line">print im.shape</span><br><span class="line"></span><br><span class="line">res = cv2.resize(im, None, fx=2, fy=2, interpolation=cv2.INTER_CUBIC)</span><br><span class="line"># height, width = im.shape[:2]</span><br><span class="line"># res = cv2.resize(im, (2\*width, 2\*height), interpolation=cv2.INTER_CUBIC)</span><br><span class="line">print res.shape</span><br></pre></td></tr></table></figure>
<h1 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h1><p>Translation is the shifting of object’s location. If you know the shift in (x,y) direction, let it be (tx,ty), you can create the transformation matrix M as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">M = [[1, 0, tx],</span><br><span class="line">     [0, 1, ty]]</span><br></pre></td></tr></table></figure>
<p>You can take make it into a Numpy array of type <code>np.float32</code> and pass it into <code>cv2.warpAffine()</code> function. See below example for a shift of (100,50):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">im = cv2.imread(&apos;crop.png&apos;)</span><br><span class="line">rows, cols = im.shape[:2]</span><br><span class="line">M = np.float32([[1,0,100],[0,1,50]])</span><br><span class="line">dst = cv2.warpAffine(im, M, (cols, rows))</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>：The third argument of the <code>cv2.warpAffine()</code> function is the size of the output image, which should be in the form of (width, height). Remember width = number of columns, and height = number of rows.</p>
<h1 id="Rotation"><a href="#Rotation" class="headerlink" title="Rotation"></a>Rotation</h1><p>Rotation of an image for an angle \theta is achieved by the transformation matrix of the form：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">M = [[cosΘ, -sinΘ],</span><br><span class="line">     [sinΘ, cosΘ]]</span><br></pre></td></tr></table></figure>
<p>But OpenCV provides scaled rotation with adjustable center of rotation so that you can rotate at any location you prefer. Modified transformation matrix is given by</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">M = [[α, β, (1-α)*center.x-β*center.y],</span><br><span class="line">     [-β, α, β*center.x+(1-α)*center.y]]</span><br><span class="line"></span><br><span class="line">α = scale.cosΘ</span><br><span class="line">β = scale.sinΘ</span><br></pre></td></tr></table></figure>
<p>To find this transformation matrix, OpenCV provides a function <code>cv2.getRotationMatrix2D</code>. Check below example which rotates the image by 90 degree (anti-clock) with respect to center without any scaling：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">im = cv2.imread(&apos;crop.png&apos;)</span><br><span class="line">rows, cols = im.shape[:2]</span><br><span class="line">M = cv2.getRotationMatrix2D((cols/2,rows/2), 90, 1)</span><br><span class="line">dst = cv2.warpAffine(im, M, (cols,rows))</span><br></pre></td></tr></table></figure>
<h1 id="Affine-Transformation"><a href="#Affine-Transformation" class="headerlink" title="Affine Transformation"></a>Affine Transformation</h1><p>In affine transformation, all parallel lines in the original image will still be parallel in the output image. To find the transformation matrix, we need three points from input image and their corresponding locations in output image. Then <code>cv2.getAffineTransform</code> will create a 2x3 matrix which is to be passed to <code>cv2.warpAffine</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">im = cv2.imread(&apos;crop.png&apos;)</span><br><span class="line">rows, cols = im.shape[:2]</span><br><span class="line">pts1 = np.float32([[50,50],[200,50],[50,200]])</span><br><span class="line">pts2 = np.float32([[10,100],[200,50],[100,250]])</span><br><span class="line">M = cv2.getAffineTransform(pts1, pts2)</span><br><span class="line">dst = cv2.warpAffine(im, M, (cols,rows))</span><br></pre></td></tr></table></figure>
<p>See the output：</p>
<p><img src="/images/affine-transformation.png" alt=""></p>
<h1 id="Perspective-Transformation"><a href="#Perspective-Transformation" class="headerlink" title="Perspective Transformation"></a>Perspective Transformation</h1><p>For perspective transformation, you need a 3x3 transformation matrix. Straight lines will remain straight even after the transformation. To find this transformation matrix, you need 4 points on the input image and corresponding points on the output image. Among these 4 points, 3 of them should not be collinear. Then transformation matrix can be found by the function <code>cv2.getPerspectiveTransform</code>. Then apply <code>cv2.warpPerspective</code> with this 3x3 transformation matrix.</p>
<p>See the code below：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">im = cv2.imread(&apos;nine-square.jpg&apos;)</span><br><span class="line">rows, cols = im.shape[:2]</span><br><span class="line">pts1 = np.float32([(8,85), (480,86), (6,523), (478,525)])</span><br><span class="line">pts2 = np.float32([(0,0), (490, 0), (0,555), (490,555)])</span><br><span class="line">M = cv2.getPerspectiveTransform(pts1, pts2)</span><br><span class="line">dst = cv2.warpPerspective(im, M, (490,555))</span><br></pre></td></tr></table></figure>
<p>Result：</p>
<p><img src="/images/perspective-transformation.png" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Trackbar as the Color Palette]]></title>
      <url>http://lizonghang.github.io/2016/08/14/Trackbar-as-the-Color-Palette/</url>
      <content type="html"><![CDATA[<p>Here we will create a simple application which shows the color you specify. You have a window which shows the color and three trackbars to specify each of B,G,R colors. You slide the trackbar and correspondingly window color changes. By default, initial color will be set to Black.</p>
<p>For <code>cv2.createTrackbar()</code> function, first argument is the trackbar name, second one is the window name to which it is attached, third argument is the default value, fourth one is the maximum value and fifth one is the callback function which is executed everytime trackbar value changes. The callback function always has a default argument which is the trackbar position. In our case, function does nothing, so we simply pass.</p>
<p>Another important application of trackbar is to use it as a button or switch. OpenCV, by default, doesn’t have button functionality. So you can use trackbar to get such functionality. In our application, we have created one switch in which application works only if switch is ON, otherwise screen is always black.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">def callback(x):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"># Create a black image, a window</span><br><span class="line">img = np.zeros((300,512,3), np.uint8)</span><br><span class="line">cv2.namedWindow(&apos;image&apos;)</span><br><span class="line"></span><br><span class="line"># create trackbars for color change</span><br><span class="line">cv2.createTrackbar(&apos;R&apos;,&apos;image&apos;,0,255,callback)</span><br><span class="line">cv2.createTrackbar(&apos;G&apos;,&apos;image&apos;,0,255,callback)</span><br><span class="line">cv2.createTrackbar(&apos;B&apos;,&apos;image&apos;,0,255,callback)</span><br><span class="line"></span><br><span class="line"># create switch for ON/OFF functionality</span><br><span class="line">cv2.createTrackbar(&apos;OFF/ON&apos;, &apos;image&apos;,0,1,callback)</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    cv2.imshow(&apos;image&apos;,img)</span><br><span class="line">    k = cv2.waitKey(1) &amp; 0xFF</span><br><span class="line">    if k == 27:</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">    # get current positions of four trackbars</span><br><span class="line">    r = cv2.getTrackbarPos(&apos;R&apos;,&apos;image&apos;)</span><br><span class="line">    g = cv2.getTrackbarPos(&apos;G&apos;,&apos;image&apos;)</span><br><span class="line">    b = cv2.getTrackbarPos(&apos;B&apos;,&apos;image&apos;)</span><br><span class="line">    s = cv2.getTrackbarPos(&apos;OFF/ON&apos;,&apos;image&apos;)</span><br><span class="line"></span><br><span class="line">    if s == 0:</span><br><span class="line">        img[:] = 0</span><br><span class="line">    else:</span><br><span class="line">        img[:] = [b,g,r]</span><br><span class="line"></span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>The screenshot of the application looks like below :</p>
<p><img src="/images/trackbar-color-palette.png" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Mouse as a Paint-Brush]]></title>
      <url>http://lizonghang.github.io/2016/08/14/Mouse-as-a-Paint-Brush/</url>
      <content type="html"><![CDATA[<h1 id="Simple-Demo"><a href="#Simple-Demo" class="headerlink" title="Simple Demo"></a>Simple Demo</h1><p>Here, we create a simple application which draws plots on an image wherever mouse move on it.</p>
<p>First we create a mouse callback function which is executed when a mouse event take place. Mouse event can be anything related to mouse like left-button down, left-button up, left-button double-click etc. It gives us the coordinates (x,y) for every mouse event. With this event and location, we can do whatever we like. To list all available events available, run the following code in Python terminal:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import cv2</span><br><span class="line">&gt;&gt;&gt; events = [i for i in dir(cv2) if &apos;EVENT&apos; in i]</span><br><span class="line">&gt;&gt;&gt; print events</span><br><span class="line">[&apos;EVENT_FLAG_ALTKEY&apos;, &apos;EVENT_FLAG_CTRLKEY&apos;, &apos;EVENT_FLAG_LBUTTON&apos;,</span><br><span class="line"> &apos;EVENT_FLAG_MBUTTON&apos;, &apos;EVENT_FLAG_RBUTTON&apos;, &apos;EVENT_FLAG_SHIFTKEY&apos;, </span><br><span class="line"> &apos;EVENT_LBUTTONDBLCLK&apos;, &apos;EVENT_LBUTTONDOWN&apos;, &apos;EVENT_LBUTTONUP&apos;, </span><br><span class="line"> &apos;EVENT_MBUTTONDBLCLK&apos;, &apos;EVENT_MBUTTONDOWN&apos;, &apos;EVENT_MBUTTONUP&apos;, </span><br><span class="line"> &apos;EVENT_MOUSEMOVE&apos;, &apos;EVENT_RBUTTONDBLCLK&apos;, &apos;EVENT_RBUTTONDOWN&apos;, </span><br><span class="line"> &apos;EVENT_RBUTTONUP&apos;]</span><br></pre></td></tr></table></figure>
<p>Creating mouse callback function has a specific format which is same everywhere. It differs only in what the function does. So our mouse callback function does one thing, it draws plots where the mouse located. So see the code below. Code is self-explanatory from comments :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line"># mouse callback function</span><br><span class="line">def draw_circle(event,x,y,flags,param):</span><br><span class="line">    if event == cv2.EVENT_MOUSEMOVE:</span><br><span class="line">        cv2.circle(img,(x,y),1,(255,255,255),-1)</span><br><span class="line"></span><br><span class="line"># Create a black image, a window and bind the function to window</span><br><span class="line">img = np.zeros((512,512,3), np.uint8)</span><br><span class="line">cv2.namedWindow(&apos;image&apos;)</span><br><span class="line">cv2.setMouseCallback(&apos;image&apos;,draw_circle)</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    while True:</span><br><span class="line">        cv2.imshow(&apos;image&apos;,img)</span><br><span class="line">        cv2.waitKey(5)</span><br><span class="line">finally:</span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<h1 id="More-Advanced-Demo"><a href="#More-Advanced-Demo" class="headerlink" title="More Advanced Demo"></a>More Advanced Demo</h1><p>Now we go for much more better application. In this, we draw either rectangles or circles (depending on the mode we select) by dragging the mouse like we do in Paint application. So our mouse callback function has two parts, one to draw rectangle and other to draw the circles. This specific example will be really helpful in creating and understanding some interactive applications like object tracking, image segmentation etc.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">drawing = False # true if mouse is pressed</span><br><span class="line">mode = True # if True, draw rectangle. Press &apos;m&apos; to toggle to curve</span><br><span class="line">ix,iy = -1,-1</span><br><span class="line"></span><br><span class="line"># mouse callback function</span><br><span class="line">def draw_circle(event,x,y,flags,param):</span><br><span class="line">    global ix,iy,drawing,mode</span><br><span class="line"></span><br><span class="line">    if event == cv2.EVENT_LBUTTONDOWN:</span><br><span class="line">        drawing = True</span><br><span class="line">        ix,iy = x,y</span><br><span class="line"></span><br><span class="line">    elif event == cv2.EVENT_MOUSEMOVE:</span><br><span class="line">        if drawing == True:</span><br><span class="line">            if mode == True:</span><br><span class="line">                cv2.rectangle(img,(ix,iy),(x,y),(0,255,0),-1)</span><br><span class="line">            else:</span><br><span class="line">                cv2.circle(img,(x,y),5,(0,0,255),-1)</span><br><span class="line"></span><br><span class="line">    elif event == cv2.EVENT_LBUTTONUP:</span><br><span class="line">        drawing = False</span><br><span class="line">        if mode == True:</span><br><span class="line">            cv2.rectangle(img,(ix,iy),(x,y),(0,255,0),-1)</span><br><span class="line">        else:</span><br><span class="line">            cv2.circle(img,(x,y),5,(0,0,255),-1)</span><br></pre></td></tr></table></figure>
<p>Next we have to bind this mouse callback function to OpenCV window. In the main loop, we should set a keyboard binding for key ‘m’ to toggle between rectangle and circle.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">img = np.zeros((512,512,3), np.uint8)</span><br><span class="line">cv2.namedWindow(&apos;image&apos;)</span><br><span class="line">cv2.setMouseCallback(&apos;image&apos;,draw_circle)</span><br><span class="line"></span><br><span class="line">while(1):</span><br><span class="line">    cv2.imshow(&apos;image&apos;,img)</span><br><span class="line">    k = cv2.waitKey(1) &amp; 0xFF</span><br><span class="line">    if k == ord(&apos;m&apos;):</span><br><span class="line">        mode = not mode</span><br><span class="line">    elif k == 27:</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Drawing-Functions-in-OpenCV]]></title>
      <url>http://lizonghang.github.io/2016/08/13/Drawing-Functions-in-OpenCV/</url>
      <content type="html"><![CDATA[<p>In all the above functions, you will see some common arguments as given below:</p>
<ul>
<li>img : The image where you want to draw the shapes</li>
<li>color : Color of the shape. for BGR, pass it as a tuple, eg: (255,0,0) for blue. For grayscale, just pass the scalar value.</li>
<li>thickness : Thickness of the line or circle etc. If -1 is passed for closed figures like circles, it will fill the shape. default thickness = 1</li>
<li>lineType : Type of line, whether 8-connected, anti-aliased line etc. By default, it is 8-connected. <code>cv2.LINE_AA</code> gives anti-aliased line which looks great for curves.</li>
</ul>
<h1 id="Drawing-Line"><a href="#Drawing-Line" class="headerlink" title="Drawing Line"></a>Drawing Line</h1><p>To draw a line, you need to pass starting and ending coordinates of line. We will create a black image and draw a blue line on it from top-left to bottom-right corners.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">im = np.zeros((512,512,3), np.uint8)</span><br><span class="line">cv2.line(im, (0,0), (511,511), (255,0,0), 5)</span><br></pre></td></tr></table></figure>
<h1 id="Drawing-Rectangle"><a href="#Drawing-Rectangle" class="headerlink" title="Drawing Rectangle"></a>Drawing Rectangle</h1><p>To draw a rectangle, you need top-left corner and bottom-right corner of rectangle. This time we will draw a green rectangle at the top-right corner of image.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.rectangle(img,(384,0),(510,128),(0,255,0),3)</span><br></pre></td></tr></table></figure>
<h1 id="Drawing-Circle"><a href="#Drawing-Circle" class="headerlink" title="Drawing Circle"></a>Drawing Circle</h1><p>To draw a circle, you need its center coordinates and radius. We will draw a circle inside the rectangle drawn above.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.circle(im, (447,63), 63, (0,0,255), -1)</span><br></pre></td></tr></table></figure>
<h1 id="Drawing-Ellipse"><a href="#Drawing-Ellipse" class="headerlink" title="Drawing Ellipse"></a>Drawing Ellipse</h1><p>To draw the ellipse, we need to pass several arguments. One argument is the center location (x,y). Next argument is axes lengths (major axis length, minor axis length). <code>angle</code> is the angle of rotation of ellipse in anti-clockwise direction. <code>startAngle</code> and <code>endAngle</code> denotes the starting and ending of ellipse arc measured in clockwise direction from major axis. i.e. giving values 0 and 360 gives the full ellipse. For more details, check the documentation of cv2.ellipse(). Below example draws a half ellipse at the center of the image.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.ellipse(im, (256,256), (100,50), 0, 0, 180, 255, -1)</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>：The angles used in ellipse function is not our circular angles. For more details, visit the discussion below.</p>
<h2 id="Angles-in-Ellipse"><a href="#Angles-in-Ellipse" class="headerlink" title="Angles in Ellipse"></a>Angles in Ellipse</h2><p><code>startangle</code> is taken from positive x axis in clockwise direction and that is same for <code>endangle</code>. If you try this：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">im = np.zeros((512,512,3), np.uint8)</span><br><span class="line">cv2.ellipse(im, (256,256), (100,50), 0, 0, 360, (255,255,255), 1)</span><br><span class="line">cv2.line(im, (0,0), (511,511), (255,255,255), 1)</span><br><span class="line">cv2.line(im, (511,0), (0,511), (255,255,255), 1)</span><br><span class="line">cv2.ellipse(im, (256,256), (100,50), 0, 45, 225, (0,0,255), 2) # Note this</span><br></pre></td></tr></table></figure>
<p>You will get the output as below, the <code>startangle</code> and <code>endangle</code> is not 45° and 225° here：</p>
<p><img src="/images/ellipse-angle.png" style="width: 300px; height: 300px"></p>
<p>It is not a bug, the reason is that it is measured in arc-angles from an ellipse, not from a circle. The phenomen is visualized in paragraph (59) of <a href="http://mathworld.wolfram.com/Ellipse.html" target="_blank" rel="external">http://mathworld.wolfram.com/Ellipse.html</a> . It follows that you cannot compute the angle via atan2(y-center.y,x-center.x) since the points are not lying on a circle.</p>
<p>A solution was to convert the ellipse to a polygon and cut out the area where extremal-points were located, so after <code>cv::ellipse2poly()</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">void cutOut(const std::vector&lt;cv::Point&gt; &amp; pts,</span><br><span class="line">            std::vector&lt;cv::Point&gt; &amp; poly, </span><br><span class="line">            const cv::Point2d &amp; ext1, const cv::Point2d &amp; ext2) const</span><br><span class="line">&#123;</span><br><span class="line">    // whole ellipse</span><br><span class="line">    if ( ext1 == cv::Point2d(0.0,0.0)</span><br><span class="line">         &amp;&amp; ext2 == cv::Point2d(0.0,0.0) )</span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // get closest points on ellipse to given extremal points</span><br><span class="line">    double min1 = std::numeric_limits&lt;double&gt;::max();</span><br><span class="line">    double min2 = std::numeric_limits&lt;double&gt;::max();</span><br><span class="line">    int min_ind1, min_ind2;</span><br><span class="line">    for( size_t i = 0; i &lt; pts.size(); i++ ) &#123;</span><br><span class="line">        double n1 = cv::norm(cv::Point2d(pts[i].x,pts[i].y) - ext1);</span><br><span class="line">        if ( n1 &lt; min1 ) &#123;</span><br><span class="line">            min_ind1 = i;</span><br><span class="line">            min1 = n1;</span><br><span class="line">        &#125;</span><br><span class="line">        double n2 = cv::norm(cv::Point2d(pts[i].x,pts[i].y) - ext2);</span><br><span class="line">        if ( n2 &lt; min2 ) &#123;</span><br><span class="line">            min_ind2 = i;</span><br><span class="line">            min2 = n2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // copy points to poly</span><br><span class="line">    if ( min_ind2 == min_ind1 ) &#123;</span><br><span class="line">        poly = pts;</span><br><span class="line">    &#125;</span><br><span class="line">    if ( min_ind2 &lt; min_ind1 ) &#123;</span><br><span class="line">        poly.insert(poly.begin(), pts.begin()+min_ind1, pts.end());</span><br><span class="line">        poly.insert(poly.end(),pts.begin(), pts.begin()+min_ind2+1);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        poly.insert(poly.begin(), pts.begin()+min_ind1, pts.begin()+min_ind2+1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This solution is from <a href="http://stackoverflow.com/questions/197649/how-to-calculate-center-of-an-ellipse-by-two-points-and-radius-sizes" target="_blank" rel="external">stackoverflow</a>, however a little dirty.</p>
<h1 id="Drawing-Polygon"><a href="#Drawing-Polygon" class="headerlink" title="Drawing Polygon"></a>Drawing Polygon</h1><p>To draw a polygon, first you need coordinates of vertices. Make those points into an array of shape <code>ROWSx1x2</code> where ROWS are number of vertices and it should be of type <code>int32</code>. Here we draw a small polygon of with four vertices in yellow color.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pts = np.array([[10,5], [20,30], [70,20], [50,10]], np.int32).reshape((-1,1,2))</span><br><span class="line">cv2.polylines(im, [pts], True, (0,255,255))</span><br></pre></td></tr></table></figure>
<p><strong>Notes</strong>：If third argument is False, you will get a polylines joining all the points, not a closed shape.</p>
<p><strong>Notes</strong>：<code>cv2.polylines()</code> can be used to draw multiple lines. Just create a list of all the lines you want to draw and pass it to the function. All lines will be drawn individually. It is more better and faster way to draw a group of lines than calling <code>cv2.line()</code> for each line.</p>
<h1 id="Adding-Text-to-Images"><a href="#Adding-Text-to-Images" class="headerlink" title="Adding Text to Images"></a>Adding Text to Images</h1><p>To put texts in images, you need specify following things：</p>
<ul>
<li>Text data that you want to write</li>
<li>Position coordinates of where you want put it (i.e. left-bottom corner where data starts).</li>
<li>Font type (Check <code>cv2.putText()</code> docs for supported fonts)</li>
<li>Font Scale (specifies the size of font)</li>
<li>regular things like color, thickness, lineType etc.</li>
</ul>
<p>We will write OpenCV on our image in white color.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">font = cv2.FONT_HERSHEY_SIMPLEX</span><br><span class="line">cv2.putText(img,&apos;OpenCV&apos;,(10,500), font, 4,(255,255,255),2)</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[BadApple视频转字符动画]]></title>
      <url>http://lizonghang.github.io/2016/08/06/BadApple%E8%A7%86%E9%A2%91%E8%BD%AC%E5%AD%97%E7%AC%A6%E5%8A%A8%E7%94%BB/</url>
      <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>&emsp;&emsp;实现 badapple.mp4 视频转字符动画，在终端显示字符动画。原理比较简单，使用终端命令 <code>ffmpeg</code> 从视频中抽取帧保存为图片，使用函数 <code>image2txt()</code> 将图片转化为字符画，最后使用终端命令 <code>cat</code> 输出字符动画。<br>&emsp;&emsp;源代码、帧图片、txt文本集可以从<a href="https://github.com/Lizonghang/Python-BadApple" target="_blank" rel="external">Github</a>中获取，badapple.mp4 可以从<a href="http://yun.baidu.com/s/1cLvjHG" target="_blank" rel="external">百度云</a>获取。通常视频是以 1 秒 24 帧图片组成的，为了节省时间与容量，采样的帧图片为 1 秒 10 帧，最终字符动画播放流畅，对质量无明显影响。若依旧要采用 1 秒 24 帧，可以修改 getImage.py 中的参数，修改方法见下文。<br>&emsp;&emsp;需要确保已经安装有第三方库 <code>PIL</code> 与 <code>numpy</code>，以及 <code>ffmpeg</code> 插件(可通过 Homebrew 安装)。</p>
<h1 id="运行方法"><a href="#运行方法" class="headerlink" title="运行方法"></a>运行方法</h1><p>本项目完整的包内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">badapple</span><br><span class="line">├── README.md</span><br><span class="line">├── getImage.py</span><br><span class="line">├── image2txt.py</span><br><span class="line">├── play.py</span><br><span class="line">├── images</span><br><span class="line">│   └── *.png</span><br><span class="line">└── txt</span><br><span class="line">    └── *.txt</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;getImage.py 用于从视频中提取帧图片，提取的帧图片存放于 images/ 文件夹，有 2190 张帧图片，若文件夹中已存在帧图片可不运行该程序。若要调整每帧图片数可调整变量 <code>crop_time</code> 累加的数值，清空已存在的图片集，修改视频路径(<code>videoPath</code>)、帧图片目录路径(<code>imagePath</code>)，再运行 getImage.py。由于调用的 <code>ffmpeg</code> 命令会输出很多信息，若要屏蔽这些信息可以修改 <code>os.system()</code> 中的命令，更换标准输出到文件。只需确保有对应图片生成即可。<br>&emsp;&emsp;image2txt.py 用于将图片转化为一定尺寸的字符画，从 images/ 文件夹中提取图片并转化为 txt 文本存放于 txt/ 文件夹。默认要求的终端尺寸为 300x75 ，若屏幕不能支持该大小，可以将参数 <code>charWidth</code> 修改为自定义的每行显示字符数，调整后若运行 play.py 要求终端大小为 (charWidth)x(charWidth/4) 。<br>&emsp;&emsp;play.py 用于获取 txt 文本集与依次显示 txt 文本集，以达到在终端播放字符动画的效果。运行之前请修改视频目录(<code>videoPath</code>)、txt文件夹目录(<code>txt_dir_path</code>)、images文件夹目录(<code>img_dir_path</code>)。若选择默认的终端大小 300x75 运行该程序，请先注释掉 <code>getTxt(img_dir_path, txt_dir_path)</code>，然后运行 play.py。若选择自定义的终端大小运行该程序，需要自行调整终端大小为 (charWidth)x(charWidth/4)，不注释 <code>getTxt(img_dir_path, txt_dir_path)</code>，然后运行 play.py，这需要稍等 10~60 秒。随后就能在终端显示字符动画。</p>
<p><strong>注意</strong>：自定义的 <code>charWidth</code> 过小则会降低播放质量，过大则会出现终端闪烁现象。需要根据实际情况调整 <code>charWidth</code>。<br><strong>注意</strong>：若修改了每帧播放的图片数目，则需要修改 play.py 中的 <code>time.sleep()</code> 数值，这是一个经验数值，用于和视频播放速度同步，修改该数值可加速或减缓字符动画播放速率。</p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><h2 id="getImage-py"><a href="#getImage-py" class="headerlink" title="getImage.py"></a>getImage.py</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">def getImage(videoPath, imagePath):</span><br><span class="line">    img_count = 1</span><br><span class="line">    crop_time = 0.0</span><br><span class="line">    while crop_time &lt;= 219.0:</span><br><span class="line">        os.system(&apos;ffmpeg -i %s -f image2 -ss %s -vframes 1 %s.png&apos; % (videoPath, str(crop_time), imagePath + str(img_count)))</span><br><span class="line">        img_count += 1</span><br><span class="line">        print &apos;Geting Image &apos; + str(img_count) + &apos;.png&apos; + &apos; from time &apos; + str(crop_time)</span><br><span class="line">        crop_time += 0.1</span><br><span class="line">    print &apos;Image Collected&apos;</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    videoPath = &apos;/Users/mac/Desktop/badapple.avi&apos;</span><br><span class="line">    imagePath = &apos;/Users/mac/Desktop/badapple/images/&apos;</span><br><span class="line">    getImage(videoPath, imagePath)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;该模块用于从视频文件中抽取帧图片，<code>crop_time</code> 为抽取帧的时间，单位为秒，默认从 0 秒开始抽取，直到截取时间到达视频结束时间(219秒)。抽取帧图片使用了终端命令 <code>ffmpeg</code> 。输入文件为 badapple.mp4，输出格式为 <code>image2</code> 图片格式，截取时间为 0.0 秒，帧数为 1 ，输出图片为 1.png ： <code>ffmpeg -i badapple.mp4 -f image2 -ss 0.0 -vframes 1 1.png</code>。<br>&emsp;&emsp;<code>crop_time += 0.1</code> 中的累加数值表示 1 秒获取 1/0.1 张帧图片，调整该值将改变每秒获取的帧数目。<br>&emsp;&emsp;图片存储从 1.png 开始依次累增，直到 2190.png。<br>&emsp;&emsp;<code>videoPath</code> 为视频文件路径， <code>imagePath</code> 为图片文件夹路径。该模块可直接运行，运行之前先确认路径正确。如果已经有图片集，不需要运行该模块。</p>
<h2 id="image2txt-py"><a href="#image2txt-py" class="headerlink" title="image2txt.py"></a>image2txt.py</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line">import numpy</span><br><span class="line"></span><br><span class="line">def image2txt(inputFile, outputFile):</span><br><span class="line">    im = Image.open(inputFile).convert(&apos;L&apos;)</span><br><span class="line">    charWidth = 300</span><br><span class="line">    im = im.resize((charWidth, charWidth / 4))</span><br><span class="line">    target_width, target_height = im.size</span><br><span class="line">    data = numpy.array(im)[:target_height, :target_width]</span><br><span class="line">    f = open(outputFile, &apos;w&apos;)</span><br><span class="line">    for row in data:</span><br><span class="line">        for pixel in row:</span><br><span class="line">            if pixel &gt; 127:</span><br><span class="line">                f.write(&apos;#&apos;)</span><br><span class="line">            else:</span><br><span class="line">                f.write(&apos; &apos;)</span><br><span class="line">        f.write(&apos;\n&apos;)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;该模块用于将图片转化为字符画，转化前先将图片转化为灰度图，并将图片“变扁”以适应输出字符画与原画的比例，经验数据高度应为宽度的 1/4 。随后将大于阈值的像素写入’#’，小于阈值的像素写入’ ‘，默认阈值为 127。输出时，’#’ 表示白色，’ ‘ 表示黑色。写入的 txt 文件名需要与对应图片文件名对应，如 ‘1.png’ 对应 ‘1.txt’。转化后的 txt 文件存放于 txt/ 文件夹中。<br>&emsp;&emsp;<code>charWidth</code> 表示终端每行输出的字符数，数值需要根据实际需求调整，默认适应的终端大小为 300x75。</p>
<h2 id="play-py"><a href="#play-py" class="headerlink" title="play.py"></a>play.py</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import sys, os</span><br><span class="line">import image2txt</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def getTxt(imagePath, txtPath):</span><br><span class="line">    img_count = 1</span><br><span class="line">    while img_count &lt;= len(os.listdir(imagePath)):</span><br><span class="line">        imageFile = imagePath + str(img_count) + &apos;.png&apos;</span><br><span class="line">        txtFile = txtPath + str(img_count) + &apos;.txt&apos;</span><br><span class="line">        image2txt.image2txt(imageFile, txtFile)</span><br><span class="line">        print &apos;txt &apos; + str(img_count) + &apos; collected.&apos;</span><br><span class="line">        img_count += 1</span><br><span class="line"></span><br><span class="line">def play(txtPath):</span><br><span class="line">    txt_count = 1</span><br><span class="line">    while txt_count &lt;= len(os.listdir(txtPath)):</span><br><span class="line">        os.system(&apos;cat &apos; + txtPath + str(txt_count) + &apos;.txt&apos;)</span><br><span class="line">        time.sleep(1.0/11.25)</span><br><span class="line">        txt_count += 1</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    txt_dir_path = &apos;/Users/mac/Desktop/badapple/txt/&apos;</span><br><span class="line">    img_dir_path = &apos;/Users/mac/Desktop/badapple/images/&apos;</span><br><span class="line">    getTxt(img_dir_path, txt_dir_path)</span><br><span class="line">    play(txt_dir_path)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;该模块是主要模块，用于在终端播放字符动画。播放前先按照 <code>charWidth</code> 的数值将帧图片集转换为字符集(若使用默认的 300x75 则忽略该步骤，注释掉函数 <code>getTxt(…)</code> 即可；若使用自定义比例，需要 10~60 秒等待时间)。然后使用终端命令 <code>cat</code> 依次输出各个 txt 文本中的字符画，输出的时间间隔是经验数值，可根据实际播放速度调整，加速或减缓播放速率以和原视频同步。<br>&emsp;&emsp;运行该模块前需要确保 txt/ 文件夹路径与 images/ 文件夹路径正确。</p>
<h1 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h1><p>&emsp;&emsp;左边是终端窗口，右边是 Quicktime Player，显示屏是电视显示屏。当初应该直接用 Quicktime Player 屏幕录制的，有点后悔，就将就看了吧。某些细节不必在意。效果展示在<a href="https://pan.baidu.com/s/1hs0kp0K" target="_blank" rel="external">百度云</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[自动化测试模型]]></title>
      <url>http://lizonghang.github.io/2016/08/04/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E6%A8%A1%E5%9E%8B/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;一个自动化测试框架就是一个集成体系，在这一体系中包含测试功能的函数库、测试数据源、测试对象识别标准、以及多种可重用的模块。自动化测试框架在发展的过程中经历了几个阶段：模块驱动测试、数据驱动测试、对象驱动测试。</p>
<h1 id="自动化测试模型"><a href="#自动化测试模型" class="headerlink" title="自动化测试模型"></a>自动化测试模型</h1><p>&emsp;&emsp;自动化测试模型是自动化测试架构的基础，自动化测试的发展也经历了不同的阶段，不断有新的模型（概念）被提出，了解和使用这些自动化模型有利于构建一个灵活可维护的自动化架构。</p>
<h2 id="线性测试"><a href="#线性测试" class="headerlink" title="线性测试"></a>线性测试</h2><p>&emsp;&emsp;通过录制或编写脚本，一个脚本完成一个场景（一组完整功能操作），通过对脚本的回放来进行自动化测试。这是早期进行自动化测试的一种形式。例如在<a href="/2016/08/03/Selenium模拟操作实例/">模拟登陆实例</a>中的脚本就是线性测试形式。它的优势是每个脚本都是独立的，任何一个脚本文件可以单独运行。缺点是用例的开发与维护成本很高：</p>
<ul>
<li>一个用例对应一个脚本。如果登陆发送变化，例如用户名的属性发生改变，就不得不对每个脚本进行修改。测试用例形成规模，大量的工作被用于脚本的维护，从而失去自动化的意义。</li>
<li>这种模式下数据和脚本是混合在一起的，如果数据发生改变就需要修改脚本。这种模式下，脚本没有可重复使用的概念。</li>
</ul>
<h2 id="模块化与类库"><a href="#模块化与类库" class="headerlink" title="模块化与类库"></a>模块化与类库</h2><p>&emsp;&emsp;在脚本中有很多内容是重复的，于是可以将重复的部分写成公共模块，在需要的时候进行调用，这样就提高了编写脚本的效率。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># login.py</span><br><span class="line">def login():</span><br><span class="line">    driver.find_element_by_id(&quot;username&quot;).send_keys(&quot;username&quot;)</span><br><span class="line">    driver.find_element_by_id(&quot;password&quot;).send_keys(&quot;password&quot;)</span><br><span class="line">    driver.find_element_by_id(&quot;btnLogin&quot;).click()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># quit.py</span><br><span class="line">def quit():</span><br><span class="line">    driver.find_element_by_id(&quot;btnQuit&quot;).click()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">import login, quit</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(&apos;http://www.ooxx.com&apos;)</span><br><span class="line">login.login()</span><br><span class="line">quit.quit()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;通过上述不完整样例发现，可以将脚本中相同的部分代码独立出来形成模块或库。这样做有两方面优点：</p>
<ul>
<li>提高了开发效率，不用重复编写相同的脚本。之后需要时调用已写好的模块即可。</li>
<li>方便代码的维护。如果某个模块发生变化，只需要修改对应模块的代码即可。</li>
</ul>
<h2 id="数据驱动"><a href="#数据驱动" class="headerlink" title="数据驱动"></a>数据驱动</h2><p>&emsp;&emsp;数据驱动是自动化的进步，数据的改变驱动自动化的执行，从而引起测试结果的改变。简单的说，通过输入数据的不同引起输出结果的变化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.keys import Keys</span><br><span class="line">import time</span><br><span class="line">values = [&apos;selenium&apos;, &apos;webdriver&apos;]</span><br><span class="line">for search in values:</span><br><span class="line">    driver = webdriver.Chrome()</span><br><span class="line">    driver.get(http://www.baidu.com)</span><br><span class="line">    driver.find_element_by_id(&apos;kw&apos;).send_keys(search, Keys.RETURN)</span><br><span class="line">    time.sleep(3)</span><br><span class="line">    driver.close()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;读取的数据源可能是数组、字典、函数、CSV或TXT文件，上面的例子实现了数据与脚本的分离，实现了参数化。同样的脚本执行不同的数据得到不同的结果，从而增强了脚本的复用性。</p>
<h2 id="关键字驱动"><a href="#关键字驱动" class="headerlink" title="关键字驱动"></a>关键字驱动</h2><p>&emsp;&emsp;关键词驱动就是通过关键字的改变引起测试结果改变。QTP、robot framework 等都是以关键字驱动为主的自动化工具，因为这类工具的易用性，‘填表’式的关键字驱动帮助封装了很多底层的东西，测试人员只需要考虑三个问题：做什么、对谁做、怎么做。可以将 Selenium IDE 看做一种关键字驱动的自动化工具，Selenium IDE 脚本分：命令（command）、对象（target）、值（value），通过这样的格式去描述不同的对象，从而引起结果的改变。</p>
<h1 id="登陆模块化"><a href="#登陆模块化" class="headerlink" title="登陆模块化"></a>登陆模块化</h1><p>&emsp;&emsp;在目前的脚本中有很多代码是可以模块化的，比如登陆模块。几乎每一个用例的执行都需要登陆脚本，那么久可以将登陆脚本独立到单独的文件调用。以<a href="/2016/08/03/Selenium模拟操作实例/#模拟百度登入登出">模拟百度登入登出</a>为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># login.py</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.common.exceptions import NoSuchElementException</span><br><span class="line"></span><br><span class="line">def login(self):</span><br><span class="line">    driver = self.driver</span><br><span class="line">    driver.find_element_by_id(&apos;u1&apos;).find_element_by_name(&apos;tj_login&apos;).click()</span><br><span class="line">    try:</span><br><span class="line">        usernameInput = driver.find_element_by_id(&apos;TANGRAM__PSP_8__userName&apos;)</span><br><span class="line">        passwordInput = driver.find_element_by_id(&apos;TANGRAM__PSP_8__password&apos;)</span><br><span class="line">        usernameInput.clear()</span><br><span class="line">        passwordInput.clear()</span><br><span class="line">        usernameInput.send_keys(self.username)</span><br><span class="line">        passwordInput.send_keys(self.password)</span><br><span class="line">        driver.find_element_by_id(&apos;TANGRAM__PSP_8__submit&apos;).submit()</span><br><span class="line">    except NoSuchElementException as msg:</span><br><span class="line">        return False</span><br><span class="line">    return True</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># baidu.py</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.action_chains import ActionChains</span><br><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line">import unittest, time</span><br><span class="line">import login</span><br><span class="line"></span><br><span class="line">class Login(unittest.TestCase):</span><br><span class="line"></span><br><span class="line">    def setUp(self):</span><br><span class="line">        self.driver = webdriver.Chrome()</span><br><span class="line">        self.driver.implicitly_wait(5)</span><br><span class="line">        self.username = &apos;username&apos;</span><br><span class="line">        self.password = &apos;password&apos;</span><br><span class="line"></span><br><span class="line">    def test_login(self):</span><br><span class="line">        driver = self.driver</span><br><span class="line">        driver.get(&apos;https://www.baidu.com&apos;)</span><br><span class="line">        if login.login(self):</span><br><span class="line">            ActionChains(driver).move_to_element(driver.find_element_by_id(&apos;s_username_top&apos;)).perform()</span><br><span class="line">            ActionChains(driver).move_to_element(driver.find_element_by_class_name(&apos;quit&apos;)).click().perform()</span><br><span class="line">            ActionChains(driver).move_to_element(driver.find_elements_by_xpath(&apos;//div[@class=&quot;button-wrap&quot;]/a&apos;)[2]).click().perform()</span><br><span class="line">            time.sleep(3)</span><br><span class="line"></span><br><span class="line">    def tearDown(self):</span><br><span class="line">        self.driver.quit()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<h1 id="数据驱动-1"><a href="#数据驱动-1" class="headerlink" title="数据驱动"></a>数据驱动</h1><h2 id="数据参数化"><a href="#数据参数化" class="headerlink" title="数据参数化"></a>数据参数化</h2><p>&emsp;&emsp;在上面关于数据驱动的介绍中已经示例了使用数组进行参数化设置，这里将通过读取 txt 文件中的数据来实现参数化。</p>
<p>创建一个 data.txt 文件，文件内有三行数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">selenium</span><br><span class="line">webdriver</span><br><span class="line">bokeyuan</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;通过 for 循环，search 可以每次获取到文件中的一行数据，在定位到百度搜索框后将数据传入 send_keys()。这样通过循环调用，直到文件中的所有内容被读取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.keys import Keys</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">source = open(&apos;data.txt&apos;)</span><br><span class="line">values = source.readlines()</span><br><span class="line">source.close()</span><br><span class="line">for search in values:</span><br><span class="line">    driver = webdriver.Chrome()</span><br><span class="line">    driver.get(&apos;http://www.baidu.com&apos;)</span><br><span class="line">    driver.find_element_by_id(&apos;kw&apos;).send_keys(search, Keys.RETURN)</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    driver.close()</span><br></pre></td></tr></table></figure>
<h2 id="登录参数化-读取txt文件"><a href="#登录参数化-读取txt文件" class="headerlink" title="登录参数化(读取txt文件)"></a>登录参数化(读取txt文件)</h2><p>&emsp;&emsp;按照上述思路，对自动化脚本中用户名、密码进行参数化。创建 userdata.txt 文件，存放用户名和密码，假设存放格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username1 password1</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在之前编写的 login.py 文件基础上作如下修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.common.exceptions import NoSuchElementException</span><br><span class="line"></span><br><span class="line">source = open(&apos;userdata.txt&apos;)</span><br><span class="line">username, password = source.readlines()[0].split()</span><br><span class="line">source.close()</span><br><span class="line"></span><br><span class="line">def login(self):</span><br><span class="line">    driver = self.driver</span><br><span class="line">    driver.find_element_by_id(&apos;u1&apos;).find_element_by_name(&apos;tj_login&apos;).click()</span><br><span class="line">    try:</span><br><span class="line">        usernameInput = driver.find_element_by_id(&apos;TANGRAM__PSP_8__userName&apos;)</span><br><span class="line">        passwordInput = driver.find_element_by_id(&apos;TANGRAM__PSP_8__password&apos;)</span><br><span class="line">        usernameInput.clear()</span><br><span class="line">        passwordInput.clear()</span><br><span class="line">        usernameInput.send_keys(username)</span><br><span class="line">        passwordInput.send_keys(password)</span><br><span class="line">        driver.find_element_by_id(&apos;TANGRAM__PSP_8__submit&apos;).submit()</span><br><span class="line">    except NoSuchElementException as msg:</span><br><span class="line">        return False</span><br><span class="line">    return True</span><br></pre></td></tr></table></figure>
<h2 id="登录参数化-函数"><a href="#登录参数化-函数" class="headerlink" title="登录参数化(函数)"></a>登录参数化(函数)</h2><p>&emsp;&emsp;函数可以预先给参数化赋值，借助这个特性，可以通过调用函数对用户名和密码进行参数化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># userinfo.py</span><br><span class="line">def Tester_Li(username=&apos;testusername&apos;, password=&apos;testpassword&apos;):</span><br><span class="line">    return username, password</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;通过给函数参数赋予默认值并返回的方法可以在函数中存储一些信息。再次修改 login.py 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># login.py</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.common.exceptions import NoSuchElementException</span><br><span class="line">import userinfo</span><br><span class="line"></span><br><span class="line">username, password = userinfo.Tester_Li()</span><br><span class="line"></span><br><span class="line">def login(self):</span><br><span class="line">    driver = self.driver</span><br><span class="line">    driver.find_element_by_id(&apos;u1&apos;).find_element_by_name(&apos;tj_login&apos;).click()</span><br><span class="line">    try:</span><br><span class="line">        usernameInput = driver.find_element_by_id(&apos;TANGRAM__PSP_8__userName&apos;)</span><br><span class="line">        passwordInput = driver.find_element_by_id(&apos;TANGRAM__PSP_8__password&apos;)</span><br><span class="line">        usernameInput.clear()</span><br><span class="line">        passwordInput.clear()</span><br><span class="line">        usernameInput.send_keys(username)</span><br><span class="line">        passwordInput.send_keys(password)</span><br><span class="line">        driver.find_element_by_id(&apos;TANGRAM__PSP_8__submit&apos;).submit()</span><br><span class="line">    except NoSuchElementException as msg:</span><br><span class="line">        return False</span><br><span class="line">    return True</span><br></pre></td></tr></table></figure>
<h2 id="登录参数化-读取字典"><a href="#登录参数化-读取字典" class="headerlink" title="登录参数化(读取字典)"></a>登录参数化(读取字典)</h2><p>&emsp;&emsp;使用一个函数来存储字典，假设文件名为 userinfo.py：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># userinfo.py</span><br><span class="line">def getUserInfo():</span><br><span class="line">    data = &#123;</span><br><span class="line">    &apos;Tester_Li&apos;: &#123;&apos;username&apos;: &apos;Li_username&apos;, &apos;password&apos;: &apos;Li_password&apos;&#125;,</span><br><span class="line">    &apos;Tester_Wang&apos;: &#123;&apos;username&apos;: &apos;Wang_username&apos;, &apos;password&apos;: &apos;Wang_password&apos;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    return data</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># login.py</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.common.exceptions import NoSuchElementException</span><br><span class="line">import userinfo</span><br><span class="line"></span><br><span class="line">info_dict = userinfo.getUserInfo()[&apos;Tester_Li&apos;]</span><br><span class="line">username = info_dict[&apos;username&apos;]</span><br><span class="line">password = info_dict[&apos;password&apos;]</span><br><span class="line"></span><br><span class="line">def login(self):</span><br><span class="line">    driver = self.driver</span><br><span class="line">    driver.find_element_by_id(&apos;u1&apos;).find_element_by_name(&apos;tj_login&apos;).click()</span><br><span class="line">    try:</span><br><span class="line">        usernameInput = driver.find_element_by_id(&apos;TANGRAM__PSP_8__userName&apos;)</span><br><span class="line">        passwordInput = driver.find_element_by_id(&apos;TANGRAM__PSP_8__password&apos;)</span><br><span class="line">        usernameInput.clear()</span><br><span class="line">        passwordInput.clear()</span><br><span class="line">        usernameInput.send_keys(username)</span><br><span class="line">        passwordInput.send_keys(password)</span><br><span class="line">        driver.find_element_by_id(&apos;TANGRAM__PSP_8__submit&apos;).submit()</span><br><span class="line">    except NoSuchElementException as msg:</span><br><span class="line">        return False</span><br><span class="line">    return True</span><br></pre></td></tr></table></figure>
<h2 id="表单参数化-CSV"><a href="#表单参数化-CSV" class="headerlink" title="表单参数化(CSV)"></a>表单参数化(CSV)</h2><p>&emsp;&emsp;假设自动化脚本中要参数化一张表单，表单需要填写用户名、邮箱、年龄、性别等信息，就适合用读取 CSV 文件的方法来解决。创建 userinfo.csv 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laowang,123456@126.com,23,男,</span><br><span class="line">xiaoli,123123@qq.com, 18, 女,</span><br><span class="line">xiaomin,456123@gmail.com, 29,女,</span><br></pre></td></tr></table></figure>
<p>使用 csv 库来读取 CSV 文件中的数据并格式化输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br><span class="line">import csv</span><br><span class="line">for user in csv.reader(file(&apos;userinfo.csv&apos;, &apos;rb&apos;)):</span><br><span class="line">    print &apos;Name: %s, Mail: %s, Age: %s, Sex: %s&apos; % tuple(user[0:4])</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Name: laowang, Mail: 123456@126.com, Age: 23, Sex: 男</span><br><span class="line">Name: xiaoli, Mail: 123123@qq.com, Age:  18, Sex:  女</span><br><span class="line">Name: xiaomin, Mail: 456123@gmail.com, Age:  29, Sex: 女</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;csv.reader() 用于读取 CSV 文件，每一次循环的 user 变量是一个列表，可以通过 user[index] 来读取其中的数据，上面将 user 中的数据抽取出来并转换为元组来简化代码。通过 csv 读取文件比较灵活，可以循环读取每一条数据，又不局限每次读取数据的个数。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Selenium模拟操作实例]]></title>
      <url>http://lizonghang.github.io/2016/08/03/Selenium%E6%A8%A1%E6%8B%9F%E6%93%8D%E4%BD%9C%E5%AE%9E%E4%BE%8B/</url>
      <content type="html"><![CDATA[<h1 id="模拟百度登入登出"><a href="#模拟百度登入登出" class="headerlink" title="模拟百度登入登出"></a>模拟百度登入登出</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.keys import Keys</span><br><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line">from selenium.webdriver.common.action_chains import ActionChains</span><br><span class="line">from selenium.webdriver.common.alert import Alert</span><br><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(&apos;https://www.baidu.com&apos;)</span><br><span class="line">try:</span><br><span class="line">    driver.find_element_by_id(&apos;u1&apos;).find_element_by_name(&apos;tj_login&apos;).click()</span><br><span class="line">    WebDriverWait(driver, 3).until(EC.presence_of_element_located((By.ID, &apos;TANGRAM__PSP_8__userName&apos;)))</span><br><span class="line">    driver.find_element_by_id(&apos;TANGRAM__PSP_8__userName&apos;).send_keys(&apos;username&apos;)</span><br><span class="line">    driver.find_element_by_id(&apos;TANGRAM__PSP_8__password&apos;).send_keys(&apos;password&apos;)</span><br><span class="line">    driver.find_element_by_id(&apos;TANGRAM__PSP_8__submit&apos;).submit()</span><br><span class="line">    WebDriverWait(driver, 3).until(EC.presence_of_element_located((By.ID, &apos;s_username_top&apos;)))</span><br><span class="line">    ActionChains(driver).move_to_element(driver.find_element_by_id(&apos;s_username_top&apos;)).perform()</span><br><span class="line">    ActionChains(driver).move_to_element(driver.find_element_by_class_name(&apos;quit&apos;)).click().perform()</span><br><span class="line">    WebDriverWait(driver, 3).until(EC.presence_of_element_located((By.CLASS_NAME, &apos;button-wrap&apos;)))</span><br><span class="line">    ActionChains(driver).move_to_element(driver.find_elements_by_xpath(&apos;//div[@class=&quot;button-wrap&quot;]/a&apos;)[2]).click().perform()</span><br><span class="line">    time.sleep(3)</span><br><span class="line">finally:</span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>
<h1 id="模拟问卷星发布问卷"><a href="#模拟问卷星发布问卷" class="headerlink" title="模拟问卷星发布问卷"></a>模拟问卷星发布问卷</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.keys import Keys</span><br><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line">from selenium.common.exceptions import NoSuchElementException</span><br><span class="line">from selenium.webdriver.support.select import Select</span><br><span class="line">from selenium.webdriver.common.alert import Alert</span><br><span class="line">import time, sys</span><br><span class="line"></span><br><span class="line"># settings</span><br><span class="line">username = &apos;username&apos;</span><br><span class="line">password = &apos;password&apos;</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.implicitly_wait(5)</span><br><span class="line">driver.get(&apos;http://www.baidu.com&apos;)</span><br><span class="line">driver.find_element_by_id(&apos;kw&apos;).send_keys(u&apos;问卷星&apos;, Keys.RETURN)</span><br><span class="line">driver.find_element_by_xpath(&apos;//div[@id=&quot;1&quot;]/h3&apos;).click()</span><br><span class="line">driver.switch_to_window(driver.window_handles[1])</span><br><span class="line">driver.find_element_by_id(&apos;ctl00_liLogin&apos;).click()</span><br><span class="line">time.sleep(1)</span><br><span class="line">username = driver.find_element_by_id(&apos;ctl00_ContentPlaceHolder1_UserName&apos;)</span><br><span class="line">password = driver.find_element_by_id(&apos;ctl00_ContentPlaceHolder1_Password&apos;)</span><br><span class="line">username.clear()</span><br><span class="line">password.clear()</span><br><span class="line">username.send_keys(username)</span><br><span class="line">password.send_keys(password, Keys.RETURN)</span><br><span class="line"></span><br><span class="line"># 登陆时可能出现验证码</span><br><span class="line">try:</span><br><span class="line">    driver.find_element_by_xpath(&apos;//div[@id=&quot;ctl01_ContentPlaceHolder1_divInfo&quot;]/div/div/span/a&apos;).click()</span><br><span class="line">except NoSuchElementException:</span><br><span class="line">    print u&apos;出现验证码，程序退出&apos;</span><br><span class="line">    sys.exit(0)</span><br><span class="line"></span><br><span class="line">driver.find_element_by_xpath(&apos;//ul[@class=&quot;CR-Obox&quot;]/li/a&apos;).click()</span><br><span class="line">driver.find_elements_by_xpath(&apos;//div[@id=&quot;divSearchResult&quot;]/ul/li&apos;)[0].click()</span><br><span class="line">driver.find_element_by_class_name(&apos;MOM-bottom&apos;).click()</span><br><span class="line"></span><br><span class="line"># 新建问卷时可能出现验证码</span><br><span class="line">try:</span><br><span class="line">    driver.find_element_by_id(&apos;hrefFiQ&apos;).click()</span><br><span class="line">except NoSuchElementException:</span><br><span class="line">    print u&apos;出现验证码，程序退出&apos;</span><br><span class="line">    sys.exit(0)</span><br><span class="line"></span><br><span class="line">select = Select(driver.find_element_by_xpath(&apos;//select[@id=&quot;ddlActivity&quot;]&apos;))</span><br><span class="line">print u&apos;新建的问卷名为: &apos;, select.first_selected_option.text</span><br><span class="line">driver.find_element_by_xpath(&apos;//ul[@class=&quot;BS-menu&quot;]/li&apos;).click()</span><br><span class="line">driver.find_elements_by_xpath(&apos;//tr&apos;)[0].find_element_by_class_name(&apos;delete&apos;).click()</span><br><span class="line">Alert(driver).accept()</span><br><span class="line">driver.find_elements_by_xpath(&apos;//ul[@class=&quot;BS-menu&quot;]/li&apos;)[-1].click()</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Selenium-WebDriverAPI]]></title>
      <url>http://lizonghang.github.io/2016/08/01/Selenium-WebDriverAPI/</url>
      <content type="html"><![CDATA[<p><strong>Recommended Import Style</strong></p>
<p>The API definitions in this chapter shows the absolute location of classes. However the recommended import style is as given below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium import  webdriver</span><br></pre></td></tr></table></figure>
<p>The special keys class (Keys) can be imported like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.keys import Keys</span><br></pre></td></tr></table></figure>
<p>The exception classes can be imported like this (Replace the TheNameOfTheExceptionClass with actual class name given below):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium.common.exceptions import [TheNameOfTheExceptionClass]</span><br></pre></td></tr></table></figure>
<h1 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h1><h2 id="ElementNotSelectableException"><a href="#ElementNotSelectableException" class="headerlink" title="ElementNotSelectableException"></a>ElementNotSelectableException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.ElementNotSelectableException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.InvalidElementStateException<br><strong>Description</strong>: Thrown when trying to select an unselectable element. For example, selecting a ‘script’ element.</p>
<h2 id="ElementNotVisibleException"><a href="#ElementNotVisibleException" class="headerlink" title="ElementNotVisibleException"></a>ElementNotVisibleException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.ElementNotVisibleException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.InvalidElementStateException<br><strong>Description</strong>: Thrown when an element is present on the DOM, but it is not visible, and so is not able to be interacted with. Most commonly encountered when trying to click or read text of an element that is hidden from view.</p>
<h2 id="ErrorInResponseException"><a href="#ErrorInResponseException" class="headerlink" title="ErrorInResponseException"></a>ErrorInResponseException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.ErrorInResponseException(response, msg)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when an error has occurred on the server side. This may happen when communicating with the firefox extension or the remote driver server.</p>
<h2 id="ImeActivationFailedException"><a href="#ImeActivationFailedException" class="headerlink" title="ImeActivationFailedException"></a>ImeActivationFailedException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.ImeActivationFailedException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when activating an IME engine has failed.</p>
<h2 id="ImeNotAvailableException"><a href="#ImeNotAvailableException" class="headerlink" title="ImeNotAvailableException"></a>ImeNotAvailableException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.ImeNotAvailableException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when IME support is not available. This exception is thrown for every IME-related method call if IME support is not available on the machine.</p>
<h2 id="InvalidCookieDomainException"><a href="#InvalidCookieDomainException" class="headerlink" title="InvalidCookieDomainException"></a>InvalidCookieDomainException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.InvalidCookieDomainException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when attempting to add a cookie under a different domain than the current URL.</p>
<h2 id="InvalidElementStateException"><a href="#InvalidElementStateException" class="headerlink" title="InvalidElementStateException"></a>InvalidElementStateException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.InvalidElementStateException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: None</p>
<h2 id="InvalidSelectorException"><a href="#InvalidSelectorException" class="headerlink" title="InvalidSelectorException"></a>InvalidSelectorException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.InvalidSelectorException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.NoSuchElementException<br><strong>Description</strong>: Thrown when the selector which is used to find an element does not return a WebElement. Currently this only happens when the selector is an xpath expression and it is either syntactically invalid (i.e. it is not a xpath expression) or the expression does not select WebElements (e.g. “count(//input)”).</p>
<h2 id="InvalidSwitchToTargetException"><a href="#InvalidSwitchToTargetException" class="headerlink" title="InvalidSwitchToTargetException"></a>InvalidSwitchToTargetException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.InvalidSwitchToTargetException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when frame or window target to be switched doesn’t exist.</p>
<h2 id="MoveTargetOutOfBoundsException"><a href="#MoveTargetOutOfBoundsException" class="headerlink" title="MoveTargetOutOfBoundsException"></a>MoveTargetOutOfBoundsException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.MoveTargetOutOfBoundsException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when the target provided to the ActionsChains move() method is invalid, i.e. out of document.</p>
<h2 id="NoAlertPresentException"><a href="#NoAlertPresentException" class="headerlink" title="NoAlertPresentException"></a>NoAlertPresentException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.NoAlertPresentException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when switching to no presented alert. This can be caused by calling an operation on the Alert() class when an alert is not yet on the screen.</p>
<h2 id="NoSuchAttributeException"><a href="#NoSuchAttributeException" class="headerlink" title="NoSuchAttributeException"></a>NoSuchAttributeException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.NoSuchAttributeException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when the attribute of element could not be found. You may want to check if the attribute exists in the particular browser you are testing against. Some browsers may have different property names for the same property. (IE8’s .innerText vs. Firefox .textContent)</p>
<h2 id="NoSuchElementException"><a href="#NoSuchElementException" class="headerlink" title="NoSuchElementException"></a>NoSuchElementException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.NoSuchElementException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when element could not be found. If you encounter this exception, you may want to check the following:</p>
<ul>
<li>Check your selector used in your find_by…</li>
<li>Element may not yet be on the screen at the time of the find operation, (webpage is still loading) see selenium.webdriver.support.wait.WebDriverWait() for how to write a wait wrapper to wait for an element to appear.</li>
</ul>
<h2 id="NoSuchFrameException"><a href="#NoSuchFrameException" class="headerlink" title="NoSuchFrameException"></a>NoSuchFrameException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.NoSuchFrameException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.InvalidSwitchToTargetException<br><strong>Description</strong>: Thrown when frame target to be switched doesn’t exist.</p>
<h2 id="NoSuchWindowException"><a href="#NoSuchWindowException" class="headerlink" title="NoSuchWindowException"></a>NoSuchWindowException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.NoSuchWindowException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.InvalidSwitchToTargetException<br><strong>Description</strong>: Thrown when window target to be switched doesn’t exist. To find the current set of active window handles, you can get a list of the active window handles in the following way:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print driver.window_handles</span><br></pre></td></tr></table></figure></p>
<h2 id="RemoteDriverServerException"><a href="#RemoteDriverServerException" class="headerlink" title="RemoteDriverServerException"></a>RemoteDriverServerException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.RemoteDriverServerException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: None</p>
<h2 id="StaleElementReferenceException"><a href="#StaleElementReferenceException" class="headerlink" title="StaleElementReferenceException"></a>StaleElementReferenceException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.StaleElementReferenceException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when a reference to an element is now “stale”. Stale means the element no longer appears on the DOM of the page. Possible causes of StaleElementReferenceException include, but not limited to:</p>
<ul>
<li>You are no longer on the same page, or the page may have refreshed since the element was located. </li>
<li>The element may have been removed and re-added to the screen, since it was located. Such as an element being relocated. This can happen typically with a javascript framework when values are updated and the node is rebuilt. </li>
<li>Element may have been inside an iframe or another context which was refreshed.</li>
</ul>
<h2 id="TimeoutException"><a href="#TimeoutException" class="headerlink" title="TimeoutException"></a>TimeoutException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.TimeoutException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when a command does not complete in enough time.</p>
<h2 id="UnableToSetCookieException"><a href="#UnableToSetCookieException" class="headerlink" title="UnableToSetCookieException"></a>UnableToSetCookieException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.UnableToSetCookieException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when a driver fails to set a cookie.</p>
<h2 id="UnexpectedAlertPresentException"><a href="#UnexpectedAlertPresentException" class="headerlink" title="UnexpectedAlertPresentException"></a>UnexpectedAlertPresentException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.UnexpectedAlertPresentException(msg=None, screen=None, stacktrace=None, alert_text=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when an unexpected alert is appeared. Usually raised when an expected modal is blocking webdriver form executing any more commands.</p>
<h2 id="UnexpectedTagNameException"><a href="#UnexpectedTagNameException" class="headerlink" title="UnexpectedTagNameException"></a>UnexpectedTagNameException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.UnexpectedTagNameException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.common.exceptions.WebDriverException<br><strong>Description</strong>: Thrown when a support class did not get an expected web element.</p>
<h2 id="WebDriverException"><a href="#WebDriverException" class="headerlink" title="WebDriverException"></a>WebDriverException</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.WebDriverException(msg=None, screen=None, stacktrace=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: exceptions.Exception<br><strong>Description</strong>: Base webdriver exception.</p>
<h1 id="Action-Chains"><a href="#Action-Chains" class="headerlink" title="Action Chains"></a>Action Chains</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.action_chains import ActionChains</span><br></pre></td></tr></table></figure>
<p>ActionChains are a way to automate low level interactions such as mouse movements, mouse button actions, key press, and context menu interactions. This is useful for doing more complex actions like hover over and drag and drop.</p>
<h2 id="Generate-user-actions"><a href="#Generate-user-actions" class="headerlink" title="Generate user actions"></a>Generate user actions</h2><p>When you call methods for actions on the ActionChains object, the actions are stored in a queue in the ActionChains object. When you call <code>perform()</code>, the events are fired in the order they are queued up.</p>
<p>ActionChains can be used in a chain pattern:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">menu = driver.find_element_by_css_selector(&quot;.nav&quot;)</span><br><span class="line">hidden_submenu = driver.find_element_by_css_selector(&quot;.nav #submenu1&quot;)</span><br><span class="line"></span><br><span class="line">ActionChains(driver).move_to_element(menu).click(hidden_submenu).perform()</span><br></pre></td></tr></table></figure>
<p>Or actions can be queued up one by one, then performed:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">menu = driver.find_element_by_css_selector(&quot;.nav&quot;)</span><br><span class="line">hidden_submenu = driver.find_element_by_css_selector(&quot;.nav #submenu1&quot;)</span><br><span class="line"></span><br><span class="line">actions = ActionChains(driver)</span><br><span class="line">actions.move_to_element(menu)</span><br><span class="line">actions.click(hidden_submenu)</span><br><span class="line">actions.perform()</span><br></pre></td></tr></table></figure>
<p>Either way, the actions are performed in the order they are called, one after another.</p>
<h2 id="click-on-element-None"><a href="#click-on-element-None" class="headerlink" title="click(on_element=None)"></a>click(on_element=None)</h2><p>Clicks an element.</p>
<ul>
<li>on_element: The element to click. If None, clicks on current mouse position.</li>
</ul>
<h2 id="click-and-hold-on-element-None"><a href="#click-and-hold-on-element-None" class="headerlink" title="click_and_hold(on_element=None)"></a>click_and_hold(on_element=None)</h2><p>Holds down the left mouse button on an element.</p>
<ul>
<li>on_element: The element to mouse down. If None, clicks on current mouse position.</li>
</ul>
<h2 id="context-click-on-element-None"><a href="#context-click-on-element-None" class="headerlink" title="context_click(on_element=None)"></a>context_click(on_element=None)</h2><p>Performs a context-click (right click) on an element.</p>
<ul>
<li>on_element: The element to context-click. If None, clicks on current mouse position.</li>
</ul>
<h2 id="double-click-on-element-None"><a href="#double-click-on-element-None" class="headerlink" title="double_click(on_element=None)"></a>double_click(on_element=None)</h2><p>Double-clicks an element.</p>
<ul>
<li>on_element: The element to double-click. If None, clicks on current mouse position.</li>
</ul>
<h2 id="drag-and-drop-source-target"><a href="#drag-and-drop-source-target" class="headerlink" title="drag_and_drop(source, target)"></a>drag_and_drop(source, target)</h2><p>Holds down the left mouse button on the source element, then moves to the target element and releases the mouse button.</p>
<ul>
<li>source: The element to mouse down.</li>
<li>target: The element to mouse up.</li>
</ul>
<h2 id="drag-and-drop-by-offset-source-xoffset-yoffset"><a href="#drag-and-drop-by-offset-source-xoffset-yoffset" class="headerlink" title="drag_and_drop_by_offset(source, xoffset, yoffset)"></a>drag_and_drop_by_offset(source, xoffset, yoffset)</h2><p>Holds down the left mouse button on the source element, then moves to the target offset and releases the mouse button.</p>
<ul>
<li>source: The element to mouse down.</li>
<li>xoffset: X offset to move to.</li>
<li>yoffset: Y offset to move to.</li>
</ul>
<h2 id="key-down-value-element-None"><a href="#key-down-value-element-None" class="headerlink" title="key_down(value, element=None)"></a>key_down(value, element=None)</h2><p>Sends a key press only, without releasing it. Should only be used with modifier keys (Control, Alt and Shift). Example, pressing ctrl+c:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ActionChains(driver).key_down(Keys.CONTROL).send_keys(&apos;c&apos;).key_up(Keys.CONTROL).perform()</span><br></pre></td></tr></table></figure>
<ul>
<li>value: The modifier key to send. Values are defined in Keys class.</li>
<li>element: The element to send keys. If None, sends a key to current focused element.</li>
</ul>
<h2 id="key-up-value-element-None"><a href="#key-up-value-element-None" class="headerlink" title="key_up(value, element=None)"></a>key_up(value, element=None)</h2><p>Releases a modifier key. Example is same as key_down().</p>
<ul>
<li>value: The modifier key to send. Values are defined in Keys class.</li>
<li>element: The element to send keys. If None, sends a key to current focused element.</li>
</ul>
<h2 id="move-by-offset-xoffset-yoffset"><a href="#move-by-offset-xoffset-yoffset" class="headerlink" title="move_by_offset(xoffset, yoffset)"></a>move_by_offset(xoffset, yoffset)</h2><p>Moving the mouse to an offset from current mouse position.</p>
<ul>
<li>xoffset: X offset to move to, as a positive or negative integer.</li>
<li>yoffset: Y offset to move to, as a positive or negative integer.</li>
</ul>
<h2 id="move-to-element-to-element"><a href="#move-to-element-to-element" class="headerlink" title="move_to_element(to_element)"></a>move_to_element(to_element)</h2><p>Moving the mouse to the middle of an element.</p>
<ul>
<li>to_element: The WebElement to move to.</li>
</ul>
<h2 id="move-to-element-with-offset-to-element-xoffset-yoffset"><a href="#move-to-element-with-offset-to-element-xoffset-yoffset" class="headerlink" title="move_to_element_with_offset(to_element, xoffset, yoffset)"></a>move_to_element_with_offset(to_element, xoffset, yoffset)</h2><p>Move the mouse by an offset of the specified element. Offsets are relative to the top-left corner of the element.</p>
<ul>
<li>to_element: The WebElement to move to.</li>
<li>xoffset: X offset to move to.</li>
<li>yoffset: Y offset to move to.</li>
</ul>
<h2 id="perform"><a href="#perform" class="headerlink" title="perform()"></a>perform()</h2><p>Performs all stored actions.</p>
<h2 id="release-on-element-None"><a href="#release-on-element-None" class="headerlink" title="release(on_element=None)"></a>release(on_element=None)</h2><p>Releasing a held mouse button on an element.</p>
<ul>
<li>on_element: The element to mouse up. If None, releases on current mouse position.</li>
</ul>
<h2 id="send-keys-keys-to-send"><a href="#send-keys-keys-to-send" class="headerlink" title="send_keys(*keys_to_send)"></a>send_keys(*keys_to_send)</h2><p>Sends keys to current focused element.</p>
<ul>
<li>keys_to_send: The keys to send. Modifier keys constants can be found in the<br>‘Keys’ class.</li>
</ul>
<h2 id="send-keys-to-element-element-keys-to-send"><a href="#send-keys-to-element-element-keys-to-send" class="headerlink" title="send_keys_to_element(element, *keys_to_send)"></a>send_keys_to_element(element, *keys_to_send)</h2><p>Sends keys to an element.</p>
<ul>
<li>element: The element to send keys.</li>
<li>keys_to_send: The keys to send. Modifier keys constants can be found in the<br>‘Keys’ class.</li>
</ul>
<h1 id="Alerts"><a href="#Alerts" class="headerlink" title="Alerts"></a>Alerts</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.alert import Alert</span><br></pre></td></tr></table></figure>
<p>Allows to work with alerts. Use this class to interact with alert prompts. It contains methods for dismissing, accepting, inputting, and getting text from alert prompts.</p>
<p>Accepting / Dismissing alert prompts:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Alert(driver).accept()</span><br><span class="line">Alert(driver).dismiss()</span><br></pre></td></tr></table></figure>
<p>Inputting a value into an alert prompt:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name_prompt = Alert(driver)</span><br><span class="line">name_prompt.send_keys(“Willian Shakesphere”) </span><br><span class="line">name_prompt.accept()</span><br></pre></td></tr></table></figure>
<p>Reading a the text of a prompt for verification:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alert_text = Alert(driver).text</span><br><span class="line">self.assertEqual(“Do you wish to quit?”, alert_text)</span><br></pre></td></tr></table></figure>
<h2 id="accept"><a href="#accept" class="headerlink" title="accept()"></a>accept()</h2><p>Accepts the alert available.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Alert(driver).accept() # Confirm a alert dialog.</span><br></pre></td></tr></table></figure>
<h2 id="authenticate-username-password"><a href="#authenticate-username-password" class="headerlink" title="authenticate(username, password)"></a>authenticate(username, password)</h2><p>Send the username / password to an Authenticated dialog (like with Basic HTTP Auth). Implicitly ‘clicks ok’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to.alert.authenticate(‘username’, ‘password’)</span><br></pre></td></tr></table></figure>
<h2 id="dismiss"><a href="#dismiss" class="headerlink" title="dismiss()"></a>dismiss()</h2><p>Dismisses the alert available.</p>
<h2 id="send-keys-keysToSend"><a href="#send-keys-keysToSend" class="headerlink" title="send_keys(keysToSend)"></a>send_keys(keysToSend)</h2><p>Send Keys to the Alert.</p>
<ul>
<li>keysToSend: The text to be sent to Alert.</li>
</ul>
<h2 id="text"><a href="#text" class="headerlink" title="text"></a>text</h2><p>Gets the text of the Alert.</p>
<h1 id="Special-Keys"><a href="#Special-Keys" class="headerlink" title="Special Keys"></a>Special Keys</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.keys import Keys</span><br></pre></td></tr></table></figure>
<p>Set of special keys codes：</p>
<ul>
<li>ADD = u’\ue025’</li>
<li>ALT = u’\ue00a’</li>
<li>ARROW_DOWN = u’\ue015’</li>
<li>ARROW_LEFT = u’\ue012’</li>
<li>ARROW_RIGHT = u’\ue014’</li>
<li>ARROW_UP = u’\ue013’</li>
<li>BACKSPACE = u’\ue003’</li>
<li>BACK_SPACE = u’\ue003’</li>
<li>CANCEL = u’\ue001’</li>
<li>CLEAR = u’\ue005’</li>
<li>COMMAND = u’\ue03d’</li>
<li>CONTROL = u’\ue009’</li>
<li>DECIMAL = u’\ue028’</li>
<li>DELETE = u’\ue017’</li>
<li>DIVIDE = u’\ue029’</li>
<li>DOWN = u’\ue015’</li>
<li>END = u’\ue010’</li>
<li>ENTER = u’\ue007’</li>
<li>EQUALS = u’\ue019’</li>
<li>ESCAPE = u’\ue00c’</li>
<li>F1 = u’\ue031’</li>
<li>F10 = u’\ue03a’</li>
<li>F11 = u’\ue03b’</li>
<li>F12 = u’\ue03c’</li>
<li>F2 = u’\ue032’</li>
<li>F3 = u’\ue033’</li>
<li>F4 = u’\ue034’</li>
<li>F5 = u’\ue035’</li>
<li>F6 = u’\ue036’</li>
<li>F7 = u’\ue037’</li>
<li>F8 = u’\ue038’</li>
<li>F9 = u’\ue039’</li>
<li>HELP = u’\ue002’</li>
<li>HOME = u’\ue011’</li>
<li>INSERT = u’\ue016’</li>
<li>LEFT = u’\ue012’</li>
<li>LEFT_ALT = u’\ue00a’</li>
<li>LEFT_CONTROL = u’\ue009’</li>
<li>LEFT_SHIFT = u’\ue008’</li>
<li>META = u’\ue03d’</li>
<li>MULTIPLY = u’\ue024’</li>
<li>NULL = u’\ue000’</li>
<li>NUMPAD0 = u’\ue01a’</li>
<li>NUMPAD1 = u’\ue01b’</li>
<li>NUMPAD2 = u’\ue01c’</li>
<li>NUMPAD3 = u’\ue01d’</li>
<li>NUMPAD4 = u’\ue01e’</li>
<li>NUMPAD5 = u’\ue01f’</li>
<li>NUMPAD6 = u’\ue020’</li>
<li>NUMPAD7 = u’\ue021’</li>
<li>NUMPAD8 = u’\ue022’</li>
<li>NUMPAD9 = u’\ue023’</li>
<li>PAGE_DOWN = u’\ue00f’</li>
<li>PAGE_UP = u’\ue00e’</li>
<li>PAUSE = u’\ue00b’</li>
<li>RETURN = u’\ue006’</li>
<li>RIGHT = u’\ue014’</li>
<li>SEMICOLON = u’\ue018’</li>
<li>SEPARATOR = u’\ue026’</li>
<li>SHIFT = u’\ue008’</li>
<li>SPACE = u’\ue00d’</li>
<li>SUBTRACT = u’\ue027’</li>
<li>TAB = u’\ue004’</li>
<li>UP = u’\ue013’</li>
</ul>
<h1 id="Locate-elements-By"><a href="#Locate-elements-By" class="headerlink" title="Locate elements By"></a>Locate elements By</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.by import By</span><br></pre></td></tr></table></figure>
<p>These are the attributes which can be used to locate elements. See the Locating Elements chapter for example usages.</p>
<p>Set of supported locator strategies：</p>
<ul>
<li>CLASS_NAME = ‘class name’</li>
<li>CSS_SELECTOR = ‘css selector’</li>
<li>ID = ‘id’</li>
<li>LINK_TEXT = ‘link text’</li>
<li>NAME = ‘name’</li>
<li>PARTIAL_LINK_TEXT = ‘partial link text’</li>
<li>TAG_NAME = ‘tag name’</li>
<li>XPATH = ‘xpath’</li>
</ul>
<h1 id="Desired-Capabilities"><a href="#Desired-Capabilities" class="headerlink" title="Desired Capabilities"></a>Desired Capabilities</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.desired_capabilities import DesiredCapabilities</span><br></pre></td></tr></table></figure>
<p>Set of default supported desired capabilities. Use this as a starting point for creating a desired capabilities object for requesting remote webdrivers for connecting to selenium server or selenium grid.</p>
<p>Usage Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">selenium_grid_url = “http://198.0.0.1:4444/wd/hub“</span><br><span class="line"></span><br><span class="line"># Create a desired capabilities object as a starting point. </span><br><span class="line">capabilities = DesiredCapabilities.FIREFOX.copy() </span><br><span class="line">capabilities[‘platform’] = “WINDOWS” </span><br><span class="line">capabilities[‘version’] = “10”</span><br><span class="line"></span><br><span class="line"># Instantiate an instance of Remote WebDriver with the desired capabilities. </span><br><span class="line">driver = webdriver.Remote(desired_capabilities=capabilities, command_executor=selenium_grid_url)</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>: Always use ‘.copy()’ on the DesiredCapabilities object to avoid the side effects of altering the Global class instance.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ANDROID = &#123;&apos;platform&apos;: &apos;ANDROID&apos;, &apos;browserName&apos;: &apos;android&apos;, &apos;version&apos;: &apos;&apos;, &apos;javascriptEnabled&apos;: True&#125;</span><br><span class="line">CHROME = &#123;&apos;platform&apos;: &apos;ANY&apos;, &apos;browserName&apos;: &apos;chrome&apos;, &apos;version&apos;: &apos;&apos;, &apos;javascriptEnabled&apos;: True&#125;</span><br><span class="line">EDGE = &#123;&apos;platform&apos;: &apos;WINDOWS&apos;, &apos;browserName&apos;: &apos;MicrosoftEdge&apos;, &apos;version&apos;: &apos;&apos;&#125;</span><br><span class="line">FIREFOX = &#123;&apos;platform&apos;: &apos;ANY&apos;, &apos;browserName&apos;: &apos;firefox&apos;, &apos;version&apos;: &apos;&apos;, &apos;marionette&apos;: False, &apos;javascriptEnabled&apos;: True&#125;</span><br><span class="line">HTMLUNIT = &#123;&apos;platform&apos;: &apos;ANY&apos;, &apos;browserName&apos;: &apos;htmlunit&apos;, &apos;version&apos;: &apos;&apos;&#125;</span><br><span class="line">HTMLUNITWITHJS = &#123;&apos;platform&apos;: &apos;ANY&apos;, &apos;browserName&apos;: &apos;htmlunit&apos;, &apos;version&apos;: &apos;firefox&apos;, &apos;javascriptEnabled&apos;: True&#125;</span><br><span class="line">INTERNETEXPLORER = &#123;&apos;platform&apos;: &apos;WINDOWS&apos;, &apos;browserName&apos;: &apos;internet explorer&apos;, &apos;version&apos;: &apos;&apos;, &apos;javascriptEnabled&apos;: True&#125;</span><br><span class="line">IPAD = &#123;&apos;platform&apos;: &apos;MAC&apos;, &apos;browserName&apos;: &apos;iPad&apos;, &apos;version&apos;: &apos;&apos;, &apos;javascriptEnabled&apos;: True&#125;</span><br><span class="line">IPHONE = &#123;&apos;platform&apos;: &apos;MAC&apos;, &apos;browserName&apos;: &apos;iPhone&apos;, &apos;version&apos;: &apos;&apos;, &apos;javascriptEnabled&apos;: True&#125;</span><br><span class="line">OPERA = &#123;&apos;platform&apos;: &apos;ANY&apos;, &apos;browserName&apos;: &apos;opera&apos;, &apos;version&apos;: &apos;&apos;, &apos;javascriptEnabled&apos;: True&#125;</span><br><span class="line">PHANTOMJS = &#123;&apos;platform&apos;: &apos;ANY&apos;, &apos;browserName&apos;: &apos;phantomjs&apos;, &apos;version&apos;: &apos;&apos;, &apos;javascriptEnabled&apos;: True&#125;</span><br><span class="line">SAFARI = &#123;&apos;platform&apos;: &apos;MAC&apos;, &apos;browserName&apos;: &apos;safari&apos;, &apos;version&apos;: &apos;&apos;, &apos;javascriptEnabled&apos;: True&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Utilities"><a href="#Utilities" class="headerlink" title="Utilities"></a>Utilities</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.utils import *</span><br></pre></td></tr></table></figure>
<h2 id="find-connectable-ip-host-port-None"><a href="#find-connectable-ip-host-port-None" class="headerlink" title="find_connectable_ip(host, port=None)"></a>find_connectable_ip(host, port=None)</h2><p>Resolve a hostname to an IP, preferring IPv4 addresses. We prefer IPv4 so that we don’t change behavior from previous IPv4-only implementations, and because some drivers (e.g., FirefoxDriver) do not support IPv6 connections. </p>
<p>If the optional port number is provided, only IPs that listen on the given port are considered.</p>
<p><strong>Returns</strong>: A single IP address, as a string. If any IPv4 address is found, one is returned. Otherwise, if any IPv6 address is found, one is returned. If neither, then None is returned.</p>
<h2 id="free-port"><a href="#free-port" class="headerlink" title="free_port()"></a>free_port()</h2><p>Determines a free port using sockets.</p>
<h2 id="is-connectable-port-host-’localhost’"><a href="#is-connectable-port-host-’localhost’" class="headerlink" title="is_connectable(port, host=’localhost’)"></a>is_connectable(port, host=’localhost’)</h2><p>Tries to connect to the server at port to see if it is running.</p>
<h2 id="is-url-connectable-port"><a href="#is-url-connectable-port" class="headerlink" title="is_url_connectable(port)"></a>is_url_connectable(port)</h2><p>Tries to connect to the HTTP server at /status path and specified port to see if it responds successfully.</p>
<h2 id="join-host-port-host-port"><a href="#join-host-port-host-port" class="headerlink" title="join_host_port(host, port)"></a>join_host_port(host, port)</h2><p>Joins a hostname and port together. This is a minimal implementation intended to cope with IPv6 literals.</p>
<h2 id="keys-to-typing-value"><a href="#keys-to-typing-value" class="headerlink" title="keys_to_typing(value)"></a>keys_to_typing(value)</h2><p>Processes the values that will be typed in the element.</p>
<h1 id="Firefox-WebDriver"><a href="#Firefox-WebDriver" class="headerlink" title="Firefox WebDriver"></a>Firefox WebDriver</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.webdriver.firefox.webdriver.WebDriver(firefox_profile=None, firefox_binary=None, timeout=30, capabilities=None, proxy=None, executable_path=&apos;wires&apos;, firefox_options=None)</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.webdriver.remote.webdriver.WebDriver</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">quit()</span><br><span class="line">set_context(context)</span><br><span class="line">NATIVE_EVENTS_ALLOWED = True</span><br><span class="line">firefox_profile</span><br></pre></td></tr></table></figure>
<h1 id="Chrome-WebDriver"><a href="#Chrome-WebDriver" class="headerlink" title="Chrome WebDriver"></a>Chrome WebDriver</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.webdriver.chrome.webdriver.WebDriver(executable_path=&apos;chromedriver&apos;, port=0, chrome_options=None, service_args=None, desired_capabilities=None, service_log_path=None )</span><br></pre></td></tr></table></figure>
<p><strong>Base</strong>: selenium.webdriver.remote.webdriver.WebDriver</p>
<p>Controls the ChromeDriver and allows you to drive the browser. You will need to download the ChromeDriver executable from <a href="http://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="external">chromedriver.storage.googleapis.com</a>, or have a look at <a href="http://127.0.0.1:4000/2016/07/31/Selenium自动化测试/#chromedriver" target="_blank" rel="external">Selenium 自动化测试</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create_options()</span><br><span class="line">launch_app(id)</span><br><span class="line">quit()</span><br></pre></td></tr></table></figure>
<h1 id="Remote-WebDriver"><a href="#Remote-WebDriver" class="headerlink" title="Remote WebDriver"></a>Remote WebDriver</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.webdriver.remote.webdriver.WebDriver(command_executor=&apos;http://127.0.0.1:4444/wd/hub&apos;, desired_capabilities=None, browser_profile=None, proxy=None, keep_alive=False, file_detector=None)</span><br></pre></td></tr></table></figure>
<p>Controls a browser by sending commands to a remote server. This server is expected to be running the WebDriver wire protocol as defined at <a href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol" target="_blank" rel="external">JsonWireProtocol</a></p>
<p><strong>Attributes</strong>:</p>
<ul>
<li>session_id - String ID of the browser session started and controlled by this WebDriver.</li>
<li>capabilities - Dictionaty of effective capabilities of this browser session as returned by the remote server. See <a href="https://github.com/SeleniumHQ/selenium/wiki/DesiredCapabilities" target="_blank" rel="external">DesiredCapabilities</a></li>
<li>command_executor - remote_connection.RemoteConnection object used to execute commands.</li>
<li>error_handler - errorhandler.ErrorHandler object used to handle errors.</li>
</ul>
<h2 id="add-cookie-cookie-dict"><a href="#add-cookie-cookie-dict" class="headerlink" title="add_cookie(cookie_dict)"></a>add_cookie(cookie_dict)</h2><p>Adds a cookie to your current session.</p>
<ul>
<li>cookie_dict: A dictionary object, with required keys - “name” and “value”</li>
<li>optional keys - “path”, “domain”, “secure”, “expiry”</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver.add_cookie(&#123;‘name’ : ‘foo’, ‘value’ : ‘bar’&#125;) </span><br><span class="line">driver.add_cookie(&#123;‘name’ : ‘foo’, ‘value’ : ‘bar’, ‘path’ : ‘/’&#125;)</span><br><span class="line">driver.add_cookie(&#123;‘name’ : ‘foo’, ‘value’ : ‘bar’, ‘path’ : ‘/’, ‘secure’:True&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="back"><a href="#back" class="headerlink" title="back()"></a>back()</h2><p>Goes one step backward in the browser history.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.back()</span><br></pre></td></tr></table></figure>
<h2 id="forward"><a href="#forward" class="headerlink" title="forward()"></a>forward()</h2><p>Goes one step forward in the browser history.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.forward()</span><br></pre></td></tr></table></figure>
<h2 id="close"><a href="#close" class="headerlink" title="close()"></a>close()</h2><p>Closes the current window.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.close()</span><br></pre></td></tr></table></figure>
<h2 id="create-web-element-element-id"><a href="#create-web-element-element-id" class="headerlink" title="create_web_element(element_id)"></a>create_web_element(element_id)</h2><p>Creates a web element with the specified element_id.</p>
<h2 id="delete-all-cookies"><a href="#delete-all-cookies" class="headerlink" title="delete_all_cookies()"></a>delete_all_cookies()</h2><p>Delete all cookies in the scope of the session.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.delete_all_cookies()</span><br></pre></td></tr></table></figure>
<h2 id="delete-cookie-name"><a href="#delete-cookie-name" class="headerlink" title="delete_cookie(name)"></a>delete_cookie(name)</h2><p>Deletes a single cookie with the given name.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.delete_cookie(‘my_cookie’)</span><br></pre></td></tr></table></figure>
<h2 id="execute-driver-command-params-None"><a href="#execute-driver-command-params-None" class="headerlink" title="execute(driver_command, params=None)"></a>execute(driver_command, params=None)</h2><p>Sends a command to be executed by a command.CommandExecutor.</p>
<ul>
<li>driver_command: The name of the command to execute as a string.</li>
<li>params: A dictionary of named parameters to send with the command.</li>
</ul>
<p><strong>Return</strong>:    The command’s JSON response loaded into a dictionary object.</p>
<h2 id="execute-async-script-script-args"><a href="#execute-async-script-script-args" class="headerlink" title="execute_async_script(script, *args)"></a>execute_async_script(script, *args)</h2><p>Asynchronously Executes JavaScript in the current window/frame.</p>
<ul>
<li>script: The JavaScript to execute.</li>
<li>*args: Any applicable arguments for your JavaScript.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.execute_async_script(‘document.title’)</span><br></pre></td></tr></table></figure>
<h2 id="execute-script-script-args"><a href="#execute-script-script-args" class="headerlink" title="execute_script(script, *args)"></a>execute_script(script, *args)</h2><p>Synchronously Executes JavaScript in the current window/frame.</p>
<ul>
<li>script: The JavaScript to execute.</li>
<li>*args: Any applicable arguments for your JavaScript.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.execute_script(‘document.title’)</span><br></pre></td></tr></table></figure>
<h2 id="file-detector-context-args-kwds"><a href="#file-detector-context-args-kwds" class="headerlink" title="file_detector_context(*args, **kwds)"></a>file_detector_context(*args, **kwds)</h2><p>Overrides the current file detector (if necessary) in limited context. Ensures the original file detector is set afterwards. Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with webdriver.file_detector_context(UselessFileDetector):</span><br><span class="line">    someinput.send_keys(‘/etc/hosts’)</span><br></pre></td></tr></table></figure>
<ul>
<li>file_detector_class - Class of the desired file detector. If the class is different from the current file_detector, then the class is instantiated with args and kwargs and used as a file detector during the duration of the context manager.</li>
<li>args - Optional arguments that get passed to the file detector class during instantiation.</li>
<li>kwargs - Keyword arguments, passed the same way as args.</li>
</ul>
<h2 id="find-element-by-’id’-value-None"><a href="#find-element-by-’id’-value-None" class="headerlink" title="find_element(by=’id’, value=None)"></a>find_element(by=’id’, value=None)</h2><p>‘Private’ method used by the find_element_by_* methods. Use the corresponding find_element_by_* instead of this.</p>
<h2 id="find-element-by-class-name-name"><a href="#find-element-by-class-name-name" class="headerlink" title="find_element_by_class_name(name)"></a>find_element_by_class_name(name)</h2><p>Finds an element by class name.</p>
<ul>
<li>name: The class name of the element to find.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_class_name(‘foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-element-by-css-selector-css-selector"><a href="#find-element-by-css-selector-css-selector" class="headerlink" title="find_element_by_css_selector(css_selector)"></a>find_element_by_css_selector(css_selector)</h2><p>Finds an element by css selector.</p>
<ul>
<li>css_selector: The css selector to use when finding elements.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_css_selector(‘#foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-element-by-id-id"><a href="#find-element-by-id-id" class="headerlink" title="find_element_by_id(id)"></a>find_element_by_id(id)</h2><p>Finds an element by id.</p>
<ul>
<li>id - The id of the element to be found.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_id(‘foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-element-by-link-text-link-text"><a href="#find-element-by-link-text-link-text" class="headerlink" title="find_element_by_link_text(link_text)"></a>find_element_by_link_text(link_text)</h2><p>Finds an element by link text.</p>
<ul>
<li>link_text: The text of the element to be found.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_link_text(‘Sign In’)</span><br></pre></td></tr></table></figure>
<h2 id="find-element-by-name-name"><a href="#find-element-by-name-name" class="headerlink" title="find_element_by_name(name)"></a>find_element_by_name(name)</h2><p>Finds an element by name.</p>
<ul>
<li>name: The name of the element to find.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_name(‘foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-element-by-partial-link-text-link-text"><a href="#find-element-by-partial-link-text-link-text" class="headerlink" title="find_element_by_partial_link_text(link_text)"></a>find_element_by_partial_link_text(link_text)</h2><p>Finds an element by a partial match of its link text.</p>
<ul>
<li>link_text: The text of the element to partially match on.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_partial_link_text(‘Sign’)</span><br></pre></td></tr></table></figure>
<h2 id="find-element-by-tag-name-name"><a href="#find-element-by-tag-name-name" class="headerlink" title="find_element_by_tag_name(name)"></a>find_element_by_tag_name(name)</h2><p>Finds an element by tag name.</p>
<ul>
<li>name: The tag name of the element to find.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_tag_name(‘foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-element-by-xpath-xpath"><a href="#find-element-by-xpath-xpath" class="headerlink" title="find_element_by_xpath(xpath)"></a>find_element_by_xpath(xpath)</h2><p>Finds an element by xpath.</p>
<ul>
<li>xpath - The xpath locator of the element to find.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_xpath(‘//div/td[1]’)</span><br></pre></td></tr></table></figure>
<h2 id="find-elements-by-’id’-value-None"><a href="#find-elements-by-’id’-value-None" class="headerlink" title="find_elements(by=’id’, value=None)"></a>find_elements(by=’id’, value=None)</h2><p>‘Private’ method used by the find_elements_by_* methods. Use the corresponding find_elements_by_* instead of this.</p>
<h2 id="find-elements-by-class-name-name"><a href="#find-elements-by-class-name-name" class="headerlink" title="find_elements_by_class_name(name)"></a>find_elements_by_class_name(name)</h2><p>Finds elements by class name.</p>
<ul>
<li>name: The class name of the elements to find.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_elements_by_class_name(‘foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-elements-by-css-selector-css-selector"><a href="#find-elements-by-css-selector-css-selector" class="headerlink" title="find_elements_by_css_selector(css_selector)"></a>find_elements_by_css_selector(css_selector)</h2><p>Finds elements by css selector.</p>
<ul>
<li>css_selector: The css selector to use when finding elements.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_elements_by_css_selector(‘.foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-elements-by-id-id"><a href="#find-elements-by-id-id" class="headerlink" title="find_elements_by_id(id)"></a>find_elements_by_id(id)</h2><p>Finds multiple elements by id.</p>
<ul>
<li>id_ - The id of the elements to be found.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_elements_by_id(‘foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-elements-by-link-text-text"><a href="#find-elements-by-link-text-text" class="headerlink" title="find_elements_by_link_text(text)"></a>find_elements_by_link_text(text)</h2><p>Finds elements by link text.</p>
<ul>
<li>link_text: The text of the elements to be found.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_elements_by_link_text(‘Sign In’)</span><br></pre></td></tr></table></figure>
<h2 id="find-elements-by-name-name"><a href="#find-elements-by-name-name" class="headerlink" title="find_elements_by_name(name)"></a>find_elements_by_name(name)</h2><p>Finds elements by name.</p>
<ul>
<li>name: The name of the elements to find.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_elements_by_name(‘foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-elements-by-partial-link-text-link-text"><a href="#find-elements-by-partial-link-text-link-text" class="headerlink" title="find_elements_by_partial_link_text(link_text)"></a>find_elements_by_partial_link_text(link_text)</h2><p>Finds elements by a partial match of their link text.</p>
<ul>
<li>link_text: The text of the element to partial match on.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_partial_link_text(‘Sign’)</span><br></pre></td></tr></table></figure>
<h2 id="find-elements-by-tag-name-name"><a href="#find-elements-by-tag-name-name" class="headerlink" title="find_elements_by_tag_name(name)"></a>find_elements_by_tag_name(name)</h2><p>Finds elements by tag name.</p>
<ul>
<li>name: The tag name the use when finding elements.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_elements_by_tag_name(‘foo’)</span><br></pre></td></tr></table></figure>
<h2 id="find-elements-by-xpath-xpath"><a href="#find-elements-by-xpath-xpath" class="headerlink" title="find_elements_by_xpath(xpath)"></a>find_elements_by_xpath(xpath)</h2><p>Finds multiple elements by xpath.</p>
<ul>
<li>xpath - The xpath locator of the elements to be found.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_elements_by_xpath(“//div[contains(@class, ‘foo’)]”)</span><br></pre></td></tr></table></figure>
<h2 id="get-url"><a href="#get-url" class="headerlink" title="get(url)"></a>get(url)</h2><p>Loads a web page in the current browser session.</p>
<h2 id="get-cookie-name"><a href="#get-cookie-name" class="headerlink" title="get_cookie(name)"></a>get_cookie(name)</h2><p>Get a single cookie by name. Returns the cookie if found, None if not.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_cookie(‘my_cookie’)</span><br></pre></td></tr></table></figure>
<h2 id="get-cookies"><a href="#get-cookies" class="headerlink" title="get_cookies()"></a>get_cookies()</h2><p>Returns a set of dictionaries, corresponding to cookies visible in the current session.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_cookies()</span><br></pre></td></tr></table></figure>
<h2 id="get-log-log-type"><a href="#get-log-log-type" class="headerlink" title="get_log(log_type)"></a>get_log(log_type)</h2><p>Gets the log for a given log type</p>
<ul>
<li>log_type: type of log that which will be returned</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver.get_log(‘browser’) </span><br><span class="line">driver.get_log(‘driver’) </span><br><span class="line">driver.get_log(‘client’) </span><br><span class="line">driver.get_log(‘server’)</span><br></pre></td></tr></table></figure>
<h2 id="get-screenshot-as-base64"><a href="#get-screenshot-as-base64" class="headerlink" title="get_screenshot_as_base64()"></a>get_screenshot_as_base64()</h2><p>Gets the screenshot of the current window as a base64 encoded string, which is useful in embedded images in HTML.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_screenshot_as_base64()</span><br></pre></td></tr></table></figure>
<h2 id="get-screenshot-as-file-filename"><a href="#get-screenshot-as-file-filename" class="headerlink" title="get_screenshot_as_file(filename)"></a>get_screenshot_as_file(filename)</h2><p>Gets the screenshot of the current window. Returns False if there is any IOError, else returns True. Use full paths in your filename.</p>
<ul>
<li>filename: The full path you wish to save your screenshot to.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_screenshot_as_file(‘/Screenshots/foo.png’)</span><br></pre></td></tr></table></figure>
<h2 id="get-screenshot-as-png"><a href="#get-screenshot-as-png" class="headerlink" title="get_screenshot_as_png()"></a>get_screenshot_as_png()</h2><p>Gets the screenshot of the current window as a binary data.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_screenshot_as_png()</span><br></pre></td></tr></table></figure>
<h2 id="get-window-position-windowHandle-’current’"><a href="#get-window-position-windowHandle-’current’" class="headerlink" title="get_window_position(windowHandle=’current’)"></a>get_window_position(windowHandle=’current’)</h2><p>Gets the x,y position of the current window.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_window_position()</span><br></pre></td></tr></table></figure>
<h2 id="get-window-size-windowHandle-’current’"><a href="#get-window-size-windowHandle-’current’" class="headerlink" title="get_window_size(windowHandle=’current’)"></a>get_window_size(windowHandle=’current’)</h2><p>Gets the width and height of the current window.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_window_size()</span><br></pre></td></tr></table></figure>
<h2 id="implicitly-wait-time-to-wait"><a href="#implicitly-wait-time-to-wait" class="headerlink" title="implicitly_wait(time_to_wait)"></a>implicitly_wait(time_to_wait)</h2><p>Sets a sticky timeout to implicitly wait for an element to be found, or a command to complete. This method only needs to be called one time per session. To set the timeout for calls to execute_async_script, see set_script_timeout.</p>
<ul>
<li>time_to_wait: Amount of time to wait (in seconds)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.implicitly_wait(30)</span><br></pre></td></tr></table></figure>
<h2 id="maximize-window"><a href="#maximize-window" class="headerlink" title="maximize_window()"></a>maximize_window()</h2><p>Maximizes the current window that webdriver is using</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.maximize_window()</span><br></pre></td></tr></table></figure>
<h2 id="quit"><a href="#quit" class="headerlink" title="quit()"></a>quit()</h2><p>Quits the driver and closes every associated window.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h2 id="refresh"><a href="#refresh" class="headerlink" title="refresh()"></a>refresh()</h2><p>Refreshes the current page.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.refresh()</span><br></pre></td></tr></table></figure>
<h2 id="save-screenshot-filename"><a href="#save-screenshot-filename" class="headerlink" title="save_screenshot(filename)"></a>save_screenshot(filename)</h2><p>Gets the screenshot of the current window. Returns False if there is any IOError, else returns True. Use full paths in your filename.</p>
<ul>
<li>filename: The full path you wish to save your screenshot to.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_screenshot_as_file(‘/Screenshots/foo.png’)</span><br></pre></td></tr></table></figure>
<h2 id="set-page-load-timeout-time-to-wait"><a href="#set-page-load-timeout-time-to-wait" class="headerlink" title="set_page_load_timeout(time_to_wait)"></a>set_page_load_timeout(time_to_wait)</h2><p>Set the amount of time to wait for a page load to complete before throwing an error.</p>
<ul>
<li>time_to_wait: The amount of time to wait</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.set_page_load_timeout(30)</span><br></pre></td></tr></table></figure>
<h2 id="set-script-timeout-time-to-wait"><a href="#set-script-timeout-time-to-wait" class="headerlink" title="set_script_timeout(time_to_wait)"></a>set_script_timeout(time_to_wait)</h2><p>Set the amount of time that the script should wait during an execute_async_script call before throwing an error.</p>
<ul>
<li>time_to_wait: The amount of time to wait</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.set_script_timeout(30)</span><br></pre></td></tr></table></figure>
<h2 id="set-window-position-x-y-windowHandle-’current’"><a href="#set-window-position-x-y-windowHandle-’current’" class="headerlink" title="set_window_position(x, y, windowHandle=’current’)"></a>set_window_position(x, y, windowHandle=’current’)</h2><p>Sets the x,y position of the current window. (window.moveTo)</p>
<ul>
<li>x: the x-coordinate in pixels to set the window position</li>
<li>y: the y-coordinate in pixels to set the window position</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.set_window_position(0,0)</span><br></pre></td></tr></table></figure>
<h2 id="set-window-size-width-height-windowHandle-’current’"><a href="#set-window-size-width-height-windowHandle-’current’" class="headerlink" title="set_window_size(width, height, windowHandle=’current’)"></a>set_window_size(width, height, windowHandle=’current’)</h2><p>Sets the width and height of the current window. (window.resizeTo)</p>
<ul>
<li>width: the width in pixels to set the window to</li>
<li>height: the height in pixels to set the window to</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.set_window_size(800,600)</span><br></pre></td></tr></table></figure>
<h2 id="start-client"><a href="#start-client" class="headerlink" title="start_client()"></a>start_client()</h2><p>Called before starting a new session. This method may be overridden to define custom startup behavior.</p>
<h2 id="start-session-desired-capabilities-browser-profile-None"><a href="#start-session-desired-capabilities-browser-profile-None" class="headerlink" title="start_session(desired_capabilities, browser_profile=None)"></a>start_session(desired_capabilities, browser_profile=None)</h2><p>Creates a new session with the desired capabilities.</p>
<ul>
<li>browser_name - The name of the browser to request.</li>
<li>version - Which browser version to request.</li>
<li>platform - Which platform to request the browser on.</li>
<li>javascript_enabled - Whether the new session should support JavaScript.</li>
<li>browser_profile - A selenium.webdriver.firefox.firefox_profile.FirefoxProfile object. Only used if Firefox is requested.</li>
</ul>
<h2 id="stop-client"><a href="#stop-client" class="headerlink" title="stop_client()"></a>stop_client()</h2><p>Called after executing a quit command. This method may be overridden to define custom shutdown behavior.</p>
<h2 id="switch-to-active-element"><a href="#switch-to-active-element" class="headerlink" title="switch_to_active_element()"></a>switch_to_active_element()</h2><p>Deprecated use driver.switch_to.active_element</p>
<h2 id="switch-to-alert"><a href="#switch-to-alert" class="headerlink" title="switch_to_alert()"></a>switch_to_alert()</h2><p>Deprecated use driver.switch_to.alert</p>
<h2 id="switch-to-default-content"><a href="#switch-to-default-content" class="headerlink" title="switch_to_default_content()"></a>switch_to_default_content()</h2><p>Deprecated use driver.switch_to.default_content</p>
<h2 id="switch-to-frame-frame-reference"><a href="#switch-to-frame-frame-reference" class="headerlink" title="switch_to_frame(frame_reference)"></a>switch_to_frame(frame_reference)</h2><p>Deprecated use driver.switch_to.frame</p>
<h2 id="switch-to-window-window-name"><a href="#switch-to-window-window-name" class="headerlink" title="switch_to_window(window_name)"></a>switch_to_window(window_name)</h2><p>Deprecated use driver.switch_to.window</p>
<h2 id="application-cache"><a href="#application-cache" class="headerlink" title="application_cache"></a>application_cache</h2><p>Returns a ApplicationCache Object to interact with the browser app cache</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.application_cache</span><br></pre></td></tr></table></figure>
<h2 id="current-url"><a href="#current-url" class="headerlink" title="current_url"></a>current_url</h2><p>Gets the URL of the current page.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.current_url</span><br></pre></td></tr></table></figure>
<h2 id="current-window-handle"><a href="#current-window-handle" class="headerlink" title="current_window_handle"></a>current_window_handle</h2><p>Returns the handle of the current window.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.current_window_handle</span><br></pre></td></tr></table></figure>
<h2 id="desired-capabilities"><a href="#desired-capabilities" class="headerlink" title="desired_capabilities"></a>desired_capabilities</h2><p>returns the drivers current desired capabilities being used</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.desired_capabilities</span><br></pre></td></tr></table></figure>
<h2 id="file-detector"><a href="#file-detector" class="headerlink" title="file_detector"></a>file_detector</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.file_detector</span><br></pre></td></tr></table></figure>
<h2 id="log-types"><a href="#log-types" class="headerlink" title="log_types"></a>log_types</h2><p>Gets a list of the available log types</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.log_types</span><br></pre></td></tr></table></figure>
<h2 id="mobile"><a href="#mobile" class="headerlink" title="mobile"></a>mobile</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.mobile</span><br></pre></td></tr></table></figure>
<h2 id="name"><a href="#name" class="headerlink" title="name"></a>name</h2><p>Returns the name of the underlying browser for this instance.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.name</span><br></pre></td></tr></table></figure>
<h2 id="orientation"><a href="#orientation" class="headerlink" title="orientation"></a>orientation</h2><p>Gets the current orientation of the device</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orientation = driver.orientation</span><br></pre></td></tr></table></figure>
<h2 id="page-source"><a href="#page-source" class="headerlink" title="page_source"></a>page_source</h2><p>Gets the source code of the current page.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html = driver.page_source</span><br></pre></td></tr></table></figure>
<h2 id="switch-to"><a href="#switch-to" class="headerlink" title="switch_to"></a>switch_to</h2><h2 id="title"><a href="#title" class="headerlink" title="title"></a>title</h2><p>Returns the title of the current page.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.title</span><br></pre></td></tr></table></figure>
<h2 id="window-handles"><a href="#window-handles" class="headerlink" title="window_handles"></a>window_handles</h2><p>Returns the handles of all windows within the current session.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.window_handles</span><br></pre></td></tr></table></figure>
<h1 id="WebElement"><a href="#WebElement" class="headerlink" title="WebElement"></a>WebElement</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.webdriver.remote.webelement.WebElement(parent, id_, w3c=False)</span><br></pre></td></tr></table></figure>
<p>Represents a DOM element. Generally, all interesting operations that interact with a document will be performed through this interface. </p>
<p>All method calls will do a freshness check to ensure that the element reference is still valid. This essentially determines whether or not the element is still attached to the DOM. If this test fails, then an StaleElementReferenceException is thrown, and all future calls to this instance will fail.</p>
<h2 id="clear"><a href="#clear" class="headerlink" title="clear()"></a>clear()</h2><p>Clears the text if it’s a text entry element.</p>
<h2 id="click"><a href="#click" class="headerlink" title="click()"></a>click()</h2><p>Clicks the element.</p>
<h2 id="find-element-by-’id’-value-None-1"><a href="#find-element-by-’id’-value-None-1" class="headerlink" title="find_element(by=’id’, value=None)"></a>find_element(by=’id’, value=None)</h2><h2 id="find-element-s-by"><a href="#find-element-s-by" class="headerlink" title="find_element(s)_by_*()"></a>find_element(s)_by_*()</h2><p>Almost same in <a href="#Remote-WebDriver">Remote WebDriver</a>, but the object is WebElement instead of WebDriver. For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element = find_elements_by_id(&apos;q&apos;)</span><br></pre></td></tr></table></figure>
<h2 id="get-attribute-name"><a href="#get-attribute-name" class="headerlink" title="get_attribute(name)"></a>get_attribute(name)</h2><p>Gets the given attribute or property of the element. This method will first try to return the value of a property with the given name. If a property with that name doesn’t exist, it returns the value of the attribute with the same name. If there’s no attribute with that name, None is returned.</p>
<p>Values which are considered truthy, that is equals “true” or “false”, are returned as booleans. All other non-None values are returned as strings. For attributes or properties which do not exist, None is returned.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Check if the &quot;active&quot; CSS class is applied to an element.</span><br><span class="line">is_active = &quot;active&quot; in target_element.get_attribute(&quot;class&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="is-displayed"><a href="#is-displayed" class="headerlink" title="is_displayed()"></a>is_displayed()</h2><p>Whether the element is visible to a user.</p>
<h2 id="is-enabled"><a href="#is-enabled" class="headerlink" title="is_enabled()"></a>is_enabled()</h2><p>Returns whether the element is enabled.</p>
<h2 id="is-selected"><a href="#is-selected" class="headerlink" title="is_selected()"></a>is_selected()</h2><p>Returns whether the element is selected. Can be used to check if a checkbox or radio button is selected.</p>
<h2 id="screenshot-filename"><a href="#screenshot-filename" class="headerlink" title="screenshot(filename)"></a>screenshot(filename)</h2><p>Gets the screenshot of the current element. Returns False if there is any IOError, else returns True. Use full paths in your filename.</p>
<ul>
<li>filename: The full path you wish to save your screenshot to.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.screenshot(‘/Screenshots/foo.png’)</span><br></pre></td></tr></table></figure>
<h2 id="send-keys-value"><a href="#send-keys-value" class="headerlink" title="send_keys(*value)"></a>send_keys(*value)</h2><p>Simulates typing into the element.</p>
<ul>
<li>value - A string for typing, or setting form fields. For setting<br>file inputs, this could be a local file path.</li>
</ul>
<p>Use this to send simple key events or to fill out form fields:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">form_textfield = driver.find_element_by_name(&apos;username&apos;)</span><br><span class="line">form_textfield.send_keys(&quot;admin&quot;)</span><br></pre></td></tr></table></figure>
<p>This can also be used to set file inputs.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">file_input = driver.find_element_by_name(&apos;profilePic&apos;)</span><br><span class="line">file_input.send_keys(&quot;path/to/profilepic.gif&quot;)</span><br><span class="line"># Generally it&apos;s better to wrap the file path in one of the methods</span><br><span class="line"># in os.path to return the actual path to support cross OS testing.</span><br><span class="line"># file_input.send_keys(os.path.abspath(&quot;path/to/profilepic.gif&quot;))</span><br></pre></td></tr></table></figure>
<h2 id="submit"><a href="#submit" class="headerlink" title="submit()"></a>submit()</h2><p>Submits a form.</p>
<h2 id="value-of-css-property-property-name"><a href="#value-of-css-property-property-name" class="headerlink" title="value_of_css_property(property_name)"></a>value_of_css_property(property_name)</h2><p>The value of a CSS property.</p>
<h2 id="id"><a href="#id" class="headerlink" title="id"></a>id</h2><p>Internal ID used by selenium. This is mainly for internal use. Simple use cases such as checking if 2 webelements refer to the same element, can be done using ‘==’:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if element1 == element2:</span><br><span class="line">    print(&quot;These 2 are equal&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="location"><a href="#location" class="headerlink" title="location"></a>location</h2><p>The location of the element in the renderable canvas.</p>
<h2 id="location-once-scrolled-into-view"><a href="#location-once-scrolled-into-view" class="headerlink" title="location_once_scrolled_into_view"></a>location_once_scrolled_into_view</h2><p>This property may change without warning. Use this to discover where on the screen an element is so that we can click it. This method should cause the element to be scrolled into view.</p>
<p>Returns the top lefthand corner location on the screen, or None if the element is not visible.</p>
<h2 id="parent"><a href="#parent" class="headerlink" title="parent"></a>parent</h2><p>Internal reference to the WebDriver instance this element was found from.</p>
<h2 id="rect"><a href="#rect" class="headerlink" title="rect"></a>rect</h2><p>A dictionary with the size and location of the element.</p>
<h2 id="screenshot-as-base64"><a href="#screenshot-as-base64" class="headerlink" title="screenshot_as_base64"></a>screenshot_as_base64</h2><p>Gets the screenshot of the current element as a base64 encoded string.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img_b64 = element.screenshot_as_base64</span><br></pre></td></tr></table></figure>
<h2 id="screenshot-as-png"><a href="#screenshot-as-png" class="headerlink" title="screenshot_as_png"></a>screenshot_as_png</h2><p>Gets the screenshot of the current element as a binary data.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element_png = element.screenshot_as_png</span><br></pre></td></tr></table></figure>
<h2 id="size"><a href="#size" class="headerlink" title="size"></a>size</h2><p>The size of the element.</p>
<h2 id="tag-name"><a href="#tag-name" class="headerlink" title="tag_name"></a>tag_name</h2><p>This element’s tagName property.</p>
<h2 id="text-1"><a href="#text-1" class="headerlink" title="text"></a>text</h2><p>The text of the element.</p>
<h1 id="UI-Support"><a href="#UI-Support" class="headerlink" title="UI Support"></a>UI Support</h1><h2 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.webdriver.support.select.Select(webelement)</span><br></pre></td></tr></table></figure>
<h3 id="deselect-all"><a href="#deselect-all" class="headerlink" title="deselect_all()"></a>deselect_all()</h3><p>Clear all selected entries. This is only valid when the SELECT supports multiple selections. throws NotImplementedError If the SELECT does not support multiple selections</p>
<h3 id="deselect-by-index-index"><a href="#deselect-by-index-index" class="headerlink" title="deselect_by_index(index)"></a>deselect_by_index(index)</h3><p>Deselect the option at the given index. This is done by examing the “index” attribute of an element, and not merely by counting.</p>
<ul>
<li>index - The option at this index will be deselected. </li>
</ul>
<p>Throws NoSuchElementException If there is no option with specisied index in SELECT.</p>
<h3 id="deselect-by-value-value"><a href="#deselect-by-value-value" class="headerlink" title="deselect_by_value(value)"></a>deselect_by_value(value)</h3><p>Deselect all options that have a value matching the argument. That is, when given “foo” this would deselect an option like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;option value=”foo”&gt;Bar&lt;/option&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>value - The value to match against</li>
</ul>
<p>Throws NoSuchElementException If there is no option with specisied value in SELECT.</p>
<h3 id="deselect-by-visible-text-text"><a href="#deselect-by-visible-text-text" class="headerlink" title="deselect_by_visible_text(text)"></a>deselect_by_visible_text(text)</h3><p>Deselect all options that display text matching the argument. That is, when given “Bar” this would deselect an option like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;option value=”foo”&gt;Bar&lt;/option&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>text - The visible text to match against</li>
</ul>
<h3 id="select-by-index-index"><a href="#select-by-index-index" class="headerlink" title="select_by_index(index)"></a>select_by_index(index)</h3><p>Select the option at the given index. This is done by examing the “index” attribute of an element, and not merely by counting.</p>
<ul>
<li>index - The option at this index will be selected</li>
</ul>
<p>Throws NoSuchElementException If there is no option with specisied index in SELECT</p>
<h3 id="select-by-value-value"><a href="#select-by-value-value" class="headerlink" title="select_by_value(value)"></a>select_by_value(value)</h3><p>Select all options that have a value matching the argument. That is, when given “foo” this would select an option like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;option value=”foo”&gt;Bar&lt;/option&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>value - The value to match against</li>
</ul>
<p>Throws NoSuchElementException If there is no option with specisied value in SELECT.</p>
<h3 id="select-by-visible-text-text"><a href="#select-by-visible-text-text" class="headerlink" title="select_by_visible_text(text)"></a>select_by_visible_text(text)</h3><p>Select all options that display text matching the argument. That is, when given “Bar” this would select an option like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;option value=”foo”&gt;Bar&lt;/option&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>text - The visible text to match against</li>
</ul>
<p>Throws NoSuchElementException If there is no option with specisied text in SELECT.</p>
<h3 id="all-selected-options"><a href="#all-selected-options" class="headerlink" title="all_selected_options"></a>all_selected_options</h3><p>Returns a list of all selected options belonging to this select tag</p>
<h3 id="first-selected-option"><a href="#first-selected-option" class="headerlink" title="first_selected_option"></a>first_selected_option</h3><p>The first selected option in this select tag (or the currently selected option in a normal select)</p>
<h3 id="options"><a href="#options" class="headerlink" title="options"></a>options</h3><p>Returns a list of all options belonging to this select tag</p>
<h2 id="WebDriverWait"><a href="#WebDriverWait" class="headerlink" title="WebDriverWait"></a>WebDriverWait</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.webdriver.support.wait.WebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None)</span><br></pre></td></tr></table></figure>
<h3 id="until-method-message-’’"><a href="#until-method-message-’’" class="headerlink" title="until(method, message=’’)"></a>until(method, message=’’)</h3><p>Calls the method provided with the driver as an argument until the return value is not False.</p>
<h3 id="until-not-method-message-’’"><a href="#until-not-method-message-’’" class="headerlink" title="until_not(method, message=’’)"></a>until_not(method, message=’’)</h3><p>Calls the method provided with the driver as an argument until the return value is False.</p>
<h1 id="Color-Support"><a href="#Color-Support" class="headerlink" title="Color Support"></a>Color Support</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.webdriver.support.color.Color(red, green, blue, alpha=1)</span><br></pre></td></tr></table></figure>
<p>Color conversion support class. Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.support.color import Color</span><br><span class="line"></span><br><span class="line">print Color.from_string(&apos;#00ff33&apos;).rgba</span><br><span class="line">print Color.from_string(&apos;rgb(1, 255, 3)&apos;).hex</span><br><span class="line">print Color.from_string(&apos;blue&apos;).rgba</span><br></pre></td></tr></table></figure>
<p>Methods and attributes:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static from_string(str) # static method</span><br><span class="line">hex # attribute</span><br><span class="line">rgb # attribute</span><br><span class="line">rgba # attribute</span><br></pre></td></tr></table></figure>
<h1 id="Expected-Conditions-Support"><a href="#Expected-Conditions-Support" class="headerlink" title="Expected Conditions Support"></a>Expected Conditions Support</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.support.expected_conditions import *</span><br></pre></td></tr></table></figure>
<h2 id="alert-is-present"><a href="#alert-is-present" class="headerlink" title="alert_is_present"></a>alert_is_present</h2><p>Expect an alert to be present.</p>
<h2 id="element-located-selection-state-to-be-locator-is-selected"><a href="#element-located-selection-state-to-be-locator-is-selected" class="headerlink" title="element_located_selection_state_to_be(locator, is_selected)"></a>element_located_selection_state_to_be(locator, is_selected)</h2><p>An expectation to locate an element and check if the selection state specified is in that state. locator is a tuple of (by, path) is_selected is a boolean.</p>
<h2 id="element-located-to-be-selected-locator"><a href="#element-located-to-be-selected-locator" class="headerlink" title="element_located_to_be_selected(locator)"></a>element_located_to_be_selected(locator)</h2><p>An expectation for the element to be located is selected. locator is a tuple of (by, path).</p>
<h2 id="element-selection-state-to-be-element-is-selected"><a href="#element-selection-state-to-be-element-is-selected" class="headerlink" title="element_selection_state_to_be(element, is_selected)"></a>element_selection_state_to_be(element, is_selected)</h2><p>An expectation for checking if the given element is selected. element is WebElement object is_selected is a Boolean.</p>
<h2 id="element-to-be-clickable-locator"><a href="#element-to-be-clickable-locator" class="headerlink" title="element_to_be_clickable(locator)"></a>element_to_be_clickable(locator)</h2><p>An Expectation for checking an element is visible and enabled such that you can click it.</p>
<h2 id="element-to-be-selected-element"><a href="#element-to-be-selected-element" class="headerlink" title="element_to_be_selected(element)"></a>element_to_be_selected(element)</h2><p>An expectation for checking the selection is selected. element is WebElement object.</p>
<h2 id="frame-to-be-available-and-switch-to-it-locator"><a href="#frame-to-be-available-and-switch-to-it-locator" class="headerlink" title="frame_to_be_available_and_switch_to_it(locator)"></a>frame_to_be_available_and_switch_to_it(locator)</h2><p>An expectation for checking whether the given frame is available to switch to. If the frame is available it switches the given driver to the specified frame.</p>
<h2 id="invisibility-of-element-located-locator"><a href="#invisibility-of-element-located-locator" class="headerlink" title="invisibility_of_element_located(locator)"></a>invisibility_of_element_located(locator)</h2><p>An Expectation for checking that an element is either invisible or not present on the DOM. locator used to find the element.</p>
<h2 id="presence-of-all-elements-located-locator"><a href="#presence-of-all-elements-located-locator" class="headerlink" title="presence_of_all_elements_located(locator)"></a>presence_of_all_elements_located(locator)</h2><p>An expectation for checking that there is at least one element present on a web page. locator is used to find the element returns the list of WebElements once they are located.</p>
<h2 id="presence-of-element-located-locator"><a href="#presence-of-element-located-locator" class="headerlink" title="presence_of_element_located(locator)"></a>presence_of_element_located(locator)</h2><p>An expectation for checking that an element is present on the DOM of a page. This does not necessarily mean that the element is visible. locator - used to find the element returns the WebElement once it is located.</p>
<h2 id="staleness-of-element"><a href="#staleness-of-element" class="headerlink" title="staleness_of(element)"></a>staleness_of(element)</h2><p>Wait until an element is no longer attached to the DOM. element is the element to wait for. returns False if the element is still attached to the DOM, true otherwise.</p>
<h2 id="text-to-be-present-inelement-locator-text"><a href="#text-to-be-present-inelement-locator-text" class="headerlink" title="text_to_be_present_inelement(locator, text)"></a>text_to_be_present_in<em>element(locator, text</em>)</h2><p>An expectation for checking if the given text is present in the specified element. locator, text.</p>
<h2 id="text-to-be-present-in-elementvalue-locator-text"><a href="#text-to-be-present-in-elementvalue-locator-text" class="headerlink" title="text_to_be_present_in_elementvalue(locator, text)"></a>text_to_be_present_in_element<em>value(locator, text</em>)</h2><p>An expectation for checking if the given text is present in the element’s locator, text.</p>
<h2 id="title-contains-title"><a href="#title-contains-title" class="headerlink" title="title_contains(title)"></a>title_contains(title)</h2><p>An expectation for checking that the title contains a case-sensitive substring. title is the fragment of title expected returns True when the title matches, False otherwise.</p>
<h2 id="title-is-title"><a href="#title-is-title" class="headerlink" title="title_is(title)"></a>title_is(title)</h2><p>An expectation for checking the title of a page. title is the expected title, which must be an exact match returns True if the title matches, false otherwise.</p>
<h2 id="visibility-of-element"><a href="#visibility-of-element" class="headerlink" title="visibility_of(element)"></a>visibility_of(element)</h2><p>An expectation for checking that an element, known to be present on the DOM of a page, is visible. Visibility means that the element is not only displayed but also has a height and width that is greater than 0. element is the WebElement returns the (same) WebElement once it is visible.</p>
<h2 id="visibility-of-any-elements-located-locator"><a href="#visibility-of-any-elements-located-locator" class="headerlink" title="visibility_of_any_elements_located(locator)"></a>visibility_of_any_elements_located(locator)</h2><p>An expectation for checking that there is at least one element visible on a web page. locator is used to find the element returns the list of WebElements once they are located.</p>
<h2 id="visibility-of-element-located-locator"><a href="#visibility-of-element-located-locator" class="headerlink" title="visibility_of_element_located(locator)"></a>visibility_of_element_located(locator)</h2><p>An expectation for checking that an element is present on the DOM of a page and visible. Visibility means that the element is not only displayed but also has a height and width that is greater than 0. locator - used to find the element returns the WebElement once it is located and visible.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Selenium-Page-Object]]></title>
      <url>http://lizonghang.github.io/2016/08/01/Selenium-Page-Object/</url>
      <content type="html"><![CDATA[<p>This chapter is a tutorial introduction to page objects design pattern. A page object represents an area in the web application user interface that your test is interacting.</p>
<p>Benefits of using page object pattern:</p>
<ul>
<li>Creating reusable code that can be shared across multiple test cases</li>
<li>Reducing the amount of duplicated code</li>
<li>If the user interface changes, the fix needs changes in only one place</li>
</ul>
<h1 id="Test-case"><a href="#Test-case" class="headerlink" title="Test case"></a>Test case</h1><p>Here is a test case which searches for a word in python.org website and ensure some results are found.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">from selenium import webdriver</span><br><span class="line">import page</span><br><span class="line"></span><br><span class="line">class PythonOrgSearch(unittest.TestCase):</span><br><span class="line">    &apos;&apos;&apos;A simple test class to show how page object works&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    def setUp(self):</span><br><span class="line">        self.driver = webdriver.Chrome()</span><br><span class="line">        self.driver.get(&apos;http://www.python.org&apos;)</span><br><span class="line"></span><br><span class="line">    def test_search_in_python_org(self):</span><br><span class="line">        &apos;&apos;&apos;</span><br><span class="line">        Tests python.org search feature. Searches for the word &quot;pycon&quot; then verified that some results show up.</span><br><span class="line">        Note that it does not look for any particular text in search results page. This test verifies that</span><br><span class="line">        the results were not empty.</span><br><span class="line">        &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">        # load the main page. In this case the home page of Python.org</span><br><span class="line">        main_page = page.MainPage(self.driver)</span><br><span class="line">        # checks if the word &apos;Python&apos; is in title</span><br><span class="line">        assert main_page.is_title_matches(), &apos;python.org title doesn\&apos;t match.&apos;</span><br><span class="line">        # sets the text of search textbox to &apos;pycon&apos;</span><br><span class="line">        main_page.search_text_element = &apos;pycon&apos;</span><br><span class="line">        main_page.click_go_button()</span><br><span class="line">        search_results_page = page.SearchResultsPage(self.driver)</span><br><span class="line">        # verifies that the results page is not empty</span><br><span class="line">        assert search_results_page.is_results_found(), &apos;No results found.&apos;</span><br><span class="line"></span><br><span class="line">    def tearDown(self):</span><br><span class="line">        self.driver.quit()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<h1 id="Page-object-classes"><a href="#Page-object-classes" class="headerlink" title="Page object classes"></a>Page object classes</h1><p>The page object pattern intends creating an object for each web page. By following this technique a layer of separation between the test code and technical implementation is created.</p>
<p>The “page.py” will look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">from element import BasePageElement</span><br><span class="line">from locators import MainPageLocators</span><br><span class="line"></span><br><span class="line">class SearchTextElement(BasePageElement):</span><br><span class="line">    &quot;&quot;&quot;This class gets the search text from the specified locator&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # The locator for search box where search string is entered</span><br><span class="line">    locator = &apos;q&apos;</span><br><span class="line"></span><br><span class="line">class BasePage(object):</span><br><span class="line">    &quot;&quot;&quot;Base class to initialize the base page that will be called from all pages&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, driver):</span><br><span class="line">        self.driver = driver</span><br><span class="line"></span><br><span class="line">class MainPage(BasePage):</span><br><span class="line">    &quot;&quot;&quot;Home page action methods come here. I.e. Python.org&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # Declares a variable that will contain the retrieved text</span><br><span class="line">    search_text_element = SearchTextElement()</span><br><span class="line"></span><br><span class="line">    def is_title_matches(self):</span><br><span class="line">        &quot;&quot;&quot;Verifies that the hardcoded text &quot;Python&quot; appears in page title&quot;&quot;&quot;</span><br><span class="line">        return &apos;Python&apos; in self.driver.title</span><br><span class="line"></span><br><span class="line">    def click_go_button(self):</span><br><span class="line">        &quot;&quot;&quot;Triggers the search&quot;&quot;&quot;</span><br><span class="line">        element = self.driver.find_element(*MainPageLocators.GO_BUTTON)</span><br><span class="line">        element.click()</span><br><span class="line"></span><br><span class="line">class SearchResultsPage(BasePage):</span><br><span class="line">    &quot;&quot;&quot;Search results page action methods come here&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def is_results_found(self):</span><br><span class="line">        # Probably should search for this text in the specific page</span><br><span class="line">        # element, but as for now it works fine</span><br><span class="line">        return &apos;No results found&apos; not in self.driver.page_source</span><br></pre></td></tr></table></figure>
<h1 id="Page-elements"><a href="#Page-elements" class="headerlink" title="Page elements"></a>Page elements</h1><p>The “element.py” will look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line"></span><br><span class="line">class BasePageElement(object):</span><br><span class="line">    &quot;&quot;&quot;Base page class that is initialized on every page object class.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __set__(self, obj, value):</span><br><span class="line">        &quot;&quot;&quot;Sets the text to the value supplied&quot;&quot;&quot;</span><br><span class="line">        driver = obj.driver</span><br><span class="line">        WebDriverWait(driver, 100).until(</span><br><span class="line">            lambda driver: driver.find_element_by_name(self.locator))</span><br><span class="line">        driver.find_element_by_name(self.locator).send_keys(value)</span><br><span class="line"></span><br><span class="line">    def __get__(self, obj, owner):</span><br><span class="line">        &quot;&quot;&quot;Gets the text of the specified object&quot;&quot;&quot;</span><br><span class="line">        driver = obj.driver</span><br><span class="line">        WebDriverWait(driver, 100).until(</span><br><span class="line">            lambda driver: driver.find_element_by_name(self.locator))</span><br><span class="line">        element = driver.find_element_by_name(self.locator)</span><br><span class="line">        return element.get_attribute(&apos;value&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="Locators"><a href="#Locators" class="headerlink" title="Locators"></a>Locators</h1><p>One of the practices is to separate the locator strings from the place where they are being used. In this example, locators of the same page belong to same class.</p>
<p>The “locators.py” will look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line"></span><br><span class="line">class MainPageLocators(object):</span><br><span class="line">    &quot;&quot;&quot;A class for main page locators. All main page locators should come here&quot;&quot;&quot;</span><br><span class="line">    GO_BUTTON = (By.ID, &apos;submit&apos;)</span><br><span class="line"></span><br><span class="line">class SearchResultsPageLocators(object):</span><br><span class="line">    &quot;&quot;&quot;A class for search results locators. All search results locators should come here&quot;&quot;&quot;</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Selenium-Waits]]></title>
      <url>http://lizonghang.github.io/2016/08/01/Selenium-Waits/</url>
      <content type="html"><![CDATA[<p>These days most of the web apps are using AJAX techniques. When a page is loaded to browser, the elements within that page may load at different time intervals. This makes locating elements difficult, if the element is not present in the DOM, it will raise ElementNotVisibleException exception. Using waits, we can solve this issue. Waiting provides some time interval between actions performed - mostly locating element or any other operation with the element.</p>
<p>Selenium Webdriver provides two types of waits - implicit &amp; explicit. An explicit wait makes WebDriver to wait for a certain condition to occur before proceeding further with executions. An implicit wait makes WebDriver to poll the DOM for a certain amount of time when trying to locate an element.</p>
<h1 id="Explicit-Waits"><a href="#Explicit-Waits" class="headerlink" title="Explicit Waits"></a>Explicit Waits</h1><p>An explicit wait is code you define to wait for a certain condition to occur before proceeding further in the code. The worst case of this is time.sleep(), which sets the condition to an exact time period to wait. There are some convenience methods provided that help you write code that will wait only as long as required. WebDriverWait in combination with ExpectedCondition is one way this can be accomplished.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(&quot;http://somedomain/url_that_delays_loading&quot;)</span><br><span class="line">try:</span><br><span class="line">    element = WebDriverWait(driver, 10).until(</span><br><span class="line">        EC.presence_of_element_located((By.ID, &quot;myDynamicElement&quot;))</span><br><span class="line">    )</span><br><span class="line">finally:</span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>
<p>This waits up to 10 seconds before throwing a TimeoutException or if it finds the element will return it in 0 - 10 seconds. WebDriverWait by default calls the ExpectedCondition every 500 milliseconds until it returns successfully. A successful return is for ExpectedCondition type is Boolean return true or not null return value for all other ExpectedCondition types.</p>
<h2 id="Expected-Conditions"><a href="#Expected-Conditions" class="headerlink" title="Expected Conditions"></a>Expected Conditions</h2><p>There are some common conditions that are frequent when automating web browsers. Listed below are Implementations of each. Selenium Python binding provides some convienence methods so you don’t have to code an expected_condition class yourself or create your own utility package for them.</p>
<ul>
<li>title_is</li>
<li>title_contains</li>
<li>presence_of_element_located</li>
<li>visibility_of_element_located</li>
<li>visibility_of</li>
<li>presence_of_all_elements_located</li>
<li>text_to_be_present_in_element</li>
<li>text_to_be_present_in_element_value</li>
<li>frame_to_be_available_and_switch_to_it</li>
<li>invisibility_of_element_located</li>
<li>element_to_be_clickable - it is Displayed and Enabled.</li>
<li>staleness_of</li>
<li>element_to_be_selected</li>
<li>element_located_to_be_selected</li>
<li>element_selection_state_to_be</li>
<li>element_located_selection_state_to_be</li>
<li>alert_is_present</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line"></span><br><span class="line">wait = WebDriverWait(driver, 10)</span><br><span class="line">element = wait.until(EC.element_to_be_clickable((By.ID,&apos;someid&apos;)))</span><br></pre></td></tr></table></figure>
<p>The expected_conditions module contains a set of predefined conditions to use with WebDriverWait.</p>
<h1 id="Implicit-Waits"><a href="#Implicit-Waits" class="headerlink" title="Implicit Waits"></a>Implicit Waits</h1><p>An implicit wait is to tell WebDriver to poll the DOM for a certain amount of time when trying to find an element or elements if they are not immediately available. The default setting is 0. Once set, the implicit wait is set for the life of the WebDriver object instance.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.implicitly_wait(10) # seconds</span><br><span class="line">driver.get(&quot;http://somedomain/url_that_delays_loading&quot;)</span><br><span class="line">myDynamicElement = driver.find_element_by_id(&quot;myDynamicElement&quot;)</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Selenium-Locating]]></title>
      <url>http://lizonghang.github.io/2016/08/01/Selenium-Locating/</url>
      <content type="html"><![CDATA[<p>There are various strategies to locate elements in a page. You can use the most appropriate one for your case. Selenium provides the following methods to locate elements in a page:</p>
<ul>
<li>find_element_by_id</li>
<li>find_element_by_name</li>
<li>find_element_by_xpath</li>
<li>find_element_by_link_text</li>
<li>find_element_by_partial_link_text</li>
<li>find_element_by_tag_name</li>
<li>find_element_by_class_name</li>
<li>find_element_by_css_selector</li>
</ul>
<p>To find multiple elements (these methods will return a list):</p>
<ul>
<li>find_elements_by_name</li>
<li>find_elements_by_xpath</li>
<li>find_elements_by_link_text</li>
<li>find_elements_by_partial_link_text</li>
<li>find_elements_by_tag_name</li>
<li>find_elements_by_class_name</li>
<li>find_elements_by_css_selector</li>
</ul>
<p>Apart from the public methods given above, there are two private methods which might be useful with locators in page objects. These are the two private methods: find_element and find_elements.</p>
<p>Example usage:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line"></span><br><span class="line">driver.find_element(By.XPATH, &apos;//button[text()=&quot;Some text&quot;]&apos;)</span><br><span class="line">driver.find_elements(By.XPATH, &apos;//button&apos;)</span><br></pre></td></tr></table></figure>
<p>These are the attributes available for By class:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ID = &quot;id&quot;</span><br><span class="line">XPATH = &quot;xpath&quot;</span><br><span class="line">LINK_TEXT = &quot;link text&quot;</span><br><span class="line">PARTIAL_LINK_TEXT = &quot;partial link text&quot;</span><br><span class="line">NAME = &quot;name&quot;</span><br><span class="line">TAG_NAME = &quot;tag name&quot;</span><br><span class="line">CLASS_NAME = &quot;class name&quot;</span><br><span class="line">CSS_SELECTOR = &quot;css selector&quot;</span><br></pre></td></tr></table></figure>
<h1 id="Locating-by-Id"><a href="#Locating-by-Id" class="headerlink" title="Locating by Id"></a>Locating by Id</h1><p>Use this when you know id attribute of an element. With this strategy, the first element with the id attribute value matching the location will be returned. If no element has a matching id attribute, a <code>NoSuchElementException</code> will be raised.</p>
<p>For instance, consider this page source:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;form id=&quot;loginForm&quot;&gt;</span><br><span class="line">   &lt;input name=&quot;username&quot; type=&quot;text&quot; /&gt;</span><br><span class="line">   &lt;input name=&quot;password&quot; type=&quot;password&quot; /&gt;</span><br><span class="line">   &lt;input name=&quot;continue&quot; type=&quot;submit&quot; value=&quot;Login&quot; /&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"> &lt;/body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure>
<p>The form element can be located like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_form = driver.find_element_by_id(&apos;loginForm&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="Locating-by-Name"><a href="#Locating-by-Name" class="headerlink" title="Locating by Name"></a>Locating by Name</h1><p>Use this when you know name attribute of an element. With this strategy, the first element with the name attribute value matching the location will be returned. If no element has a matching name attribute, a <code>NoSuchElementException</code> will be raised.</p>
<p>For instance, consider this page source:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;form id=&quot;loginForm&quot;&gt;</span><br><span class="line">   &lt;input name=&quot;username&quot; type=&quot;text&quot; /&gt;</span><br><span class="line">   &lt;input name=&quot;password&quot; type=&quot;password&quot; /&gt;</span><br><span class="line">   &lt;input name=&quot;continue&quot; type=&quot;submit&quot; value=&quot;Login&quot; /&gt;</span><br><span class="line">   &lt;input name=&quot;continue&quot; type=&quot;button&quot; value=&quot;Clear&quot; /&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure>
<p>The username &amp; password elements can be located like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username = driver.find_element_by_name(&apos;username&apos;)</span><br><span class="line">password = driver.find_element_by_name(&apos;password&apos;)</span><br></pre></td></tr></table></figure>
<p>This will give the “Login” button as it occurs before the “Clear” button:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">continue = driver.find_element_by_name(&apos;continue&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="Locating-by-XPath"><a href="#Locating-by-XPath" class="headerlink" title="Locating by XPath"></a>Locating by XPath</h1><p>XPath is the language used for locating nodes in an XML document. As HTML can be an implementation of XML (XHTML), Selenium users can leverage this powerful language to target elements in their web applications. XPath extends beyond (as well as supporting) the simple methods of locating by id or name attributes, and opens up all sorts of new possibilities such as locating the third checkbox on the page.</p>
<p>One of the main reasons for using XPath is when you don’t have a suitable id or name attribute for the element you wish to locate. You can use XPath to either locate the element in absolute terms (not advised), or relative to an element that does have an id or name attribute. XPath locators can also be used to specify elements via attributes other than id and name.</p>
<p>Absolute XPaths contain the location of all elements from the root (html) and as a result are likely to fail with only the slightest adjustment to the application. By finding a nearby element with an id or name attribute (ideally a parent element) you can locate your target element based on the relationship. This is much less likely to change and can make your tests more robust.</p>
<p>For instance, consider this page source:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;form id=&quot;loginForm&quot;&gt;</span><br><span class="line">   &lt;input name=&quot;username&quot; type=&quot;text&quot; /&gt;</span><br><span class="line">   &lt;input name=&quot;password&quot; type=&quot;password&quot; /&gt;</span><br><span class="line">   &lt;input name=&quot;continue&quot; type=&quot;submit&quot; value=&quot;Login&quot; /&gt;</span><br><span class="line">   &lt;input name=&quot;continue&quot; type=&quot;button&quot; value=&quot;Clear&quot; /&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure>
<p>The form elements can be located like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">login_form = driver.find_element_by_xpath(&quot;/html/body/form[1]&quot;)</span><br><span class="line">login_form = driver.find_element_by_xpath(&quot;//form[1]&quot;)</span><br><span class="line">login_form = driver.find_element_by_xpath(&quot;//form[@id=&apos;loginForm&apos;]&quot;)</span><br></pre></td></tr></table></figure>
<ol>
<li>Absolute path (would break if the HTML was changed only slightly)</li>
<li>First form element in the HTML</li>
<li>The form element with attribute named id and the value loginForm</li>
</ol>
<p>The username element can be located like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username = driver.find_element_by_xpath(&quot;//form[input/@name=&apos;username&apos;]&quot;)</span><br><span class="line">username = driver.find_element_by_xpath(&quot;//form[@id=&apos;loginForm&apos;]/input[1]&quot;)</span><br><span class="line">username = driver.find_element_by_xpath(&quot;//input[@name=&apos;username&apos;]&quot;)</span><br></pre></td></tr></table></figure>
<ol>
<li>First form element with an input child element with attribute named name and the value username</li>
<li>First input child element of the form element with attribute named id and the value loginForm</li>
<li>First input element with attribute named ‘name’ and the value username</li>
</ol>
<p>The “Clear” button element can be located like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clear_button = driver.find_element_by_xpath(&quot;//input[@name=&apos;continue&apos;][@type=&apos;button&apos;]&quot;)</span><br><span class="line">clear_button = driver.find_element_by_xpath(&quot;//form[@id=&apos;loginForm&apos;]/input[4]&quot;)</span><br></pre></td></tr></table></figure>
<ol>
<li>Input with attribute named name and the value continue and attribute named type and the value button</li>
<li>Fourth input child element of the form element with attribute named id and value loginForm</li>
</ol>
<p>These examples cover some basics, but in order to learn more, the following references are recommended:</p>
<ul>
<li><a href="http://www.w3schools.com/xsl/xpath_intro.asp" target="_blank" rel="external">W3Schools XPath Tutorial</a></li>
<li><a href="http://www.w3.org/TR/xpath" target="_blank" rel="external">W3C XPath Recommendation</a></li>
<li><a href="http://www.zvon.org/comp/r/tut-XPath_1.html" target="_blank" rel="external">XPath Tutorial</a> - with interactive examples.</li>
</ul>
<p>There are also a couple of very useful Add-ons that can assist in discovering the XPath of an element:</p>
<ul>
<li><a href="https://addons.mozilla.org/en-US/firefox/addon/1095?id=1095" target="_blank" rel="external">XPath Checker</a> - suggests XPath and can be used to test XPath results.</li>
<li><a href="https://addons.mozilla.org/en-US/firefox/addon/1843" target="_blank" rel="external">Firebug</a> - XPath suggestions are just one of the many powerful features of this very useful add-on.</li>
<li><a href="https://chrome.google.com/webstore/detail/hgimnogjllphhhkhlmebbmlgjoejdpjl" target="_blank" rel="external">XPath Helper</a> - for Google Chrome</li>
</ul>
<h1 id="Locating-Hyperlinks-by-Link-Text"><a href="#Locating-Hyperlinks-by-Link-Text" class="headerlink" title="Locating Hyperlinks by Link Text"></a>Locating Hyperlinks by Link Text</h1><p>Use this when you know link text used within an anchor tag. With this strategy, the first element with the link text value matching the location will be returned. If no element has a matching link text attribute, a <code>NoSuchElementException</code> will be raised.</p>
<p>For instance, consider this page source:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;p&gt;Are you sure you want to do this?&lt;/p&gt;</span><br><span class="line">  &lt;a href=&quot;continue.html&quot;&gt;Continue&lt;/a&gt;</span><br><span class="line">  &lt;a href=&quot;cancel.html&quot;&gt;Cancel&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure>
<p>The continue.html link can be located like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">continue_link = driver.find_element_by_link_text(&apos;Continue&apos;)</span><br><span class="line">continue_link = driver.find_element_by_partial_link_text(&apos;Conti&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="Locating-Elements-by-Tag-Name"><a href="#Locating-Elements-by-Tag-Name" class="headerlink" title="Locating Elements by Tag Name"></a>Locating Elements by Tag Name</h1><p>Use this when you want to locate an element by tag name. With this strategy, the first element with the given tag name will be returned. If no element has a matching tag name, a <code>NoSuchElementException</code> will be raised.</p>
<p>For instance, consider this page source:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;h1&gt;Welcome&lt;/h1&gt;</span><br><span class="line">  &lt;p&gt;Site content goes here.&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure>
<p>The heading (h1) element can be located like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heading1 = driver.find_element_by_tag_name(&apos;h1&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="Locating-Elements-by-Class-Name"><a href="#Locating-Elements-by-Class-Name" class="headerlink" title="Locating Elements by Class Name"></a>Locating Elements by Class Name</h1><p>Use this when you want to locate an element by class attribute name. With this strategy, the first element with the matching class attribute name will be returned. If no element has a matching class attribute name, a <code>NoSuchElementException</code> will be raised.</p>
<p>For instance, consider this page source:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;p class=&quot;content&quot;&gt;Site content goes here.&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure>
<p>The “p” element can be located like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content = driver.find_element_by_class_name(&apos;content&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="Locating-Elements-by-CSS-Selectors"><a href="#Locating-Elements-by-CSS-Selectors" class="headerlink" title="Locating Elements by CSS Selectors"></a>Locating Elements by CSS Selectors</h1><p>Use this when you want to locate an element by CSS selector syntax. With this strategy, the first element with the matching CSS selector will be returned. If no element has a matching CSS selector, a <code>NoSuchElementException</code> will be raised.</p>
<p>For instance, consider this page source:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">  &lt;p class=&quot;content&quot;&gt;Site content goes here.&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure>
<p>The “p” element can be located like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content = driver.find_element_by_css_selector(&apos;p.content&apos;)</span><br></pre></td></tr></table></figure>
<p><a href="http://saucelabs.com/resources/selenium/css-selectors" target="_blank" rel="external">Sauce Labs</a> has good documentation on CSS selectors.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Selenium-Navigating]]></title>
      <url>http://lizonghang.github.io/2016/07/31/Selenium-Navigating/</url>
      <content type="html"><![CDATA[<p>The first thing you’ll want to do with WebDriver is navigate to a link. The normal way to do this is by calling <code>get</code> method:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get(&quot;http://www.google.com&quot;)</span><br></pre></td></tr></table></figure>
<p>WebDriver will wait until the page has fully loaded (that is, the <code>onload</code> event has fired) before returning control to your test or script. It’s worth noting that if your page uses a lot of AJAX on load then WebDriver may not know when it has completely loaded. If you need to ensure such pages are fully loaded then you can use waits.</p>
<h1 id="Interacting-with-the-page"><a href="#Interacting-with-the-page" class="headerlink" title="Interacting with the page"></a>Interacting with the page</h1><h2 id="driver-find-element-by"><a href="#driver-find-element-by" class="headerlink" title="driver.find_element_by_*()"></a>driver.find_element_by_*()</h2><p>Just being able to go to places isn’t terribly useful. What we’d really like to do is to interact with the pages, or, more specifically, the HTML elements within a page. First of all, we need to find one. WebDriver offers a number of ways to find elements. For example, given an element defined as:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; name=&quot;passwd&quot; id=&quot;passwd-id&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>you could find it using any of:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">element = driver.find_element_by_id(&quot;passwd-id&quot;)</span><br><span class="line">element = driver.find_element_by_name(&quot;passwd&quot;)</span><br><span class="line">element = driver.find_element_by_xpath(&quot;//input[@id=&apos;passwd-id&apos;]&quot;)</span><br></pre></td></tr></table></figure>
<p>You can also look for a link by its text, but be careful! The text must be an exact match! You should also be careful when using XPATH in WebDriver. If there’s more than one element that matches the query, then only the first will be returned. If nothing can be found, a NoSuchElementException will be raised.</p>
<p>WebDriver has an “Object-based” API; we represent all types of elements using the same interface. This means that although you may see a lot of possible methods you could invoke when you hit your IDE’s auto-complete key combination, not all of them will make sense or be valid. Don’t worry! WebDriver will attempt to do the Right Thing, and if you call a method that makes no sense (“setSelected()” on a “meta” tag, for example) an exception will be raised.</p>
<h2 id="element-send-keys"><a href="#element-send-keys" class="headerlink" title="element.send_keys()"></a>element.send_keys()</h2><p>So, you’ve got an element. What can you do with it? First of all, you may want to enter some text into a text field:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.send_keys(&quot;some text&quot;)</span><br></pre></td></tr></table></figure>
<p>You can simulate pressing the arrow keys by using the “Keys” class:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.send_keys(&quot; and some&quot;, Keys.ARROW_DOWN)</span><br></pre></td></tr></table></figure>
<p>It is possible to call send_keys on any element, which makes it possible to test keyboard shortcuts such as those used on GMail. </p>
<h2 id="element-clear"><a href="#element-clear" class="headerlink" title="element.clear()"></a>element.clear()</h2><p>A side-effect of this is that typing something into a text field won’t automatically clear it. Instead, what you type will be appended to what’s already there. You can easily clear the contents of a text field or textarea with clear method:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.clear()</span><br></pre></td></tr></table></figure>
<h1 id="Filling-in-forms"><a href="#Filling-in-forms" class="headerlink" title="Filling in forms"></a>Filling in forms</h1><p>We’ve already seen how to enter text into a textarea or text field, but what about the other elements? You can “toggle” the state of drop down, and you can use “setSelected” to set something like an OPTION tag selected. </p>
<h2 id="element-click"><a href="#element-click" class="headerlink" title="element.click()"></a>element.click()</h2><p>Dealing with SELECT tags isn’t too bad:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">element = driver.find_element_by_xpath(&quot;//select[@name=&apos;name&apos;]&quot;)</span><br><span class="line">all_options = element.find_elements_by_tag_name(&quot;option&quot;)</span><br><span class="line">for option in all_options:</span><br><span class="line">    print(&quot;Value is: %s&quot; % option.get_attribute(&quot;value&quot;))</span><br><span class="line">    option.click()</span><br></pre></td></tr></table></figure>
<p>This will find the first “SELECT” element on the page, and cycle through each of it’s OPTIONs in turn, printing out their values, and selecting each in turn.</p>
<h2 id="select-select-by"><a href="#select-select-by" class="headerlink" title="select.select_by_*()"></a>select.select_by_*()</h2><p>As you can see, this isn’t the most efficient way of dealing with SELECT elements . WebDriver’s support classes include one called “Select”, which provides useful methods for interacting with these:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.support.ui import Select</span><br><span class="line">select = Select(driver.find_element_by_name(&apos;name&apos;))</span><br><span class="line">select.select_by_index(index)</span><br><span class="line">select.select_by_visible_text(&quot;text&quot;)</span><br><span class="line">select.select_by_value(value)</span><br></pre></td></tr></table></figure>
<h2 id="select-deselect-all"><a href="#select-deselect-all" class="headerlink" title="select.deselect_all()"></a>select.deselect_all()</h2><p>WebDriver also provides features for deselecting all the selected options:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select = Select(driver.find_element_by_id(&apos;id&apos;))</span><br><span class="line">select.deselect_all()</span><br></pre></td></tr></table></figure>
<p>This will deselect all OPTIONs from the first SELECT on the page.</p>
<h2 id="select-all-selected-options"><a href="#select-all-selected-options" class="headerlink" title="select.all_selected_options"></a>select.all_selected_options</h2><p>Suppose in a test, we need the list of all default selected options, Select class provides a property method that returns a list:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select = Select(driver.find_element_by_xpath(&quot;xpath&quot;))</span><br><span class="line">all_selected_options = select.all_selected_options</span><br></pre></td></tr></table></figure>
<h2 id="select-options"><a href="#select-options" class="headerlink" title="select.options"></a>select.options</h2><p>To get all available options:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options = select.options</span><br></pre></td></tr></table></figure>
<h2 id="element-submit"><a href="#element-submit" class="headerlink" title="element.submit()"></a>element.submit()</h2><p>Once you’ve finished filling out the form, you probably want to submit it. One way to do this would be to find the “submit” button and click it:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Assume the button has the ID &quot;submit&quot;</span><br><span class="line">driver.find_element_by_id(&quot;submit&quot;).click()</span><br></pre></td></tr></table></figure>
<p>Alternatively, WebDriver has the convenience method “submit” on every element. If you call this on an element within a form, WebDriver will walk up the DOM until it finds the enclosing form and then calls submit on that. If the element isn’t in a form, then the <code>NoSuchElementException</code> will be raised:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.submit()</span><br></pre></td></tr></table></figure>
<h1 id="Drag-and-drop"><a href="#Drag-and-drop" class="headerlink" title="Drag and drop"></a>Drag and drop</h1><h2 id="action-chains-drag-and-drop"><a href="#action-chains-drag-and-drop" class="headerlink" title="action_chains.drag_and_drop()"></a>action_chains.drag_and_drop()</h2><p>You can use drag and drop, either moving an element by a certain amount, or on to another element:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">element = driver.find_element_by_name(&quot;source&quot;)</span><br><span class="line">target = driver.find_element_by_name(&quot;target&quot;)</span><br><span class="line"></span><br><span class="line">from selenium.webdriver import ActionChains</span><br><span class="line">action_chains = ActionChains(driver)</span><br><span class="line">action_chains.drag_and_drop(element, target).perform()</span><br></pre></td></tr></table></figure>
<h1 id="Moving-between-windows-and-frames"><a href="#Moving-between-windows-and-frames" class="headerlink" title="Moving between windows and frames"></a>Moving between windows and frames</h1><h2 id="driver-switch-to-window"><a href="#driver-switch-to-window" class="headerlink" title="driver.switch_to_window()"></a>driver.switch_to_window()</h2><p>It’s rare for a modern web application not to have any frames or to be constrained to a single window. WebDriver supports moving between named windows using the “switch_to_window” method:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to_window(&quot;windowName&quot;)</span><br></pre></td></tr></table></figure>
<p>All calls to <code>driver</code> will now be interpreted as being directed to the particular window. But how do you know the window’s name? Take a look at the javascript or link that opened it:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;somewhere.html&quot; target=&quot;windowName&quot;&gt;Click here to open a new window&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<h2 id="driver-window-handles"><a href="#driver-window-handles" class="headerlink" title="driver.window_handles"></a>driver.window_handles</h2><p>Alternatively, you can pass a “window handle” to the “switch_to_window()” method. Knowing this, it’s possible to iterate over every open window like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for handle in driver.window_handles:</span><br><span class="line">    driver.switch_to_window(handle)</span><br></pre></td></tr></table></figure>
<h2 id="driver-switch-to-frame"><a href="#driver-switch-to-frame" class="headerlink" title="driver.switch_to_frame()"></a>driver.switch_to_frame()</h2><p>You can also swing from frame to frame (or into iframes):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to_frame(&quot;frameName&quot;)</span><br></pre></td></tr></table></figure>
<p>It’s possible to access subframes by separating the path with a dot, and you can specify the frame by its index too. That is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to_frame(&quot;frameName.0.child&quot;)</span><br></pre></td></tr></table></figure>
<p>would go to the frame named “child” of the first subframe of the frame called “frameName”. All frames are evaluated as if from *top*.</p>
<h2 id="driver-switch-to-default-content"><a href="#driver-switch-to-default-content" class="headerlink" title="driver.switch_to_default_content()"></a>driver.switch_to_default_content()</h2><p>Once we are done with working on frames, we will have to come back to the parent frame which can be done using:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to_default_content()</span><br></pre></td></tr></table></figure>
<h1 id="Popup-dialogs"><a href="#Popup-dialogs" class="headerlink" title="Popup dialogs"></a>Popup dialogs</h1><h2 id="driver-switch-to-alert"><a href="#driver-switch-to-alert" class="headerlink" title="driver.switch_to_alert()"></a>driver.switch_to_alert()</h2><p>Selenium WebDriver has built-in support for handling popup dialog boxes. After you’ve triggerd action that would open a popup, you can access the alert with the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert = driver.switch_to_alert()</span><br></pre></td></tr></table></figure>
<p>This will return the currently open alert object. With this object you can now accept, dismiss, read its contents or even type into a prompt. This interface works equally well on alerts, confirms, prompts. Refer to the API documentation for more information.</p>
<h1 id="history-and-location"><a href="#history-and-location" class="headerlink" title="history and location"></a>history and location</h1><h2 id="driver-forward-driver-back"><a href="#driver-forward-driver-back" class="headerlink" title="driver.forward()/driver.back()"></a>driver.forward()/driver.back()</h2><p>Earlier, we covered navigating to a page using the “get” command. As you’ve seen, WebDriver has a number of smaller, task-focused interfaces, and navigation is a useful task. To move backwards and forwards in your browser’s history:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">driver.forward()</span><br><span class="line">driver.back()</span><br></pre></td></tr></table></figure>
<p>Please be aware that this functionality depends entirely on the underlying driver. It’s just possible that something unexpected may happen when you call these methods if you’re used to the behaviour of one browser over another.</p>
<h1 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h1><p>Before we leave these next steps, you may be interested in understanding how to use cookies. First of all, you need to be on the domain that the cookie will be valid for：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Go to the correct domain</span><br><span class="line">driver.get(&quot;http://www.example.com&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="driver-add-cookie"><a href="#driver-add-cookie" class="headerlink" title="driver.add_cookie()"></a>driver.add_cookie()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Now set the cookie. This one&apos;s valid for the entire domain</span><br><span class="line">cookie = &#123;‘name’ : ‘foo’, ‘value’ : ‘bar’&#125;</span><br><span class="line">driver.add_cookie(cookie)</span><br></pre></td></tr></table></figure>
<h2 id="driver-get-cookies"><a href="#driver-get-cookies" class="headerlink" title="driver.get_cookies()"></a>driver.get_cookies()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># And now output all the available cookies for the current URL</span><br><span class="line">driver.get_cookies()</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Selenium自动化测试]]></title>
      <url>http://lizonghang.github.io/2016/07/31/Selenium%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/</url>
      <content type="html"><![CDATA[<p>参考Selenium官方文档 <a href="http://selenium-python.readthedocs.io/getting-started.html" target="_blank" rel="external">http://selenium-python.readthedocs.io/getting-started.html</a></p>
<h1 id="第三方库"><a href="#第三方库" class="headerlink" title="第三方库"></a>第三方库</h1><h2 id="selenium"><a href="#selenium" class="headerlink" title="selenium"></a>selenium</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install selenium</span><br></pre></td></tr></table></figure>
<p>如果下载时抛出了如下错误，可不予理会：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OSError: [Errno 1] Operation not permitted: &apos;/System/Library/Frameworks/Python.framework/Versions/2.7/selenium&apos;</span><br></pre></td></tr></table></figure>
<p>进入 python 交互环境，尝试导入 selenium 模块即可</p>
<h2 id="chromedriver"><a href="#chromedriver" class="headerlink" title="chromedriver"></a>chromedriver</h2><p>如果要选择 Chrome 作为测试浏览器，需要先安装 chromedriver，否则在实例化时会抛出以下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; brower = webdriver.chrome()</span><br><span class="line">...</span><br><span class="line">selenium.common.exceptions.WebDriverException: Message: &apos;chromedriver&apos; executable needs to be in PATH. Please see https://sites.google.com/a/chromium.org/chromedriver/home</span><br></pre></td></tr></table></figure>
<p>Mac 用户可使用 Homebrew 直接下载：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install chromedriver</span><br></pre></td></tr></table></figure>
<p>下载完成后可能会出现以下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Error: parent directory is world writable but not sticky</span><br><span class="line">Please report this bug:</span><br><span class="line">    https://git.io/brew-troubleshooting</span><br><span class="line">/System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/tmpdir.rb:92:in `mktmpdir&apos;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>解决方法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod +t /private/tmp/</span><br></pre></td></tr></table></figure>
<p>随后再尝试下载 chromedriver，进入 python 交互环境尝试实例化即可。</p>
<h1 id="简单用例"><a href="#简单用例" class="headerlink" title="简单用例"></a>简单用例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.keys import Keys</span><br><span class="line">import time</span><br><span class="line"># The instance of Chrome WebDriver is created.</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"># The driver.get() method will navigate to a page given by the URL. WebDriver will wait until the page has fully loaded (that is, the “onload” event has fired) before returning control to your test or script. It’s worth noting that if your page uses a lot of AJAX on load then WebDriver may not know when it has completely loaded.</span><br><span class="line">driver.get(&apos;http://www.python.org&apos;)</span><br><span class="line">print driver.title</span><br><span class="line"># WebDriver offers a number of ways to find elements using one of the find_element_by_* methods. For example, the input text element can be located by its name attribute using find_element_by_name method. Detailed explanation of finding elements is available in the Locating Elements chapter</span><br><span class="line">elem = driver.find_element_by_name(&apos;q&apos;)</span><br><span class="line"># Next we are sending keys, this is similar to entering keys using your keyboard. Special keys can be send using Keys class imported from selenium.webdriver.common.keys. To be safe, we’ll first clear any prepopulated text in the input field (e.g. “Search”) so it doesn’t affect our search results</span><br><span class="line">elem.clear()</span><br><span class="line">elem.send_keys(&apos;pycon&apos;)</span><br><span class="line">elem.send_keys(Keys.RETURN)</span><br><span class="line">print driver.page_source</span><br><span class="line">time.sleep(5)</span><br><span class="line"># Finally, the browser window is closed. You can also call quit method instead of close. The quit will exit entire browser whereas close` will close one tab, but if just one tab was open, by default most browser will exit entirely.</span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure>
<p>这段程序会打开浏览器，访问 <a href="http://www.python.org" target="_blank" rel="external">http://www.python.org</a> 并搜索 pycon，等待 5s 后关闭浏览器。</p>
<h1 id="用Selenium写测试单元"><a href="#用Selenium写测试单元" class="headerlink" title="用Selenium写测试单元"></a>用Selenium写测试单元</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.keys import Keys</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">class PythonOrgSearch(unittest.TestCase):</span><br><span class="line">    def setUp(self):</span><br><span class="line">        self.driver = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line">    def test_search_in_python_org(self):</span><br><span class="line">        driver = self.driver</span><br><span class="line">        driver.get(&apos;http://www.python.org&apos;)</span><br><span class="line">        self.assertIn(&apos;Python&apos;, driver.title)</span><br><span class="line">        elem = driver.find_element_by_name(&apos;q&apos;)</span><br><span class="line">        elem.send_keys(&apos;pycon&apos;)</span><br><span class="line">        elem.send_keys(Keys.RETURN)</span><br><span class="line">        assert &apos;No results found.&apos; not in driver.page_source</span><br><span class="line">        time.sleep(5)</span><br><span class="line"></span><br><span class="line">    def tearDown(self):</span><br><span class="line">        self.driver.quit()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<p>以上仅为关于 selenium 的一些简要功能介绍，详细用法参考后续文档</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[软件测试分类]]></title>
      <url>http://lizonghang.github.io/2016/07/31/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%88%86%E7%B1%BB/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;关于软件测试领域名词很多，从不同的角度可以将软件测试分为不同的类，这里汇总常见软件测试的相关名词，对软件测试领域有个概况的了解。</p>
<h1 id="项目流程划分"><a href="#项目流程划分" class="headerlink" title="项目流程划分"></a>项目流程划分</h1><p><img src="/images/v-mode.png" alt=""></p>
<p>&emsp;&emsp;<strong>单元测试</strong>：单元测试(或模块测试)是对程序中的单个子程序或具有独立功能的代码段进行测试的过程。</p>
<p>&emsp;&emsp;<strong>集成测试</strong>：集成测试是单元测试的基础上，将通过单元模块组装成系统或子系统，再进行测试，重点是检查模块之间的接口是否正确。</p>
<p>&emsp;&emsp;<strong>系统测试</strong>：系统测试是针对整个产品系统进行的测试，验证系统是否满足了需求规格的定义，以及软件系统的正确性和性能等是否满足其规约所指定的要求。</p>
<p>&emsp;&emsp;<strong>验收测试</strong>：验收测试是部署软件之前的最后一个测试操作。验收测试的目的是确保软件准备就绪，向软件购买者展示该软件系统满足其用户的需求。</p>
<h1 id="黑盒、白盒、灰盒测试"><a href="#黑盒、白盒、灰盒测试" class="headerlink" title="黑盒、白盒、灰盒测试"></a>黑盒、白盒、灰盒测试</h1><p>&emsp;&emsp;<strong>黑盒测试</strong>：黑盒测试指的是把被测的软件看作黑盒子，不需要关心盒子里面的结构，只关心软件的输入和输出。它只检查程序呈现给用户的功能是否按照需求规格说明书的规定正常使用，程序是否能适当的接收输入数据并产生正确的输出信息。黑盒测试着眼于程序外部结构，不考虑内部逻辑结构，主要针对软件界面和软件功能进行测试。</p>
<p>&emsp;&emsp;<strong>白盒测试</strong>：白盒测试指将盒子打开，研究内部源代码和程序执行结果。它是按照程序内部的结构测试程序，通过测试来检测产品内部动作是否按照设计规格说明书的规定正常进行，检验程序中的每条通路是否都能按预定要求正确工作。</p>
<p>&emsp;&emsp;<strong>灰盒测试</strong>：灰盒测试介于黑盒测试和灰盒测试之间，灰盒测试关注输出对输入的正确性，同时也关注内部表现，但这种关注不如白盒测试详细完整，只是通过一些表征性的现象、事件、标志来判断内部的运行状态。有时输出正确但内部出现错误，如果每次都用白盒测试来操作，效率会很低，因此需要采取灰盒测试的方法。</p>
<h1 id="功能测试与性能测试"><a href="#功能测试与性能测试" class="headerlink" title="功能测试与性能测试"></a>功能测试与性能测试</h1><p>&emsp;&emsp;<strong>功能测试</strong>：功能测试检查实际的功能是否符合用户的需求。测试的大部分工作也是围绕软件的功能进行，设计软件的目的也就是满足客户对功能的需求。如果偏离这个目的，任何测试工作都失去意义。功能测试又可以分为逻辑功能测试、界面测试、易用性测试、安装测试、兼容性测试等。</p>
<p>&emsp;&emsp;<strong>性能测试</strong>：性能测试是通过自动化的测试工具模拟多种正常、峰值以及异常负载条件来对系统的各项性能指标进行测试。软件的性能包括很多方面，主要有时间性能和空间性能两种。<br>&emsp;&emsp;&emsp;&emsp;<strong>时间性能</strong>：主要是指软件的一个具体的响应时间。比如一次登录需要的时间，一次交易需要的时间等。抛开具体的测试环境来分析一次事务的响应时间没有意义。需要搭建一个具体且独立的测试环境。<br>&emsp;&emsp;&emsp;&emsp;<strong>空间性能</strong>：主要指软件运行时所消耗的系统资源，比如硬件资源、CPU、内存、网络带宽等。</p>
<h1 id="手工测试与自动化测试"><a href="#手工测试与自动化测试" class="headerlink" title="手工测试与自动化测试"></a>手工测试与自动化测试</h1><p>&emsp;&emsp;<strong>手工测试</strong>：手工测试是由人去执行测试用例，通过键盘鼠标等输入一些参数，查看返回结果是否符合预期结果。手工测试并非专业术语，手工测试通常是指在系统测试阶段所进行的功能测试，为了更明显的与自动化测试进行区分，这里使用了手工测试。</p>
<p>&emsp;&emsp;<strong>自动化测试</strong>：自动化测试时把以人为驱动的测试行为转化为机器执行的过程。通常在设计了测试用例并通过评审之后，由测试人员根据测试用例中描述的规程一步步执行测试，得到实际结果与期望结果比较。在此过程中，为了节省人力、时间或硬件资源，提高测试效率，便引入了自动化测试的概念。<br>&emsp;&emsp;自动化测试又可分为功能自动化测试与性能自动化测试。<br>&emsp;&emsp;&emsp;&emsp;<strong>功能自动化测试</strong>：一般所说的自动化测试指功能自动化测试，通过相关的测试技术，通过编码的方式用一段程序来测试一个软件的功能，这样就可以重复执行程序来进行重复的测试。如果一个软件一小部分发生改变，只需要修改一部分自动化测试代码就可以重复对整个软件进行功能测试，从而大大提高测试效率。<br>&emsp;&emsp;&emsp;&emsp;<strong>性能自动化测试</strong>：目前性能测试工作都是通过性能测试工具辅助完成的。通过工具可以模拟大量的用户向系统发送请求，用来验证系统的处理能力。</p>
<h1 id="冒烟、回归、随机测试"><a href="#冒烟、回归、随机测试" class="headerlink" title="冒烟、回归、随机测试"></a>冒烟、回归、随机测试</h1><p>&emsp;&emsp;<strong>冒烟测试</strong>：冒烟测试是指在对一个新版本进行系统大规模测试之前，先验证软件的基本功能是否实现，是否具备可测性。引入到软件测试中，就是指测试小组在正规测试一个新版本之前，先投入较少的人力和时间验证一个软件的主要功能，如果主要功能都没有实现，则打回开发组重新开发。这样做可以节省大量的时间成本和人力成本。</p>
<p>&emsp;&emsp;<strong>回归测试</strong>：回归测试是指修改了旧代码后，重新进行测试以确认修改后没有引入新的错误或导致其他代码产生错误。回归测试一般是在进行软件的第二轮测试开始的，验证第一轮中发现的问题是否得到修复。回归也是一个循环的过程，如果回归的问题通不过则需要开发人员修改后再次进行回归，直到通过为止。</p>
<p>&emsp;&emsp;<strong>随机测试</strong>：随机测试是指测试中所有输入数据都是随机生成的，其目的是模拟用户的真实操作，并发现一些边缘性的错误。随机测试可以发现一些隐蔽的错误，但是也有很多缺点，比如测试不系统，无法统计代码覆盖率和需求覆盖率，发现的问题难以重现。一般是放在测试的最后执行。随机测试更专业的升级版称为探索性测试。</p>
<h1 id="其他测试"><a href="#其他测试" class="headerlink" title="其他测试"></a>其他测试</h1><p>&emsp;&emsp;<strong>探索性测试</strong>：探索性测试可以说是一种测试思维技术。它没有很多实际的测试方法、技术和工具，但却是所有测试人员都应该掌握的测试思维方式。探索性强调测试人员的主观能动性，抛弃繁杂的测试计划和测试用例设计过程，强调在碰到问题时及时改变测试策略。</p>
<p>&emsp;&emsp;<strong>安全测试</strong>：安全测试是在 IT 软件产品生命周期中，特别是产品开发基本完成到发布阶段，对产品进行校验以验证产品符合安全需求定义和产品质量标准的过程。安全测试越来越受到企业的关注和重视，因为由于安全性问题造成的后果是不可估量的。尤其互联网产品最容易受到各种安全攻击。</p>
<h1 id="适合自动化测试的项目"><a href="#适合自动化测试的项目" class="headerlink" title="适合自动化测试的项目"></a>适合自动化测试的项目</h1><p>&emsp;&emsp;不是所有项目都适合实施自动化测试，否则可能会浪费大量的人力和时间却没有得到应有的收益。是否可以对项目开展自动化测试可以参考以下 10 个条件：</p>
<ol>
<li>测试任务明确，不会频繁变动</li>
<li>每日构建后的测试验证</li>
<li>比较频繁的回归测试</li>
<li>软件系统界面稳定，变动少</li>
<li>需要在多平台上运行相同的测试案例、组合遍历型的测试、大量的重复任务</li>
<li>软件维护周期长</li>
<li>项目进度压力不大</li>
<li>被测软件系统开发比较规范，能够保证系统的可测试性</li>
<li>具备大量的自动化测试平台</li>
<li>测试人员具备较强的编程能力</li>
</ol>
<p>&emsp;&emsp;并非以上条件都具备才能开展测试工作。在普遍经验中，只要满足下面三个条件就可以对项目开展自动化测试：</p>
<p>&emsp;&emsp;<strong>软件需求编程不频繁</strong><br>&emsp;&emsp;测试脚本的稳定性决定了自动化测试的维护成本。如果软件需求变动过于频繁，测试人员需要根据变动的需求来更新测试用例以及相关的测试脚本，而脚本的维护本身就是代码开发的过程，需要修改、调试，必要的时候还要修改自动化测试的框架，如果花费的成本不低于利用其节省的测试成本，那么自动化测试便是失败的。<br>&emsp;&emsp;项目中的某些模块相对稳定，而某些模块需求变动性很大。可以对相对稳定的模块进行自动化测试，而变动大的使用手工测试。</p>
<p>&emsp;&emsp;<strong>项目周期较长</strong><br>&emsp;&emsp;由于自动化测试需求的确定、自动化测试框架的设计、测试脚本的编写与调试均需要相当长的时间来完成，这样的过程本身就是一个测试软件的开发过程，需要较长的时间来完成。如果项目的周期比较短，没有足够的时间去支持这个过程，那么最好不适用自动化测试。</p>
<p>&emsp;&emsp;<strong>自动化测试脚本可重复使用</strong><br>&emsp;&emsp;自动化测试脚本的重复使用要从三个方面考虑。测试的项目之间是否有很大的差异性（如 C/S 系统和 B/S 系统的差异）；选择的测试工具是否适应这种差异；测试人员是否有能力开发适应这种差异的自动化测试框架。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Python实现录音功能]]></title>
      <url>http://lizonghang.github.io/2016/07/30/Python%E5%AE%9E%E7%8E%B0%E5%BD%95%E9%9F%B3%E5%8A%9F%E8%83%BD/</url>
      <content type="html"><![CDATA[<h1 id="第三方库"><a href="#第三方库" class="headerlink" title="第三方库"></a>第三方库</h1><h2 id="portaudio"><a href="#portaudio" class="headerlink" title="portaudio"></a>portaudio</h2><p>安装 pyaudio 时若没有安装该模块将会报错，因此须提前安装好该模块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install portaudio</span><br></pre></td></tr></table></figure>
<h2 id="pyaudio"><a href="#pyaudio" class="headerlink" title="pyaudio"></a>pyaudio</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install pyaudio</span><br></pre></td></tr></table></figure>
<h2 id="修改pip源"><a href="#修改pip源" class="headerlink" title="修改pip源"></a>修改pip源</h2><p>默认的源为 pypi.python.org，修改 pip 源可以加速模块的下载，可以大幅提高安装效率。</p>
<p>修改源之前：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Collecting pyaudio</span><br><span class="line">  Downloading PyAudio-0.2.9.tar.gz (289kB)</span><br><span class="line">    14% |████▌                           | 40kB 9.8kB/s eta 0:00:26Exception:</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">...</span><br><span class="line">ReadTimeoutError: HTTPSConnectionPool(host=&apos;pypi.python.org&apos;, port=443): Read timed out.</span><br></pre></td></tr></table></figure>
<p>修改源之后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Collecting pyaudio</span><br><span class="line">  Downloading http://mirrors.aliyun.com/pypi/packages/d0/dc/ffb9ce5e3f19bd289902915a9f68b7d199216065f8ea17d5b5e8e4ad86ee/PyAudio-0.2.9.tar.gz (289kB)</span><br><span class="line">    100% |████████████████████████████████| 296kB 940kB/s</span><br><span class="line">Installing collected packages: pyaudio</span><br><span class="line">  Running setup.py install for pyaudio ... done</span><br><span class="line">Successfully installed pyaudio-0.2.9</span><br></pre></td></tr></table></figure>
<p>修改步骤（Mac/Linux）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd</span><br><span class="line">$ mkdir .pip</span><br><span class="line">$ cd .pip</span><br><span class="line">$ vim pip.conf</span><br></pre></td></tr></table></figure>
<p>输入如下内容保存后退出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br></pre></td></tr></table></figure>
<p>重新执行 pip 下载命令即可。</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import wave, pyaudio</span><br><span class="line"></span><br><span class="line"># Settings</span><br><span class="line">CHUNK = 1024</span><br><span class="line">FORMAT = pyaudio.paInt16</span><br><span class="line">RATE = 8000</span><br><span class="line">CHANNELS = 1</span><br><span class="line">RECORD_SECONDS = 5</span><br><span class="line"></span><br><span class="line"># Record Function</span><br><span class="line">def recordWave():</span><br><span class="line">    pa = pyaudio.PyAudio()</span><br><span class="line">    stream = pa.open(format=FORMAT,</span><br><span class="line">                     channels=CHANNELS,</span><br><span class="line">                     rate=RATE,</span><br><span class="line">                     input=True,</span><br><span class="line">                     frames_per_buffer=CHUNK)</span><br><span class="line"></span><br><span class="line">    print &apos;Recording...&apos;</span><br><span class="line"></span><br><span class="line">    buffer = []</span><br><span class="line">    for i in range(0, int(RATE/CHUNK*RECORD_SECONDS)):</span><br><span class="line">        audio_data = stream.read(CHUNK)</span><br><span class="line">        buffer.append(audio_data)</span><br><span class="line"></span><br><span class="line">    print &apos;Record Done&apos;</span><br><span class="line"></span><br><span class="line">    stream.stop_stream()</span><br><span class="line">    stream.close()</span><br><span class="line">    pa.terminate()</span><br><span class="line"></span><br><span class="line">    wf = wave.open(&apos;record.wav&apos;, &apos;wb&apos;)</span><br><span class="line">    wf.setnchannels(CHANNELS)</span><br><span class="line">    wf.setsampwidth(pa.get_sample_size(FORMAT))</span><br><span class="line">    wf.setframerate(RATE)</span><br><span class="line">    wf.writeframes(b&apos;&apos;.join(buffer))</span><br><span class="line">    wf.close()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    recordWave()</span><br></pre></td></tr></table></figure>
<h1 id="关于语音识别"><a href="#关于语音识别" class="headerlink" title="关于语音识别"></a>关于语音识别</h1><p>&emsp;&emsp;本来想实现语音控制电脑的，结果搜索了 Google、讯飞、百度、聚合数据（不要用，存在泄露信息嫌疑）等的语音识别接口，要么价格昂贵（3000~30000大洋，学生玩不起），要么得花上数日时间审核，微信只提供了个语义识别接口而不是语音识别接口。本来 Google 提供了免费且方便的接口 <code><a href="http://www.google.com/speech-api/v1/recognize?xjerr=1&amp;client=chromium" target="_blank" rel="external">http://www.google.com/speech-api/v1/recognize?xjerr=1&amp;client=chromium</a></code> ，这是第一代 API，没有要求 Key，结果后来就被玩坏了，这个接口就被废弃了。有趣的是后来又出现了一个很相似的 API，<code><a href="https://www.google.com/speech-api/v2/recognize?lang=en-us&amp;key=APIKEY" target="_blank" rel="external">https://www.google.com/speech-api/v2/recognize?lang=en-us&amp;key=APIKEY</a></code>，它需要申请 APIKEY，仅限 Chrome 内部私自使用了。<br>&emsp;&emsp;然而经过不断尝试，这个接口始终不能正常访问，原因本人还没有找到，超时报错：<code>requests.exceptions.ConnectionError: (‘Connection aborted.’, error(60, ‘Operation timed out’))</code> 。这也导致了本文从语音控制变成了简单的使用 pyaudio 录制语言。等有结果了再来完善本篇，若有读者找到了免费可行的 API 成功实现 Speech-To-Text 还请不吝赐教，QQ：870644199 或邮箱 870644199@qq.com。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Python生成验证码]]></title>
      <url>http://lizonghang.github.io/2016/07/30/Python%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;对于识别验证码的程序来说最难的部分是验证码字符的切割和特征码的建立。很多验证码加了很多干扰素和干扰线，不仅影响用户体验还达不到防止破解的很好的效果。若要使验证码难于被程序识别，需要注意：</p>
<ul>
<li>字符粘连，最后所有字符都有粘连的部分</li>
<li>不使用规则字符，验证码的各个部分使用不同比例的缩放或者旋转</li>
</ul>
<p>&emsp;&emsp;一般实现以上两点或这两点的变性，破解程序就很难识别。为了不影响用户体验，还需要注意形状相似字符的区分。本文以较简易的椒盐、干扰线和旋转来实现常用的一类验证码。</p>
<h1 id="字体素材"><a href="#字体素材" class="headerlink" title="字体素材"></a>字体素材</h1><p><img src="/images/font.png" alt=""></p>
<h1 id="参数设置"><a href="#参数设置" class="headerlink" title="参数设置"></a>参数设置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Settings</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(&apos;input&apos;, help=&apos;font image source&apos;)</span><br><span class="line">parser.add_argument(&apos;fontwidth&apos;, help=&apos;width of the font&apos;)</span><br><span class="line">parser.add_argument(&apos;fontheight&apos;, help=&apos;height of the font&apos;)</span><br><span class="line">parser.add_argument(&apos;-o&apos;, help=&apos;target image path&apos;, default=&apos;./authcode.png&apos;)</span><br><span class="line">parser.add_argument(&apos;-l&apos;, help=&apos;authcode length&apos;, default=4)</span><br><span class="line">parser.add_argument(&apos;-s&apos;, help=&apos;salt counts&apos;, default=200)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">fontImgPath = args.input</span><br><span class="line">fontWidth = int(args.fontwidth)</span><br><span class="line">fontHeight = int(args.fontheight)</span><br><span class="line">targetImgPath = args.o</span><br><span class="line">codeLength = int(args.l)</span><br><span class="line">saltNum = int(args.s)</span><br><span class="line">base = (&apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;,</span><br><span class="line">      &apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;,&apos;E&apos;,&apos;F&apos;,&apos;G&apos;,&apos;H&apos;,&apos;I&apos;,&apos;J&apos;,</span><br><span class="line">      &apos;K&apos;,&apos;L&apos;,&apos;M&apos;,&apos;N&apos;,&apos;O&apos;,&apos;P&apos;,&apos;Q&apos;,&apos;R&apos;,&apos;S&apos;,&apos;T&apos;,</span><br><span class="line">      &apos;U&apos;,&apos;V&apos;,&apos;W&apos;,&apos;X&apos;,&apos;Y&apos;,&apos;Z&apos;)</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>fontImgPath - 必选，字体图片路径</li>
<li>fontWidth - 必选，字体图片中字体宽度</li>
<li>fontHeight - 必选，字体图片中字体高度</li>
<li>targetImgPath - 可选，生成验证码存放路径，默认为当前路径，图片名 authcode.png</li>
<li>codeLength - 可选，生成验证码中字符数目，默认为 4 个字符</li>
<li>saltNum - 可选，生成验证码中椒盐现象数目，默认为 200</li>
<li>base - 字符集合，必须与字体图片素材中的顺序匹配</li>
</ul>
<h1 id="生成基本验证码图片"><a href="#生成基本验证码图片" class="headerlink" title="生成基本验证码图片"></a>生成基本验证码图片</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Generate Authcode Image</span><br><span class="line">def getAuthcode(base, fontImgPath, codeLength, fontWidth, fontHeight):</span><br><span class="line">    code = &apos;&apos;</span><br><span class="line">    fontImg = Image.open(fontImgPath)</span><br><span class="line">    codeImg = Image.new(&apos;RGBA&apos;, (fontWidth*codeLength, fontHeight+6), (255,255,255,0))</span><br><span class="line">    for k in range(codeLength):</span><br><span class="line">        randInt = random.randint(0,len(base)-1)</span><br><span class="line">        code = &apos;&apos;.join((code, base[randInt]))</span><br><span class="line">        img_s = fontImg.crop((randInt*fontWidth,0,(randInt+1)*fontWidth,fontHeight))</span><br><span class="line">        img_s = img_s.rotate(random.randint(-30,30))</span><br><span class="line">        codeImg.paste(img_s, (k*fontWidth,3))</span><br><span class="line">    return codeImg, code</span><br></pre></td></tr></table></figure>
<p>首先创建新的 RGBA 格式空白图片，其宽为字体宽度与验证码字符个数之积，高为字体高度+6px。依次随机选取字体集合中的一个字符，从字体素材图片中截取相应字符并旋转 -30° ~ 30°，粘贴到新建的图片中。最后将新建的图片与验证码字符串返回。</p>
<h1 id="干扰素"><a href="#干扰素" class="headerlink" title="干扰素"></a>干扰素</h1><h2 id="椒盐现象"><a href="#椒盐现象" class="headerlink" title="椒盐现象"></a>椒盐现象</h2><p>在指定图片中添加指定个数的干扰点，干扰点颜色随机，位置随机（但不能影响验证码字符）。图像操作直接改变原图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Add Salt</span><br><span class="line">def addSalt(image, saltNum):</span><br><span class="line">    width, height = image.size</span><br><span class="line">    count = 0</span><br><span class="line">    while count &lt; saltNum:</span><br><span class="line">        randX = random.randint(0, width-1)</span><br><span class="line">        randY = random.randint(0, height-1)</span><br><span class="line">        if image.getpixel((randX, randY))[-1] == 0:</span><br><span class="line">            image.putpixel((randX, randY), (random.randint(100,255), random.randint(100,255), random.randint(100,255), 255))</span><br><span class="line">            count += 1</span><br><span class="line">        else:</span><br><span class="line">            continue</span><br></pre></td></tr></table></figure>
<h2 id="干扰线"><a href="#干扰线" class="headerlink" title="干扰线"></a>干扰线</h2><p>在指定图片中添加 2 条位置随机的干扰线（数目可改变，但会影响用户体验）。此处在图片上半部分与下半部分各添加一条黑色干扰线，并带有一定倾斜度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">## Add Lines</span><br><span class="line">def addLines(image):</span><br><span class="line">    width, height = image.size</span><br><span class="line">    draw = ImageDraw.Draw(image)</span><br><span class="line">    for k in range(2):</span><br><span class="line">        randHeight = (height/2)*(k%2)+random.randint(5, (height-1)/2-5)</span><br><span class="line">        startPoint = (0, randHeight)</span><br><span class="line">        if random.random() &lt; 0.5:</span><br><span class="line">            endPoint = (width-1, randHeight+random.randint(0,5))</span><br><span class="line">        else:</span><br><span class="line">            endPoint = (width-1, randHeight-random.randint(0,5))</span><br><span class="line">        draw.line((startPoint, endPoint), fill=(0,0,0,255))</span><br><span class="line">    del draw</span><br></pre></td></tr></table></figure>
<h1 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image, ImageDraw</span><br><span class="line">import random, argparse</span><br><span class="line"></span><br><span class="line"># Settings</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(&apos;input&apos;, help=&apos;font image source&apos;)</span><br><span class="line">parser.add_argument(&apos;fontwidth&apos;, help=&apos;width of the font&apos;)</span><br><span class="line">parser.add_argument(&apos;fontheight&apos;, help=&apos;height of the font&apos;)</span><br><span class="line">parser.add_argument(&apos;-o&apos;, help=&apos;target image path&apos;, default=&apos;./authcode.png&apos;)</span><br><span class="line">parser.add_argument(&apos;-l&apos;, help=&apos;authcode length&apos;, default=4)</span><br><span class="line">parser.add_argument(&apos;-s&apos;, help=&apos;salt counts&apos;, default=200)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">fontImgPath = args.input</span><br><span class="line">fontWidth = int(args.fontwidth)</span><br><span class="line">fontHeight = int(args.fontheight)</span><br><span class="line">targetImgPath = args.o</span><br><span class="line">codeLength = int(args.l)</span><br><span class="line">saltNum = int(args.s)</span><br><span class="line">base = (&apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;,</span><br><span class="line">      &apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;,&apos;E&apos;,&apos;F&apos;,&apos;G&apos;,&apos;H&apos;,&apos;I&apos;,&apos;J&apos;,</span><br><span class="line">      &apos;K&apos;,&apos;L&apos;,&apos;M&apos;,&apos;N&apos;,&apos;O&apos;,&apos;P&apos;,&apos;Q&apos;,&apos;R&apos;,&apos;S&apos;,&apos;T&apos;,</span><br><span class="line">      &apos;U&apos;,&apos;V&apos;,&apos;W&apos;,&apos;X&apos;,&apos;Y&apos;,&apos;Z&apos;)</span><br><span class="line"></span><br><span class="line"># Generate Authcode Image</span><br><span class="line">def getAuthcode(base, fontImgPath, codeLength, fontWidth, fontHeight):</span><br><span class="line">    code = &apos;&apos;</span><br><span class="line">    fontImg = Image.open(fontImgPath)</span><br><span class="line">    codeImg = Image.new(&apos;RGBA&apos;, (fontWidth*codeLength, fontHeight+6), (255,255,255,0))</span><br><span class="line">    for k in range(codeLength):</span><br><span class="line">        randInt = random.randint(0,len(base)-1)</span><br><span class="line">        code = &apos;&apos;.join((code, base[randInt]))</span><br><span class="line">        img_s = fontImg.crop((randInt*fontWidth,0,(randInt+1)*fontWidth,fontHeight))</span><br><span class="line">        img_s = img_s.rotate(random.randint(-30,30))</span><br><span class="line">        codeImg.paste(img_s, (k*fontWidth,3))</span><br><span class="line">    return codeImg, code</span><br><span class="line"></span><br><span class="line"># Add Salt</span><br><span class="line">def addSalt(image, saltNum):</span><br><span class="line">    width, height = image.size</span><br><span class="line">    count = 0</span><br><span class="line">    while count &lt; saltNum:</span><br><span class="line">        randX = random.randint(0, width-1)</span><br><span class="line">        randY = random.randint(0, height-1)</span><br><span class="line">        if image.getpixel((randX, randY))[-1] == 0:</span><br><span class="line">            image.putpixel((randX, randY), (random.randint(100,255), random.randint(100,255), random.randint(100,255), 255))</span><br><span class="line">            count += 1</span><br><span class="line">        else:</span><br><span class="line">            continue</span><br><span class="line"></span><br><span class="line">## Add Lines</span><br><span class="line">def addLines(image):</span><br><span class="line">    width, height = image.size</span><br><span class="line">    draw = ImageDraw.Draw(image)</span><br><span class="line">    for k in range(2):</span><br><span class="line">        randHeight = (height/2)*(k%2)+random.randint(5, (height-1)/2-5)</span><br><span class="line">        startPoint = (0, randHeight)</span><br><span class="line">        if random.random() &lt; 0.5:</span><br><span class="line">            endPoint = (width-1, randHeight+random.randint(0,5))</span><br><span class="line">        else:</span><br><span class="line">            endPoint = (width-1, randHeight-random.randint(0,5))</span><br><span class="line">        draw.line((startPoint, endPoint), fill=(0,0,0,255))</span><br><span class="line">    del draw</span><br><span class="line"></span><br><span class="line"># Main</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    authcode, code = getAuthcode(base, fontImgPath, codeLength, fontWidth, fontHeight)</span><br><span class="line">    addSalt(authcode, saltNum)</span><br><span class="line">    addLines(authcode)</span><br><span class="line">    authcode.save(targetImgPath, &apos;PNG&apos;)</span><br><span class="line">    print &apos;Generate Authcode: &apos;,code</span><br></pre></td></tr></table></figure>
<h1 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python generate_authcode.py font.png 19 20 -o authcode.png -l 4 -s 200</span><br></pre></td></tr></table></figure>
<p>终端输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Generate Authcode:  3PHU</span><br></pre></td></tr></table></figure>
<p>生成验证码图片：</p>
<p><img src="/images/authcode.png" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageGrab模块]]></title>
      <url>http://lizonghang.github.io/2016/07/29/ImageGrab%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;The ImageGrab module can be used to copy the contents of the screen or the clipboard to a PIL image memory.<br>&emsp;&emsp;<strong>Note：</strong>The current version works on OS X and Windows only. OS X support was added in 3.0.0.</p>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><h2 id="ImageGrab-grab-bbox-None"><a href="#ImageGrab-grab-bbox-None" class="headerlink" title="ImageGrab.grab(bbox=None)"></a>ImageGrab.grab(bbox=None)</h2><p>&emsp;&emsp;Take a snapshot of the screen. The pixels inside the bounding box are returned as an “RGB” image on Windows or “RGBA” on OS X. If the bounding box is omitted, the entire screen is copied.</p>
<h2 id="ImageGrab-grabclipboard"><a href="#ImageGrab-grabclipboard" class="headerlink" title="ImageGrab.grabclipboard()"></a>ImageGrab.grabclipboard()</h2><p>&emsp;&emsp;Take a snapshot of the clipboard image, if any.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageOps模块]]></title>
      <url>http://lizonghang.github.io/2016/07/29/ImageOps%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;(New in 1.1.3) The ImageOps module contains a number of ‘ready-made’ image processing operations. This module is somewhat experimental, and most operators only work on L and RGB images.</p>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><h2 id="ImageOps-autocontrast-im-cutoff-0"><a href="#ImageOps-autocontrast-im-cutoff-0" class="headerlink" title="ImageOps.autocontrast(im, cutoff=0)"></a>ImageOps.autocontrast(im, cutoff=0)</h2><p>&emsp;&emsp;Maximize (normalize) image contrast. This function calculates a histogram of the input image, removes cutoff percent of the lightest and darkest pixels from the histogram, and remaps the image so that the darkest remaining pixel becomes black (0), and the lightest becomes white (255).</p>
<h2 id="ImageOps-colorize-im-black-white"><a href="#ImageOps-colorize-im-black-white" class="headerlink" title="ImageOps.colorize(im, black, white)"></a>ImageOps.colorize(im, black, white)</h2><p>&emsp;&emsp;Colorize grayscale image. The black and white arguments should be RGB tuples or color names; this function calculates a colour wedge mapping all black pixels in the source image to the first colour, and all white pixels to the second colour.</p>
<h2 id="ImageOps-crop-im-border-0"><a href="#ImageOps-crop-im-border-0" class="headerlink" title="ImageOps.crop(im, border=0)"></a>ImageOps.crop(im, border=0)</h2><p>&emsp;&emsp;Remove border pixels from all four edges. This function works on all image modes.</p>
<h2 id="ImageOps-deform-im-deformer-filter-Image-BILINEAR"><a href="#ImageOps-deform-im-deformer-filter-Image-BILINEAR" class="headerlink" title="ImageOps.deform(im, deformer, filter=Image.BILINEAR)"></a>ImageOps.deform(im, deformer, filter=Image.BILINEAR)</h2><p>&emsp;&emsp;Deform the image using the given deformer object. The deformer should provide a getmesh method, which returns a MESH list suitable for the Image transform method. See the transform method for details.</p>
<h2 id="ImageOps-equalize-im"><a href="#ImageOps-equalize-im" class="headerlink" title="ImageOps.equalize(im)"></a>ImageOps.equalize(im)</h2><p>&emsp;&emsp;Equalize the image histogram. This function applies a non-linear mapping to the input image, in order to create a uniform distribution of grayscale values in the output image.</p>
<h2 id="ImageOps-expand-im-border-0-fill-0"><a href="#ImageOps-expand-im-border-0-fill-0" class="headerlink" title="ImageOps.expand(im, border=0, fill=0)"></a>ImageOps.expand(im, border=0, fill=0)</h2><p>&emsp;&emsp;Add border pixels of border to the image, at all four edges.</p>
<h2 id="ImageOps-fit-im-size-method-0-bleed-0-0-centering-0-5-0-5"><a href="#ImageOps-fit-im-size-method-0-bleed-0-0-centering-0-5-0-5" class="headerlink" title="ImageOps.fit(im, size, method=0, bleed=0.0, centering=(0.5, 0.5))"></a>ImageOps.fit(im, size, method=0, bleed=0.0, centering=(0.5, 0.5))</h2><p>&emsp;&emsp;Returns a sized and cropped version of the image, cropped to the requested aspect ratio and size. The size argument is the requested output size in pixels, given as a (width, height) tuple.<br>&emsp;&emsp;The method argument is what resampling method to use. The default is Image.NEAREST (nearest neighbour).<br>&emsp;&emsp;The bleed argument allows you to remove a border around the outside the image (from all four edges). The value is a decimal percentage (use 0.01 for one percent). The default value is 0 (no border).<br>&emsp;&emsp;The centering argument is used to control the cropping position. (0.5, 0.5) is center cropping (i.e. if cropping the width, take 50% off of the left side (and therefore 50% off the right side), and same with top/bottom).<br>&emsp;&emsp;(0.0, 0.0) will crop from the top left corner (i.e. if cropping the width, take all of the crop off of the right side, and if cropping the height, take all of it off the bottom).<br>&emsp;&emsp;(1.0, 0.0) will crop from the bottom left corner, etc. (i.e. if cropping the width, take all of the crop off the left side, and if cropping the height take none from the top (and therefore all off the bottom)).<br>&emsp;&emsp;The fit function was contributed by Kevin Cazabon.</p>
<h2 id="ImageOps-flip-im"><a href="#ImageOps-flip-im" class="headerlink" title="ImageOps.flip(im)"></a>ImageOps.flip(im)</h2><p>&emsp;&emsp;Flip the image vertically (top to bottom).</p>
<h2 id="ImageOps-grayscale-im"><a href="#ImageOps-grayscale-im" class="headerlink" title="ImageOps.grayscale(im)"></a>ImageOps.grayscale(im)</h2><p>&emsp;&emsp;Convert the image to grayscale.</p>
<h2 id="ImageOps-invert-im"><a href="#ImageOps-invert-im" class="headerlink" title="ImageOps.invert(im)"></a>ImageOps.invert(im)</h2><p>&emsp;&emsp;Invert (negate) the image.</p>
<h2 id="ImageOps-mirror-im"><a href="#ImageOps-mirror-im" class="headerlink" title="ImageOps.mirror(im)"></a>ImageOps.mirror(im)</h2><p>&emsp;&emsp;Flip image horizontally (left to right).</p>
<h2 id="ImageOps-posterize-im-bits"><a href="#ImageOps-posterize-im-bits" class="headerlink" title="ImageOps.posterize(im, bits)"></a>ImageOps.posterize(im, bits)</h2><p>&emsp;&emsp;Reduce the number of bits for each colour channel.</p>
<h2 id="ImageOps-solarize-im-threshold-128"><a href="#ImageOps-solarize-im-threshold-128" class="headerlink" title="ImageOps.solarize(im, threshold=128)"></a>ImageOps.solarize(im, threshold=128)</h2><p>&emsp;&emsp;Invert all pixel values above the given threshold.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageMath模块]]></title>
      <url>http://lizonghang.github.io/2016/07/29/ImageMath%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;(New in 1.1.6) The ImageMath module can be used to evaluate “image expressions”. The module provides a single eval function, which takes an expression string and one or more images.</p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image, ImageMath</span><br><span class="line">im1 = Image.open(&apos;image1.jpg&apos;).convert(&apos;L&apos;)</span><br><span class="line">im2 = Image.open(&apos;image2.jpg&apos;).convert(&apos;L&apos;)</span><br><span class="line">out = ImageMath.eval(&apos;convert(min(a,b), &quot;1&quot;)&apos;, a=im1, b=im2)</span><br></pre></td></tr></table></figure>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><h2 id="ImageMath-eval-expression-environment"><a href="#ImageMath-eval-expression-environment" class="headerlink" title="ImageMath.eval(expression, environment)"></a>ImageMath.eval(expression, environment)</h2><p>&emsp;&emsp;Evaluate expression in the given environment.<br>&emsp;&emsp;The expression argument is a string which uses the standard Python expression syntax. In addition to the standard operators, you can also use the functions described below.<br>&emsp;&emsp;The environment argument is a dictionary that maps image names to Image instances. You can use one or more keyword arguments instead of a dictionary, as shown in the above example. Note that the names must be valid Python identifiers.<br>&emsp;&emsp;In the current version, ImageMath only supports single-layer images. To process multi-band images, use the split and merge functions.<br>&emsp;&emsp;This function returns an image, an integer value, a floating point value, or a pixel tuple, depending on the expression.</p>
<h1 id="Expression-Syntax"><a href="#Expression-Syntax" class="headerlink" title="Expression Syntax"></a>Expression Syntax</h1><p>&emsp;&emsp;Expressions are standard Python expressions, but they’re evaluated in a non-standard environment. You can use PIL methods as usual, plus the following set of operators and functions:</p>
<h2 id="Standard-Operators"><a href="#Standard-Operators" class="headerlink" title="Standard Operators"></a>Standard Operators</h2><p>&emsp;&emsp;You can use standard arithmetical operators for addition (+), subtraction (-), multiplication (*), and division (/).<br>&emsp;&emsp;The module also supports unary minus (-), modulo (%), and power (**) operators.<br>&emsp;&emsp;Note that all operations are done with 32-bit integers or 32-bit floating point values, as necessary. For example, if you add two 8-bit images, the result will be a 32-bit integer image. If you add a floating point constant to an 8-bit image, the result will be a 32-bit floating point image.<br>&emsp;&emsp;You can force conversion using the convert, float, and int functions described below.</p>
<h2 id="Bitwise-Operators"><a href="#Bitwise-Operators" class="headerlink" title="Bitwise Operators"></a>Bitwise Operators</h2><p>&emsp;&emsp;The module also provides operations that operate on individual bits. This includes and (&amp;), or (|), and exclusive or (^). You can also invert (~) all pixel bits.<br>&emsp;&emsp;Note that the operands are converted to 32-bit signed integers before the bitwise operation is applied. This means that you’ll get negative values if you invert an ordinary greyscale image. You can use the and (&amp;) operator to mask off unwanted bits.<br>&emsp;&emsp;Bitwise operators don’t work on floating point images.</p>
<h2 id="Logical-Operators"><a href="#Logical-Operators" class="headerlink" title="Logical Operators"></a>Logical Operators</h2><p>&emsp;&emsp;Logical operators like and, or, and not work on entire images, rather than individual pixels.<br>&emsp;&emsp;An empty image (all pixels zero) is treated as false. All other images are treated as true.<br>&emsp;&emsp;Note that and and or return the last evaluated operand, while not always returns a boolean value.</p>
<h2 id="Built-in-Functions"><a href="#Built-in-Functions" class="headerlink" title="Built-in Functions"></a>Built-in Functions</h2><p>These functions are applied to each individual pixel.</p>
<ul>
<li>abs(im) - Absolute value</li>
<li>convert(im, mode) - Convert image to the given mode. The mode must be given as a string constant.</li>
<li>float(im) - Convert image to 32-bit floating point. This is equivalent to <code>convert(image, ‘F’)</code>.</li>
<li>int(im) - Convert image to 32-bit integer. This is equivalent to <code>convert(image, ‘I’)</code>.</li>
</ul>
<p>Note that 1-bit and 8-bit images are automatically converted to 32-bit integers if necessary to get a correct result.</p>
<ul>
<li>max(im1, im2) - Maximum value</li>
<li>min(im1, im2) - Minimum value</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImagePath模块]]></title>
      <url>http://lizonghang.github.io/2016/07/29/ImagePath%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;The ImagePath module is used to store and manipulate 2-dimensional vector data. Path objects can be passed to the methods in the ImageDraw module.</p>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><h2 id="ImagePath-Path-coordinates"><a href="#ImagePath-Path-coordinates" class="headerlink" title="ImagePath.Path(coordinates)"></a>ImagePath.Path(coordinates)</h2><p>&emsp;&emsp;Creates a path object. The coordinate list can be any sequence object containing either 2-tuples [ (x, y), … ] or numeric values [ x, y, … ].<br>&emsp;&emsp;You can also create a path object from another path object.<br>&emsp;&emsp;In 1.1.6 and later, you can also pass in any object that implements Python’s buffer API. The buffer should provide read access, and contain C floats in machine byte order.<br>&emsp;&emsp;The path object implements most parts of the Python sequence interface, and behaves like a list of (x, y) pairs. You can use len(), item access, and slicing as usual. However, the current version does not support slice assignment, or item and slice deletion.</p>
<h1 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h1><h2 id="path-compact-distance-2"><a href="#path-compact-distance-2" class="headerlink" title="path.compact(distance=2)"></a>path.compact(distance=2)</h2><p>&emsp;&emsp;Compacts the path, by removing points that are close to each other. This method modifies the path in place, and returns the number of points left in the path.<br>&emsp;&emsp;The distance is measured as “city-block distance,” and defaults to two pixels.</p>
<h2 id="path-getbbox"><a href="#path-getbbox" class="headerlink" title="path.getbbox()"></a>path.getbbox()</h2><p>&emsp;&emsp;Gets the bounding box of the path.</p>
<h2 id="path-map-function"><a href="#path-map-function" class="headerlink" title="path.map(function)"></a>path.map(function)</h2><p>&emsp;&emsp;Maps the path through a function.</p>
<h2 id="path-tolist"><a href="#path-tolist" class="headerlink" title="path.tolist()"></a>path.tolist()</h2><p>&emsp;&emsp;Converts the path to a Python list [(x, y), …].</p>
<h2 id="path-tolist-flat-0"><a href="#path-tolist-flat-0" class="headerlink" title="path.tolist(flat=0)"></a>path.tolist(flat=0)</h2><p>&emsp;&emsp;(New in 1.1.5) Converts the path to a Python list. If the flat flag is zero or omitted, the resulting list contains 2-tuples [ (x, y), … ]. If flat is 1, the list is flattened [ x, y, … ].</p>
<h2 id="path-transform-matrix"><a href="#path-transform-matrix" class="headerlink" title="path.transform(matrix)"></a>path.transform(matrix)</h2><p>&emsp;&emsp;Transforms the path in place, using an affine transform. The matrix is a 6-tuple (a, b, c, d, e, f), and each point is mapped as follows:<br>&emsp;&emsp;<code>xOut = xIn * a + yIn * b + c</code><br>&emsp;&emsp;<code>yOut = xIn * d + yIn * e + f</code></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageChops模块]]></title>
      <url>http://lizonghang.github.io/2016/07/29/ImageChops%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;The ImageChops module contains a number of arithmetical image operations, called channel operations (“chops”). These can be used for various purposes, including special effects, image compositions, algorithmic painting, and more.<br>&emsp;&emsp;For more pre-made operations, see ImageOps.<br>&emsp;&emsp;At this time, most channel operations are only implemented for 8-bit images (e.g. “L” and “RGB”).</p>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><p>&emsp;&emsp;Most channel operations take one or two image arguments and returns a new image. Unless otherwise noted, the result of a channel operation is always clipped to the range 0 to MAX (which is 255 for all modes supported by the operations in this module).</p>
<h2 id="ImageChops-constant-im-value"><a href="#ImageChops-constant-im-value" class="headerlink" title="ImageChops.constant(im, value)"></a>ImageChops.constant(im, value)</h2><p>&emsp;&emsp;Return a layer with the same size as the given image, but filled with the given pixel value.</p>
<h2 id="ImageChops-duplicate-im"><a href="#ImageChops-duplicate-im" class="headerlink" title="ImageChops.duplicate(im)"></a>ImageChops.duplicate(im)</h2><p>&emsp;&emsp;Return a copy of the given image.</p>
<h2 id="ImageChops-invert-im"><a href="#ImageChops-invert-im" class="headerlink" title="ImageChops.invert(im)"></a>ImageChops.invert(im)</h2><p>&emsp;&emsp;Inverts an image.</p>
<p>&emsp;&emsp;<code>out = MAX - im</code></p>
<h2 id="ImageChops-lighter-im1-im2"><a href="#ImageChops-lighter-im1-im2" class="headerlink" title="ImageChops.lighter(im1, im2)"></a>ImageChops.lighter(im1, im2)</h2><p>&emsp;&emsp;Compares the two images, pixel by pixel, and returns a new image containing the lighter values.</p>
<p>&emsp;&emsp;<code>out = max(im1, im2)</code></p>
<h2 id="ImageChops-darker-im1-im2"><a href="#ImageChops-darker-im1-im2" class="headerlink" title="ImageChops.darker(im1, im2)"></a>ImageChops.darker(im1, im2)</h2><p>&emsp;&emsp;Compares the two images, pixel by pixel, and returns a new image containing the darker values.</p>
<p>&emsp;&emsp;<code>out = min(im1, im2)</code></p>
<h2 id="ImageChops-difference-im1-im2"><a href="#ImageChops-difference-im1-im2" class="headerlink" title="ImageChops.difference(im1, im2)"></a>ImageChops.difference(im1, im2)</h2><p>&emsp;&emsp;Returns the absolute value of the difference between the two images.</p>
<p>&emsp;&emsp;<code>out = abs(im1 - im2)</code></p>
<h2 id="ImageChops-multiply-im1-im2"><a href="#ImageChops-multiply-im1-im2" class="headerlink" title="ImageChops.multiply(im1, im2)"></a>ImageChops.multiply(im1, im2)</h2><p>&emsp;&emsp;Superimposes two images on top of each other. If you multiply an image with a solid black image, the result is black. If you multiply with a solid white image, the image is unaffected.</p>
<p>&emsp;&emsp;<code>out = im1 * im2 / MAX</code></p>
<h2 id="ImageChops-screen-im1-im2"><a href="#ImageChops-screen-im1-im2" class="headerlink" title="ImageChops.screen(im1, im2)"></a>ImageChops.screen(im1, im2)</h2><p>&emsp;&emsp;Superimposes two inverted images on top of each other.</p>
<p>&emsp;&emsp;<code>out = MAX - ((MAX - image1) * (MAX - image2) / MAX)</code></p>
<h2 id="ImageChops-add-im1-im2-scale-offset"><a href="#ImageChops-add-im1-im2-scale-offset" class="headerlink" title="ImageChops.add(im1, im2, scale, offset)"></a>ImageChops.add(im1, im2, scale, offset)</h2><p>&emsp;&emsp;Adds two images, dividing the result by scale and adding the offset. If omitted, scale defaults to 1.0, and offset to 0.0.</p>
<p>&emsp;&emsp;<code>out = (image1 + image2) / scale + offset</code></p>
<h2 id="ImageChops-subtract-im1-im2-scale-offset"><a href="#ImageChops-subtract-im1-im2-scale-offset" class="headerlink" title="ImageChops.subtract(im1, im2, scale, offset)"></a>ImageChops.subtract(im1, im2, scale, offset)</h2><p>&emsp;&emsp;Subtracts two images, dividing the result by scale and adding the offset. If omitted, scale defaults to 1.0, and offset to 0.0.</p>
<p>&emsp;&emsp;<code>out = (image1 - image2) / scale + offset</code></p>
<h2 id="ImageChops-blend-im1-im2-mask"><a href="#ImageChops-blend-im1-im2-mask" class="headerlink" title="ImageChops.blend(im1, im2, mask)"></a>ImageChops.blend(im1, im2, mask)</h2><p>&emsp;&emsp;Same as the Image.blend() function in the Image module.</p>
<p>&emsp;&emsp;<code>out = image1 * (1.0 - mask) + image2 * mask</code></p>
<h2 id="ImageChops-composite-im1-im2-mask"><a href="#ImageChops-composite-im1-im2-mask" class="headerlink" title="ImageChops.composite(im1, im2, mask)"></a>ImageChops.composite(im1, im2, mask)</h2><p>&emsp;&emsp;Same as the Image.composite() function in the Image module.<br>&emsp;&emsp;Creates a new image by interpolating between the given images, using the corresponding pixels from a mask image as alpha. The mask can have mode “1”, “L”, or “RGBA”. All images must be the same size.</p>
<h2 id="ImageChops-offset-im-xoffset-yoffset"><a href="#ImageChops-offset-im-xoffset-yoffset" class="headerlink" title="ImageChops.offset(im, xoffset, yoffset)"></a>ImageChops.offset(im, xoffset, yoffset)</h2><p>&emsp;&emsp;Returns a copy of the image where data has been offset by the given distances. Data wraps around the edges. If yoffset is omitted, it is assumed to be equal to xoffset.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageEnhance模块]]></title>
      <url>http://lizonghang.github.io/2016/07/29/ImageEnhance%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>The ImageEnhance module contains a number of classes that can be used for image enhancement.</p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image, ImageEnhance</span><br><span class="line">im = Image.open(&apos;lena.jpg&apos;)</span><br><span class="line">enhancer = ImageEnhance.Sharpness(im)</span><br><span class="line">enhancer.enhance(2.0).show()</span><br></pre></td></tr></table></figure>
<h1 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h1><p>&emsp;&emsp;All enhancement classes implement a common interface, containing a single method:</p>
<h2 id="enhancer-enhance-factor"><a href="#enhancer-enhance-factor" class="headerlink" title="enhancer.enhance(factor)"></a>enhancer.enhance(factor)</h2><p>&emsp;&emsp;Returns an enhanced image. The factor is a floating point value controlling the enhancement. Factor 1.0 always returns a copy of the original image, lower factors mean less color (brightness, contrast, etc), and higher values more. There are no restrictions on this value.</p>
<h1 id="The-Color-Class"><a href="#The-Color-Class" class="headerlink" title="The Color Class"></a>The Color Class</h1><p>&emsp;&emsp;The color enhancement class is used to adjust the color balance of an image, in a manner similar to the controls on a color TV set. This class implements the enhancement interface as described above.</p>
<h2 id="class-ImageEnhance-Color-im"><a href="#class-ImageEnhance-Color-im" class="headerlink" title="class ImageEnhance.Color(im)"></a>class ImageEnhance.Color(im)</h2><p>&emsp;&emsp;Creates an enhancement object for adjusting color in an image. A factor of 0.0 gives a black and white image, a factor of 1.0 gives the original image.</p>
<h1 id="The-Brightness-Class"><a href="#The-Brightness-Class" class="headerlink" title="The Brightness Class"></a>The Brightness Class</h1><p>&emsp;&emsp;The brightness enhancement class is used to control the brightness of an image.</p>
<h2 id="class-ImageEnhance-Brightness-im"><a href="#class-ImageEnhance-Brightness-im" class="headerlink" title="class ImageEnhance.Brightness(im)"></a>class ImageEnhance.Brightness(im)</h2><p>&emsp;&emsp;Creates an enhancement object for adjusting brightness in an image. A factor of 0.0 gives a black image, factor 1.0 gives the original image.</p>
<h1 id="The-Contrast-Class"><a href="#The-Contrast-Class" class="headerlink" title="The Contrast Class"></a>The Contrast Class</h1><p>&emsp;&emsp;The contrast enhancement class is used to control the contrast of an image, similar to the contrast control on a TV set.</p>
<h2 id="class-ImageEnhance-Contrast-im"><a href="#class-ImageEnhance-Contrast-im" class="headerlink" title="class ImageEnhance.Contrast(im)"></a>class ImageEnhance.Contrast(im)</h2><p>&emsp;&emsp;Creates an enhancement object for adjusting contrast in an image. A factor of 0.0 gives an solid grey image, factor 1.0 gives the original image.</p>
<h1 id="The-Sharpness-Class"><a href="#The-Sharpness-Class" class="headerlink" title="The Sharpness Class"></a>The Sharpness Class</h1><p>&emsp;&emsp;The sharpness enhancement class is used to control the sharpness of an image.</p>
<h2 id="class-ImageEnhance-Sharpness-im"><a href="#class-ImageEnhance-Sharpness-im" class="headerlink" title="class ImageEnhance.Sharpness(im)"></a>class ImageEnhance.Sharpness(im)</h2><p>&emsp;&emsp;Creates an enhancement object for adjusting the sharpness of an image. The factor 0.0 gives a blurred image, 1.0 gives the original image, and a factor of 2.0 gives a sharpened image.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageFilter模块]]></title>
      <url>http://lizonghang.github.io/2016/07/29/ImageFilter%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;The ImageFilter module contains definitions for a pre-defined set of filters, which can be be used with the filter method of the Image class.</p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image, ImageFilter</span><br><span class="line">im = Image.open(&apos;lena.jpg&apos;)</span><br><span class="line">im1 = im.filter(ImageFilter.BLUR)</span><br><span class="line">im2 = im.filter(ImageFilter.MinFilter(3))</span><br><span class="line">im3 = im.filter(ImageFilter.MinFilter)</span><br></pre></td></tr></table></figure>
<h1 id="Filters"><a href="#Filters" class="headerlink" title="Filters"></a>Filters</h1><p>&emsp;&emsp;The current version of the library provides the following set of predefined image enhancement filters:</p>
<ul>
<li>BLUR</li>
<li>CONTOUR</li>
<li>DETAIL</li>
<li>EDGE_ENHANCE</li>
<li>EDGE_ENHANCE_MORE</li>
<li>EMBOSS</li>
<li>FIND_EDGES</li>
<li>SMOOTH_MORE</li>
<li>SHARPEN</li>
</ul>
<h2 id="ImageFilter-Kernel-size-kernel-scale-None-offset-0"><a href="#ImageFilter-Kernel-size-kernel-scale-None-offset-0" class="headerlink" title="ImageFilter.Kernel(size, kernel, scale=None, offset=0)"></a>ImageFilter.Kernel(size, kernel, scale=None, offset=0)</h2><p>&emsp;&emsp;(New in 1.1.5) Creates a convolution kernel of the given size. In the current version, size must be either (3, 3) or (5, 5), and the kernel argument must be a sequence containing 9 or 25 integer or floating point weights.<br>&emsp;&emsp;If scale is given, the result of applying the kernel to each pixel is divided by the scale value. The default is the sum of the kernel weights.<br>&emsp;&emsp;If offset is given, this value is added to the result, after it has been divided by scale.</p>
<h2 id="ImageFilter-RankFilter-size-rank"><a href="#ImageFilter-RankFilter-size-rank" class="headerlink" title="ImageFilter.RankFilter(size, rank)"></a>ImageFilter.RankFilter(size, rank)</h2><p>&emsp;&emsp;(New in 1.1.5) Creates a rank filter of the given size. For each pixel in the input image, the rank filter sorts all pixels in a (size, size) environment by pixel value, and copies the rank‘th value to the output image.</p>
<h2 id="ImageFilter-MinFilter-size-3"><a href="#ImageFilter-MinFilter-size-3" class="headerlink" title="ImageFilter.MinFilter(size=3)"></a>ImageFilter.MinFilter(size=3)</h2><p>&emsp;&emsp;(New in 1.1.5) Creates a min filter of the given size. For each pixel in the input image, this filter copies the smallest pixel value from a (size, size) environment to the output image.</p>
<h2 id="ImageFilter-MedianFilter-size-3"><a href="#ImageFilter-MedianFilter-size-3" class="headerlink" title="ImageFilter.MedianFilter(size=3)"></a>ImageFilter.MedianFilter(size=3)</h2><p>&emsp;&emsp;(New in 1.1.5) Creates a median filter of the given size. For each pixel in the input image, this filter copies the median pixel value from a (size, size) environment to the output image.</p>
<h2 id="ImageFilter-MaxFilter-size-3"><a href="#ImageFilter-MaxFilter-size-3" class="headerlink" title="ImageFilter.MaxFilter(size=3)"></a>ImageFilter.MaxFilter(size=3)</h2><p>&emsp;&emsp;(New in 1.1.5) Creates a max filter of the given size. For each pixel in the input image, this filter copies the largest pixel value from a (size, size) environment to the output image.</p>
<h2 id="ImageFilter-ModeFilter-size-3"><a href="#ImageFilter-ModeFilter-size-3" class="headerlink" title="ImageFilter.ModeFilter(size=3)"></a>ImageFilter.ModeFilter(size=3)</h2><p>&emsp;&emsp;(New in 1.1.5) Creates a mode filter of the given size. For each pixel in the input image, this filter copies the most common pixel value in a (size, size) environment to the output image. If no pixel value occurs more than once, the original pixel value is used.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageFont模块]]></title>
      <url>http://lizonghang.github.io/2016/07/28/ImageFont%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;The ImageFont module defines a class with the same name. Instances of this class store bitmap fonts, and are used with the text method of the ImageDraw class.<br>&emsp;&emsp;PIL uses its own font file format to store bitmap fonts. You can use the pilfont utility to convert BDF and PCF font descriptors (X window font formats) to this format.<br>&emsp;&emsp;Starting with version 1.1.4, PIL can be configured to support TrueType and OpenType fonts (as well as other font formats supported by the FreeType library). For earlier versions, TrueType support is only available as part of the imToolkit package.<br>&emsp;&emsp;<strong>Note：</strong> In Pythonista, the truetype() function can be used to load built-in system fonts, e.g. <code>font = ImageFont.truetype(‘Helvetica’, 20)</code>.</p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image, ImageDraw, ImageFont</span><br><span class="line">im = Image.open(&apos;lena.jpg&apos;)</span><br><span class="line">draw = ImageDraw.Draw(im)</span><br><span class="line">font = ImageFont.truetype(&apos;Helvetica&apos;, 15)</span><br><span class="line">draw.text((10,10), &apos;Hello World&apos;, font=font, fill=(255,0,0))</span><br><span class="line">del draw</span><br><span class="line">im.show()</span><br></pre></td></tr></table></figure>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><h2 id="ImageFont-load-file"><a href="#ImageFont-load-file" class="headerlink" title="ImageFont.load(file)"></a>ImageFont.load(file)</h2><p>&emsp;&emsp;Loads a font from the given file, and returns the corresponding font object. If this function fails, it raises an IOError exception.</p>
<h2 id="ImageFont-load-path-file"><a href="#ImageFont-load-path-file" class="headerlink" title="ImageFont.load_path(file)"></a>ImageFont.load_path(file)</h2><p>&emsp;&emsp;Same as load(), but searches for the file along sys.path if it’s not found in the current directory.</p>
<h2 id="ImageFont-truetype-file-size"><a href="#ImageFont-truetype-file-size" class="headerlink" title="ImageFont.truetype(file, size)"></a>ImageFont.truetype(file, size)</h2><p>&emsp;&emsp;Load a TrueType or OpenType font file, and create a font object. This function loads a font object from the given file, and creates a font object for a font of the given size.<br>&emsp;&emsp;On Windows, if the given file name does not exist, the loader also looks in Windows fonts directory.</p>
<h2 id="ImageFont-load-default"><a href="#ImageFont-load-default" class="headerlink" title="ImageFont.load_default()"></a>ImageFont.load_default()</h2><p>&emsp;&emsp;(New in 1.1.4) Load a “better than nothing” default font.</p>
<h1 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h1><h2 id="font-getsize-text"><a href="#font-getsize-text" class="headerlink" title="font.getsize(text)"></a>font.getsize(text)</h2><p>&emsp;&emsp;Returns the width and height of the given text, as a 2-tuple.</p>
<h2 id="font-getmask-text-mode-’’"><a href="#font-getmask-text-mode-’’" class="headerlink" title="font.getmask(text, mode=’’)"></a>font.getmask(text, mode=’’)</h2><p>&emsp;&emsp;Returns a bitmap for the text. The bitmap should be an internal PIL storage memory instance (as defined by the Image.core interface module).<br>&emsp;&emsp;If the font uses antialiasing, the bitmap should have mode “L” and use a maximum value of 255. Otherwise, it should have mode “1”.<br>&emsp;&emsp;(New in 1.1.5) The optional mode argument is used by some graphics drivers to indicate what mode the driver prefers; if empty, the renderer may return either mode. Note that the mode is always a string, to simplify C-level implementations.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageDraw模块]]></title>
      <url>http://lizonghang.github.io/2016/07/28/ImageDraw%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;The ImageDraw module provide simple 2D graphics for Image objects. You can use this module to create new images, annotate or retouch existing images, and to generate graphics on the fly for web use.</p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image, ImageDraw</span><br><span class="line">im = Image.open(&apos;lena.jpg&apos;)</span><br><span class="line">draw = ImageDraw.Draw(im)</span><br><span class="line">draw.line((0,0)+im.size, fill=128)</span><br><span class="line">draw.line((0,im.size[1],im.size[0],0), fill=128)</span><br><span class="line">del draw</span><br><span class="line">im.show()</span><br></pre></td></tr></table></figure>
<h1 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h1><h2 id="Coordinates"><a href="#Coordinates" class="headerlink" title="Coordinates"></a>Coordinates</h2><p>&emsp;&emsp;The graphics interface uses the same coordinate system as PIL itself, with (0, 0) in the upper left corner.</p>
<h2 id="Colours"><a href="#Colours" class="headerlink" title="Colours"></a>Colours</h2><p>&emsp;&emsp;To specify colours, you can use numbers or tuples just as you would use with Image.new or Image.putpixel. For “1”, “L”, and “I” images, use integers. For “RGB” images, use a 3-tuple containing integer values. For “F” images, use integer or floating point values.<br>&emsp;&emsp;For palette images (mode “P”), use integers as colour indexes. In 1.1.4 and later, you can also use RGB 3-tuples or colour names (see below). The drawing layer will automatically assign colour indexes, as long as you don’t draw with more than 256 colours.</p>
<h2 id="Colour-Names"><a href="#Colour-Names" class="headerlink" title="Colour Names"></a>Colour Names</h2><p>In PIL 1.1.4 and later, you can also use string constants when drawing in “RGB” images. PIL supports the following string formats:</p>
<ul>
<li>Hexadecimal color specifiers, given as “#rgb” or “#rrggbb”. For example, “#ff0000” specifies pure red.</li>
<li>RGB functions, given as “rgb(red, green, blue)” where the colour values are integers in the range 0 to 255. Alternatively, the color values can be given as three percentages (0% to 100%). For example, “rgb(255,0,0)” and “rgb(100%,0%,0%)” both specify pure red.</li>
<li>Hue-Saturation-Lightness (HSL) functions, given as “hsl(hue, saturation%, lightness%)” where hue is the colour given as an angle between 0 and 360 (red=0, green=120, blue=240), saturation is a value between 0% and 100% (gray=0%, full color=100%), and lightness is a value between 0% and 100% (black=0%, normal=50%, white=100%). For example, “hsl(0,100%,50%)” is pure red.</li>
<li>Common HTML colour names. The ImageDraw provides some 140 standard colour names, based on the colors supported by the X Window system and most web browsers. Colour names are case insensitive, and may contain whitespace. For example, “red” and “Red” both specify pure red.</li>
</ul>
<h2 id="Fonts"><a href="#Fonts" class="headerlink" title="Fonts"></a>Fonts</h2><p>&emsp;&emsp;PIL can use bitmap fonts or OpenType/TrueType fonts.<br>&emsp;&emsp;Bitmap fonts are stored in PIL’s own format, where each font typically consists of a two files, one named .pil and the other usually named .pbm. The former contains font metrics, the latter raster data.<br>&emsp;&emsp;To load a bitmap font, use the load functions in the ImageFont module.<br>&emsp;&emsp;To load a OpenType/TrueType font, use the truetype function in the ImageFont module. Note that this function depends on third-party libraries, and may not available in all PIL builds.</p>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><h2 id="ImageDraw-Draw-im"><a href="#ImageDraw-Draw-im" class="headerlink" title="ImageDraw.Draw(im)"></a>ImageDraw.Draw(im)</h2><p>&emsp;&emsp;Creates an object that can be used to draw in the given image.Note that the image will be modified in place.</p>
<h1 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h1><h2 id="ImageDraw-arc-xy-start-end-options"><a href="#ImageDraw-arc-xy-start-end-options" class="headerlink" title="ImageDraw.arc(xy, start, end, options)"></a>ImageDraw.arc(xy, start, end, options)</h2><p>&emsp;&emsp;Draws an arc (a portion of a circle outline) between the start and end angles, inside the given bounding box.<br>&emsp;&emsp;The outline option gives the colour to use for the arc.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">draw.arc((0, 0, im.size[0], im.size[1]), 0, 180, fill=(255,0,0))</span><br></pre></td></tr></table></figure>
<h2 id="ImageDraw-bitmap-xy-bitmap-options"><a href="#ImageDraw-bitmap-xy-bitmap-options" class="headerlink" title="ImageDraw.bitmap(xy, bitmap, options)"></a>ImageDraw.bitmap(xy, bitmap, options)</h2><p>&emsp;&emsp;Draws a bitmap (mask) at the given position, using the current fill colour for the non-zero portions. The bitmap should be a valid transparency mask (mode “1”) or matte (mode “L” or “RGBA”).<br>&emsp;&emsp;This is equivalent to doing image.paste(xy, color, bitmap).<br>&emsp;&emsp;To paste pixel data into an image, use the paste method on the image itself.</p>
<h2 id="ImageDraw-chord-xy-start-end-options"><a href="#ImageDraw-chord-xy-start-end-options" class="headerlink" title="ImageDraw.chord(xy, start, end, options)"></a>ImageDraw.chord(xy, start, end, options)</h2><p>&emsp;&emsp;Same as arc(), and connects the end points and the start points with a straight line.<br>&emsp;&emsp;The outline option gives the colour to use for the chord outline. The fill option gives the colour to use for the chord interior.</p>
<h2 id="ImageDraw-ellipse-xy-options"><a href="#ImageDraw-ellipse-xy-options" class="headerlink" title="ImageDraw.ellipse(xy, options)"></a>ImageDraw.ellipse(xy, options)</h2><p>&emsp;&emsp;Draws an ellipse inside the given bounding box.<br>&emsp;&emsp;The outline option gives the colour to use for the ellipse outline. The fill option gives the colour to use for the ellipse interior.</p>
<h2 id="ImageDraw-line-xy-options"><a href="#ImageDraw-line-xy-options" class="headerlink" title="ImageDraw.line(xy, options)"></a>ImageDraw.line(xy, options)</h2><p>&emsp;&emsp;Draws a line between the coordinates in the xy list.<br>&emsp;&emsp;The coordinate list can be any sequence object containing either 2-tuples [ (x, y), … ] or numeric values [ x, y, … ]. It should contain at least two coordinates.<br>&emsp;&emsp;The fill option gives the colour to use for the line.<br>&emsp;&emsp;(New in 1.1.5) The width option gives the line width, in pixels. Note that line joins are not handled well, so wide polylines will not look good.</p>
<h2 id="ImageDraw-pieslice-xy-start-end-options"><a href="#ImageDraw-pieslice-xy-start-end-options" class="headerlink" title="ImageDraw.pieslice(xy, start, end, options)"></a>ImageDraw.pieslice(xy, start, end, options)</h2><p>&emsp;&emsp;Same as arc, but also draws straight lines between the end points and the center of the bounding box.<br>&emsp;&emsp;The outline option gives the colour to use for the pieslice outline. The fill option gives the colour to use for the pieslice interior.</p>
<h2 id="ImageDraw-point-xy-options"><a href="#ImageDraw-point-xy-options" class="headerlink" title="ImageDraw.point(xy, options)"></a>ImageDraw.point(xy, options)</h2><p>&emsp;&emsp;Draws points (individual pixels) at the given coordinates.<br>&emsp;&emsp;The coordinate list can be any sequence object containing either 2-tuples [ (x, y), … ] or numeric values [ x, y, … ].<br>&emsp;&emsp;The fill option gives the colour to use for the points.</p>
<h2 id="ImageDraw-polygon-xy-options"><a href="#ImageDraw-polygon-xy-options" class="headerlink" title="ImageDraw.polygon(xy, options)"></a>ImageDraw.polygon(xy, options)</h2><p>&emsp;&emsp;Draws a polygon.<br>&emsp;&emsp;The polygon outline consists of straight lines between the given coordinates, plus a straight line between the last and the first coordinate.<br>&emsp;&emsp;The coordinate list can be any sequence object containing either 2-tuples [ (x, y), … ] or numeric values [ x, y, … ]. It should contain at least three coordinates.<br>&emsp;&emsp;The outline option gives the colour to use for the polygon outline. The fill option gives the colour to use for the polygon interior.</p>
<h2 id="ImageDraw-rectangle-box-options"><a href="#ImageDraw-rectangle-box-options" class="headerlink" title="ImageDraw.rectangle(box, options)"></a>ImageDraw.rectangle(box, options)</h2><p>&emsp;&emsp;Draws a rectangle.<br>&emsp;&emsp;The box can be any sequence object containing either 2-tuples [ (x, y), (x, y) ] or numeric values [ x, y, x, y ]. It should contain two coordinates.<br>&emsp;&emsp;Note that the second coordinate pair defines a point just outside the rectangle, also when the rectangle is not filled.<br>&emsp;&emsp;The outline option gives the colour to use for the rectangle outline. The fill option gives the colour to use for the rectangle interior.</p>
<h2 id="ImageDraw-text-position-string-options"><a href="#ImageDraw-text-position-string-options" class="headerlink" title="ImageDraw.text(position, string, options)"></a>ImageDraw.text(position, string, options)</h2><p>&emsp;&emsp;Draws the string at the given position. The position gives the upper left corner of the text.<br>&emsp;&emsp;The font option is used to specify which font to use. It should be an instance of the ImageFont class, typically loaded from file using the load method in the ImageFont module.<br>&emsp;&emsp;The fill option gives the colour to use for the text.</p>
<h2 id="ImageDraw-textsize-string-options"><a href="#ImageDraw-textsize-string-options" class="headerlink" title="ImageDraw.textsize(string, options)"></a>ImageDraw.textsize(string, options)</h2><p>&emsp;&emsp;Return the size of the given string, in pixels.<br>&emsp;&emsp;The font option is used to specify which font to use. It should be an instance of the ImageFont class, typically loaded from file using the load method in the ImageFont module.</p>
<h1 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h1><ul>
<li>outline - integer or tuple</li>
<li>fill - integer or tuple</li>
<li>font - ImageFont instance</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageColor模块]]></title>
      <url>http://lizonghang.github.io/2016/07/28/ImageColor%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;The ImageColor module contains colour tables and converters from CSS3-style colour specifiers to RGB tuples. This module is used by Image.new() and the ImageDraw module, among others.</p>
<h1 id="Colour-Names"><a href="#Colour-Names" class="headerlink" title="Colour Names"></a>Colour Names</h1><p>The ImageColor module supports the following string formats:</p>
<ul>
<li>Hexadecimal color specifiers, given as “#rgb” or “#rrggbb”. For example, “#ff0000” specifies pure red.</li>
<li>RGB functions, given as “rgb(red, green, blue)” where the colour values are integers in the range 0 to 255. Alternatively, the color values can be given as three percentages (0% to 100%). For example, “rgb(255,0,0)” and “rgb(100%,0%,0%)” both specify pure red.</li>
<li>Hue-Saturation-Lightness (HSL) functions, given as “hsl(hue, saturation%, lightness%)” where hue is the colour given as an angle between 0 and 360 (red=0, green=120, blue=240), saturation is a value between 0% and 100% (gray=0%, full color=100%), and lightness is a value between 0% and 100% (black=0%, normal=50%, white=100%). For example, “hsl(0,100%,50%)” is pure red.</li>
<li>Common HTML colour names. The ImageColor module provides some 140 standard colour names, based on the colors supported by the X Window system and most web browsers. Colour names are case insensitive. For example, “red” and “Red” both specify pure red.</li>
</ul>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><h2 id="ImageColor-getrgb-color"><a href="#ImageColor-getrgb-color" class="headerlink" title="ImageColor.getrgb(color)"></a>ImageColor.getrgb(color)</h2><p>&emsp;&emsp;(New in 1.1.4) Convert a colour string to an RGB tuple. If the string cannot be parsed, this function raises a ValueError exception.</p>
<h2 id="ImageColor-getcolor-color-mode"><a href="#ImageColor-getcolor-color-mode" class="headerlink" title="ImageColor.getcolor(color, mode)"></a>ImageColor.getcolor(color, mode)</h2><p>&emsp;&emsp;(New in 1.1.4) Same as getrgb(), but converts the RGB value to a greyscale value if the mode is not color or a palette image. If the string cannot be parsed, this function raises a ValueError exception.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ImageFile模块]]></title>
      <url>http://lizonghang.github.io/2016/07/28/ImageFile%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;The ImageFile module provides support functions for the image open and save functions.<br>&emsp;&emsp;In addition, it provides a Parser class which can be used to decode an image piece by piece (e.g. while receiving it over a network connection). This class implements the same consumer interface as the standard sgmllib and xmllib modules.</p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from PIL import ImageFile</span><br><span class="line">fp = open(&apos;lena.jpg&apos;, &apos;rb&apos;)</span><br><span class="line">p = ImageFile.Parser()</span><br><span class="line">while True:</span><br><span class="line">    s = fp.read(1024)</span><br><span class="line">    if not s:</span><br><span class="line">        break</span><br><span class="line">    p.feed(s)</span><br><span class="line">im = p.close()</span><br><span class="line">im.save(&apos;copy.jpg&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><h2 id="ImageFile-Parser"><a href="#ImageFile-Parser" class="headerlink" title="ImageFile.Parser()"></a>ImageFile.Parser()</h2><p>&emsp;&emsp;Creates a parser object. Parsers cannot be reused.</p>
<h1 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h1><h2 id="parser-feed-data"><a href="#parser-feed-data" class="headerlink" title="parser.feed(data)"></a>parser.feed(data)</h2><p>&emsp;&emsp;Feed a string of data to the parser. This method may raise an IOError exception.</p>
<h2 id="parser-close"><a href="#parser-close" class="headerlink" title="parser.close()"></a>parser.close()</h2><p>&emsp;&emsp;Tells the parser to finish decoding. If the parser managed to decode an image, it returns an Image object. Otherwise, this method raises an IOError exception.</p>
<p>&emsp;&emsp;<strong>Note：</strong>If the file cannot be identified, the parser will raise an IOError exception in the close method. If the file can be identified, but not decoded (for example, if the data is damaged, or if it uses an unsupported compression method), the parser will raise an IOError exception as soon as possible, either in feed or close.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Image模块]]></title>
      <url>http://lizonghang.github.io/2016/07/27/Image%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<h1 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h1><h2 id="Image-new-mode-size-color"><a href="#Image-new-mode-size-color" class="headerlink" title="Image.new(mode, size[, color])"></a>Image.new(mode, size[, color])</h2><p>&emsp;&emsp;Creates a new image with the given mode and size. Size is given as a (width, height)-tuple, in pixels. The color is given as a single value for single-band images, and a tuple for multi-band images (with one value for each band). In 1.1.4 and later, you can also use color names (see the ImageColor module documentation for details) If the color argument is omitted, the image is filled with zero (this usually corresponds to black). If the color is None, the image is not initialised. This can be useful if you’re going to paste or draw things in the image.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">im = Image.new(&apos;RGB&apos;, (512,512), &apos;white&apos;)</span><br></pre></td></tr></table></figure>
<h2 id="Image-open-file-mode"><a href="#Image-open-file-mode" class="headerlink" title="Image.open(file[, mode])"></a>Image.open(file[, mode])</h2><p>&emsp;&emsp;Opens and identifies the given image file. This is a lazy operation; the function reads the file header, but the actual image data is not read from the file until you try to process the data (call the load method to force loading). If the mode argument is given, it must be “r”.<br>&emsp;&emsp;You can use either a string (representing the filename) or a file object as the file argument. In the latter case, the file object must implement read, seek, and tell methods, and be opened in binary mode.</p>
<h2 id="Image-blend-im1-im2-alpha"><a href="#Image-blend-im1-im2-alpha" class="headerlink" title="Image.blend(im1, im2, alpha)"></a>Image.blend(im1, im2, alpha)</h2><p>&emsp;&emsp;Creates a new image by interpolating between the given images, using a constant alpha. Both images must have the same size and mode.<br><code>out = image1 * (1.0 - alpha) + image2 * alpha</code><br>&emsp;&emsp;If the alpha is 0.0, a copy of the first image is returned. If the alpha is 1.0, a copy of the second image is returned. There are no restrictions on the alpha value. If necessary, the result is clipped to fit into the allowed output range.</p>
<h2 id="Image-composite-im1-im2-mask"><a href="#Image-composite-im1-im2-mask" class="headerlink" title="Image.composite(im1, im2, mask)"></a>Image.composite(im1, im2, mask)</h2><p>&emsp;&emsp;Creates a new image by interpolating between the given images, using the corresponding pixels from a mask image as alpha. The mask can have mode “1”, “L”, or “RGBA”. All images must be the same size.</p>
<h2 id="Image-eval-im-function"><a href="#Image-eval-im-function" class="headerlink" title="Image.eval(im, function)"></a>Image.eval(im, function)</h2><p>&emsp;&emsp;Applies the function (which should take one argument) to each pixel in the given image. If the image has more than one band, the same function is applied to each band. Note that the function is evaluated once for each possible pixel value, so you cannot use random components or other generators.</p>
<h2 id="Image-frombuffer-mode-size-data"><a href="#Image-frombuffer-mode-size-data" class="headerlink" title="Image.frombuffer(mode, size, data)"></a>Image.frombuffer(mode, size, data)</h2><p>&emsp;&emsp;(New in PIL 1.1.4). Creates an image memory from pixel data in a string or buffer object, using the standard “raw” decoder. For some modes, the image memory will share memory with the original buffer (this means that changes to the original buffer object are reflected in the image). Not all modes can share memory; supported modes include “L”, “RGBX”, “RGBA”, and “CMYK”. For other modes, this function behaves like a corresponding call to the fromstring function.<br>&emsp;&emsp;Note：In versions up to and including 1.1.6, the default orientation differs from that of fromstring. This may be changed in future versions, so for maximum portability, it’s recommended that you spell out all arguments when using the “raw” decoder:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">im = Image.frombuffer(mode, size, data, &quot;raw&quot;, mode, 0, 1)</span><br></pre></td></tr></table></figure></p>
<h2 id="Image-fromstring-mode-size-data-decoder-parameters"><a href="#Image-fromstring-mode-size-data-decoder-parameters" class="headerlink" title="Image.fromstring(mode, size, data[, decoder, parameters])"></a>Image.fromstring(mode, size, data[, decoder, parameters])</h2><p>&emsp;&emsp;Creates an image memory from pixel data in a string.</p>
<h2 id="Image-merge-mode-bands"><a href="#Image-merge-mode-bands" class="headerlink" title="Image.merge(mode, bands)"></a>Image.merge(mode, bands)</h2><p>&emsp;&emsp;Creates a new image from a number of single band images. The bands are given as a tuple or list of images, one for each band described by the mode. All bands must have the same size.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r, g, b = im.split()</span><br><span class="line">out = Image.merge(&apos;RGB&apos;, (r,g,b))</span><br></pre></td></tr></table></figure>
<h1 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h1><h2 id="Image-convert-mode"><a href="#Image-convert-mode" class="headerlink" title="Image.convert(mode)"></a>Image.convert(mode)</h2><p>&emsp;&emsp;Converts an image to another mode, and returns the new image.<br>&emsp;&emsp;When converting from a palette image, this translates pixels through the palette. If mode is omitted, a mode is chosen so that all information in the image and the palette can be represented without a palette.<br>&emsp;&emsp;When converting from a colour image to black and white, the library uses the ITU-R 601-2 luma transform:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">L = R * 299/1000 + G * 587/1000 + B * 114/1000</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;When converting to a bilevel image (mode “1”), the source image is first converted to black and white. Resulting values larger than 127 are then set to white, and the image is dithered. To use other thresholds, use the point method. To disable dithering, use the dither= option (see below).</p>
<h2 id="Image-convert-‘P’-options"><a href="#Image-convert-‘P’-options" class="headerlink" title="Image.convert(‘P’, **options)"></a>Image.convert(‘P’, **options)</h2><p>&emsp;&emsp;Same, but provides better control when converting an “RGB” image to an 8-bit palette image. Available options are:</p>
<ul>
<li><code>dither=</code>：Controls dithering. The default is FLOYDSTEINBERG, which distributes errors to neighboring pixels. To disable dithering, use NONE.</li>
<li><code>palette=</code>：Controls palette generation. The default is WEB, which is the standard 216-color “web palette”. To use an optimized palette, use ADAPTIVE.</li>
<li><code>colors=</code>：Controls the number of colors used for the palette when palette is ADAPTIVE. Defaults to the maximum value, 256 colors.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out = im.convert(&apos;P&apos;, palette=Image.ADAPTIVE)</span><br></pre></td></tr></table></figure>
<h2 id="Image-convert-mode-matrix"><a href="#Image-convert-mode-matrix" class="headerlink" title="Image.convert(mode, matrix)"></a>Image.convert(mode, matrix)</h2><p>&emsp;&emsp;Converts an “RGB” image to “L” or “RGB” using a conversion matrix. The matrix is a 4- or 16-tuple.<br>&emsp;&emsp;The following example converts an RGB image (linearly calibrated according to ITU-R 709, using the D65 luminant) to the CIE XYZ colour space:<br>&emsp;&emsp;Convert RGB to XYZ:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">matrix = (</span><br><span class="line">    0.412453, 0.357580, 0.180423, 0,</span><br><span class="line">    0.212671, 0.715160, 0.072169, 0,</span><br><span class="line">    0.019334, 0.119193, 0.950227, 0 )</span><br><span class="line">out = im.convert(&apos;RGB&apos;, matrix)</span><br></pre></td></tr></table></figure>
<h2 id="Image-copy"><a href="#Image-copy" class="headerlink" title="Image.copy()"></a>Image.copy()</h2><p>&emsp;&emsp;Copies the image. Use this method if you wish to paste things into an image, but still retain the original.</p>
<h2 id="Image-crop-box"><a href="#Image-crop-box" class="headerlink" title="Image.crop(box)"></a>Image.crop(box)</h2><p>&emsp;&emsp;Returns a copy of a rectangular region from the current image. The box is a 4-tuple defining the left, upper, right, and lower pixel coordinate.<br>&emsp;&emsp;This is a lazy operation. Changes to the source image may or may not be reflected in the cropped image. To get a separate copy, call the load method on the cropped copy.</p>
<h2 id="Image-draft-mode-size"><a href="#Image-draft-mode-size" class="headerlink" title="Image.draft(mode, size)"></a>Image.draft(mode, size)</h2><p>&emsp;&emsp;Configures the image file loader so it returns a version of the image that as closely as possible matches the given mode and size. For example, you can use this method to convert a colour JPEG to greyscale while loading it, or to extract a 128x192 version from a PCD file.<br>&emsp;&emsp;Note that this method modifies the Image object in place (to be precise, it reconfigures the file reader). If the image has already been loaded, this method has no effect.</p>
<h2 id="Image-filter-filter"><a href="#Image-filter-filter" class="headerlink" title="Image.filter(filter)"></a>Image.filter(filter)</h2><p>&emsp;&emsp;Returns a copy of an image filtered by the given filter. For a list of available filters, see the ImageFilter module.</p>
<h2 id="Image-fromstring-data-decoder-parameters"><a href="#Image-fromstring-data-decoder-parameters" class="headerlink" title="Image.fromstring(data[, decoder[, parameters]])"></a>Image.fromstring(data[, decoder[, parameters]])</h2><p>&emsp;&emsp;function fromstring has been removed. Please call function frombytes instead.</p>
<h2 id="Image-getbands"><a href="#Image-getbands" class="headerlink" title="Image.getbands()"></a>Image.getbands()</h2><p>&emsp;&emsp;Returns a tuple containing the name of each band. For example, getbands on an RGB image returns (“R”, “G”, “B”).</p>
<h2 id="Image-getbbox"><a href="#Image-getbbox" class="headerlink" title="Image.getbbox()"></a>Image.getbbox()</h2><p>&emsp;&emsp;Calculates the bounding box of the non-zero regions in the image. The bounding box is returned as a 4-tuple defining the left, upper, right, and lower pixel coordinate. If the image is completely empty, this method returns None.</p>
<h2 id="Image-getcolors"><a href="#Image-getcolors" class="headerlink" title="Image.getcolors()"></a>Image.getcolors()</h2><h2 id="Image-getcolors-maxcolors"><a href="#Image-getcolors-maxcolors" class="headerlink" title="Image.getcolors(maxcolors)"></a>Image.getcolors(maxcolors)</h2><p>&emsp;&emsp;(New in 1.1.5) Returns an unsorted list of (count, color) tuples, where count is the number of times the corresponding color occurs in the image.<br>&emsp;&emsp;If the maxcolors value is exceeded, the method stops counting and returns None. The default maxcolors value is 256. To make sure you get all colors in an image, you can pass in size[0]*size[1] (but make sure you have lots of memory before you do that on huge images).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maxcolors = im.size[0] * im.size[1]</span><br><span class="line">print im.getcolors(maxcolors)</span><br></pre></td></tr></table></figure>
<h2 id="Image-getdata"><a href="#Image-getdata" class="headerlink" title="Image.getdata()"></a>Image.getdata()</h2><p>&emsp;&emsp;Returns the contents of an image as a sequence object containing pixel values. The sequence object is flattened, so that values for line one follow directly after the values of line zero, and so on.<br>&emsp;&emsp;Note that the sequence object returned by this method is an internal PIL data type, which only supports certain sequence operations, including iteration and basic sequence access. To convert it to an ordinary sequence (e.g. for printing), use：</p>
<h2 id="Image-getextrema"><a href="#Image-getextrema" class="headerlink" title="Image.getextrema()"></a>Image.getextrema()</h2><p>&emsp;&emsp;Returns a 2-tuple containing the minimum and maximum values of the image. In the current version of PIL, this works for multi-band images.</p>
<h2 id="Image-getpixel-x-y"><a href="#Image-getpixel-x-y" class="headerlink" title="Image.getpixel((x,y))"></a>Image.getpixel((x,y))</h2><p>&emsp;&emsp;Returns the pixel at the given position. If the image is a multi-layer image, this method returns a tuple.<br>&emsp;&emsp;Note that this method is rather slow; if you need to process larger parts of an image from Python, you can either use pixel access objects (see load), or the getdata method.</p>
<h2 id="Image-histogram"><a href="#Image-histogram" class="headerlink" title="Image.histogram()"></a>Image.histogram()</h2><p>&emsp;&emsp;Returns a histogram for the image. The histogram is returned as a list of pixel counts, one for each pixel value in the source image. If the image has more than one band, the histograms for all bands are concatenated (for example, the histogram for an “RGB” image contains 768 values).<br>&emsp;&emsp;A bilevel image (mode “1”) is treated as a greyscale (“L”) image by this method.</p>
<h2 id="Image-load"><a href="#Image-load" class="headerlink" title="Image.load()"></a>Image.load()</h2><p>&emsp;&emsp;Allocates storage for the image and loads it from the file (or from the source, for lazy operations). In normal cases, you don’t need to call this method, since the Image class automatically loads an opened image when it is accessed for the first time.<br>&emsp;&emsp;(New in 1.1.6) In 1.1.6 and later, load returns a pixel access object that can be used to read and modify pixels. The access object behaves like a 2-dimensional array, so you can do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pix = im.load()</span><br><span class="line">pix[x, y] = value</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;Access via this object is a lot faster than getpixel and putpixel.</p>
<h2 id="Image-offset"><a href="#Image-offset" class="headerlink" title="Image.offset()"></a>Image.offset()</h2><p>&emsp;&emsp;method offset has been removed. Please call method ImageChops.offset instead.</p>
<h2 id="Image-paste-im-box"><a href="#Image-paste-im-box" class="headerlink" title="Image.paste(im, box)"></a>Image.paste(im, box)</h2><p>&emsp;&emsp;Pastes another image into this image. The box argument is either a 2-tuple giving the upper left corner, a 4-tuple defining the left, upper, right, and lower pixel coordinate, or None (same as (0, 0)). If a 4-tuple is given, the size of the pasted image must match the size of the region.<br>&emsp;&emsp;If the modes don’t match, the pasted image is converted to the mode of this image (see the convert method for details).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">region = im.crop((175,96,396,363))</span><br><span class="line">im.paste(region.rotate(180), (175,96,396,363))</span><br></pre></td></tr></table></figure>
<h2 id="Image-paste-colour-box"><a href="#Image-paste-colour-box" class="headerlink" title="Image.paste(colour, box)"></a>Image.paste(colour, box)</h2><p>&emsp;&emsp;Same as above, but fills the region with a single colour. The colour is given as a single numerical value for single-band images, and a tuple for multi-band images.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">im.paste((255,255,255), (175,96,396,363))</span><br></pre></td></tr></table></figure>
<h2 id="Image-paste-im-box-mask"><a href="#Image-paste-im-box-mask" class="headerlink" title="Image.paste(im, box, mask)"></a>Image.paste(im, box, mask)</h2><p>&emsp;&emsp;Same as above, but updates only the regions indicated by the mask. You can use either “1”, “L” or “RGBA” images (in the latter case, the alpha band is used as mask). Where the mask is 255, the given image is copied as is. Where the mask is 0, the current value is preserved. Intermediate values can be used for transparency effects.<br>&emsp;&emsp;Note that if you paste an “RGBA” image, the alpha band is ignored. You can work around this by using the same image as both source image and mask.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">out = im.convert(&apos;L&apos;)</span><br><span class="line">region = im.crop((175,96,396,363)).convert(&apos;L&apos;)</span><br><span class="line">out.paste(region, (175,96,396,363), mask=Image.new(&apos;L&apos;, (221,267), 100))</span><br></pre></td></tr></table></figure>
<h2 id="Image-paste-colour-box-mask"><a href="#Image-paste-colour-box-mask" class="headerlink" title="Image.paste(colour, box, mask)"></a>Image.paste(colour, box, mask)</h2><p>&emsp;&emsp;Same as above, but fills the region indicated by the mask with a single colour.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">out = im.convert(&apos;L&apos;)</span><br><span class="line">region = im.crop((175,96,396,363)).convert(&apos;L&apos;)</span><br><span class="line">out.paste(100, (175,96,396,363), mask=region)</span><br></pre></td></tr></table></figure>
<h2 id="Image-point-table"><a href="#Image-point-table" class="headerlink" title="Image.point(table)"></a>Image.point(table)</h2><h2 id="Image-point-function"><a href="#Image-point-function" class="headerlink" title="Image.point(function)"></a>Image.point(function)</h2><p>&emsp;&emsp;Returns a copy of the image where each pixel has been mapped through the given lookup table. The table should contains 256 values per band in the image. If a function is used instead, it should take a single argument. The function is called once for each possible pixel value, and the resulting table is applied to all bands of the image.<br>&emsp;&emsp;If the image has mode “I” (integer) or “F” (floating point), you must use a function, and the function must have the following format:<code>argument * scale + offset</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out = im.point(lambda i: i * 1.2 + 10)</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;You can leave out either the scale or the offset.</p>
<h2 id="Image-point-table-mode"><a href="#Image-point-table-mode" class="headerlink" title="Image.point(table, mode)"></a>Image.point(table, mode)</h2><h2 id="Image-point-function-mode"><a href="#Image-point-function-mode" class="headerlink" title="Image.point(function, mode)"></a>Image.point(function, mode)</h2><p>&emsp;&emsp;Same as above, but specifies a new mode for the output image. This can be used to convert “L” and “P” images to “1” in one step, e.g. to threshold an image.<br>&emsp;&emsp;(New in 1.1.5) This form can also be used to convert “L” images to “I” or “F”, and to convert “I” images with 16-bit data to “L”. In the second case, you must use a 65536-item lookup table.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out = im.point(function, &apos;1&apos;)</span><br></pre></td></tr></table></figure>
<h2 id="Image-putalpha-band"><a href="#Image-putalpha-band" class="headerlink" title="Image.putalpha(band)"></a>Image.putalpha(band)</h2><p>&emsp;&emsp;Copies the given band to the alpha layer of the current image.<br>&emsp;&emsp;The image must be an “RGBA” image, and the band must be either “L” or “1”.<br>&emsp;&emsp;(New in PIL 1.1.5) You can use putalpha on other modes as well; the image is converted in place, to a mode that matches the current mode but has an alpha layer (this usually means “LA” or “RGBA”). Also, the band argument can be either an image, or a colour value (an integer).</p>
<h2 id="Image-putdata-data"><a href="#Image-putdata-data" class="headerlink" title="Image.putdata(data)"></a>Image.putdata(data)</h2><h2 id="Image-putdata-data-scale-offset"><a href="#Image-putdata-data-scale-offset" class="headerlink" title="Image.putdata(data, scale, offset)"></a>Image.putdata(data, scale, offset)</h2><p>&emsp;&emsp;Copy pixel values from a sequence object into the image, starting at the upper left corner (0, 0). The scale and offset values are used to adjust the sequence values:<code>pixel = value * scale + offset</code><br>&emsp;&emsp;If the scale is omitted, it defaults to 1.0. If the offset is omitted, it defaults to 0.0.</p>
<h2 id="Image-putpalette-sequence"><a href="#Image-putpalette-sequence" class="headerlink" title="Image.putpalette(sequence)"></a>Image.putpalette(sequence)</h2><p>&emsp;&emsp;Attach a palette to a “P” or “L” image. For an “L” image, the mode is changed to “P”. The palette sequence should contain 768 integer values, where each group of three values represent the red, green, and blue values for the corresponding pixel index. Instead of an integer sequence, you can use a 768-byte string.</p>
<h2 id="Image-putpixel-x-y-colour"><a href="#Image-putpixel-x-y-colour" class="headerlink" title="Image.putpixel((x,y), colour)"></a>Image.putpixel((x,y), colour)</h2><p>&emsp;&emsp;Modifies the pixel at the given position. The colour is given as a single numerical value for single-band images, and a tuple for multi-band images.<br>&emsp;&emsp;Note that this method is relatively slow. If you’re using 1.1.6, pixel access objects (see load) provide a faster way to modify the image. If you want to generate an entire image, it can be more efficient to create a Python list and use putdata to copy it to the image. For more extensive changes, use paste or the ImageDraw module instead.</p>
<h2 id="Image-quantize-colors-options"><a href="#Image-quantize-colors-options" class="headerlink" title="Image.quantize(colors, **options)"></a>Image.quantize(colors, **options)</h2><p>&emsp;&emsp;(Deprecated) Converts an “L” or “RGB” image to a “P” image with the given number of colors, and returns the new image.<br>&emsp;&emsp;For new code, use convert() with a adaptive palette instead:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out = im.convert(&quot;P&quot;, palette=Image.ADAPTIVE, colors=256)</span><br></pre></td></tr></table></figure></p>
<h2 id="Image-resize-size"><a href="#Image-resize-size" class="headerlink" title="Image.resize(size)"></a>Image.resize(size)</h2><p>&emsp;&emsp;Returns a resized copy of an image. The size argument gives the requested size in pixels, as a 2-tuple: (width, height).</p>
<h2 id="Image-resize-size-filter"><a href="#Image-resize-size-filter" class="headerlink" title="Image.resize(size, filter)"></a>Image.resize(size, filter)</h2><p>&emsp;&emsp;Returns a resized copy of an image. The size argument gives the requested size in pixels, as a 2-tuple: (width, height).<br>&emsp;&emsp;The filter argument can be one of NEAREST (use nearest neighbour), BILINEAR (linear interpolation in a 2x2 environment), BICUBIC (cubic spline interpolation in a 4x4 environment), or ANTIALIAS (a high-quality downsampling filter). If omitted, or if the image has mode “1” or “P”, it is set to NEAREST.<br>&emsp;&emsp;Note that the bilinear and bicubic filters in the current version of PIL are not well-suited for large downsampling ratios (e.g. when creating thumbnails). You should use ANTIALIAS unless speed is much more important than quality.</p>
<h2 id="Image-rotate-angle"><a href="#Image-rotate-angle" class="headerlink" title="Image.rotate(angle)"></a>Image.rotate(angle)</h2><p>&emsp;&emsp;Returns a copy of an image rotated the given number of degrees counter clockwise around its centre.</p>
<h2 id="Image-rotate-angle-filter-NEAREST-expand-0"><a href="#Image-rotate-angle-filter-NEAREST-expand-0" class="headerlink" title="Image.rotate(angle, filter=NEAREST, expand=0)"></a>Image.rotate(angle, filter=NEAREST, expand=0)</h2><p>&emsp;&emsp;Returns a copy of an image rotated the given number of degrees counter clockwise around its centre.<br>&emsp;&emsp;The filter argument can be one of NEAREST (use nearest neighbour), BILINEAR (linear interpolation in a 2x2 environment), or BICUBIC (cubic spline interpolation in a 4x4 environment). If omitted, or if the image has mode “1” or “P”, it is set to NEAREST.<br>&emsp;&emsp;The expand argument, if true, indicates that the output image should be made large enough to hold the rotated image. If omitted or false, the output image has the same size as the input image.</p>
<h2 id="Image-save-outfile-options"><a href="#Image-save-outfile-options" class="headerlink" title="Image.save(outfile, options)"></a>Image.save(outfile, options)</h2><p>&emsp;&emsp;Saves the image under the given filename.<br>&emsp;&emsp;Keyword options can be used to provide additional instructions to the writer. If a writer doesn’t recognise an option, it is silently ignored. The available options are described later in this handbook.<br>&emsp;&emsp;If the save fails, for some reason, the method will raise an exception (usually an IOError exception). If this happens, the method may have created the file, and may have written data to it. It’s up to your application to remove incomplete files, if necessary.</p>
<h2 id="Image-save-outfile-format-options"><a href="#Image-save-outfile-format-options" class="headerlink" title="Image.save(outfile, format, options)"></a>Image.save(outfile, format, options)</h2><p>&emsp;&emsp;Saves the image under the given filename. If format is omitted, the format is determined from the filename extension, if possible. This method returns None.<br>&emsp;&emsp;Keyword options can be used to provide additional instructions to the writer. If a writer doesn’t recognise an option, it is silently ignored. The available options are described later in this handbook.<br>&emsp;&emsp;You can use a file object instead of a filename. In this case, you must always specify the format. The file object must implement the seek, tell, and write methods, and be opened in binary mode.<br>&emsp;&emsp;If the save fails, for some reason, the method will raise an exception (usually an IOError exception). If this happens, the method may have created the file, and may have written data to it. It’s up to your application to remove incomplete files, if necessary.</p>
<h2 id="Image-seek-frame"><a href="#Image-seek-frame" class="headerlink" title="Image.seek(frame)"></a>Image.seek(frame)</h2><p>&emsp;&emsp;Seeks to the given frame in a sequence file. If you seek beyond the end of the sequence, the method raises an EOFError exception. When a sequence file is opened, the library automatically seeks to frame 0.<br>&emsp;&emsp;Note that in the current version of the library, most sequence formats only allows you to seek to the next frame.</p>
<h2 id="Image-show"><a href="#Image-show" class="headerlink" title="Image.show()"></a>Image.show()</h2><p>&emsp;&emsp;Displays an image. This method is mainly intended for debugging purposes, it returns None.</p>
<h2 id="Image-split"><a href="#Image-split" class="headerlink" title="Image.split()"></a>Image.split()</h2><p>&emsp;&emsp;Returns a tuple of individual image bands from an image. For example, splitting an “RGB” image creates three new images each containing a copy of one of the original bands (red, green, blue).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r, g, b = im.split()</span><br></pre></td></tr></table></figure>
<h2 id="Image-tell"><a href="#Image-tell" class="headerlink" title="Image.tell()"></a>Image.tell()</h2><p>&emsp;&emsp;Returns the current frame number.</p>
<h2 id="Image-thumbnail-size"><a href="#Image-thumbnail-size" class="headerlink" title="Image.thumbnail(size)"></a>Image.thumbnail(size)</h2><p>&emsp;&emsp;Modifies the image to contain a thumbnail version of itself, no larger than the given size. This method calculates an appropriate thumbnail size to preserve the aspect of the image, calls the draft method to configure the file reader (where applicable), and finally resizes the image.<br>&emsp;&emsp;Also note that this function modifies the Image object in place. If you need to use the full resolution image as well, apply this method to a copy of the original image. This method returns None.</p>
<h2 id="Image-thumbnail-size-filter"><a href="#Image-thumbnail-size-filter" class="headerlink" title="Image.thumbnail(size, filter)"></a>Image.thumbnail(size, filter)</h2><p>&emsp;&emsp;Modifies the image to contain a thumbnail version of itself, no larger than the given size. This method calculates an appropriate thumbnail size to preserve the aspect of the image, calls the draft method to configure the file reader (where applicable), and finally resizes the image.<br>&emsp;&emsp;The filter argument can be one of NEAREST, BILINEAR, BICUBIC, or ANTIALIAS (best quality). If omitted, it defaults to NEAREST.<br>&emsp;&emsp;Note that the bilinear and bicubic filters in the current version of PIL are not well-suited for thumbnail generation. You should use ANTIALIAS unless speed is much more important than quality.<br>&emsp;&emsp;Also note that this function modifies the Image object in place. If you need to use the full resolution image as well, apply this method to a copy of the original image. This method returns None.</p>
<h2 id="Image-tobitmap"><a href="#Image-tobitmap" class="headerlink" title="Image.tobitmap()"></a>Image.tobitmap()</h2><p>&emsp;&emsp;Returns the image converted to an X11 bitmap.</p>
<h2 id="Image-tostring"><a href="#Image-tostring" class="headerlink" title="Image.tostring()"></a>Image.tostring()</h2><p>&emsp;&emsp;method tostring has been removed. Please call tobytes instead.</p>
<h2 id="Image-tostring-encoder-parameters"><a href="#Image-tostring-encoder-parameters" class="headerlink" title="Image.tostring(encoder, parameters)"></a>Image.tostring(encoder, parameters)</h2><p>&emsp;&emsp;method tostring has been removed. Please call tobytes instead.</p>
<h2 id="Image-transform-size-method-data"><a href="#Image-transform-size-method-data" class="headerlink" title="Image.transform(size, method, data)"></a>Image.transform(size, method, data)</h2><p>&emsp;&emsp;Creates a new image with the given size, and the same mode as the original, and copies data to the new image using the given transform.<br>&emsp;&emsp;In the current version of PIL, the method argument can be EXTENT (cut out a rectangular subregion), AFFINE (affine transform), QUAD (map a quadrilateral to a rectangle), MESH (map a number of source quadrilaterals in one operation), or PERSPECTIVE. The various methods are described below.</p>
<h2 id="Image-transform-size-method-data-filter"><a href="#Image-transform-size-method-data-filter" class="headerlink" title="Image.transform(size, method, data, filter)"></a>Image.transform(size, method, data, filter)</h2><p>&emsp;&emsp;Creates a new image with the given size, and the same mode as the original, and copies data to the new image using the given transform.<br>&emsp;&emsp;In the current version of PIL, the method argument can be EXTENT (cut out a rectangular subregion), AFFINE (affine transform), QUAD (map a quadrilateral to a rectangle), MESH (map a number of source quadrilaterals in one operation), or PERSPECTIVE. The various methods are described below.<br>&emsp;&emsp;The filter argument defines how to filter pixels from the source image. In the current version, it can be NEAREST (use nearest neighbour), BILINEAR (linear interpolation in a 2x2 environment), or BICUBIC (cubic spline interpolation in a 4x4 environment). If omitted, or if the image has mode “1” or “P”, it is set to NEAREST.</p>
<h2 id="Image-transform-size-EXTENT-data"><a href="#Image-transform-size-EXTENT-data" class="headerlink" title="Image.transform(size, EXTENT, data)"></a>Image.transform(size, EXTENT, data)</h2><h2 id="Image-transform-size-EXTENT-data-filter"><a href="#Image-transform-size-EXTENT-data-filter" class="headerlink" title="Image.transform(size, EXTENT, data, filter)"></a>Image.transform(size, EXTENT, data, filter)</h2><p>&emsp;&emsp;Extracts a subregion from the image.<br>&emsp;&emsp;Data is a 4-tuple (x0, y0, x1, y1) which specifies two points in the input image’s coordinate system. The resulting image will contain data sampled from between these two points, such that (x0, y0) in the input image will end up at (0,0) in the output image, and (x1, y1) at size.<br>&emsp;&emsp;This method can be used to crop, stretch, shrink, or mirror an arbitrary rectangle in the current image. It is slightly slower than crop, but about as fast as a corresponding resize operation.</p>
<h2 id="Image-transform-size-AFFINE-data"><a href="#Image-transform-size-AFFINE-data" class="headerlink" title="Image.transform(size, AFFINE, data)"></a>Image.transform(size, AFFINE, data)</h2><h2 id="Image-transform-size-AFFINE-data-filter"><a href="#Image-transform-size-AFFINE-data-filter" class="headerlink" title="Image.transform(size, AFFINE, data, filter)"></a>Image.transform(size, AFFINE, data, filter)</h2><p>&emsp;&emsp;Applies an affine transform to the image, and places the result in a new image with the given size.<br>&emsp;&emsp;Data is a 6-tuple (a, b, c, d, e, f) which contain the first two rows from an affine transform matrix. For each pixel (x, y) in the output image, the new value is taken from a position (a x + b y + c, d x + e y + f) in the input image, rounded to nearest pixel.<br>&emsp;&emsp;This function can be used to scale, translate, rotate, and shear the original image.</p>
<h2 id="Image-transform-size-QUAD-data"><a href="#Image-transform-size-QUAD-data" class="headerlink" title="Image.transform(size, QUAD, data)"></a>Image.transform(size, QUAD, data)</h2><h2 id="Image-transform-size-QUAD-data-filter"><a href="#Image-transform-size-QUAD-data-filter" class="headerlink" title="Image.transform(size, QUAD, data, filter)"></a>Image.transform(size, QUAD, data, filter)</h2><p>&emsp;&emsp;Maps a quadrilateral (a region defined by four corners) from the image to a rectangle with the given size.<br>&emsp;&emsp;Data is an 8-tuple (x0, y0, x1, y1, x2, y2, y3, y3) which contain the upper left, lower left, lower right, and upper right corner of the source quadrilateral.</p>
<h2 id="Image-transfrom-size-MESH-data"><a href="#Image-transfrom-size-MESH-data" class="headerlink" title="Image.transfrom(size, MESH, data)"></a>Image.transfrom(size, MESH, data)</h2><h2 id="Image-transform-size-MESH-data-filter"><a href="#Image-transform-size-MESH-data-filter" class="headerlink" title="Image.transform(size, MESH, data, filter)"></a>Image.transform(size, MESH, data, filter)</h2><p>&emsp;&emsp;Similar to QUAD, but data is a list of target rectangles and corresponding source quadrilaterals.</p>
<h2 id="Image-transform-size-PERSPECTIVE-data"><a href="#Image-transform-size-PERSPECTIVE-data" class="headerlink" title="Image.transform(size, PERSPECTIVE, data)"></a>Image.transform(size, PERSPECTIVE, data)</h2><h2 id="Image-transform-size-PERSPECTIVE-data-filter"><a href="#Image-transform-size-PERSPECTIVE-data-filter" class="headerlink" title="Image.transform(size, PERSPECTIVE, data, filter)"></a>Image.transform(size, PERSPECTIVE, data, filter)</h2><p>&emsp;&emsp;Applies a perspective transform to the image, and places the result in a new image with the given size.<br>&emsp;&emsp;Data is a 8-tuple (a, b, c, d, e, f, g, h) which contains the coefficients for a perspective transform. For each pixel (x, y) in the output image, the new value is taken from a position (a x + b y + c)/(g x + h y + 1), (d x + e y + f)/(g x + h y + 1) in the input image, rounded to nearest pixel.<br>&emsp;&emsp;This function can be used to change the 2D perspective of the original image.</p>
<h2 id="Image-transpose-method"><a href="#Image-transpose-method" class="headerlink" title="Image.transpose(method)"></a>Image.transpose(method)</h2><p>&emsp;&emsp;Returns a flipped or rotated copy of an image.<br>&emsp;&emsp;Method can be one of the following: FLIP_LEFT_RIGHT, FLIP_TOP_BOTTOM, ROTATE_90, ROTATE_180, or ROTATE_270.</p>
<h2 id="Image-verify"><a href="#Image-verify" class="headerlink" title="Image.verify()"></a>Image.verify()</h2><p>&emsp;&emsp;Attempts to determine if the file is broken, without actually decoding the image data. If this method finds any problems, it raises suitable exceptions. This method only works on a newly opened image; if the image has already been loaded, the result is undefined. Also, if you need to load the image after using this method, you must reopen the image file.<br>&emsp;&emsp;Note that this method doesn’t catch all possible errors; to catch decoding errors, you may have to load the entire image as well.</p>
<h1 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h1><h2 id="Image-format"><a href="#Image-format" class="headerlink" title="Image.format"></a>Image.format</h2><p>&emsp;&emsp;The file format of the source file. For images created by the library itself (via a factory function, or by running a method on an existing image), this attribute is set to None.</p>
<h2 id="Image-mode"><a href="#Image-mode" class="headerlink" title="Image.mode"></a>Image.mode</h2><p>&emsp;&emsp;Image mode. This is a string specifying the pixel format used by the image. Typical values are “1”, “L”, “RGB”, or “CMYK.” See Concepts for a full list.</p>
<h2 id="Image-size"><a href="#Image-size" class="headerlink" title="Image.size"></a>Image.size</h2><p>&emsp;&emsp;Image size, in pixels. The size is given as a 2-tuple (width, height).</p>
<h2 id="Image-palette"><a href="#Image-palette" class="headerlink" title="Image.palette"></a>Image.palette</h2><p>&emsp;&emsp;Colour palette table, if any. If mode is “P”, this should be an instance of the ImagePalette class. Otherwise, it should be set to None.</p>
<h2 id="Image-info"><a href="#Image-info" class="headerlink" title="Image.info"></a>Image.info</h2><p>&emsp;&emsp;A dictionary holding data associated with the image. This dictionary is used by file handlers to pass on various non-image information read from the file. See documentation for the various file handlers for details.<br>&emsp;&emsp;Most methods ignore the dictionary when returning new images; since the keys are not standardized, it’s not possible for a method to know if the operation affects the dictionary. If you need the information later on, keep a reference to the info dictionary returned from the open() method.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[socket网络通信——UNIX域套接字]]></title>
      <url>http://lizonghang.github.io/2016/07/26/socket%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E2%80%94%E2%80%94UNIX%E5%9F%9F%E5%A5%97%E6%8E%A5%E5%AD%97/</url>
      <content type="html"><![CDATA[<p>从程序员的角度来看，使用 UNIX 域套接字和 TCP/IP 套接字存在两个根本区别。首先，套接字的地址是文件系统上的一个路径，而不是一个包含服务器名和端口的元组。其次，文件系统中创建的表示套接字的节点会持久保存，即时套接字关闭也仍然存在，所以每次服务器启动时都需要将其删除。只需在设置部分做一些修改就可以把前面的回应服务器例子更新为使用 UDS。</p>
<h1 id="UNIX域套接字"><a href="#UNIX域套接字" class="headerlink" title="UNIX域套接字"></a>UNIX域套接字</h1><p>注意：sock 的创建已经从 <code>socket.AF_INET</code> 改变为 <code>socket.AF_UNIX</code>，并且服务器地址是文件系统中的一个节点。运行以下代码后，将会在指定位置创建一个 readonly 文件，文件类型为 socket 文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">server_address = &apos;/Users/mac/Desktop/uds_socket&apos;</span><br><span class="line">try:</span><br><span class="line">    os.unlink(server_address)</span><br><span class="line">except OSError:</span><br><span class="line">    if os.path.exists(server_address)</span><br><span class="line">        raise</span><br><span class="line"></span><br><span class="line"># Create a UDS socket</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">print &apos;Starting up on %s&apos; % server_address</span><br><span class="line">sock.bind(server_address)</span><br><span class="line">sock.listen(1)</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    print &apos;Waiting for a connection ...&apos;</span><br><span class="line">    connection, client_address = sock.accept()</span><br><span class="line">    try:</span><br><span class="line">        print &apos;Connection from &apos;, client_address</span><br><span class="line">        while True:</span><br><span class="line">            data = connection.recv(16)</span><br><span class="line">            print &apos;Received &quot;%s&quot;&apos; % data</span><br><span class="line">            if data:</span><br><span class="line">                print &apos;Sending data back to the client&apos;</span><br><span class="line">                connection.sendall(data)</span><br><span class="line">            else:</span><br><span class="line">                print &apos;No data from %s&apos; % server_address</span><br><span class="line">                break</span><br><span class="line">    finally:</span><br><span class="line">        connection.close()</span><br></pre></td></tr></table></figure>
<p>还需要修改客户设置来使用 UDS，要假设套接字的相应文件系统节点存在，因为服务器要通过绑定这个地址来创建套接字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)</span><br><span class="line">server_address = &apos;/Users/mac/Desktop/uds_socket&apos;</span><br><span class="line"></span><br><span class="line">print &apos;Connecting to %s ...&apos; % server_address</span><br><span class="line">try:</span><br><span class="line">    sock.connect(server_address)</span><br><span class="line">except socket.error, msg:</span><br><span class="line">    print msg</span><br><span class="line">    sys.exit(1)</span><br><span class="line"></span><br><span class="line"># Send data</span><br><span class="line">try:</span><br><span class="line">    message = &apos;This is the message, it will be repeated.&apos;</span><br><span class="line">    print &apos;Sending &quot;%s&quot;&apos; % message</span><br><span class="line">    sock.sendall(message)</span><br><span class="line">    amount_received = 0</span><br><span class="line">    amount_expected = len(message)</span><br><span class="line">    while amount_received &lt; amount_expected:</span><br><span class="line">        data = sock.recv(16)</span><br><span class="line">        amount_received += len(data)</span><br><span class="line">        print &apos;Received &quot;%s&quot;&apos; % data</span><br><span class="line">finally:</span><br><span class="line">    sock.close()</span><br></pre></td></tr></table></figure>
<p>程序输出基本上相同，但对地址信息有适当的更新。服务器显示接收的消息并发回给客户端。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Starting up on /Users/mac/Desktop/uds_socket</span><br><span class="line">Waiting for a connection ...</span><br><span class="line">Connection from</span><br><span class="line">Received &quot;This is the mess&quot;</span><br><span class="line">Sending data back to the client</span><br><span class="line">Received &quot;age, it will be &quot;</span><br><span class="line">Sending data back to the client</span><br><span class="line">Received &quot;repeated.&quot;</span><br><span class="line">Sending data back to the client</span><br><span class="line">Received &quot;&quot;</span><br><span class="line">No data from /Users/mac/Desktop/uds_socket</span><br><span class="line">Waiting for a connection ...</span><br></pre></td></tr></table></figure>
<p>客户端采用增量方式逐部分接收消息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Connecting to /Users/mac/Desktop/uds_socket ...</span><br><span class="line">Sending &quot;This is the message, it will be repeated.&quot;</span><br><span class="line">Received &quot;This is the mess&quot;</span><br><span class="line">Received &quot;age, it will be &quot;</span><br><span class="line">Received &quot;repeated.&quot;</span><br></pre></td></tr></table></figure>
<h1 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h1><p>由于 UDS 套接字由文件系统上的一个节点表示，所以可以使用标准文件系统权限来控制对服务器的访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l /Users/mac/Desktop/uds_socket</span><br><span class="line">srwxr-xr-x  1 Hang  staff  0  7 26 21:35 /Users/mac/Desktop/uds_socket</span><br></pre></td></tr></table></figure>
<p>如果客户作为一个用户运行而不是作为 root，则会导致一个错误，因为进程没有打开套接字的权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python server.py</span><br><span class="line">Connecting to /Users/mac/Desktop/uds_socket</span><br><span class="line">[Errno 13] Permission denied</span><br></pre></td></tr></table></figure>
<h1 id="父进程与子进程通信"><a href="#父进程与子进程通信" class="headerlink" title="父进程与子进程通信"></a>父进程与子进程通信</h1><p>在 Unix 下，<code>socketpair()</code> 函数对于建立 UDS 套接字完成进程间通信很有用。它会创建一对连接的套接字，在创建子进程之后，可以用来在父进程和子进程之间通信。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">parent, child = socket.socketpair()</span><br><span class="line">pid = os.fork()</span><br><span class="line">if pid:</span><br><span class="line">    print &apos;In parent, sending message&apos;</span><br><span class="line">    child.close()</span><br><span class="line">    parent.sendall(&apos;message from parent&apos;)</span><br><span class="line">    response = parent.recv(1024)</span><br><span class="line">    print &apos;Response from child: &apos;, response</span><br><span class="line">    parent.close()</span><br><span class="line">else:</span><br><span class="line">    print &apos;In child, waiting for message&apos;</span><br><span class="line">    parent.close()</span><br><span class="line">    message = child.recv(1024)</span><br><span class="line">    print &apos;Message from parent: &apos;, message</span><br><span class="line">    child.sendall(&apos;message from child&apos;)</span><br><span class="line">    child.close()</span><br></pre></td></tr></table></figure>
<p>默认地会创建一个 UDS 套接字，不过调用者还可以传递地址簇、套接字类型，甚至协议选项来控制如何创建套接字。</p>
<p>运行输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In parent, sending message</span><br><span class="line">In child, waiting for message</span><br><span class="line">Message from parent:  message from parent</span><br><span class="line">Response from child:  message from child</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[socket网络通信——UDP客户和服务器]]></title>
      <url>http://lizonghang.github.io/2016/07/26/socket%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E2%80%94%E2%80%94UDP%E5%AE%A2%E6%88%B7%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      <content type="html"><![CDATA[<p>用户数据报协议（user datagram protocol，UDP）的工作方式与 TCP/IP 不同。TCP 是一个面向流（stream-oriented）的协议，确保所有数据以正确的顺序传输。UDP 是一个面向消息（message-oriented）的协议。UDP 不需要一个长期活动的连接，所以建立 UDP 套接字要简单些。另一方面，UDP 消息必须放在一个数据包中（对于IPv4，意味着它们可以包含 65507 字节，因为 65535 字节大小的数据包还包括首部信息），而且无法得到 TCP 提供的传输保障。</p>
<h1 id="回应服务器"><a href="#回应服务器" class="headerlink" title="回应服务器"></a>回应服务器</h1><p>由于实际上并没有连接，服务器不需要监听和接受连接。它只需要使用 <code>bind()</code> 将其套接字与一个端口关联，然后等待各个消息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"># Create a UDP socket</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"># Bind the socket to the port</span><br><span class="line">sock.bind((&apos;localhost&apos;, 10000))</span><br></pre></td></tr></table></figure>
<p>使用 <code>recvfrom()</code> 从套接字读取消息，这个函数会返回数据，还会返回发出这个数据的客户地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">while True:</span><br><span class="line">    print &apos;Waiting to receive message ...&apos;</span><br><span class="line">    data, address = sock.recvfrom(4096)</span><br><span class="line">    print &apos;Received %s bytes from %s&apos; % (len(data), address)</span><br><span class="line">    print &apos;Data: &apos;, data</span><br><span class="line">    if data:</span><br><span class="line">        sent = sock.sendto(data, address)</span><br><span class="line">        print &apos;sent data &quot;%s&quot; back to %s&apos; % (data, address)</span><br></pre></td></tr></table></figure>
<h1 id="回应客户"><a href="#回应客户" class="headerlink" title="回应客户"></a>回应客户</h1><p>UDP 回应客户与服务器类似，但是不使用 <code>bind()</code> 将套接字关联到一个地址。它使用 <code>sendto()</code> 将消息直接传送到服务器，并使用 <code>recvfrom()</code> 接收响应。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"># Create a UDP socket</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">message = &apos;This is the message, it will be repeat later.&apos;</span><br><span class="line">try:</span><br><span class="line">    print &apos;Send message: &apos;, message</span><br><span class="line">    sent = sock.sendto(message, (&apos;localhost&apos;, 10000))</span><br><span class="line">    print &apos;Waiting to receive callback message ...&apos;</span><br><span class="line">    data, server = sock.recvfrom(4096)</span><br><span class="line">    print &apos;Received callback message: &apos;, data</span><br><span class="line">finally:</span><br><span class="line">    sock.close()</span><br><span class="line">    print &apos;Socket closed&apos;</span><br></pre></td></tr></table></figure>
<h1 id="客户与服务器"><a href="#客户与服务器" class="headerlink" title="客户与服务器"></a>客户与服务器</h1><p>运行这个服务器将会生成以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Waiting to receive message ...</span><br><span class="line">Received 45 bytes from (&apos;127.0.0.1&apos;, 60844)</span><br><span class="line">Data:  This is the message, it will be repeat later.</span><br><span class="line">sent data &quot;This is the message, it will be repeat later.&quot; back to (&apos;127.0.0.1&apos;, 60844)</span><br><span class="line">Waiting to receive message ...</span><br></pre></td></tr></table></figure>
<p>客户端输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Send message:  This is the message, it will be repeat later.</span><br><span class="line">Waiting to receive callback message ...</span><br><span class="line">Received callback message:  This is the message, it will be repeat later.</span><br><span class="line">Socket closed</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[轮廓检测]]></title>
      <url>http://lizonghang.github.io/2016/07/25/%E8%BD%AE%E5%BB%93%E6%A3%80%E6%B5%8B/</url>
      <content type="html"><![CDATA[<h1 id="轮廓检测"><a href="#轮廓检测" class="headerlink" title="轮廓检测"></a>轮廓检测</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">im = cv2.imread(&apos;star.png&apos;)</span><br><span class="line">im = im.copy()</span><br><span class="line">gray = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)</span><br><span class="line">ret, binary = cv2.threshold(gray, 127, 255, cv2.THRESH_BINARY)</span><br><span class="line">contours, hierarchy = cv2.findContours(binary, cv2.RETR_TREE, cv2.CHAIN_APPROX_SIMPLE)</span><br><span class="line">cv2.drawContours(im, contours, -1, (0,0,255), 3)</span><br><span class="line">cv2.imshow(&apos;img&apos;, im)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>需要注意的是 <code>cv2.findContours()</code> 函数接受的参数为二值图，所以读取的图像要先转成灰度图，再转成二值图。</p>
<p>原图：</p>
<p><img src="/images/star.png" alt=""></p>
<p>检测结果：</p>
<p><img src="/images/star-edge.jpg" alt=""></p>
<p>注意，<code>cv2.findContours()</code> 函数会修改输入的图像。</p>
<h1 id="cv2-findContours"><a href="#cv2-findContours" class="headerlink" title="cv2.findContours()"></a>cv2.findContours()</h1><p>函数原型为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contours, hierarchy = cv2.findContours(image, mode, method[, contours[, hierarchy[, offset]]])</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>image - 输入图像</li>
<li>mode - 轮廓的检索模式。<code>cv2.RETR_EXTERNAL</code> 只检测外轮廓；<code>RETR_LIST</code> 检测的轮廓不建立等级关系；<code>RETR_CCOMP</code> 建立两个等级的轮廓，上一层为外边界，内层为内孔的边界。如果内孔内还有连通物体，则这个物体的边界也在顶层；<code>RETR_TREE</code> 建立一个等级树结构的轮廓。</li>
<li>method - 轮廓的近似办法。<code>cv2.CHAIN_APPROX_NONE</code> 存储所有的轮廓点，相邻的两个点的像素位置差不超过 1 ，即 max(abs(x1-x2), abs(y1-y2)) == 1；<code>cv2.CHAIN_APPROX_SIMP</code> 压缩水平方向、垂直方向、对角线方向的元素，只保留该方向的终点坐标。例如一个矩形轮廓只需要 4 个点来保存轮廓信息；<code> cv2.CHAIN_APPROX_TC89_L1</code>，CV_CHAIN_APPROX_TC89_KCOS 使用 teh-Chinl chain 近似算法。</li>
<li>contours - 返回的轮廓</li>
<li>hierarchy - 每条轮廓对应的属性</li>
</ul>
<h2 id="返回值contour"><a href="#返回值contour" class="headerlink" title="返回值contour"></a>返回值contour</h2><p><code>cv2.findContours()</code> 函数首先返回一个 list，list 中每个元素都是图像中的一个轮廓，用 numpy 中的 ndarray 表示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print type(contours)</span><br><span class="line">print type(contours[0])</span><br><span class="line">print len(contours)</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;type &apos;list&apos;&gt;</span><br><span class="line">&lt;type &apos;numpy.ndarray&apos;&gt;</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>可以验证上述信息。可以看到本例中有两条轮廓，一个是五角星的，一个是矩形的。每个轮廓是一个 ndarray，每个 ndarray 是轮廓上的点的集合。</p>
<p>由于知道返回的轮廓有两个，因此可以通过：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cv2.drawContours(im, contours, 0, (0,0,255), 3)</span><br><span class="line">cv2.drawContours(im, contours, 1, (0,255,0), 3)</span><br></pre></td></tr></table></figure>
<p>分别绘制两个轮廓。同时使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print len(contours[0])</span><br><span class="line">print len(contours[1])</span><br></pre></td></tr></table></figure>
<p>输出两个轮廓中存储的点的个数。可见五角星只有 5 个元素，这是因为轮廓中并不是存储轮廓上所有点，而是只存储可以用直线描述轮廓的点的个数，比如一个矩形只需要 4 个顶点就可以描述轮廓。</p>
<h2 id="返回值hierarchy"><a href="#返回值hierarchy" class="headerlink" title="返回值hierarchy"></a>返回值hierarchy</h2><p>该函数还返回一个可选的 hierarchy 结果，这是一个 ndarray，其中元素个数和轮廓个数相同，每个轮廓 <code>contours[i]</code> 对应 4 个 hierarchy 元素 <code>hierarchy[i][0] ~ hierarchy[i][3]</code>，分别表示后一个轮廓、前一个轮廓、父轮廓、内嵌轮廓的索引编号，如果没有对应项，则该值为负数。通过如下查看各属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print type(hierarchy)</span><br><span class="line">print hierarchy.ndim</span><br><span class="line">print hierarchy[0].ndim</span><br><span class="line">print hierarchy.shape</span><br></pre></td></tr></table></figure>
<h1 id="轮廓的绘制"><a href="#轮廓的绘制" class="headerlink" title="轮廓的绘制"></a>轮廓的绘制</h1><p>OpenCV 通过 <code>cv2.drawContours()</code> 在图像上绘制轮廓。函数原型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.drawContours(image, contours, contourIdx, color[, thickness[, lineType[, hierarchy[, maxLevel[, offset ]]]]])</span><br></pre></td></tr></table></figure>
<ul>
<li>image - 在选定的图像上绘制轮廓</li>
<li>contours - 轮廓本身，是一个 list</li>
<li>contourIdx - 指定绘制哪条轮廓，如果为 -1 则绘制所有轮廓</li>
<li>后续参数比较显而易见，其中 thickness 表明轮廓线宽度，如果为 -1 （<code>cv2.FILLED</code>），则为填充模式。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cv2.drawContours(im, contours, -1, (0,0,255), 2)</span><br><span class="line">cv2.imshow(&apos;image&apos;, im)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[霍夫变换检测直线]]></title>
      <url>http://lizonghang.github.io/2016/07/25/%E9%9C%8D%E5%A4%AB%E5%8F%98%E6%8D%A2%E6%A3%80%E6%B5%8B%E7%9B%B4%E7%BA%BF/</url>
      <content type="html"><![CDATA[<h1 id="霍夫变换"><a href="#霍夫变换" class="headerlink" title="霍夫变换"></a>霍夫变换</h1><p>Hough 变换是经典的检测直线的算法，最初用来检测图像中的直线，也可以将其扩展，以检测图像中简单的结构。</p>
<p>OpenCV 提供了两种用于直线检测的 Hough 变换形式，其中基本的版本是 <code>cv2.HoughLines()</code>。输入一幅含有点集的二值图，其中一些点相互联系组成直线。通常这是通过如 Canny 算子获得的一幅边缘图像。<code>cv2.HoughLines()</code> 函数输出 <code>[float, float]</code> 形式的 ndarray，其中每个值表示检测到的线(ρ , θ)中浮点点值的参数。下面的例子先用 Canny 算子获得图像边缘，然后使用 Hough 变换检测直线。其中 <code>cv2.HoughLines()</code> 函数的参数3和4对应直线搜索的步长。在本例中，函数将通过步长为 1 的半径和步长为 π/180 的角来搜索所有可能的直线。最后一个参数是经过某一点曲线的数量的阈值，超过这个阈值就表示这个交点所代表的参数对 (ρ , θ) 在原图像为一条直线。</p>
<p>示例图像如下：</p>
<p><img src="/images/street.jpg" alt=""></p>
<p>直线检测代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;street.jpg&apos;)</span><br><span class="line">im = cv2.GaussianBlur(im, (3,3), 0)</span><br><span class="line">edges = cv2.Canny(im, 50, 150, apertureSize=3)</span><br><span class="line">lines = cv2.HoughLines(edges, 1, np.pi/180, 260)</span><br><span class="line">result = im.copy()</span><br><span class="line">for line in lines[0]:</span><br><span class="line">    rho = line[0]</span><br><span class="line">    theta= line[1]</span><br><span class="line">    if  (theta &lt; (np.pi/4. )) or (theta &gt; (3.*np.pi/4.0)):</span><br><span class="line">        pt1 = (int(rho/np.cos(theta)),0)</span><br><span class="line">        pt2 = (int((rho-result.shape[0]*np.sin(theta))/np.cos(theta)),result.shape[0])</span><br><span class="line">        cv2.line( result, pt1, pt2, (0,0,255))</span><br><span class="line">    else:</span><br><span class="line">        pt1 = (0,int(rho/np.sin(theta)))</span><br><span class="line">        pt2 = (result.shape[1], int((rho-result.shape[1]*np.cos(theta))/np.sin(theta)))</span><br><span class="line">        cv2.line(result, pt1, pt2, (0,0,255), 1)</span><br><span class="line"></span><br><span class="line">cv2.imshow(&apos;Hough&apos;, result)</span><br><span class="line">if cv2.waitKey(0) == 27:</span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="/images/hough.jpg" alt=""></p>
<h1 id="概率霍夫变换"><a href="#概率霍夫变换" class="headerlink" title="概率霍夫变换"></a>概率霍夫变换</h1><p>前面例子得到的结果图片，其中 Hough 变换看起来就像在图像中查找对齐的边界像素点集合，但这样会在一些情况下导致虚假检测，如像素偶然对齐或多条直线穿过同样的对齐像素造成的多重检测。</p>
<p>要避免这样的问题，并检测图像中分段的直线（而不是贯穿整个图像的直线），就出现了概率 Hough 变换。在 OpenCV 中用函数 <code>cv2.HoughLinesP()</code> 实现。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;street.jpg&apos;)</span><br><span class="line">im = cv2.GaussianBlur(im, (3,3), 0)</span><br><span class="line">edges = cv2.Canny(im, 50, 150, apertureSize=3)</span><br><span class="line">result = im.copy()</span><br><span class="line">minLineLength = 100</span><br><span class="line">maxLineGap = 50</span><br><span class="line">lines = cv2.HoughLinesP(edges, 1, np.pi/180, 200, minLineLength, maxLineGap)</span><br><span class="line">for x1,y1,x2,y2 in lines[0]:</span><br><span class="line">    cv2.line(result, (x1,y1), (x2,y2), (0,0,255), 2)</span><br><span class="line"></span><br><span class="line">cv2.imshow(&apos;HoughP&apos;, result)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="/images/houghP.jpg" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Laplacian算子]]></title>
      <url>http://lizonghang.github.io/2016/07/25/Laplacian%E7%AE%97%E5%AD%90/</url>
      <content type="html"><![CDATA[<p>图像中的边缘区域像素值会发生“跳跃”，对这些像素求导，其一阶导数在边缘位置为极值，这是 Sobel 算子的原理。如果对像素值求二阶导数，会发现边缘处的二阶导数值为 0 。Laplace 函数实现的方法是先用 Sobel 算子计算二阶 x 和 y 导数，再求和：</p>
<p><img src="/images/laplace_arg.jpg" alt=""></p>
<p>在 OpenCV-Python 中，Laplace 算子的函数原型如下，和 Sobel 算子中的参数基本一致：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dst = cv2.Laplacian(src, ddepth[, dst[, ksize[, scale[, delta[, borderType]]]]])</span><br></pre></td></tr></table></figure>
<p>测试图像：</p>
<p><img src="/images/tower.jpg" alt=""></p>
<p>测试代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;tower.jpg&apos;)</span><br><span class="line">gray_lap = cv2.Laplacian(im, cv2.CV_16S, ksize=3)</span><br><span class="line">dst = cv2.convertScaleAbs(gray_lap)</span><br><span class="line"></span><br><span class="line">cv2.imshow(&apos;laplacian&apos;, dst)</span><br><span class="line">if cv2.waitKey(0) == 27:</span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>效果图如下：</p>
<p><img src="/images/tower-lap.png" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Sobel算子]]></title>
      <url>http://lizonghang.github.io/2016/07/24/Sobel%E7%AE%97%E5%AD%90/</url>
      <content type="html"><![CDATA[<p>Sobel 算子是一种过滤器，但它带有方向。在 OpenCV-Python 中，使用 Sobel 算子的函数原型如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dst = cv2.Sobel(src, ddepth, dx, dy[, dst[, ksize[, scale[, delta[, borderType]]]]])</span><br></pre></td></tr></table></figure>
<p>必选参数：</p>
<ul>
<li>src - 需要处理的图像。</li>
<li>ddepth - 图像深度。-1 表示采用与原图像相同的深度。目标图像深度≥原图像深度。</li>
<li>dx, dy - 求导阶数，0 表示不求导。</li>
</ul>
<p>可选参数：</p>
<ul>
<li>ksize - Sobel 算子大小，必须为 1、3、5、7。</li>
<li>scale - 缩放导数的比例常数，默认情况下不伸缩。</li>
<li>delta - 可选增量，会加到最终 dst 中，默认情况下不额外增加。</li>
<li>borderType - 判断图像边界的模式。默认值为 <code>cv2.BORDER_DEFAULT。</code></li>
</ul>
<p>Sobel 函数使用如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lion.jpg&apos;)</span><br><span class="line">im = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">x = cv2.Sobel(im, cv2.CV_16S, 1, 0)</span><br><span class="line">y = cv2.Sobel(im, cv2.CV_16S, 0, 1)</span><br><span class="line"></span><br><span class="line">absX = cv2.convertScaleAbs(x)</span><br><span class="line">absY = cv2.convertScaleAbs(y)</span><br><span class="line"></span><br><span class="line">dst = cv2.addWeighted(absX, 0.5, absY, 0.5, 0)</span><br><span class="line"></span><br><span class="line">cv2.imshow(&apos;origin&apos;, im)</span><br><span class="line">cv2.imshow(&quot;absX&quot;, absX)</span><br><span class="line">cv2.imshow(&quot;absY&quot;, absY)</span><br><span class="line">cv2.imshow(&quot;Result&quot;, dst)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>由于 Sobel 函数求导数后会有负值，还会有大于 255 的值，而原图像是 uint8 ，所以 Sobel 建立的图像位数不够，会有截断。因此要使用 16 位有符号的数据类型，即 <code>cv2.CV_16S</code>。</p>
<p>处理后要用 <code>cv2.convertScaleAbs()</code> 将其转回原来的 uint8 形式，否则无法显示图像。 <code>cv2.convertScaleAbs()</code> 的原型为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dst = cv2.convertScaleAbs(src[, dst[, alpha[, beta]]])</span><br></pre></td></tr></table></figure>
<p>其中可选参数 <code>alpha</code> 是伸缩系数， <code>beta</code> 是加到结果上的一个值。结果返回 uint8 类型的图片。</p>
<p>由于 Sobel 算子是在两个方向计算的，最后要使用 <code>cv2.addWeighted()</code> 函数将其组合起来。函数原型为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dst = cv2.addWeighted(src1, alpha, src2, beta, gamma[, dst[, dtype]])</span><br></pre></td></tr></table></figure>
<p>其中 <code>alpha</code> 是第一幅图片中元素的权重， <code>beta</code> 是第二个图片中元素的权重， <code>gamma</code> 是加到最后结果上的一个值。</p>
<p>原图：</p>
<p><img src="/images/lion.jpg" alt=""></p>
<p>absX：</p>
<p><img src="/images/absX.jpg" alt=""></p>
<p>absY：</p>
<p><img src="/images/absY.jpg" alt=""></p>
<p>Result：</p>
<p><img src="/images/sobel.jpg" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[滤波]]></title>
      <url>http://lizonghang.github.io/2016/07/24/%E6%BB%A4%E6%B3%A2/</url>
      <content type="html"><![CDATA[<h1 id="滤波简介"><a href="#滤波简介" class="headerlink" title="滤波简介"></a>滤波简介</h1><p>过滤是信号和图像处理中基本的任务，目的是根据应用环境的不同，选择性的提取图像中某些认为重要的信号。过滤可以移除图像中的噪音、提取感兴趣的可视特征、允许图像重采样等等。</p>
<p>当观察一张图片时，我们观察的是图像中有多少灰度级（或颜色）及其分布。根据灰度分布的不同来区分不同的图像。也有其他方面可以对图像进行分析，例如观察图像中灰度的变化。某些图像中包含大量强度不变的区域（如蓝天），而在其他图像中的灰度变化可能会非常快（如包含许多小物体的拥挤的图像）。因此，观察图像中这些变化的频率就构成了另一条分类图像的方法，这个观点称为频域。而通过观察图像灰度分布来分类图像称为空间域。</p>
<p>频域分析将图像分成从低频到高频的不同部分。低频对应图像强度变化小的区域，而高频是图像强度变化非常大的区域。目前存在若干种转换方法，如傅里叶变换或余弦变换，可以用来清晰地显示图像的频率。由于图像是一个二维实体，所以其频率由水平频率和竖直频率共同组成。</p>
<p>在频率分析领域的框架中，滤波器是一个用来增强图像中某个波段或频率并阻塞（或降低）其他频率波段的操作。低通滤波器是消除图像中的高频部分，保留低频部分。高通滤波器消除低频部分，保留高频部分。</p>
<p>这里只介绍在 OpenCV-Python 中实现的初级滤波操作，之后介绍更复杂的滤波原理及实现。</p>
<p>以下图为例：</p>
<p><img src="/images/lena.jpg" alt=""></p>
<h1 id="低通滤波平滑图像"><a href="#低通滤波平滑图像" class="headerlink" title="低通滤波平滑图像"></a>低通滤波平滑图像</h1><h2 id="初级低通滤波"><a href="#初级低通滤波" class="headerlink" title="初级低通滤波"></a>初级低通滤波</h2><p>低通滤波器的目标是降低图像的变化率。如将每个像素替换为该像素周围像素的均值，这样就可以平滑并替代那些强度变化明显的区域。在 OpenCV 中可以通过 <code>cv2.blur()</code> 来实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dst = cv2.blur(im, (5,5))</span><br></pre></td></tr></table></figure>
<p>其中 <code>dst</code> 是函数处理后返回的图像，第一个参数是待处理图像，第二个参数是低通滤波器的大小。其后含有几个可选参数用来设置滤波器的细节。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">blured = cv2.blur(im, (5,5))</span><br><span class="line"></span><br><span class="line">cv2.namedWindow(&apos;Origin&apos;, cv2.WINDOW_NORMAL)</span><br><span class="line">cv2.namedWindow(&apos;Blur&apos;, cv2.WINDOW_NORMAL)</span><br><span class="line">cv2.imshow(&apos;Origin&apos;, im)</span><br><span class="line">cv2.imshow(&apos;Blur&apos;, blured)</span><br><span class="line">if cv2.waitKey(0) == 27:</span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>效果图如下：</p>
<p><img src="/images/blur.png" alt=""></p>
<p>这种滤波器又称为 boxfilter，所以也可使用 <code>cv2.boxFilter()</code> 完成相同的工作。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dst = cv2.boxFilter(im, -1, (5,5))</span><br></pre></td></tr></table></figure>
<p>该函数与 <code>cv2.blur()</code> 效果完全相同，第二个参数 -1 表示输出图像使用的深度与输入图像相同。</p>
<h2 id="高斯模糊"><a href="#高斯模糊" class="headerlink" title="高斯模糊"></a>高斯模糊</h2><p>在某些情况下需要对一个像素的周围像素给予更多的重视。因此可用分配权重来重新计算这些周围点的值，可以通过高斯函数的权重方案来解决。<code>cv2.GaussianBlur()</code> 可作为滤波器，用以下方式调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dst = cv2.GaussianBlur(im, (5,5), 1.5)</span><br></pre></td></tr></table></figure>
<h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><p>低通滤波与高斯滤波不同之处在于：低通滤波中，滤波器中每个像素的权重是相同的，即滤波器是线性的。而高斯滤波器中像素的权重与其距中心像素的距离成比例。</p>
<h1 id="中值滤波消除噪点"><a href="#中值滤波消除噪点" class="headerlink" title="中值滤波消除噪点"></a>中值滤波消除噪点</h1><p>中值滤波器对于消除椒盐现象很有用。调用方法与调用其他滤波器类似，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dst = cv2.medianBlur(im, 5)</span><br></pre></td></tr></table></figure>
<p>函数返回处理结果，第一个参数是待处理图像，第二个参数是孔径尺寸，是一个大于 1 的奇数。比如上面就会使用 5x5 领域组成一个数值集，对其进行处理，当前像素被均值替换。</p>
<p>若在某个像素周围有白色或黑色的像素，这些白色或黑色的像素不会选择作为中值（最大或最小值排除），而是被替换为领域值。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;saltImg.jpg&apos;)</span><br><span class="line">median = cv2.medianBlur(im, 5)</span><br><span class="line"></span><br><span class="line">cv2.namedWindow(&apos;Salt&apos;, cv2.WINDOW_NORMAL)</span><br><span class="line">cv2.namedWindow(&apos;Median&apos;, cv2.WINDOW_NORMAL)</span><br><span class="line">cv2.imshow(&apos;Salt&apos;, im)</span><br><span class="line">cv2.imshow(&apos;Median&apos;, median)</span><br><span class="line">if cv2.waitKey(0) == 27:</span><br><span class="line">    cv2.destroyAllWindow()</span><br></pre></td></tr></table></figure>
<p>处理结果如下：</p>
<p><img src="/images/median.png" alt=""></p>
<p>由于中值滤波不会处理最大和最小值，所以不会受噪声影响。相反，如果直接采用 <code>cv2.blur()</code> 进行均值滤波，则不会区分这些噪声点，滤波后的图像会受到噪声的影响。</p>
<p>中值滤波器在处理边缘也有优势，但中值滤波器会清除掉某些区域的纹理，如头发纹理。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[形态学处理]]></title>
      <url>http://lizonghang.github.io/2016/07/23/%E5%BD%A2%E6%80%81%E5%AD%A6%E5%A4%84%E7%90%86/</url>
      <content type="html"><![CDATA[<h1 id="定义结构元素"><a href="#定义结构元素" class="headerlink" title="定义结构元素"></a>定义结构元素</h1><p>形态学处理核心是定义结构元素，在 OpenCV-Python 中，可以使用其自带的 <code>getStructuringElement</code> 函数，也可以直接使用 NumPy 的 <code>ndarray</code> 来定义一个结构元素。首先看用 <code>getStructuringElement</code> 函数定义的结构元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element = cv2.getStructuringElement(cv2.MORPH_CROSS, (5,5))</span><br></pre></td></tr></table></figure>
<p>这就定义了一个 5x5 的十字形结构元素，如下：</p>
<p><img src="/images/cross.jpg" alt=""></p>
<p>也可以用 NumPy 定义结构元素，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NpKernel = numpy.uint8(numpy.zeros((5,5)))</span><br><span class="line">for i in range(5):</span><br><span class="line">    NpKernel[2, i] = 1</span><br><span class="line">    NpKernel[i, 2] = 1</span><br></pre></td></tr></table></figure>
<p>两者定义的结构元素完全一样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print element</span><br><span class="line">[[0 0 1 0 0]</span><br><span class="line"> [0 0 1 0 0]</span><br><span class="line"> [1 1 1 1 1]</span><br><span class="line"> [0 0 1 0 0]</span><br><span class="line"> [0 0 1 0 0]]</span><br><span class="line">&gt;&gt;&gt; print NpKernel</span><br><span class="line">[[0 0 1 0 0]</span><br><span class="line"> [0 0 1 0 0]</span><br><span class="line"> [1 1 1 1 1]</span><br><span class="line"> [0 0 1 0 0]</span><br><span class="line"> [0 0 1 0 0]]</span><br></pre></td></tr></table></figure>
<p>用 OpenCV-Python 内置的常量定义椭圆（MORPH_ELLIPSE）和十字形结构（MORPH_CROSS）元素要简单一些，如果定义矩形（MORPH_RECT）和自定义结构元素，则用两者差不多。</p>
<p>测试图片：</p>
<p><img src="/images/origin.jpg" alt=""></p>
<h1 id="腐蚀和膨胀"><a href="#腐蚀和膨胀" class="headerlink" title="腐蚀和膨胀"></a>腐蚀和膨胀</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;origin.jpg&apos;)</span><br><span class="line"># OpenCV定义结构元素</span><br><span class="line">kernel = cv2.getStructuringElement(cv2.MORPH_RECT, (3,3))</span><br><span class="line"></span><br><span class="line"># 腐蚀图像</span><br><span class="line">eroded = cv2.erode(im, kernel)</span><br><span class="line">cv2.imshow(&apos;Eroded Image&apos;, eroded)</span><br><span class="line"></span><br><span class="line"># 膨胀图像</span><br><span class="line">dilated = cv2.dilate(im, kernel)</span><br><span class="line">cv2.imshow(&apos;Dilated Image&apos;, dilated)</span><br><span class="line"></span><br><span class="line"># 原图像</span><br><span class="line">cv2.imshow(&apos;Origin Image&apos;, im)</span><br><span class="line"></span><br><span class="line"># NumPy定义结构元素</span><br><span class="line">NpKernel = np.uint8(np.ones((3,3)))</span><br><span class="line"></span><br><span class="line"># 腐蚀图像</span><br><span class="line">Nperoded = cv2.erode(im, NpKernel)</span><br><span class="line">cv2.imshow(&apos;Eroded by NumPy kernel&apos;, Nperoded)</span><br><span class="line"></span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>腐蚀和膨胀的处理很简单，只需要设置好结构元素，然后分别调用 <code>cv2.erode()</code> 和 <code>cv2.dilate()</code> 函数即可。其中第一个参数是需要处理的图像，第二个参数是结构元素。函数返回处理后的图像。</p>
<p>结果如下：</p>
<p><img src="/images/erode-dilate.jpg" alt=""></p>
<h1 id="开运算和闭运算"><a href="#开运算和闭运算" class="headerlink" title="开运算和闭运算"></a>开运算和闭运算</h1><p>开运算和闭运算时将腐蚀和膨胀按照一定的次序进行处理，但这两者不可逆，即进行开运算后进行闭运算不能得到原来的图像。示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;origin.jpg&apos;)</span><br><span class="line"># OpenCV定义结构元素</span><br><span class="line">kernel = cv2.getStructuringElement(cv2.MORPH_RECT, (5,5))</span><br><span class="line"></span><br><span class="line"># 闭运算</span><br><span class="line">closed = cv2.morphologyEx(im, cv2.MORPH_CLOSE, kernel)</span><br><span class="line">cv2.imshow(&apos;Close&apos;, closed)</span><br><span class="line"></span><br><span class="line"># 开运算</span><br><span class="line">opened = cv2.morphologyEx(im, cv2.MORPH_OPEN, kernel)</span><br><span class="line">cv2.imshow(&apos;Open&apos;, opened)</span><br><span class="line"></span><br><span class="line">if cv2.waitKey(0) == 27:</span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>闭运算用来连接被误分为许多小块的对象，而开运算用于移除由图像噪音形成的斑点。因此，某些情况下可以连续运用这两种运算。如对一幅二值图连续使用闭运算和开运算，将获得图像中的主要对象。同样，如果想要消除图像中的噪声，也可以对图像先用开运算后用闭运算，不过这样也会消除一些破碎的对象。</p>
<p>对原始图像分别进行开运算和闭运算的结果如下：</p>
<p><img src="/images/open.jpg" alt=""><br><img src="/images/close.jpg" alt=""></p>
<h1 id="用形态学运算检测边和角点"><a href="#用形态学运算检测边和角点" class="headerlink" title="用形态学运算检测边和角点"></a>用形态学运算检测边和角点</h1><p>仅作为介绍形态学处理的例子，实际使用时建议使用 Canny 或 Harris 等算法</p>
<h2 id="检测边缘"><a href="#检测边缘" class="headerlink" title="检测边缘"></a>检测边缘</h2><p>形态学检测边缘的原理为：在膨胀时图像中的物体会想向周围扩张；腐蚀时图像中的物体会收缩。比较这两幅图像，由于其变化的区域只发生在边缘，所以将两幅图像相减，得到的就是图像中物体的边缘。</p>
<p>以下图为例：</p>
<p><img src="/images/lampo.jpg" alt=""></p>
<p>边缘检测代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#encoding: utf-8</span><br><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lampo.jpg&apos;)</span><br><span class="line"># 转换颜色模式为灰度图</span><br><span class="line">im = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)</span><br><span class="line"># OpenCV 3x3结构元素</span><br><span class="line">kernel = cv2.getStructuringElement(cv2.MORPH_RECT, (3,3))</span><br><span class="line"># 膨胀图像</span><br><span class="line">dilated = cv2.dilate(im, kernel)</span><br><span class="line"># 腐蚀图像</span><br><span class="line">eroded = cv2.erode(im, kernel)</span><br><span class="line"># 两幅图像相减得到边缘，第一个参数是膨胀图像，第二个参数是腐蚀图像</span><br><span class="line">edges = cv2.absdiff(dilated, eroded)</span><br><span class="line"># edges是灰度图，二值化处理以更清楚观察结果</span><br><span class="line">retval, edges = cv2.threshold(edges, 50, 100, cv2.THRESH_BINARY)</span><br><span class="line"># 反转颜色</span><br><span class="line">edges = cv2.bitwise_not(edges)</span><br><span class="line"></span><br><span class="line">cv2.imshow(&apos;origin&apos;, im)</span><br><span class="line">cv2.imshow(&apos;edges&apos;, edges)</span><br><span class="line">if cv2.waitKey(0) == 27:</span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>效果图如下：</p>
<p><img src="/images/lampo-edge.jpg" alt=""></p>
<h2 id="检测拐角"><a href="#检测拐角" class="headerlink" title="检测拐角"></a>检测拐角</h2><p>拐角检测与边缘检测的原理相同，不同的是先用十字形的结构元素膨胀像素，这种情况下图像中只会在边缘处扩张，而角点不发生变化。接着用菱形的结构元素腐蚀原图像，导致只有在拐角处才会收缩，而直线边缘都未发生变化。第二步是用 X 形膨胀原图像，角点膨胀比边要多。这样第二次用方块腐蚀时，角点恢复原状，而边要腐蚀得更多。所以当两幅图像相减时，只保留了拐角处。</p>
<p>以下图为例：</p>
<p><img src="/images/building.jpg" alt=""></p>
<p>拐角检测代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#encoding: utf-8</span><br><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;building.jpg&apos;)</span><br><span class="line"># 转换颜色模式为灰度图</span><br><span class="line">im = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)</span><br><span class="line"># 构造 5x5 的结构元素，分别为十字形、菱形、方形和X形</span><br><span class="line">cross = cv2.getStructuringElement(cv2.MORPH_CROSS, (5,5))</span><br><span class="line">diamond = cv2.getStructuringElement(cv2.MORPH_RECT, (5,5))</span><br><span class="line">diamond[0,0], diamond[0,1], diamond[1,0], diamond[4,4], diamond[4,3], diamond[3,4], diamond[4,0], diamond[4,1], diamond[3,0], diamond[0,3], diamond[0,4], diamond[1,4] = 0,0,0,0,0,0,0,0,0,0,0,0</span><br><span class="line">square = cv2.getStructuringElement(cv2.MORPH_RECT, (5,5))</span><br><span class="line">x = cv2.getStructuringElement(cv2.MORPH_CROSS, (5,5))</span><br><span class="line"># 使用十字形结构元素膨胀图像</span><br><span class="line">detect1 = cv2.dilate(im, cross)</span><br><span class="line"># 使用菱形结构元素腐蚀图像</span><br><span class="line">detect1 = cv2.erode(detect1, diamond)</span><br><span class="line"># 使用X结构元素膨胀图像</span><br><span class="line">detect2 = cv2.dilate(im, x)</span><br><span class="line"># 使用方形结构元素腐蚀图像</span><br><span class="line">detect2 = cv2.erode(detect2, square)</span><br><span class="line"># 将两幅图像相减获得角</span><br><span class="line">horn = cv2.absdiff(detect2, detect1)</span><br><span class="line"># 使用阈值获得二值图</span><br><span class="line">retval, horn = cv2.threshold(horn, 40, 255, cv2.THRESH_BINARY)</span><br><span class="line"># 在原图上用半径为5的圆将点标出</span><br><span class="line">for j in range(horn.size):</span><br><span class="line">    y = j / horn.shape[0]</span><br><span class="line">    x = j % horn.shape[0]</span><br><span class="line">    if horn[x,y] == 255:</span><br><span class="line">        cv2.circle(im, (y,x), 5, (255,0,0))</span><br><span class="line"># 显示修改后的原图</span><br><span class="line">cv2.imshow(&apos;Horn Detect&apos;, im)</span><br><span class="line">if cv2.waitKey(0) == 27:</span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>由于封装的缘故，OpenCV 中函数参数中使用的坐标系和 NumPy 和 ndarray 的坐标系是不同的，在标点时可以看出。通过上面的代码可以检测图像中的拐角并标出，效果图如下：</p>
<p><img src="/images/horn.jpg" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Canny边缘检测]]></title>
      <url>http://lizonghang.github.io/2016/07/22/Canny%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8B/</url>
      <content type="html"><![CDATA[<h1 id="Canny函数原型"><a href="#Canny函数原型" class="headerlink" title="Canny函数原型"></a>Canny函数原型</h1><p>OpenCV-Python 中 Canny 函数的原型为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">edge = cv2.Canny(image, threshold1, threshold2[, edges[, apertureSize[, L2gradient]]])</span><br></pre></td></tr></table></figure>
<ul>
<li>第一个参数是需要处理的原图像，该图像必须为单通道的灰度图</li>
<li>第二个参数是阈值1</li>
<li>第三个参数是阈值2</li>
</ul>
<p>其中较大的阈值2用于检测图像中明显的边缘，但一般情况下检测的效果不大完美，边缘检测出来是断断续续的。所以用较小的阈值1将这些间断的边缘连接起来。</p>
<p>可选参数中 <code>apertureSize</code> 就是 Sobel 算子的大小。而 <code>L2gradient</code> 参数是一个布尔值，若为真则使用更精确的 L2 范数进行计算（即两个方向的导数的平方和再开方），否则使用 L1 范数（直接将两个方向导数的绝对值相加）。</p>
<p>函数返回一幅二值图，其中包含检测出的边缘。</p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>Canny 函数使用只需要指定最大和最小阈值即可。以下图为例：</p>
<p><img src="/images/tower.jpg" alt=""></p>
<p>使用如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import cv2</span><br><span class="line">im = cv2.imread(&apos;tower.jpg&apos;)</span><br><span class="line">im = cv2.GaussianBlur(im, (3,3), 0)</span><br><span class="line">canny = cv2.Canny(im, 30, 100)</span><br><span class="line">cv2.imwrite(&apos;canny.jpg&apos;, canny)</span><br></pre></td></tr></table></figure>
<p>效果图如下：</p>
<p><img src="/images/canny.jpg" alt=""></p>
<p>可以调整阈值以改变边缘效果。</p>
<p>由于 Canny 只能处理灰度图，所以需要先将读取的图像转成灰度图。然后使用高斯平滑处理原图像以降噪。最后调用 Canny 函数，指定最大和最小阈值，其中 <code>apertureSize</code> 默认为 3。</p>
<h1 id="动态调整阈值"><a href="#动态调整阈值" class="headerlink" title="动态调整阈值"></a>动态调整阈值</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">def CannyThreshold(lowThreshold):</span><br><span class="line">    detected_edges = cv2.GaussianBlur(gray, (3,3), 0) # Denoise</span><br><span class="line">    detected_edges = cv2.Canny(detected_edges, lowThreshold, lowThreshold*ratio,apertureSize=kernel_size) # Canny Edge Detect</span><br><span class="line">    dst = cv2.bitwise_and(im, im, mask=detected_edges) # Get Edge Image With Color</span><br><span class="line">    cv2.imshow(&apos;canny&apos;, dst)</span><br><span class="line"></span><br><span class="line"># Settings</span><br><span class="line">lowThreshold = 0 # Track Bar Start from State-0</span><br><span class="line">max_lowThreshold = 100 # Track Bar End with State-100</span><br><span class="line">ratio = 3 # threshold2 = threshold1 * ratio</span><br><span class="line">kernel_size = 3 # Size of Sobel</span><br><span class="line"></span><br><span class="line"># Running</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    im = cv2.imread(&apos;tower.jpg&apos;) # Read From File</span><br><span class="line">    gray = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY) # GBR Convert To Gray</span><br><span class="line">    cv2.namedWindow(&apos;canny&apos;) # Create New Window</span><br></pre></td></tr></table></figure>
<p>得到的局部效果图如下：</p>
<p><img src="/images/canny_dial.jpg" alt=""></p>
<p>上图中有一个滑动条，拖动可改变 Canny 边缘检测效果，可以自行尝试一下。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[直方图的计算与显示]]></title>
      <url>http://lizonghang.github.io/2016/07/22/%E7%9B%B4%E6%96%B9%E5%9B%BE%E7%9A%84%E8%AE%A1%E7%AE%97%E4%B8%8E%E6%98%BE%E7%A4%BA/</url>
      <content type="html"><![CDATA[<p>与 C++ 中一样，在 Python 中调用的 OpenCV 直方图计算函数为 <code>cv2.calcHist()</code>。</p>
<p><code>cv2.calcHist()</code> 的原型为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.calcHist(images, channels, mask, histSize, ranges[, hist[, accumlate ]])</span><br></pre></td></tr></table></figure>
<p>下面为一个简单例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">hist = cv2.calcHist(</span><br><span class="line">    [im],</span><br><span class="line">    [0], #使用的通道</span><br><span class="line">    None, #没有使用mask</span><br><span class="line">    [256], #HistSize</span><br><span class="line">    [0.0, 255.0] #直方图柱的范围</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>其中第一个参数 <code>images</code> 必须用方括号括起</li>
<li>第二个参数 <code>channels</code> 是用于计算直方图的通道，这里使用灰度图计算直方图，所以就直接使用第一个通道</li>
<li>第三个参数 <code>mask</code> 没有使用，用 <code>None</code></li>
<li>第四个参数 <code>histSize</code> 表示这个直方图分成多少份（即多少个直方柱）</li>
<li>第五个参数 <code>ranges</code> 表示直方图中各个像素的值， <code>[0.0, 255.0]</code> 表示直方图能表示像素值从 0.0 到 255.0 的像素</li>
<li>由于直方图作为函数结果返回了，所以 <code>hist</code> 没有意义</li>
<li><code>accumulate</code> 是一个布尔值，用来表示直方图是否叠加</li>
</ul>
<h1 id="彩色图像不同通道的直方图"><a href="#彩色图像不同通道的直方图" class="headerlink" title="彩色图像不同通道的直方图"></a>彩色图像不同通道的直方图</h1><p>以下图为例：</p>
<p><img src="/images/lena.jpg" alt=""></p>
<p>首先读取并分离各通道：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">r,g,b = cv2.split(im)</span><br></pre></td></tr></table></figure>
<p>接着计算每个通道的直方图，这里将其封装成一个函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def calcAndDrawHist(image, color):</span><br><span class="line">    hist = cv2.calcHist([image], [0], None, [256], [0.0, 255.0])</span><br><span class="line">    minVal, maxVal, minLoc, maxLoc = cv2.minMaxLoc(hist)</span><br><span class="line">    histImg = numpy.zeros([256,256,3], numpy.uint8)</span><br><span class="line">    hpt = int(0.9*256)</span><br><span class="line">    for h in range(256):</span><br><span class="line">        intensity = int(hist[h] * hpt / maxVal)</span><br><span class="line">        cv2.line(histImg, (h,256), (h,256-intensity), color)</span><br><span class="line">    return histImg</span><br></pre></td></tr></table></figure>
<p>在主函数中调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">    r, g, b = cv2.split(im)</span><br><span class="line">    histImgR = calcAndDrawHist(r, [255, 0, 0])</span><br><span class="line">    histImgG = calcAndDrawHist(g, [0, 255, 0])</span><br><span class="line">    histImgB = calcAndDrawHist(b, [0, 0, 255])</span><br><span class="line">    cv2.imwrite(&apos;/Users/mac/Desktop/histImgR.jpg&apos;, histImgR)</span><br><span class="line">    cv2.imwrite(&apos;/Users/mac/Desktop/histImgG.jpg&apos;, histImgG)</span><br><span class="line">    cv2.imwrite(&apos;/Users/mac/Desktop/histImgB.jpg&apos;, histImgB)</span><br></pre></td></tr></table></figure>
<p>得到的三个通道的直方图如下：</p>
<p><img src="/images/histImgR.jpg" alt=""><br><img src="/images/histImgG.jpg" alt=""><br><img src="/images/histImgB.jpg" alt=""></p>
<p>也可不分离通道，用折线来描绘直方图的边界，可在一个图中同时绘出三个通道的直方图：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">h = numpy.zeros((256,256,3))</span><br><span class="line">bins = numpy.arange(256).reshape(256,1)</span><br><span class="line">color = [(255,0,0),(0,255,0),(0,0,255)]</span><br><span class="line">for ch,color in enumerate(color):</span><br><span class="line">    originHist = cv2.calcHist([im], [ch], None, [256], [0,256])</span><br><span class="line">    cv2.normalize(originHist, originHist, 0, 255*0.9, cv2.NORM_MINMAX)</span><br><span class="line">    hist = numpy.int32(numpy.around(originHist))</span><br><span class="line">    pts = numpy.column_stack((bins, hist))</span><br><span class="line">    cv2.polylines(h, [pts], False, color)</span><br><span class="line">h = numpy.flipud(h)</span><br><span class="line">cv2.imwrite(&apos;colorhist.jpg&apos;, h)</span><br></pre></td></tr></table></figure>
<p>结果如下图所示：</p>
<p><img src="/images/colorhist.jpg" alt=""></p>
<ul>
<li>for 循环是对三个通道遍历一次，每次绘制相应通道的直方图的折线。for 循环的第一行是计算对应通道的直方图。</li>
<li>这里直接调用了 OpenCV 的归一化函数，该函数将直方图的范围限定在 0~255×0.9 之间。</li>
<li><code>hist = numpy.int32(numpy.around(originHist))</code> 先将生成的原始直方图中的每个元素四舍六入五凑偶取整（cv2.calcHist函数得到的是 float32 类型的数组），接着将整数部分转成 <code>numpy.int32</code> 类型。即61.123先转成61.0，再转成61。这里必须使用 <code>numpy.int32()</code> 进行转换，numpy 的转换函数可以对数组中的每个元素都进行转换，而Python的转换函数只能转换一个元素，如果使用 Python 的转换函数，将导致 <code>only length-1 arrays can be converted to Python scalars</code> 错误。</li>
<li><code>pts = numpy.column_stack((bins,hist))</code> 是将直方图中每个bin的值转成相应的坐标。比如hist[0] =3，…，hist[126] = 178，…，hist[255] = 5；而bins的值为[[0],[1],[2]…,[255]]。使用 <code>np.column_stack</code> 将其组合成[0, 3]、[126, 178]、[255, 5]这样的坐标作为元素组成的数组。</li>
<li><code>cv2.polylines()</code> 函数根据这些点绘制出折线，False 参数指出这个折线不需要闭合。第四个参数指定了折线的颜色。</li>
<li><code>h = numpy.flipud(h)</code> 反转绘制好的直方图。因为绘制时，[0,0]在图像的左上角。</li>
</ul>
<h1 id="NumPy的直方图计算"><a href="#NumPy的直方图计算" class="headerlink" title="NumPy的直方图计算"></a>NumPy的直方图计算</h1><p>使用 NumPy 的直方图计算函数 <code>numpy.histogram()</code> 也能实现相同的效果，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜  Desktop vim cv.py</span><br><span class="line">➜  Desktop ls</span><br><span class="line">import numpy</span><br><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">h = numpy.zeros((300,256,3))</span><br><span class="line">bins = numpy.arange(257)</span><br><span class="line">bin = bins[0:-1]</span><br><span class="line">color = [(255,0,0),(0,255,0),(0,0,255)]</span><br><span class="line"></span><br><span class="line">for ch,color in enumerate(color):</span><br><span class="line">    item = im[:,:,ch]</span><br><span class="line">    N,bins = numpy.histogram(item, bins)</span><br><span class="line">    v = N.max()</span><br><span class="line">    N = numpy.int32(numpy.around((N*255)/v))</span><br><span class="line">    N = N.reshape(256,1)</span><br><span class="line">    pts = numpy.column_stack((bin,N))</span><br><span class="line">    cv2.polylines(h, [pts], False, color)</span><br><span class="line">h = numpy.flipud(h)</span><br><span class="line">cv2.imwrite(&apos;colorhist_np.jpg&apos;, h)</span><br></pre></td></tr></table></figure>
<p>效果图和上图相同。</p>
<p>通过 NumPy 和 matplotlib 可以更方便的绘制出直方图，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import numpy</span><br><span class="line">import cv2</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">bins = numpy.arange(257)</span><br><span class="line">item = im[:,:,1] # G通道直方图</span><br><span class="line">hist, bins = numpy.histogram(item, bins)</span><br><span class="line">width = 0.7*(bins[1]-bins[0])</span><br><span class="line">center = (bins[:-1]+bins[1:])/2</span><br><span class="line">plt.bar(center, hist, align=&apos;center&apos;, width=width)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>效果图如下：</p>
<p><img src="/images/plt.jpg" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[OpenCV像素与通道]]></title>
      <url>http://lizonghang.github.io/2016/07/21/OpenCV%E5%83%8F%E7%B4%A0%E4%B8%8E%E9%80%9A%E9%81%93/</url>
      <content type="html"><![CDATA[<h1 id="访问像素"><a href="#访问像素" class="headerlink" title="访问像素"></a>访问像素</h1><p>像素的访问和访问 numpy 中 ndarray 的方法完全一样，灰度图为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img[j,i] = 255</span><br></pre></td></tr></table></figure>
<p>其中 j，i 分别表示图像的行和列。对于RGB图像第三个数表示通道，为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">img[j,i,0] = 255</span><br><span class="line">img[j,i,1] = 255</span><br><span class="line">img[j,i,2] = 255</span><br></pre></td></tr></table></figure>
<p>下面通过对图像添加人工的椒盐现象来说明 OpenCV 中需要注意的一些问题。</p>
<p>实验图如下：</p>
<p><img src="/images/lena.jpg" alt=""></p>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy</span><br><span class="line"></span><br><span class="line">def salt(img, n):</span><br><span class="line">    for k in range(n):</span><br><span class="line">        i = int(numpy.random.random() * img.shape[1])</span><br><span class="line">        j = int(numpy.random.random() * img.shape[0])</span><br><span class="line">        if img.ndim == 2:</span><br><span class="line">            img[j,i] = 255</span><br><span class="line">        elif img.ndim == 3:</span><br><span class="line">            img[j,i,0] = 255</span><br><span class="line">            img[j,i,1] = 255</span><br><span class="line">            img[j,i,2] = 255</span><br><span class="line">    return img</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    img = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">    saltImg = salt(img, 1000)</span><br><span class="line">    cv2.imshow(&apos;SaltImage&apos;, saltImg)</span><br><span class="line">    cv2.waitKey(0)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line">    cv2.imwrite(&apos;/Users/mac/Desktop/saltImg.jpg&apos;, saltImg)</span><br></pre></td></tr></table></figure>
<p>处理后能得到类似下面这样带有模拟椒盐现象的图片：</p>
<p><img src="/images/saltImg.jpg" alt=""></p>
<p>需要注意的是：</p>
<ul>
<li>与 C++ 不同，在 Python 中灰度图的 <code>img.ndim = 2</code>，而 C++ 中灰度图图像的通道数 <code>img.channel() = 1</code></li>
<li>这里使用了 numpy 的随机数， Python自身也有一个随机数生成函数。<code>numpy.random</code> 模块中拥有更多的方法，而 Python 自带的 <code>random</code> 只是一个轻量级的模块。不过需要注意的是 <code>numpy.random.seed()</code> 不是线程安全的，而 Python 自带的 <code>random.seed()</code> 是线程安全的。如果使用随机数时需要用到多线程，建议使用 Python 自带的 <code>random()</code> 和 <code>random.seed()，或者构建一个本地的 <code>numpy.random.Random</code> 类的实例。</code></li>
</ul>
<h1 id="分离、合并通道"><a href="#分离、合并通道" class="headerlink" title="分离、合并通道"></a>分离、合并通道</h1><p>由于 OpenCV-Python 和 NumPy 结合的很紧，所以即可使用 OpenCV自带的 <code>split</code>函数，也可以直接操作 Numpy 数组来分离通道。</p>
<h2 id="OpenCV分离通道"><a href="#OpenCV分离通道" class="headerlink" title="OpenCV分离通道"></a>OpenCV分离通道</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">r, g, b = cv2.split(im)</span><br><span class="line">cv2.imshow(&apos;Red&apos;, r)</span><br><span class="line">cv2.imshow(&apos;Green&apos;, g)</span><br><span class="line">cv2.imshow(&apos;Blue&apos;, b)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>其中 <code>cv2.split()</code> 返回 RGB 三个通道，如果只想返回其中一个通道，可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r = cv2.split(im)[0]</span><br><span class="line">g = cv2.split(im)[1]</span><br><span class="line">b = cv2.split(im)[2]</span><br></pre></td></tr></table></figure>
<h2 id="NumPy分离通道"><a href="#NumPy分离通道" class="headerlink" title="NumPy分离通道"></a>NumPy分离通道</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">r = numpy.zeros((im.shape[0], im.shape[1]), dtype=im.dtype)</span><br><span class="line">g = numpy.zeros((im.shape[0], im.shape[1]), dtype=im.dtype)</span><br><span class="line">b = numpy.zeros((im.shape[0], im.shape[1]), dtype=im.dtype)</span><br><span class="line">r[:,:] = im[:,:,0]</span><br><span class="line">g[:,:] = im[:,:,1]</span><br><span class="line">b[:,:] = im[:,:,2]</span><br><span class="line">cv2.imshow(&apos;Red&apos;, r)</span><br><span class="line">cv2.imshow(&apos;Green&apos;, g)</span><br><span class="line">cv2.imshow(&apos;Blue&apos;, b)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>注意先要开辟一个相同大小的图片出来。这是由于 numpy 中数组的复制有三种方式，详见<a href="/2016/07/20/numpy深入探讨/#复制和镜像">NumPy数组复制</a>。</p>
<h1 id="合并通道"><a href="#合并通道" class="headerlink" title="合并通道"></a>合并通道</h1><h2 id="OpenCV合并通道"><a href="#OpenCV合并通道" class="headerlink" title="OpenCV合并通道"></a>OpenCV合并通道</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">r,g,b = cv2.split(im)</span><br><span class="line">mergeImg = cv2.merge([r,g,b])</span><br><span class="line">cv2.imshow(&apos;merge&apos;, mergeImg)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<h2 id="Numpy合并通道"><a href="#Numpy合并通道" class="headerlink" title="Numpy合并通道"></a>Numpy合并通道</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">r,g,b = cv2.split(im)</span><br><span class="line">merged = numpy.dstack([r,g,b])</span><br><span class="line">cv2.imshow(&apos;merge&apos;, merged)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<h2 id="合并效果"><a href="#合并效果" class="headerlink" title="合并效果"></a>合并效果</h2><p>实际使用时建议用 OpenCV 自带的合并函数，在效果上存在一点歧义，有人测试出二者的 <code>strides</code> 属性不同，而实际测出的却相同。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;)</span><br><span class="line">r,g,b = cv2.split(im)</span><br><span class="line">mergedByCV2 = numpy.dstack([r,g,b])</span><br><span class="line">mergedByNumpy = cv2.merge([r,g,b])</span><br><span class="line">print &apos;merged by opencv2.0: &apos;, mergedByCV2.strides</span><br><span class="line">print &apos;merged by numpy: &apos;, mergedByNumpy.strides</span><br></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">merged by opencv2.0:  (1500, 3, 1)</span><br><span class="line">merged by numpy:  (1500, 3, 1)</span><br></pre></td></tr></table></figure>
<p>NumPy 数组的 <code>strides</code> 属性表示的是在每个维数上以字节计算的步长。如下例（int64）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.arange(6)</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([0, 1, 2, 3, 4, 5])</span><br><span class="line">&gt;&gt;&gt; a.strides</span><br><span class="line">(8,)</span><br><span class="line">&gt;&gt;&gt; b = numpy.arange(12).reshape((3,4))</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [ 4,  5,  6,  7],</span><br><span class="line">       [ 8,  9, 10, 11]])</span><br><span class="line">&gt;&gt;&gt; b.strides</span><br><span class="line">(32, 8)</span><br><span class="line">&gt;&gt;&gt; c = numpy.arange(27).reshape(3,3,3)</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">array([[[ 0,  1,  2],</span><br><span class="line">        [ 3,  4,  5],</span><br><span class="line">        [ 6,  7,  8]],</span><br><span class="line"></span><br><span class="line">       [[ 9, 10, 11],</span><br><span class="line">        [12, 13, 14],</span><br><span class="line">        [15, 16, 17]],</span><br><span class="line"></span><br><span class="line">       [[18, 19, 20],</span><br><span class="line">        [21, 22, 23],</span><br><span class="line">        [24, 25, 26]]])</span><br><span class="line">&gt;&gt;&gt; c.strides</span><br><span class="line">(72, 24, 8)</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[numpy深入探讨]]></title>
      <url>http://lizonghang.github.io/2016/07/20/numpy%E6%B7%B1%E5%85%A5%E6%8E%A2%E8%AE%A8/</url>
      <content type="html"><![CDATA[<p>前两篇文章对NumPy数组做了基本的介绍，本篇文章对NumPy数组进行较深入的探讨。首先介绍自定义类型的数组，接着数组的组合，最后介绍数组复制方面的问题。</p>
<h1 id="自定义结构数组"><a href="#自定义结构数组" class="headerlink" title="自定义结构数组"></a>自定义结构数组</h1><p>通过 NumPy 也可以定义像 C 语言那样的结构类型。在 NumPy中定义结构的方法如下：</p>
<p>定义结构类型名称；定义字段名称；标明字段数据类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">student = numpy.dtype(&#123;&apos;names&apos;: [&apos;name&apos;, &apos;age&apos;, &apos;weight&apos;], &apos;formats&apos;: [&apos;S32&apos;, &apos;i&apos;, &apos;f&apos;]&#125;, align=True)</span><br></pre></td></tr></table></figure>
<p>这里 <code>student</code> 是自定义结构类型的名称，使用 <code>dtype()</code> 函数创建，在第一个参数中， <code>‘names’</code> 和 <code>‘formats’</code> 不能改变， <code>names</code>中列出的是结构中的字段名称， <code>formats</code> 中列出的是对应字段的数据类型。<code>S32</code>表示 32 字节长度的字符串， <code>i</code> 表示 32 位的整数， <code>f</code> 表示 32 位长度的浮点数。最后一个参数为 <code>True</code> 时，表示要求进行内存对齐。</p>
<p>字段中使用 NumPy 的字符编码来表示数据类型。更详细的数据类型见下表：</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>字符编码</th>
</tr>
</thead>
<tbody>
<tr>
<td>整数</td>
<td>i</td>
</tr>
<tr>
<td>无符号整数</td>
<td>u</td>
</tr>
<tr>
<td>单精度浮点数</td>
<td>f</td>
</tr>
<tr>
<td>双精度浮点数</td>
<td>d</td>
</tr>
<tr>
<td>布尔值</td>
<td>b</td>
</tr>
<tr>
<td>复数</td>
<td>D</td>
</tr>
<tr>
<td>字符串</td>
<td>S</td>
</tr>
<tr>
<td>Unicode</td>
<td>U</td>
</tr>
<tr>
<td>Void</td>
<td>V</td>
</tr>
</tbody>
</table>
<p>在定义好结构类型之后，就可以定义以该类型为元素的数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = numpy.array([(&apos;Zhang&apos;, 32, 65.5), (&apos;Wang&apos;, 24, 55.2)], dtype=student)</span><br></pre></td></tr></table></figure>
<p>除了在每个元素中依次列出对应字段的数据外，还需要在 <code>array</code> 函数中指定对应的数据类型。</p>
<h1 id="组合函数"><a href="#组合函数" class="headerlink" title="组合函数"></a>组合函数</h1><p>首先创建两个数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.arange(9).reshape(3,3)</span><br><span class="line">&gt;&gt;&gt; b = 2 * a</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[0, 1, 2],</span><br><span class="line">       [3, 4, 5],</span><br><span class="line">       [6, 7, 8]])</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  2,  4],</span><br><span class="line">       [ 6,  8, 10],</span><br><span class="line">       [12, 14, 16]])</span><br></pre></td></tr></table></figure>
<h2 id="水平组合"><a href="#水平组合" class="headerlink" title="水平组合"></a>水平组合</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.hstack((a,b))</span><br><span class="line">array([[ 0,  1,  2,  0,  2,  4],</span><br><span class="line">       [ 3,  4,  5,  6,  8, 10],</span><br><span class="line">       [ 6,  7,  8, 12, 14, 16]])</span><br></pre></td></tr></table></figure>
<p>也可通过 <code>concatenate</code> 函数并指定相应的轴来获得这一效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.concatenate((a,b), axis=1)</span><br><span class="line">array([[ 0,  1,  2,  0,  2,  4],</span><br><span class="line">       [ 3,  4,  5,  6,  8, 10],</span><br><span class="line">       [ 6,  7,  8, 12, 14, 16]])</span><br></pre></td></tr></table></figure>
<h2 id="垂直组合"><a href="#垂直组合" class="headerlink" title="垂直组合"></a>垂直组合</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.vstack((a,b))</span><br><span class="line">array([[ 0,  1,  2],</span><br><span class="line">       [ 3,  4,  5],</span><br><span class="line">       [ 6,  7,  8],</span><br><span class="line">       [ 0,  2,  4],</span><br><span class="line">       [ 6,  8, 10],</span><br><span class="line">       [12, 14, 16]])</span><br></pre></td></tr></table></figure>
<p>同样可通过 <code>concatenate</code> 函数并指定相应的轴来获得这一效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.concatenate((a,b), axis=0)</span><br><span class="line">array([[ 0,  1,  2],</span><br><span class="line">       [ 3,  4,  5],</span><br><span class="line">       [ 6,  7,  8],</span><br><span class="line">       [ 0,  2,  4],</span><br><span class="line">       [ 6,  8, 10],</span><br><span class="line">       [12, 14, 16]])</span><br></pre></td></tr></table></figure>
<h2 id="深度组合"><a href="#深度组合" class="headerlink" title="深度组合"></a>深度组合</h2><p>另外还有深度方面的组合函数 <code>dstack</code>，顾名思义，就是在数组的第三个轴（即深度）上组合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.dstack((a,b))</span><br><span class="line">array([[[ 0,  0],</span><br><span class="line">        [ 1,  2],</span><br><span class="line">        [ 2,  4]],</span><br><span class="line"></span><br><span class="line">       [[ 3,  6],</span><br><span class="line">        [ 4,  8],</span><br><span class="line">        [ 5, 10]],</span><br><span class="line"></span><br><span class="line">       [[ 6, 12],</span><br><span class="line">        [ 7, 14],</span><br><span class="line">        [ 8, 16]]])</span><br></pre></td></tr></table></figure>
<p>仔细观察发现对应的元素都组合成一个新的列表，该列表作为新的数组的元素。</p>
<h2 id="行组合"><a href="#行组合" class="headerlink" title="行组合"></a>行组合</h2><p>行组合可将多个一维数组作为新数组的每一行进行组合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.arange(2)</span><br><span class="line">&gt;&gt;&gt; b = a + 2</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([0, 1])</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([2, 3])</span><br><span class="line">&gt;&gt;&gt; numpy.row_stack((a,b))</span><br><span class="line">array([[0, 1],</span><br><span class="line">       [2, 3]])</span><br></pre></td></tr></table></figure>
<h2 id="列组合"><a href="#列组合" class="headerlink" title="列组合"></a>列组合</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([0, 1])</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([2, 3])</span><br><span class="line">&gt;&gt;&gt; numpy.column_stack((a,b))</span><br><span class="line">array([[0, 2],</span><br><span class="line">       [1, 3]])</span><br></pre></td></tr></table></figure>
<h1 id="分割数组"><a href="#分割数组" class="headerlink" title="分割数组"></a>分割数组</h1><p>分割数组的函数有 <code>hsplit</code>、<code>vsplit</code>、<code>dsplit</code>、<code>split</code>。可将数组分割成相同大小的子数组，或指定原数组分割的位置。</p>
<h2 id="水平分割"><a href="#水平分割" class="headerlink" title="水平分割"></a>水平分割</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.hsplit(a, 3)</span><br><span class="line">[array([[0],</span><br><span class="line">       [3],</span><br><span class="line">       [6]]), array([[1],</span><br><span class="line">       [4],</span><br><span class="line">       [7]]), array([[2],</span><br><span class="line">       [5],</span><br><span class="line">       [8]])]</span><br></pre></td></tr></table></figure>
<p>也可以调用 <code>split</code> 函数并指定 <code>axis=1</code> 来获得这样的效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.split(a, 3, axis=1)</span><br></pre></td></tr></table></figure>
<h2 id="垂直分割"><a href="#垂直分割" class="headerlink" title="垂直分割"></a>垂直分割</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.vsplit(a, 3)</span><br><span class="line">[array([[0, 1, 2]]), array([[3, 4, 5]]), array([[6, 7, 8]])]</span><br></pre></td></tr></table></figure>
<p>也可以调用 <code>split</code> 函数并指定 <code>axis=0</code> 来获得这样的效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.split(a, 3, axis=0)</span><br></pre></td></tr></table></figure>
<h2 id="深度分割"><a href="#深度分割" class="headerlink" title="深度分割"></a>深度分割</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = numpy.arange(27).reshape(3,3,3)</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">array([[[ 0,  1,  2],</span><br><span class="line">        [ 3,  4,  5],</span><br><span class="line">        [ 6,  7,  8]],</span><br><span class="line"></span><br><span class="line">       [[ 9, 10, 11],</span><br><span class="line">        [12, 13, 14],</span><br><span class="line">        [15, 16, 17]],</span><br><span class="line"></span><br><span class="line">       [[18, 19, 20],</span><br><span class="line">        [21, 22, 23],</span><br><span class="line">        [24, 25, 26]]])</span><br><span class="line">&gt;&gt;&gt; numpy.dsplit(c, 3)</span><br><span class="line">[array([[[ 0],</span><br><span class="line">        [ 3],</span><br><span class="line">        [ 6]],</span><br><span class="line"></span><br><span class="line">       [[ 9],</span><br><span class="line">        [12],</span><br><span class="line">        [15]],</span><br><span class="line"></span><br><span class="line">       [[18],</span><br><span class="line">        [21],</span><br><span class="line">        [24]]]), array([[[ 1],</span><br><span class="line">        [ 4],</span><br><span class="line">        [ 7]],</span><br><span class="line"></span><br><span class="line">       [[10],</span><br><span class="line">        [13],</span><br><span class="line">        [16]],</span><br><span class="line"></span><br><span class="line">       [[19],</span><br><span class="line">        [22],</span><br><span class="line">        [25]]]), array([[[ 2],</span><br><span class="line">        [ 5],</span><br><span class="line">        [ 8]],</span><br><span class="line"></span><br><span class="line">       [[11],</span><br><span class="line">        [14],</span><br><span class="line">        [17]],</span><br><span class="line"></span><br><span class="line">       [[20],</span><br><span class="line">        [23],</span><br><span class="line">        [26]]])]</span><br></pre></td></tr></table></figure>
<h1 id="复制和镜像"><a href="#复制和镜像" class="headerlink" title="复制和镜像"></a>复制和镜像</h1><p>当运算和处理数组时，它们的数据有时被拷贝到新的数组，有时不是。有三种情况：</p>
<h2 id="完全不复制"><a href="#完全不复制" class="headerlink" title="完全不复制"></a>完全不复制</h2><p>简单的赋值，而不复制数组对象或它们的数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.arange(12)</span><br><span class="line">&gt;&gt;&gt; b = a # 不创建新对象</span><br><span class="line">&gt;&gt;&gt; b is a</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; b.shape = (3,4)</span><br><span class="line">&gt;&gt;&gt; a.shape</span><br><span class="line">(3, 4)</span><br></pre></td></tr></table></figure>
<p>Python 传递不定对象作为参考，所以函数调用不拷贝数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def f(x):</span><br><span class="line">...     print id(x)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; id(a)</span><br><span class="line">4560419696</span><br><span class="line">&gt;&gt;&gt; f(a)</span><br><span class="line">4560419696</span><br></pre></td></tr></table></figure>
<h2 id="视图（View）和浅复制"><a href="#视图（View）和浅复制" class="headerlink" title="视图（View）和浅复制"></a>视图（View）和浅复制</h2><p>不同的数组对象分享同一个数据。视图方法创造一个新的数组对象指向同一数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = a.view()</span><br><span class="line">&gt;&gt;&gt; c is a</span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; c.base is a </span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; c.flags.owndata</span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; c.shape = (2,6) # a的形状不变</span><br><span class="line">&gt;&gt;&gt; a.shape</span><br><span class="line">(3, 4)</span><br><span class="line">&gt;&gt;&gt; c[0,4] = 12 # a的数据改变</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [12,  5,  6,  7],</span><br><span class="line">       [ 8,  9, 10, 11]])</span><br></pre></td></tr></table></figure>
<p>切片数组返回它的一个视图：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = a[:, 1:3]</span><br><span class="line">&gt;&gt;&gt; s[:] = 10 # s[:]是s的镜像，共享数据</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[ 0, 10, 10,  3],</span><br><span class="line">       [12, 10, 10,  7],</span><br><span class="line">       [ 8, 10, 10, 11]])</span><br></pre></td></tr></table></figure>
<h2 id="深复制"><a href="#深复制" class="headerlink" title="深复制"></a>深复制</h2><p>完全复制数组和它的数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = a.copy()</span><br><span class="line">&gt;&gt;&gt; d is a</span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; d.base is a</span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; d[0,0] = 99</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[ 0, 10, 10,  3],</span><br><span class="line">       [12, 10, 10,  7],</span><br><span class="line">       [ 8, 10, 10, 11]])</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[numpy数组操作]]></title>
      <url>http://lizonghang.github.io/2016/07/20/numpy%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C/</url>
      <content type="html"><![CDATA[<h1 id="基本运算"><a href="#基本运算" class="headerlink" title="基本运算"></a>基本运算</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.array([20,30,40,50])</span><br><span class="line">&gt;&gt;&gt; b = numpy.arange(4)</span><br><span class="line">&gt;&gt;&gt; c = a - b</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">array([20, 29, 38, 47])</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([0, 1, 2, 3])</span><br><span class="line">&gt;&gt;&gt; b**2</span><br><span class="line">array([0, 1, 4, 9])</span><br><span class="line">&gt;&gt;&gt; 10*numpy.sin(a)</span><br><span class="line">array([ 9.12945251, -9.88031624,  7.4511316 , -2.62374854])</span><br><span class="line">&gt;&gt;&gt; a &lt; 35</span><br><span class="line">array([ True,  True, False, False], dtype=bool)</span><br></pre></td></tr></table></figure>
<p>NumPy 中的乘法运算符按元素逐个计算，矩阵乘法可以使用 dot 函数或创建矩阵对象实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; A = numpy.array([[1,1],[0,1]])</span><br><span class="line">&gt;&gt;&gt; B = numpy.array([[2,0],[3,4]])</span><br><span class="line">&gt;&gt;&gt; A*B</span><br><span class="line">array([[2, 0],</span><br><span class="line">       [0, 4]])</span><br><span class="line">&gt;&gt;&gt; numpy.dot(A,B)</span><br><span class="line">array([[5, 4],</span><br><span class="line">       [3, 4]])</span><br></pre></td></tr></table></figure>
<p>当数组中存储的是不同类型的元素时，数组将使用占用更多位的数据类型作为其本身的数据类型，也就是偏向更精确的数据类型，这种行为叫做 upcast：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.ones(3, dtype=numpy.int32)</span><br><span class="line">&gt;&gt;&gt; b = numpy.linspace(0, numpy.pi, 3)</span><br><span class="line">&gt;&gt;&gt; b.dtype.name</span><br><span class="line">&apos;float64&apos;</span><br><span class="line">&gt;&gt;&gt; c = a + b</span><br><span class="line">&gt;&gt;&gt; c.dtype.name</span><br><span class="line">&apos;float64&apos;</span><br><span class="line">&gt;&gt;&gt; d = numpy.exp(c*1j)</span><br><span class="line">&gt;&gt;&gt; d.dtype.name</span><br><span class="line">&apos;complex128&apos;</span><br></pre></td></tr></table></figure>
<p>许多非数组运算，如计算数组所有元素之和，都作为 ndarray 类的方法来实现，使用时需要用 ndarray 类的实例来调用这些方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.random.random((2,3))</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[ 0.68091784,  0.41612706,  0.86948767],</span><br><span class="line">       [ 0.78411139,  0.25901918,  0.6092565 ]])</span><br><span class="line">&gt;&gt;&gt; a.sum()</span><br><span class="line">3.6189196384603322</span><br><span class="line">&gt;&gt;&gt; a.min()</span><br><span class="line">0.2590191823646294</span><br><span class="line">&gt;&gt;&gt; a.max()</span><br><span class="line">0.86948766685829515</span><br></pre></td></tr></table></figure>
<p>这些运算将数组看作是一维线性列表。但可通过指定 axis 参数（即数组的行）对指定的轴做相应的运算：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b = numpy.arange(12).reshape(3,4)</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [ 4,  5,  6,  7],</span><br><span class="line">       [ 8,  9, 10, 11]])</span><br><span class="line">&gt;&gt;&gt; b.sum(axis=0)</span><br><span class="line">array([12, 15, 18, 21])</span><br><span class="line">&gt;&gt;&gt; b.min(axis=1)</span><br><span class="line">array([0, 4, 8])</span><br><span class="line">&gt;&gt;&gt; b.cumsum(axis=1)</span><br><span class="line">array([[ 0,  1,  3,  6],</span><br><span class="line">       [ 4,  9, 15, 22],</span><br><span class="line">       [ 8, 17, 27, 38]])</span><br></pre></td></tr></table></figure>
<h1 id="索引，切片和迭代"><a href="#索引，切片和迭代" class="headerlink" title="索引，切片和迭代"></a>索引，切片和迭代</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.arange(10)**3</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([  0,   1,   8,  27,  64, 125, 216, 343, 512, 729])</span><br><span class="line">&gt;&gt;&gt; a[2]</span><br><span class="line">8</span><br><span class="line">&gt;&gt;&gt; a[2:5]</span><br><span class="line">array([ 8, 27, 64])</span><br><span class="line">&gt;&gt;&gt; a[:6:2] = -1000</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([-1000,     1, -1000,    27, -1000,   125,   216,   343,   512,   729])</span><br><span class="line">&gt;&gt;&gt; a[::-1]</span><br><span class="line">array([  729,   512,   343,   216,   125, -1000,    27, -1000,     1, -1000])</span><br></pre></td></tr></table></figure>
<p>多维数组可以每个轴有一个索引，这些索引由一个逗号分割的元组给出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def f(x,y):</span><br><span class="line">...     return 10*x+y</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; b = numpy.fromfunction(f, (5,4), dtype=int)</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [10, 11, 12, 13],</span><br><span class="line">       [20, 21, 22, 23],</span><br><span class="line">       [30, 31, 32, 33],</span><br><span class="line">       [40, 41, 42, 43]])</span><br><span class="line">&gt;&gt;&gt; b[2,3]</span><br><span class="line">23</span><br><span class="line">&gt;&gt;&gt; b[0:5,1]</span><br><span class="line">array([ 1, 11, 21, 31, 41])</span><br><span class="line">&gt;&gt;&gt; b[:,1]</span><br><span class="line">array([ 1, 11, 21, 31, 41])</span><br><span class="line">&gt;&gt;&gt; b[1:3,:]</span><br><span class="line">array([[10, 11, 12, 13],</span><br><span class="line">       [20, 21, 22, 23]])</span><br></pre></td></tr></table></figure>
<p>b[i] 中括号中的表达式被当做 i 和一系列 : 来代表剩下的轴。NumPy 允许使用 b[i, …]。’…’代表许多产生一个完整的索引元组必要的分号。如果 x 是秩为 5 的数组，那么：</p>
<ul>
<li>x[1,2,…] 等同于 x[1,2,:,:,:]</li>
<li>x[…,3] 等同于 x[:,:,:,:,3]</li>
<li>x[4,…,5,:] 等同于 x[4,:,:,5,:]</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = numpy.arange(12).reshape((3,4))</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [ 4,  5,  6,  7],</span><br><span class="line">       [ 8,  9, 10, 11]])</span><br><span class="line">&gt;&gt;&gt; c.shape</span><br><span class="line">(3, 4)</span><br><span class="line">&gt;&gt;&gt; c[1,...]</span><br><span class="line">array([4, 5, 6, 7])</span><br><span class="line">&gt;&gt;&gt; c[...,2]</span><br><span class="line">array([ 2,  6, 10])</span><br></pre></td></tr></table></figure>
<p>如果想对数组中每个元素都进行处理，可以使用 <code>flat</code> 属性，该属性是一个数组元素迭代器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [10, 11, 12, 13],</span><br><span class="line">       [20, 21, 22, 23],</span><br><span class="line">       [30, 31, 32, 33],</span><br><span class="line">       [40, 41, 42, 43]])</span><br><span class="line">&gt;&gt;&gt; for element in b.flat:</span><br><span class="line">...     print element,</span><br><span class="line">...</span><br><span class="line">0 1 2 3 10 11 12 13 20 21 22 23 30 31 32 33 40 41 42 43</span><br></pre></td></tr></table></figure>
<h1 id="形状操作"><a href="#形状操作" class="headerlink" title="形状操作"></a>形状操作</h1><p>可以用多种方式修改数组的形状：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [10, 11, 12, 13],</span><br><span class="line">       [20, 21, 22, 23],</span><br><span class="line">       [30, 31, 32, 33],</span><br><span class="line">       [40, 41, 42, 43]])</span><br><span class="line">&gt;&gt;&gt; b.shape</span><br><span class="line">(5, 4)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b.ravel() # 平坦化数组</span><br><span class="line">array([ 0,  1,  2,  3, 10, 11, 12, 13, 20, 21, 22, 23, 30, 31, 32, 33, 40,</span><br><span class="line">       41, 42, 43])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b.shape = (10,2)</span><br><span class="line">&gt;&gt;&gt; b.transpose()</span><br><span class="line">array([[ 0,  2, 10, 12, 20, 22, 30, 32, 40, 42],</span><br><span class="line">       [ 1,  3, 11, 13, 21, 23, 31, 33, 41, 43]])</span><br></pre></td></tr></table></figure>
<p><code>reshape()</code> 函数改变调用数组的形状并返回该数组，而 <code>resize()</code> 函数改变调用数组自身：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [10, 11, 12, 13],</span><br><span class="line">       [20, 21, 22, 23],</span><br><span class="line">       [30, 31, 32, 33],</span><br><span class="line">       [40, 41, 42, 43]])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b.reshape((2,10))</span><br><span class="line">array([[ 0,  1,  2,  3, 10, 11, 12, 13, 20, 21],</span><br><span class="line">       [22, 23, 30, 31, 32, 33, 40, 41, 42, 43]])</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [10, 11, 12, 13],</span><br><span class="line">       [20, 21, 22, 23],</span><br><span class="line">       [30, 31, 32, 33],</span><br><span class="line">       [40, 41, 42, 43]])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b.resize((2,10))</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  1,  2,  3, 10, 11, 12, 13, 20, 21],</span><br><span class="line">       [22, 23, 30, 31, 32, 33, 40, 41, 42, 43]])</span><br></pre></td></tr></table></figure>
<p>如果在 <code>reshape()</code> 操作中指定一个维度为 -1，那么其准确维度将根据实际情况计算得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">       [10, 11, 12, 13],</span><br><span class="line">       [20, 21, 22, 23],</span><br><span class="line">       [30, 31, 32, 33],</span><br><span class="line">       [40, 41, 42, 43]])</span><br><span class="line">&gt;&gt;&gt; b.reshape((4,-1))</span><br><span class="line">array([[ 0,  1,  2,  3, 10],</span><br><span class="line">       [11, 12, 13, 20, 21],</span><br><span class="line">       [22, 23, 30, 31, 32],</span><br><span class="line">       [33, 40, 41, 42, 43]])</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[numpy数组初探]]></title>
      <url>http://lizonghang.github.io/2016/07/20/numpy%E6%95%B0%E7%BB%84%E5%88%9D%E6%8E%A2/</url>
      <content type="html"><![CDATA[<h1 id="NumPy数组"><a href="#NumPy数组" class="headerlink" title="NumPy数组"></a>NumPy数组</h1><p>Numpy 数组是一个多维数组对象，称为 ndarray，由实际的数据和描述这些数据的元数据组成。大部分操作仅针对元数据，而不改变底层实际的数据。</p>
<p>关于 NumPy 数组需要知道：NumPy 数组的下标从 0 开始；同一个 NumPy 数组中的所有元素的类型必须是相同的。</p>
<h1 id="NumPy-数组属性"><a href="#NumPy-数组属性" class="headerlink" title="NumPy 数组属性"></a>NumPy 数组属性</h1><p>NumPy 数组的维数称为秩（rank），每一个线性的数组称为一个轴（axes），秩其实是描述轴的数量。比如说，二维数组相当于是两个一维数组，其中第一个一维数组中的每个元素又是一个一维数组。所以一维数组就是 NumPy 中的轴，第一个轴相当于是底层数组，第二个轴是底层数组里的数组。而轴的数量——秩，就是数组的维数。</p>
<p>NumPy 的数组中比较重要的 ndarray 对象属性有：</p>
<ul>
<li><code>ndarray.ndim</code> - 数组的维数/秩。最常见为二维数组。</li>
<li><code>ndarray.shape</code> - 数组的维度。为一个表示数组在每个维度上大小的整数元组。例如二维数组中，表示数组的“行数”和“列数”。<code>ndarray.shape</code> 返回一个元组，这个元组的长度就是维度的数目，即 <code>ndim</code> 属性。</li>
<li><code>ndarray.size</code> - 数组元素的总个数，等于 <code>shape</code> 属性中元组元素的乘积。</li>
<li><code>ndarray.dtype</code> - 表示数组中元素类型的对象，可使用标准的 Python 类型创建或指定 <code>dtype</code>。</li>
<li><code>ndarray.itemsize</code> - 数组中每个元素的字节大小。例如一个元素类型为 float64 的数组 <code>itemsize</code> 属性值为 8，一个元素类型为 complex32 的数组 <code>itemsize</code> 属性为 4。</li>
<li><code>ndarray.data</code> - 包含实际数组元素的缓冲区，由于一般通过数组的索引获取元素，所以通常不需要使用这个属性。</li>
</ul>
<h1 id="创建数组"><a href="#创建数组" class="headerlink" title="创建数组"></a>创建数组</h1><h2 id="numpy-array"><a href="#numpy-array" class="headerlink" title="numpy.array()"></a>numpy.array()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import numpy</span><br><span class="line">&gt;&gt;&gt; a = numpy.array([2,3,4])</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([2, 3, 4])</span><br><span class="line">&gt;&gt;&gt; a.dtype</span><br><span class="line">dtype(&apos;int64&apos;)</span><br><span class="line">&gt;&gt;&gt; b = numpy.array([1.2, 3.5, 5.1])</span><br><span class="line">&gt;&gt;&gt; b.dtype</span><br><span class="line">dtype(&apos;float64&apos;)</span><br></pre></td></tr></table></figure>
<p>使用 <code>numpy.array()</code> 函数创建时，参数必须是由方括号括起的列表，而不能使用多个数值作为参数调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.array(1,2,3,4)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">ValueError: only 2 non-keyword arguments accepted</span><br></pre></td></tr></table></figure>
<p>可使用双重序列表示二维的数组，三重序列表示三维数组，以此类推：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b = numpy.array([(1.5,2,3),(4,5,6)])</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 1.5,  2. ,  3. ],</span><br><span class="line">       [ 4. ,  5. ,  6. ]])</span><br></pre></td></tr></table></figure>
<p>可以在创建时显式指定数组中元素的类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = numpy.array([[1,2],[3,4]], dtype=complex)</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">array([[ 1.+0.j,  2.+0.j],</span><br><span class="line">       [ 3.+0.j,  4.+0.j]])</span><br></pre></td></tr></table></figure>
<h2 id="numpy-zeros-、numpy-ones-、numpy-empty"><a href="#numpy-zeros-、numpy-ones-、numpy-empty" class="headerlink" title="numpy.zeros()、numpy.ones()、numpy.empty()"></a>numpy.zeros()、numpy.ones()、numpy.empty()</h2><p>通常刚开始时数组的元素未知，而数组的大小已知。因此 NumPy 提供了一些使用占位符创建数组的函数。这些函数有助于满足除了数组扩展的需要，同时降低了高昂的运算开销。</p>
<p>用函数 <code>numpy.zeros()</code> 可创建一个全是 0 的数组，用函数 <code>numpy.ones()</code> 可创建一个全为 1 的数组，函数 <code>numpy.empty()</code> 创建一个内容随机并且依赖于内存状态的数组。默认创建的数组类型（dtype）都是 float64。</p>
<p>可以用 <code>d.dtype.itemsize</code> 来查看数组中元素占用的字节数目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = numpy.zeros((3,4))</span><br><span class="line">&gt;&gt;&gt; d.dtype</span><br><span class="line">dtype(&apos;float64&apos;)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">array([[ 0.,  0.,  0.,  0.],</span><br><span class="line">       [ 0.,  0.,  0.,  0.],</span><br><span class="line">       [ 0.,  0.,  0.,  0.]])</span><br><span class="line">&gt;&gt;&gt; d.dtype.itemsize</span><br><span class="line">8</span><br></pre></td></tr></table></figure>
<p>也可以自己制定数组中元素的类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.ones((2,3,4), dtype=numpy.int8)</span><br><span class="line">array([[[1, 1, 1, 1],</span><br><span class="line">        [1, 1, 1, 1],</span><br><span class="line">        [1, 1, 1, 1]],</span><br><span class="line"></span><br><span class="line">       [[1, 1, 1, 1],</span><br><span class="line">        [1, 1, 1, 1],</span><br><span class="line">        [1, 1, 1, 1]]], dtype=int8)</span><br><span class="line">&gt;&gt;&gt; numpy.empty((2,3))</span><br><span class="line">array([[ 0.,  0.,  0.],</span><br><span class="line">       [ 0.,  0.,  0.]])</span><br></pre></td></tr></table></figure>
<h2 id="numpy-arange"><a href="#numpy-arange" class="headerlink" title="numpy.arange()"></a>numpy.arange()</h2><p>NumPy 提供一个类似 <code>arange()</code> 的函数返回一个数列形式的数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.arange(10,30,5)</span><br><span class="line">array([10, 15, 20, 25])</span><br><span class="line">&gt;&gt;&gt; numpy.arange(0,2,0.5)</span><br><span class="line">array([ 0. ,  0.5,  1. ,  1.5])</span><br></pre></td></tr></table></figure>
<h2 id="numpy-linspace"><a href="#numpy-linspace" class="headerlink" title="numpy.linspace()"></a>numpy.linspace()</h2><p>当 <code>numpy.arange()</code> 使用浮点数参数时，由于浮点数精度有限，通常无法预测获得的元素个数。因此，最好使用函数 <code>numpy.linspace()</code> 去接收我们想要的元素个数来代替用 <code>range</code> 来指定步长：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.linspace(-1, 0, 5)</span><br><span class="line">array([-1.  , -0.75, -0.5 , -0.25,  0.  ])</span><br></pre></td></tr></table></figure>
<p>数组中的元素是通过下标来访问的，可以以切片的形式访问数组中多个元素。</p>
<h1 id="NumPy基本数据类型"><a href="#NumPy基本数据类型" class="headerlink" title="NumPy基本数据类型"></a>NumPy基本数据类型</h1><table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>取值范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>bool</td>
<td>用一个字节存储的布尔类型</td>
<td>True / False</td>
</tr>
<tr>
<td>int8</td>
<td>整数</td>
<td>-128 ~ 127</td>
</tr>
<tr>
<td>int16</td>
<td>整数</td>
<td>-32768 ~ 32767</td>
</tr>
<tr>
<td>int32</td>
<td>整数</td>
<td>-2^31 ~ 2^31-1</td>
</tr>
<tr>
<td>int64</td>
<td>整数</td>
<td>-2^63 ~ 2^63-1</td>
</tr>
<tr>
<td>uint8</td>
<td>无符号整数</td>
<td>0 ~ 255</td>
</tr>
<tr>
<td>uint16</td>
<td>无符号整数</td>
<td>0 ~ 65535</td>
</tr>
<tr>
<td>uint32</td>
<td>无符号整数</td>
<td>0 ~ 2^32-1</td>
</tr>
<tr>
<td>uint64</td>
<td>无符号整数</td>
<td>0 ~ 2^64-1</td>
</tr>
<tr>
<td>float16</td>
<td>半精度浮点数16位</td>
<td>正负号1位，指数5位，精度10位</td>
</tr>
<tr>
<td>float32</td>
<td>单精度浮点数32位</td>
<td>正负号1位，指数8位，精度23位</td>
</tr>
<tr>
<td>float64</td>
<td>双精度浮点数64位</td>
<td>正负号1位，指数11位，精度52位</td>
</tr>
<tr>
<td>float</td>
<td>双精度浮点数64位</td>
<td>正负号1位，指数11位，精度52位</td>
</tr>
<tr>
<td>complex64</td>
<td>复数</td>
<td>分别用两个32位浮点数表示实部和虚部</td>
</tr>
<tr>
<td>complex128</td>
<td>复数</td>
<td>分别用两个64位浮点数表示实部和虚部</td>
</tr>
<tr>
<td>complex</td>
<td>复数</td>
<td>分别用两个64位浮点数表示实部和虚部</td>
</tr>
</tbody>
</table>
<h2 id="NumPy类型转换"><a href="#NumPy类型转换" class="headerlink" title="NumPy类型转换"></a>NumPy类型转换</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.float64(42)</span><br><span class="line">42.0</span><br><span class="line">&gt;&gt;&gt; numpy.int8(42.0)</span><br><span class="line">42</span><br><span class="line">&gt;&gt;&gt; numpy.bool(42)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; numpy.bool(42.0)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; numpy.float(True)</span><br><span class="line">1.0</span><br></pre></td></tr></table></figure>
<p>许多函数的参数中可以指定参数的类型，这个类型参数是可选的，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.arange(7, dtype=numpy.uint16)</span><br><span class="line">array([0, 1, 2, 3, 4, 5, 6], dtype=uint16)</span><br></pre></td></tr></table></figure>
<h1 id="输出数组"><a href="#输出数组" class="headerlink" title="输出数组"></a>输出数组</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = numpy.arange(6)</span><br><span class="line">&gt;&gt;&gt; print a</span><br><span class="line">[0 1 2 3 4 5]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b = numpy.arange(12).reshape(4,3)</span><br><span class="line">&gt;&gt;&gt; print b</span><br><span class="line">[[ 0  1  2]</span><br><span class="line"> [ 3  4  5]</span><br><span class="line"> [ 6  7  8]</span><br><span class="line"> [ 9 10 11]]</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; c = numpy.arange(24).reshape(2,3,4)</span><br><span class="line">&gt;&gt;&gt; print c</span><br><span class="line">[[[ 0  1  2  3]</span><br><span class="line">  [ 4  5  6  7]</span><br><span class="line">  [ 8  9 10 11]]</span><br><span class="line"></span><br><span class="line"> [[12 13 14 15]</span><br><span class="line">  [16 17 18 19]</span><br><span class="line">  [20 21 22 23]]]</span><br></pre></td></tr></table></figure>
<p>如果一个数组太长，则 NumPy 自动省略中间部分而只打印两端的数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print numpy.arange(10000)</span><br><span class="line">[   0    1    2 ..., 9997 9998 9999]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; print numpy.arange(10000).reshape(100,100)</span><br><span class="line">[[   0    1    2 ...,   97   98   99]</span><br><span class="line"> [ 100  101  102 ...,  197  198  199]</span><br><span class="line"> [ 200  201  202 ...,  297  298  299]</span><br><span class="line"> ...,</span><br><span class="line"> [9700 9701 9702 ..., 9797 9798 9799]</span><br><span class="line"> [9800 9801 9802 ..., 9897 9898 9899]</span><br><span class="line"> [9900 9901 9902 ..., 9997 9998 9999]]</span><br></pre></td></tr></table></figure>
<p>可以通过设置 <code>set_printoptions()</code> 函数来禁用 NumPy 的这种行为并强制打印整个数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; numpy.set_printoptions(threshold=&apos;nan&apos;)</span><br><span class="line">&gt;&gt;&gt; print numpy.arange(10000).reshape(100,100)</span><br></pre></td></tr></table></figure>
<p>此后输出时数组的所有元素都会显示出来。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[socket网络通信——TCP/IP客户和服务器]]></title>
      <url>http://lizonghang.github.io/2016/07/18/socket%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E2%80%94%E2%80%94TCP-IP%E5%AE%A2%E6%88%B7%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      <content type="html"><![CDATA[<h1 id="TCP-IP客户和服务器"><a href="#TCP-IP客户和服务器" class="headerlink" title="TCP/IP客户和服务器"></a>TCP/IP客户和服务器</h1><p>套接字可以配置为一个服务器，监听到来的消息，或者也可以配置为客户，连接到其他应用。TCP/IP 套接字的两端连接后，可以完成双向通信。</p>
<h2 id="回应服务器"><a href="#回应服务器" class="headerlink" title="回应服务器"></a>回应服务器</h2><p>下面的例子接收到来的消息，再回复给发送者。首先创建一个 TCP/IP 套接字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br></pre></td></tr></table></figure>
<p>然后使用 <code>bind()</code> 将这个套接字与服务器地址关联。在这里，地址是 localhost （当前服务器），端口号为 10000：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sock.bind((&apos;localhost&apos;, 10000))</span><br></pre></td></tr></table></figure>
<p>调用 <code>listen()</code> 将这个套接字置为服务器模式，调用 <code>accept()</code> 等待到来的连接。整数参数是在后台排队的连接数，达到这个连接数后，系统会拒绝连接新用户。该例希望一次只处理一个连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.listen(1)</span><br><span class="line">while True:</span><br><span class="line">    print &apos;wait for a connection&apos;</span><br><span class="line">    connection, client_address = sock.accept()</span><br></pre></td></tr></table></figure>
<p><code>accept()</code> 返回服务器和客户之间的一个打开的连接，并返回客户地址。这个连接实际上是另一个端口上的一个不同的套接字（由内核分配）。数据使用 <code>recv()</code> 从连接读取，并用 <code>sendall()</code> 传输。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    print &apos;connection from &apos;, client_address</span><br><span class="line">    while True:</span><br><span class="line">        data = connection.revc(16)</span><br><span class="line">        print &apos;received &apos;, data</span><br><span class="line">        if data:</span><br><span class="line">            print &apos;sending data back to the client&apos;</span><br><span class="line">            connection.sendall(data)</span><br><span class="line">        else:</span><br><span class="line">            print &apos;no data from &apos;, client_address</span><br><span class="line">            break</span><br><span class="line">finally:</span><br><span class="line">    connection.close()</span><br></pre></td></tr></table></figure>
<p>与一个客户的通信完成时，需要用 <code>close()</code> 清理这个连接。例子使用 <code>finally</code> 确保 <code>close()</code> 总会被调用，即时出现了一个错误也不例外。</p>
<p>服务器端全部代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((&apos;localhost&apos;, 10000))</span><br><span class="line">sock.listen(1)</span><br><span class="line">while True:</span><br><span class="line">    print &apos;wait for a connection&apos;</span><br><span class="line">    connection, client_address = sock.accept()</span><br><span class="line">    try:</span><br><span class="line">        print &apos;connection from &apos;, client_address</span><br><span class="line">        while True:</span><br><span class="line">            data = connection.recv(16)</span><br><span class="line">            print &apos;received &apos;, data</span><br><span class="line">            if data:</span><br><span class="line">                print &apos;sending data back to the client&apos;</span><br><span class="line">                connection.sendall(data)</span><br><span class="line">            else:</span><br><span class="line">                print &apos;no data from &apos;, client_address</span><br><span class="line">                break</span><br><span class="line">    finally:</span><br><span class="line">        connection.close()</span><br><span class="line">        print &apos;connection closed()&apos;</span><br></pre></td></tr></table></figure>
<h2 id="回应客户"><a href="#回应客户" class="headerlink" title="回应客户"></a>回应客户</h2><p>与服务器不同，客户程序采用另一种方式建立 socket。它不绑定到一个端口并监听，而是使用 <code>connect()</code> 将套接字直接关联到远程地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">print &apos;connecting to server&apos;</span><br><span class="line">sock.connect((&apos;localhost&apos;, 10000))</span><br></pre></td></tr></table></figure>
<p>建立连接后，可以通过 socket 利用 <code>sendall()</code> 发送数据，并用 <code>recv()</code> 接收数据，这和服务器中是一样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    message = &apos;abcdefghijklmnopqrstuvwxyz&apos;</span><br><span class="line">    sock.sendall(message)</span><br><span class="line">    amount_received = 0</span><br><span class="line">    amount_expected = len(message)</span><br><span class="line">    while amount_received &lt; amount_expected:</span><br><span class="line">        data = sock.recv(16)</span><br><span class="line">        amount_received += len(data)</span><br><span class="line">        print &apos;received &apos;, data</span><br><span class="line">finally:</span><br><span class="line">    print &apos;socket closed&apos;</span><br><span class="line">    sock.close()</span><br></pre></td></tr></table></figure>
<p>发送了整个消息并接收到一个副本时，套接字会关闭，以释放端口。</p>
<p>客户端全部代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">print &apos;connecting to server&apos;</span><br><span class="line">sock.connect((&apos;localhost&apos;, 10000))</span><br><span class="line">try:</span><br><span class="line">    message = &apos;abcdefghijklmnopqrstuvwxyz&apos;</span><br><span class="line">    sock.sendall(message)</span><br><span class="line">    amount_received = 0</span><br><span class="line">    amount_expected = len(message)</span><br><span class="line">    while amount_received &lt; amount_expected:</span><br><span class="line">        data = sock.recv(16)</span><br><span class="line">        amount_received += len(data)</span><br><span class="line">        print &apos;received &apos;, data</span><br><span class="line">finally:</span><br><span class="line">    print &apos;socket closed&apos;</span><br><span class="line">    sock.close()</span><br></pre></td></tr></table></figure>
<h2 id="客户与服务器"><a href="#客户与服务器" class="headerlink" title="客户与服务器"></a>客户与服务器</h2><p>要在不同的终端窗口运行客户和服务器，使它们能够相互通信。服务器输出显示了到来的连接和数据，以及发回给客户的响应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wait for a connection</span><br><span class="line">connection from  (&apos;127.0.0.1&apos;, 50124)</span><br><span class="line">received  abcdefghijklmnop</span><br><span class="line">sending data back to the client</span><br><span class="line">received  qrstuvwxyz</span><br><span class="line">sending data back to the client</span><br><span class="line">received</span><br><span class="line">no data from  (&apos;127.0.0.1&apos;, 50124)</span><br><span class="line">connection closed()</span><br><span class="line">wait for a connection</span><br></pre></td></tr></table></figure>
<p>客户端输出显示了来自服务器的响应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">connecting to server</span><br><span class="line">received  abcdefghijklmnop</span><br><span class="line">received  qrstuvwxyz</span><br><span class="line">socket closed</span><br></pre></td></tr></table></figure>
<h2 id="简易客户连接"><a href="#简易客户连接" class="headerlink" title="简易客户连接"></a>简易客户连接</h2><p>如何使用便利函数 <code>create_connection()</code> 来连接服务器，TCP/IP 客户可以省去几步。这个函数只有一个参数，这是一个包含服务器地址的二值元组，函数将由这个参数推导出用于连接的最佳地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">def get_constants(prefix):</span><br><span class="line">    return dict((getattr(socket, n), n) for n in dir(socket) if n.startswith(prefix))</span><br><span class="line"></span><br><span class="line">families = get_constants(&apos;AF_&apos;)</span><br><span class="line">types = get_constants(&apos;SOCK_&apos;)</span><br><span class="line">protocols = get_constants(&apos;IPPROTO_&apos;)</span><br><span class="line"></span><br><span class="line">sock = socket.create_connection((&apos;localhost&apos;, 10000))</span><br><span class="line">print &apos;Family: &apos;, families[sock.family]</span><br><span class="line">print &apos;Type: &apos;, types[sock.type]</span><br><span class="line">print &apos;Protocol: &apos;, protocols[sock.proto]</span><br><span class="line">print</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    message = &apos;This is the message, It will be repeated.&apos;</span><br><span class="line">    print &apos;sending &quot;%s&quot;&apos; % message</span><br><span class="line">    sock.sendall(message)</span><br><span class="line">    amount_received = 0</span><br><span class="line">    amount_expected = len(message)</span><br><span class="line">    while amount_received &lt; amount_expected:</span><br><span class="line">        data = sock.recv(16)</span><br><span class="line">        amount_received += len(data)</span><br><span class="line">        print &apos;received &quot;%s&quot;&apos; % data</span><br><span class="line">finally:</span><br><span class="line">    sock.close()</span><br><span class="line">    print &apos;socket closed&apos;</span><br></pre></td></tr></table></figure>
<p><code>create_connection()</code> 使用 <code>getaddrinfo()</code> 来查找候选连接参数，并返回一个打开的 socket，它的第一个配置可以成功创建一个连接。可以检查 family、type 和 proto 属性确定返回的 socket 类型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Family:  AF_INET</span><br><span class="line">Type:  SOCK_STREAM</span><br><span class="line">Protocol:  IPPROTO_TCP</span><br><span class="line"></span><br><span class="line">sending &quot;This is the message, It will be repeated.&quot;</span><br><span class="line">received &quot;This is the mess&quot;</span><br><span class="line">received &quot;age, It will be &quot;</span><br><span class="line">received &quot;repeated.&quot;</span><br><span class="line">socket closed</span><br></pre></td></tr></table></figure>
<h2 id="选择监听地址"><a href="#选择监听地址" class="headerlink" title="选择监听地址"></a>选择监听地址</h2><p>将服务器绑定到正确的地址很重要，这样客户才能与之通信。前面的例子都使用 <code>‘localhost’</code> 作为 IP 地址，这会限制为只能连接在同一服务器上运行的客户。可以使用服务器的一个公共地址，如 <code>gethostname()</code> 返回的值，从而允许其他主机连接。下面的例子修改了回应服务器，让它监听一个指定的地址，例如服务器地址 114.215.121.63 ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">server_address = (&apos;114.215.121.63&apos;, 10000)</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind(server_address)</span><br><span class="line">sock.listen(1)</span><br><span class="line">while True:</span><br><span class="line">    print &apos;wait for a connection&apos;</span><br><span class="line">    connection, client_address = sock.accept()</span><br><span class="line">    try:</span><br><span class="line">        print &apos;client connected: &apos;, client_address</span><br><span class="line">        while True:</span><br><span class="line">            data = connection.recv(16)</span><br><span class="line">            print &apos;received &apos;, data</span><br><span class="line">            if data:</span><br><span class="line">                connection.sendall(data)</span><br><span class="line">            else:</span><br><span class="line">                break</span><br><span class="line">    finally:</span><br><span class="line">        connection.close()</span><br></pre></td></tr></table></figure>
<p>测试之前，需要对客户程序做类似的修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">server_address = (&apos;114.215.121.63&apos;, 10000)</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">print &apos;connecting to server&apos;</span><br><span class="line">sock.connect(server_address)</span><br><span class="line">try:</span><br><span class="line">    message = &apos;This is the message, it will be repeat later.&apos;</span><br><span class="line">    print &apos;sending &quot;%s&quot;&apos; % message</span><br><span class="line">    sock.sendall(message)</span><br><span class="line">    amount_received = 0</span><br><span class="line">    amount_expected = len(message)</span><br><span class="line">    while amount_received &lt; amount_expected:</span><br><span class="line">        data = sock.recv(16)</span><br><span class="line">        amount_received += len(data)</span><br><span class="line">        print &apos;received &apos;, data</span><br><span class="line">finally:</span><br><span class="line">    print &apos;socket closed&apos;</span><br><span class="line">    sock.close()</span><br></pre></td></tr></table></figure>
<p>在服务器 114.215.121.63 上启动服务器程序，监听端口 10000。在另一个主机上运行客户端程序，会产生以下结果：</p>
<p>服务器端输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wait for a connection</span><br><span class="line">client connected:  (&apos;171.212.168.187&apos;, 50688)</span><br><span class="line">received  This is the mess</span><br><span class="line">received  age, it will be</span><br><span class="line">received  repeat later.</span><br><span class="line">received</span><br><span class="line">wait for a connection</span><br></pre></td></tr></table></figure>
<p>客户端输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">connecting to server</span><br><span class="line">sending &quot;This is the message, it will be repeat later.&quot;</span><br><span class="line">received  This is the mess</span><br><span class="line">received  age, it will be</span><br><span class="line">received  repeat later.</span><br><span class="line">socket closed</span><br></pre></td></tr></table></figure>
<p>很多服务器有不止一个网络接口，相应的会有不止一个 IP 地址。并不需要运行服务的不同副本分别绑定到各个 IP 地址，可以使用一个特殊的地址 <code>INADDR_ANY</code> 同时监听所有地址。socket 为 <code>INADDR_ANY</code> 定义了一个常量，这是一个整数值，但在传递到 <code>bind()</code> 之前必须将它转换为采用点记法的地址字符串。作为一种快捷方式，可以使用 ‘0.0.0.0’ 或者空串，而不是完成转换：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server_address = (&apos;&apos;, 10000)</span><br></pre></td></tr></table></figure>
<p>要看一个套接字使用的具体地址，可以调用其 <code>getsockname()</code> 方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">server_address = (&apos;&apos;, 10000)</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind(server_address)</span><br><span class="line">print &apos;starting up on %s, port %s&apos; % sock.getsockname()</span><br></pre></td></tr></table></figure>
<p>输出的套接字使用的具体地址如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">starting up on 0.0.0.0, port 10000</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[图像载入、显示、复制、新建和保存]]></title>
      <url>http://lizonghang.github.io/2016/07/17/OpenCV-Python%E5%85%A5%E9%97%A8/</url>
      <content type="html"><![CDATA[<p>OpenCV的全称是Open Source Computer Vision Library，是一个跨平台的计算机视觉库。OpenCV可用于开发实时的图像处理、计算机视觉以及模式识别程序。OpenCV可用于解决如下领域的问题：</p>
<ul>
<li>人机交互</li>
<li>物体识别</li>
<li>图像分区</li>
<li>人脸识别</li>
<li>动作识别</li>
<li>运动跟踪</li>
<li>机器人</li>
</ul>
<p>OpenCV可以在Windows, Android, Maemo, FreeBSD, OpenBSD, iOS, Linux和Mac OS等平台上运行。</p>
<p>OpenCV1.0时代的基于 C 语言接口而建的图像存储格式IplImage*，如果在退出前忘记release掉的话，就会照成内存泄露。这导致debug时越来越多的纠缠于内存管理，而不是着力解决开发目标。但自从OpenCV踏入2.0时代用Mat类数据结构作为主打之后，OpenCV变得越发像Matlab那样，上手非常快。甚至有些函数名称都和matlab一样，比如大家所熟知的imread，imwrite，imshow等函数。</p>
<p><code>cv::Mat</code>类是用于保存图像以及其他矩阵数据的数据结构。默认情况下，其尺寸为0，我们也可以指定初始尺寸,比如定义一个Mat类对象，就要写<code>cv::Mat pic(320,640,cv::Scalar(100));</code>。它是对应于OpenCV1.0时代的IplImage的主要用来存放图像的数据结构。</p>
<h1 id="读取并显示图像"><a href="#读取并显示图像" class="headerlink" title="读取并显示图像"></a>读取并显示图像</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">im = cv2.imread(&apos;lena.jpg&apos;) # 读取文件</span><br><span class="line">cv2.namedWindow(&apos;lena&apos;) # 创建窗口</span><br><span class="line">cv2.imshow(&apos;lena&apos;, im) # 在窗口显示图像</span><br><span class="line"># cv2.waitKey(10000) # 等待10s</span><br><span class="line">cv2.waitKey(0) # 保持等待直到按下任意键</span><br><span class="line">cv2.destroyAllWindows() # 释放窗口</span><br></pre></td></tr></table></figure>
<h1 id="创建-复制图像"><a href="#创建-复制图像" class="headerlink" title="创建/复制图像"></a>创建/复制图像</h1><p>新的OpenCV的接口中没有CreateImage接口，如果要创建图像，需要使用numpy的函数，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emptyImage = numpy.zeros(im.shape, numpy.uint8)</span><br></pre></td></tr></table></figure>
<p>图像使用NumPy数组的属性来表示图像的尺寸和通道信息。如果输出im.shape，将得到(750, 500, 3)，最后的3表示这是一个RGB图像。</p>
<p>也可以复制原图像得到新图像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tempImage = im.copy()</span><br></pre></td></tr></table></figure>
<p>还可以用cvtColor获得原图像的副本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tempImage = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)  </span><br><span class="line">tempImage[...] = 0 # 转成空白的黑色图像</span><br></pre></td></tr></table></figure>
<h1 id="保存图像"><a href="#保存图像" class="headerlink" title="保存图像"></a>保存图像</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.imwrite(&apos;/Users/mac/Desktop/temp.jpg&apos;, tempImage)</span><br></pre></td></tr></table></figure>
<p>imwrite()有第三个可选参数，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.imwrite(&apos;/Users/mac/Desktop/temp.jpg&apos;, tempImage, [int(cv2.IMWRITE_JPEG_QUALITY), 5])</span><br></pre></td></tr></table></figure>
<p>第三个参数针对特定的格式：</p>
<ul>
<li>对于JPEG，第三个参数表示的是图像的质量，用0-100的整数表示，默认为95。<code>cv2.IMWRITE_JPEG_QUALITY</code>类型为Long，必须转换成int。下面是以不同质量存储的两幅图：</li>
</ul>
<p>图像质量保存为5时：</p>
<p><img src="/images/temp_5.jpg" alt=""></p>
<p>图像质量保存为100时：</p>
<p><img src="/images/temp_100.jpg" alt=""></p>
<ul>
<li>对于PNG，第三个参数表示的是压缩级别。cv2.IMWRITE_PNG_COMPRESSION，从0到9,压缩级别越高，图像尺寸越小。默认级别为3：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cv2.imwrite(&quot;temp0.png&quot;, tempImage, [int(cv2.IMWRITE_PNG_COMPRESSION), 0])   </span><br><span class="line">cv2.imwrite(&quot;temp9.png&quot;, tempImage, [int(cv2.IMWRITE_PNG_COMPRESSION), 9])</span><br></pre></td></tr></table></figure>
<p>得到的图片存储大小分别为929KB和317KB</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Mac上安装python-opencv]]></title>
      <url>http://lizonghang.github.io/2016/07/16/Mac%E4%B8%8A%E5%AE%89%E8%A3%85python-opencv/</url>
      <content type="html"><![CDATA[<p>如何正确安装OpenCV历来是一个堪称玄学的问题，在成功安装OpenCV的道路上经历了种种艰辛，这真的是我最恶心的一次安装经历。下载源码并编译的方法就不说了，下面介绍较简易的使用Homebrew安装的方法。</p>
<p>第一步：安装OpenCV</p>
<p>直接使用命令<code>brew install opencv</code>是不行的，因为homebrew找不到它，会产生如下报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ brew install opencv</span><br><span class="line">Error: No available formula with the name &quot;opencv&quot;</span><br><span class="line">==&gt; Searching for similarly named formulae...</span><br><span class="line">Error: No similarly named formulae found.</span><br><span class="line">==&gt; Searching taps...</span><br><span class="line">These formulae were found in taps:</span><br><span class="line">homebrew/science/opencv                  homebrew/science/opencv3</span><br><span class="line">To install one of them, run (for example):</span><br><span class="line">  brew install homebrew/science/opencv</span><br><span class="line">==&gt; You haven&apos;t updated Homebrew in a while.</span><br><span class="line">A formula for opencv might have been added recently.</span><br><span class="line">Run `brew update` to get the latest Homebrew updates!</span><br></pre></td></tr></table></figure>
<p>你需要先将opencv所在的science分类加入homebrew的搜索列表中再尝试下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap homebrew/science</span><br><span class="line">$ brew install opencv</span><br></pre></td></tr></table></figure>
<p>请留意安装过程中的输出信息，最好保存一下，之后可能有用，确保opencv正确安装后就可以删掉了。</p>
<p>安装过程中自动为你安装好了以下库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">==&gt; Installing dependencies for homebrew/science/opencv: eigen, ilmbase,</span><br><span class="line">==&gt; Installing homebrew/science/opencv dependency: eigen</span><br><span class="line">🍺  /usr/local/Cellar/eigen/3.2.8: 368 files, 3.5M</span><br><span class="line">==&gt; Installing homebrew/science/opencv dependency: ilmbase</span><br><span class="line">🍺  /usr/local/Cellar/ilmbase/2.2.0: 362 files, 5.6M</span><br><span class="line">==&gt; Installing homebrew/science/opencv dependency: openexr</span><br><span class="line">🍺  /usr/local/Cellar/openexr/2.2.0: 131 files, 11.4M</span><br><span class="line">==&gt; Installing homebrew/science/opencv dependency: homebrew/python/numpy</span><br><span class="line">🍺  /usr/local/Cellar/numpy/1.11.1: 430 files, 9M</span><br><span class="line">==&gt; Installing homebrew/science/opencv</span><br><span class="line">🍺  /usr/local/Cellar/opencv/2.4.13: 276 files, 35.8M</span><br></pre></td></tr></table></figure>
<p>其中已为你安装好numpy，其版本为1.11.1，如果你此前已经通过pip安装过numpy了，那需要很多额外步骤。</p>
<p>进入python环境，测试opencv是否正确安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import cv2</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">ImportError: No module named cv2</span><br></pre></td></tr></table></figure>
<p>python找不到opencv，这就蛋疼了。翻看opencv的安装记录，有如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Python modules have been installed and Homebrew&apos;s site-packages is not</span><br><span class="line">in your Python sys.path, so you will not be able to import the modules</span><br><span class="line">this formula installed. If you plan to develop with these modules,</span><br><span class="line">please run:</span><br><span class="line">  mkdir -p /Users/mac/Library/Python/2.7/lib/python/site-packages</span><br><span class="line">  echo &apos;import site; site.addsitedir(&quot;/usr/local/lib/python2.7/site-packages&quot;)&apos; &gt;&gt; /Users/mac/Library/Python/2.7/lib/python/site-packages/homebrew.pth</span><br></pre></td></tr></table></figure>
<p>Homebrew的site-packages不在python的sys.path路径中，所以python无法导入安装好的opencv模块，如果想要python能够找到，执行下面的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /Users/mac/Library/Python/2.7/lib/python/site-packages</span><br><span class="line">$ echo &apos;import site; site.addsitedir(&quot;/usr/local/lib/python2.7/site-packages&quot;)&apos; &gt;&gt; /Users/mac/Library/Python/2.7/lib/python/site-packages/homebrew.pth</span><br></pre></td></tr></table></figure>
<p>再尝试<code>import cv2</code>，可能会有如下报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RuntimeError: module compiled against API version 0xa but this version of numpy is 0x9</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">ImportError: numpy.core.multiarray failed to import</span><br></pre></td></tr></table></figure>
<p>这是由于numpy版本过低导致的，可能是你系统中已经安装的numpy版本不能满足opencv的需求。并且没有提示找不到模块，所以python能正确找到opencv了。尝试<code>sudo pip uninstall numpy</code>，可能会有下面的报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Exception:</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/pip/basecommand.py&quot;, line 215, in main</span><br><span class="line">    status = self.run(options, args)</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/pip/commands/uninstall.py&quot;, line 76, in run</span><br><span class="line">    requirement_set.uninstall(auto_confirm=options.yes)</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/pip/req/req_set.py&quot;, line 336, in uninstall</span><br><span class="line">    req.uninstall(auto_confirm=auto_confirm)</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/pip/req/req_install.py&quot;, line 742, in uninstall</span><br><span class="line">    paths_to_remove.remove(auto_confirm)</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/pip/req/req_uninstall.py&quot;, line 115, in remove</span><br><span class="line">    renames(path, new_path)</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/pip/utils/__init__.py&quot;, line 267, in renames</span><br><span class="line">    shutil.move(old, new)</span><br><span class="line">  File &quot;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/shutil.py&quot;, line 302, in move</span><br><span class="line">    copy2(src, real_dst)</span><br><span class="line">  File &quot;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/shutil.py&quot;, line 131, in copy2</span><br><span class="line">    copystat(src, dst)</span><br><span class="line">  File &quot;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/shutil.py&quot;, line 103, in copystat</span><br><span class="line">    os.chflags(dst, st.st_flags)</span><br><span class="line">OSError: [Errno 1] Operation not permitted: &apos;/tmp/pip-8Z9Jmh-uninstall/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/numpy-1.8.0rc1-py2.7.egg-info&apos;</span><br><span class="line">The directory &apos;/Users/mac/Library/Caches/pip/http&apos; or its parent directory is not owned by the current user and the cache has been disabled. Please check the permissions and owner of that directory. If executing pip with sudo, you may want sudo&apos;s -H flag.</span><br></pre></td></tr></table></figure>
<p>并且，在使用<code>sudo pip install matplotlib</code>时也有类似的报错。可以改成<code>sudo pip install --ignore-installed matplotlib</code>试试。</p>
<p>这是由于System Integrity Protection导致的，需要关闭保护SIP，否则即时加了sudo也没用，尝试卸载和升级都需要关闭保护SIP。后面会介绍一种更简单的方法，这一段可略过。具体操作如下：</p>
<ol>
<li>重启电脑，电脑启动的时候按住command+R</li>
<li>等画面上显示苹果logo后会看到[OS X 工具程式]窗口，选择终端，要把键盘按下去，不要轻按</li>
<li>终端打开后输入<code>csrutil disable</code>，之后重启</li>
</ol>
<p>重启之后再升级或重装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install --upgrade numpy</span><br></pre></td></tr></table></figure>
<p>另一种更简单的方式和安装opencv时一样隐藏在安装信息中，就在opencv路径信息的上一段里，执行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;import sys; sys.path.insert(1, &quot;/usr/local/lib/python2.7/site-packages&quot;)&apos; &gt;&gt; /Users/mac/Library/Python/2.7/lib/python/site-packages/homebrew.pth</span><br></pre></td></tr></table></figure>
<p>由于<code>mkdir -p /Users/mac/Library/Python/2.7/lib/python/site-packages</code>之前已经创建过了，可以不再创建。执行完命令后，重启一下终端，再进入python环境测试是否能正确导入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import cv2</span><br><span class="line">&gt;&gt;&gt; import numpy</span><br><span class="line">&gt;&gt;&gt; from matplotlib import pyplot</span><br></pre></td></tr></table></figure>
<p>本机异常已消除，若还有其他异常，请另行寻找解决方法。以下是本机安装的版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print cv2.__version__</span><br><span class="line">2.4.13</span><br><span class="line">&gt;&gt;&gt; print numpy.__version__</span><br><span class="line">1.11.1</span><br><span class="line">&gt;&gt;&gt; print matplotlib.__version__</span><br><span class="line">1.3.1</span><br></pre></td></tr></table></figure>
<p>希望这篇文章能帮助你脱离玄学的道路。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[儿童锁屏幕监测报警]]></title>
      <url>http://lizonghang.github.io/2016/07/15/%E5%84%BF%E7%AB%A5%E9%94%81%E5%B1%8F%E5%B9%95%E7%9B%91%E6%B5%8B%E6%8A%A5%E8%AD%A6/</url>
      <content type="html"><![CDATA[<p>这是一个丧尽天良的程序，用于家长对孩子使用电脑时的监控，当程序发现屏幕上出现了疑似色情的图片/视频时，将屏幕进行截图保存并邮件通知家长，也能判断出程序是否正常退出。可以设置采样间隔与监控时间，可以设置截图保存路径与图片尺寸。</p>
<p>假设文件名为ScreenScrape.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># encoding: utf-8</span><br><span class="line">from PIL import Image, ImageGrab</span><br><span class="line">import time</span><br><span class="line">import argparse</span><br><span class="line">import smtplib</span><br><span class="line">from email import encoders</span><br><span class="line">from email.header import Header</span><br><span class="line">from email.mime.text import MIMEText</span><br><span class="line">from email.utils import parseaddr, formataddr</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(&apos;p&apos;, help=&apos;Path to Save the Images.&apos;)</span><br><span class="line">parser.add_argument(&apos;-W&apos;, help=&apos;Width of the Scraped Images&apos;, default=1000)</span><br><span class="line">parser.add_argument(&apos;-H&apos;, help=&apos;Height of the Scraped Images.&apos;, default=600)</span><br><span class="line">parser.add_argument(&apos;-d&apos;, help=&apos;Scrape Duration(Minute).&apos;, default=1)</span><br><span class="line">parser.add_argument(&apos;-t&apos;, help=&apos;Total Scrape Time(Minute)&apos;, default=30)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"># 图片存放路径、图片尺寸、检测间隔、检测时长</span><br><span class="line">path, width, height, duration, totalTime = args.p, int(args.W), int(args.H), float(args.d), float(args.t)</span><br><span class="line"></span><br><span class="line">message = u&apos;屏幕检测到异常截图，请及时查看您的电脑&apos;</span><br><span class="line">fromUser = &apos;user_to_send_email&apos;</span><br><span class="line">password = &apos;vaelgxgnybtlbafd&apos; # 开启SMTP/POP3等，获得的校验码为密码，不是登陆密码</span><br><span class="line">toUser = &apos;user_to_receive_email&apos;</span><br><span class="line">smtp_server = &apos;smtp.qq.com&apos; # 可以是其他邮件代理服务器</span><br><span class="line"></span><br><span class="line">send_once = False # 只发送一次邮件</span><br><span class="line"></span><br><span class="line">start_time = int(time.time())</span><br><span class="line">def inTotalTime():</span><br><span class="line">    &apos;&apos;&apos;判断检测时间是否到时，上限时间totalTime&apos;&apos;&apos;</span><br><span class="line">    now_time = int(time.time())</span><br><span class="line">    elapseTimeByMinutes = (now_time - start_time) / 60.0</span><br><span class="line">    if elapseTimeByMinutes &lt; totalTime:</span><br><span class="line">        return True</span><br><span class="line">    else:</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">def _format_addr(s):</span><br><span class="line">    &apos;&apos;&apos;调整邮件信息格式&apos;&apos;&apos;</span><br><span class="line">    name, addr = parseaddr(s)</span><br><span class="line">    return formataddr((Header(name, &apos;utf-8&apos;).encode(), addr.encode(&apos;utf-8&apos;) if isinstance(addr, unicode) else addr))</span><br><span class="line"></span><br><span class="line">def sendMessage(message, fromUser, password, toUser, smtp_server):</span><br><span class="line">    &apos;&apos;&apos;发送邮件&apos;&apos;&apos;</span><br><span class="line">    msg = MIMEText(message, &apos;plain&apos;, &apos;utf-8&apos;)</span><br><span class="line">    # 下面三项不标明可能被当作垃圾邮件，导致接收方收不到邮件</span><br><span class="line">    msg[&apos;From&apos;] = _format_addr(u&apos;Mac管理员-%s&apos; % fromUser) # 邮件中标明发件人</span><br><span class="line">    msg[&apos;To&apos;] = _format_addr(u&apos;家长-%s&apos; % toUser) # 邮件中标明收件人</span><br><span class="line">    msg[&apos;Subject&apos;] = Header(u&apos;屏幕监测报告&apos;, &apos;utf-8&apos;).encode() # 邮件标题</span><br><span class="line">    server = smtplib.SMTP_SSL(smtp_server, 465)</span><br><span class="line">    # server.set_debuglevel(1) # 发送邮件过程中的详细信息</span><br><span class="line">    server.login(fromUser, password)</span><br><span class="line">    server.sendmail(fromUser, toUser, msg.as_string())</span><br><span class="line">    server.quit()</span><br><span class="line"></span><br><span class="line">def handleRudeImage(im):</span><br><span class="line">    &apos;&apos;&apos;保存截图并发送邮件通知&apos;&apos;&apos;</span><br><span class="line">    filename = str(int(time.time())) + &apos;.jpg&apos;</span><br><span class="line">    im.save(path+filename, &apos;JPEG&apos;)</span><br><span class="line">    global send_once</span><br><span class="line">    if not send_once:</span><br><span class="line">        sendMessage(message, fromUser, password, toUser, smtp_server)</span><br><span class="line">        send_once = True</span><br><span class="line"></span><br><span class="line">def screenScrape():</span><br><span class="line">    &apos;&apos;&apos;屏幕截取、鉴黄与处置&apos;&apos;&apos;</span><br><span class="line">    im = ImageGrab.grab().resize((width, height)).convert(&apos;YCbCr&apos;)</span><br><span class="line">    w, h = im.size</span><br><span class="line">    sx = im.getdata()</span><br><span class="line">    count = 0</span><br><span class="line">    for i, ycbcr in enumerate(sx):</span><br><span class="line">        y, cb, cr = ycbcr</span><br><span class="line">        if 86 &lt;= cb &lt;= 117 and 140 &lt;= cr &lt;= 168:</span><br><span class="line">            count += 1</span><br><span class="line">    if count &gt; w * h * 0.3:</span><br><span class="line">        handleRudeImage(im)</span><br><span class="line">#        print &apos;Sexy Playing&apos;</span><br><span class="line">#    else:</span><br><span class="line">#        print &apos;Normal&apos;</span><br><span class="line">    im.close()</span><br><span class="line"></span><br><span class="line">while inTotalTime():</span><br><span class="line">    time.sleep(duration*60) # 间隔duration分钟对屏幕采样</span><br><span class="line">    screenScrape()</span><br><span class="line"></span><br><span class="line"># 程序正常退出提醒</span><br><span class="line">sendMessage(u&apos;监控程序正常退出&apos;, fromUser, password, toUser, smtp_server)</span><br></pre></td></tr></table></figure>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python ScreenScrape.py path [-W Width] [-H Height] [-d duration] [-t totalTime]</span><br></pre></td></tr></table></figure>
<ul>
<li>path - 存放截图的文件夹，必选</li>
<li>Width - 存储截图时的截图宽度，可选</li>
<li>Height - 存储截图时的截图高度，可选</li>
<li>duration - 采样周期，单位min，可选</li>
<li>totalTime - 监控时长，单位min，可选</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[多张图片合成GIF图]]></title>
      <url>http://lizonghang.github.io/2016/07/14/%E5%A4%9A%E5%BC%A0%E5%9B%BE%E7%89%87%E5%90%88%E6%88%90GIF%E5%9B%BE/</url>
      <content type="html"><![CDATA[<h1 id="需要的库"><a href="#需要的库" class="headerlink" title="需要的库"></a>需要的库</h1><h2 id="PIL"><a href="#PIL" class="headerlink" title="PIL"></a>PIL</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install Pillow</span><br></pre></td></tr></table></figure>
<h2 id="images2gif"><a href="#images2gif" class="headerlink" title="images2gif"></a>images2gif</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install images2gif</span><br></pre></td></tr></table></figure>
<h1 id="图片素材"><a href="#图片素材" class="headerlink" title="图片素材"></a>图片素材</h1><p>将以下gif图分割为多张静态PNG格式图，并以这些PNG图为例：</p>
<p><img src="/images/niko.gif" alt=""></p>
<h1 id="帧分割"><a href="#帧分割" class="headerlink" title="帧分割"></a>帧分割</h1><p>由于需要将图片按顺序进行合成，需要将图片在文件夹中顺序排列。假设文件名为split.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">im = Image.open(&apos;niko.gif&apos;)</span><br><span class="line">im.seek(0)</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    while True:</span><br><span class="line">        im.save(&apos;./nikos/&apos; + chr(im.tell() + ord(&apos;a&apos;))  + &apos;.png&apos;, &apos;PNG&apos;)</span><br><span class="line">        im.seek(im.tell()+1)</span><br><span class="line">except EOFError, msg:</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<p>执行分割GIF图程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python split.py</span><br></pre></td></tr></table></figure>
<p>将得到的图片放置于nikos/文件夹中</p>
<h1 id="帧合成"><a href="#帧合成" class="headerlink" title="帧合成"></a>帧合成</h1><p>假设文件名为GetGifAnimation.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">#encoding: utf-8</span><br><span class="line">from PIL import Image</span><br><span class="line">import os</span><br><span class="line">import images2gif</span><br><span class="line">import argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(&apos;image_path&apos;, help=&apos;The Path to Source Images, to Create the Gif Animation.&apos;)</span><br><span class="line">parser.add_argument(&apos;-T&apos;, help=&apos;Target to Save the Gif&apos;, default=&apos;./generate.gif&apos;)</span><br><span class="line">parser.add_argument(&apos;-W&apos;, help=&apos;Width of the Gif&apos;, default=300)</span><br><span class="line">parser.add_argument(&apos;-H&apos;, help=&apos;Height of the Gif&apos;, default=281)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">srcImageFilePath = args.image_path</span><br><span class="line">if srcImageFilePath.split(&apos;/&apos;)[-1]:</span><br><span class="line">    srcImageFilePath += &apos;/&apos;</span><br><span class="line">targetGIFPath = args.T</span><br><span class="line">targetGIFWidth = args.W</span><br><span class="line">targetGIFHeight = args.H</span><br><span class="line">targetSize = (targetGIFWidth, targetGIFHeight)</span><br><span class="line"></span><br><span class="line">def GetGifAnimationFromImages(srcImageFilePath):</span><br><span class="line">    images = []</span><br><span class="line">    for item in os.listdir(srcImageFilePath):</span><br><span class="line">        suffix = item.split(&apos;.&apos;)[-1]</span><br><span class="line">        if suffix == &apos;png&apos;:</span><br><span class="line">            images.append(Image.open(srcImageFilePath + item).resize(targetSize))</span><br><span class="line">    images2gif.writeGif(targetGIFPath, images, duration=0.1, nq=0.1)</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    GetGifAnimationFromImages(srcImageFilePath)</span><br></pre></td></tr></table></figure>
<h1 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python GetGifAnimation.py &lt;path-to-images&gt; [-T targetGIFPath] [-W targetGIFWidth] [-H targetGIFHeight]</span><br></pre></td></tr></table></figure>
<p>合成的gif图为generate.gif</p>
<h1 id="可能出现的错误"><a href="#可能出现的错误" class="headerlink" title="可能出现的错误"></a>可能出现的错误</h1><h2 id="TypeError"><a href="#TypeError" class="headerlink" title="TypeError"></a>TypeError</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;images2gif.py&quot;, line 436, in writeGifToFile</span><br><span class="line">  fp.write(globalPalette)</span><br><span class="line">TypeError: must be string or buffer, not None</span><br></pre></td></tr></table></figure>
<p>将images2gif.py文件中的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for im in images:</span><br><span class="line">    palettes.append( getheader(im)[1] )</span><br></pre></td></tr></table></figure>
<p>更改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for im in images:</span><br><span class="line">    palettes.append(im.palette.getdata()[1])</span><br></pre></td></tr></table></figure>
<h2 id="ValueError"><a href="#ValueError" class="headerlink" title="ValueError"></a>ValueError</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;./GetGifAnimation.py&quot;, line 31, in &lt;module&gt;</span><br><span class="line">    GetGifAnimationFromImages(srcImageFilePath)</span><br><span class="line">  File &quot;./GetGifAnimation.py&quot;, line 28, in GetGifAnimationFromImages</span><br><span class="line">    images2gif.writeGif(targetGIFPath, images, duration=0.1, nq=0.1)</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/images2gif/images2gif.py&quot;, line 572, in writeGif</span><br><span class="line">    images, xy, images_info = gifWriter.handleSubRectangles(images, subRectangles)</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/images2gif/images2gif.py&quot;, line 295, in handleSubRectangles</span><br><span class="line">    images, xy = self.getSubRectangles(images)</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/images2gif/images2gif.py&quot;, line 332, in getSubRectangles</span><br><span class="line">    diff = np.abs(im-prev)</span><br><span class="line">ValueError: operands could not be broadcast together with shapes (281,300,4) (281,300,3)</span><br></pre></td></tr></table></figure>
<p>错误的原因是存在png图片（a.png）不含有alpha通道，可能是分割GIF图时PIL库中代码导致透明通道丢失。可以手动将图片导出为带alpha通道的PNG图片，ValueError即解除。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[socket网络通信——寻址、协议簇和套接字类型]]></title>
      <url>http://lizonghang.github.io/2016/07/14/socket%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E2%80%94%E2%80%94%E5%AF%BB%E5%9D%80%E3%80%81%E5%8D%8F%E8%AE%AE%E7%B0%87%E5%92%8C%E5%A5%97%E6%8E%A5%E5%AD%97%E7%B1%BB%E5%9E%8B/</url>
      <content type="html"><![CDATA[<p>&emsp;&emsp;socket模块提供了一个底层C API，可以使用BSD套接字接口实现网络通信。它包括socket类，用于处理具体的数据通道，还包括用于完成网络相关任务的函数，如将一个服务器名称转换为一个地址，以及格式化数据以便在网络上发送。</p>
<h1 id="寻址、协议簇和套接字类型"><a href="#寻址、协议簇和套接字类型" class="headerlink" title="寻址、协议簇和套接字类型"></a>寻址、协议簇和套接字类型</h1><p>&emsp;&emsp;套接字（socket）是程序在本地或者通过互联网来回传递数据时所用通信通道的一个端点。套接字有两个主要属性来控制如何发送数据：地址簇（address family）控制所用的OSI网络层协议，套接字类型（socket type）控制传输层协议。</p>
<p>&emsp;&emsp;Python支持3个地址簇。最常用的是AF_INET，用于IPv4 Internet寻址。IPv4地址长度为4个字节，通常表示为4个数的序列，每个字节对应一个数，用点号分隔（如10.1.1.5和127.0.0.1）。这些值通常被称为“IP地址”。目前几乎所有互联网网络应用都使用IPv4.</p>
<p>&emsp;&emsp;AF_INET6用于IPv6 Internet寻址。IPv6是下一代Internet协议。它支持128位地址和通信流调整，还支持IPv4所不支持的一些路由特性。目前采用IPv6的应用还很有限，不过在不断增长。</p>
<p>&emsp;&emsp;AF_UNIX是UNIX域套接字（UNIX Domain Sockets， UDS）的地址簇，这是一种POSIX兼容系统上的进程间通信协议。UDS的实现通常允许操作系统直接从进程向进程传递数据，而不用通过网络栈。这比使用AF_INET更高效，但是由于要用文件系统作为寻址的命名空间，UDS仅限于同一个系统上的进程。相比其他IPC机制（如命名管道或共享内存），使用UDS的优势在于它与IP网络应用的编程接口是一样的。这说明应用在单个主机上运行时可以利用高效的通信，在网络上发送数据时仍然可以使用同样的代码。</p>
<pre>注意：AF_UNIX常量仅在支持UDS的系统上定义。</pre>

<p>&emsp;&emsp;套接字类型往往是SOCK_DGRAM或SOCK_STREAM，SOCK_DGRAM对应用户数据报协议（user datagram protocol，UDP），SOCK_STREAM对应传输控制协议（transmission control protocol，TCP）。UDP不需要传输握手过程或其他设置过程（setup），但是提供的传输可靠性较低。UDP消息可能乱序传送，也可能传送多次，或者根本不传送。TCP则相反，可以确保每个消息只传送一次，而且按正确的顺序传送。不过，由于增加了可靠性，可能会引入额外的延迟，因为数据报可能需要重新传输。大多数传送大量数据的应用协议（如HTTP）都建立在TCP基础上。UDP通常用于顺序不太重要的协议（因为消息可以放在一个数据包中，例如DNS），或者用于广播（向多个主机发送相同的数据）。</p>
<h2 id="在网络上查找主机"><a href="#在网络上查找主机" class="headerlink" title="在网络上查找主机"></a>在网络上查找主机</h2><p>&emsp;&emsp;socket包含一些函数与网络上的域名服务交互，使得程序可以将服务器的主机名转换为其数字网络地址。应用使用地址来连接一个服务器之前不需要显式转换地址，不过报告错误时除了报告所用的名字之外，还包含这个数字地址会很有用。</p>
<h3 id="socket-gethostname"><a href="#socket-gethostname" class="headerlink" title="socket.gethostname()"></a>socket.gethostname()</h3><p>&emsp;&emsp;要查找当前主机的名字，可以使用<code>gethostname()</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import socket</span><br><span class="line">&gt;&gt;&gt; print socket.gethostname()</span><br><span class="line">macdeMacBook-Pro.local</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;返回的名字取决于当前系统的网络设置，在不同的网络上返回的名字可能有变化（如一个连接到WLAN的笔记本电脑）。</p>
<h3 id="socket-gethostbyname"><a href="#socket-gethostbyname" class="headerlink" title="socket.gethostbyname()"></a>socket.gethostbyname()</h3><p>&emsp;&emsp;下面使用<code>gethostbyname()</code>访问操作系统主机名解析API，将服务器名字转换为其数字地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import socket</span><br><span class="line">&gt;&gt;&gt; for host in [&apos;homer&apos;, &apos;www&apos;, &apos;www.python.org&apos;, socket.gethostname()]:</span><br><span class="line">...     try:</span><br><span class="line">...             print &apos;%s : %s&apos; % (host, socket.gethostbyname(host))</span><br><span class="line">...     except socket.error, msg:</span><br><span class="line">...             print &apos;%s : %s&apos; % (host, msg)</span><br><span class="line">... </span><br><span class="line">homer : [Errno 8] nodename nor servname provided, or not known</span><br><span class="line">www : [Errno 8] nodename nor servname provided, or not known</span><br><span class="line">www.python.org : 151.101.36.223</span><br><span class="line">macdeMacBook-Pro.local : 192.168.0.101</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果当前系统的DNS配置在搜索中包括一个或多个域，名字（name）参数不要求是完全限定名（不需要包含域名和基名）。如果一个名字无法找到，会产生一个socket.error类型的异常。</p>
<h3 id="socket-gethostbyname-ex"><a href="#socket-gethostbyname-ex" class="headerlink" title="socket.gethostbyname_ex()"></a>socket.gethostbyname_ex()</h3><p>&emsp;&emsp;要访问有关服务器的更多命名信息，可以使用函数<code>gethostbyname_ex()</code>，它会返回服务器的标准主机名、所有别名，以及可以用来到达这个主机的所有可用IP地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import socket</span><br><span class="line">&gt;&gt;&gt; for host in [&apos;baidu.com&apos;, &apos;www.python.org&apos;, socket.gethostname(), &apos;nosuchname&apos;]:</span><br><span class="line">...     print host</span><br><span class="line">...     try:</span><br><span class="line">...             hostname, aliases, addresses = socket.gethostbyname_ex(host)</span><br><span class="line">...             print &apos; Hostname:&apos;, hostname</span><br><span class="line">...             print &apos; Aliases:&apos;, aliases</span><br><span class="line">...             print &apos; Addresses:&apos;, addresses</span><br><span class="line">...     except socket.error as msg:</span><br><span class="line">...             print &apos;ERROR:&apos;, msg</span><br><span class="line">...     print</span><br><span class="line">...</span><br><span class="line">baidu.com</span><br><span class="line"> Hostname: baidu.com</span><br><span class="line"> Aliases: []</span><br><span class="line"> Addresses: [&apos;111.13.101.208&apos;, &apos;123.125.114.144&apos;, &apos;180.149.132.47&apos;, &apos;220.181.57.217&apos;]</span><br><span class="line"></span><br><span class="line">www.python.org</span><br><span class="line"> Hostname: prod.python.map.fastlylb.net</span><br><span class="line"> Aliases: [&apos;www.python.org&apos;, &apos;python.map.fastly.net&apos;]</span><br><span class="line"> Addresses: [&apos;151.101.16.223&apos;]</span><br><span class="line"></span><br><span class="line">macdeMacBook-Pro.local</span><br><span class="line"> Hostname: macdemacbook-pro.local</span><br><span class="line"> Aliases: []</span><br><span class="line"> Addresses: [&apos;10.200.55.2&apos;, &apos;10.57.129.2&apos;, &apos;192.168.0.103&apos;]</span><br><span class="line"></span><br><span class="line">nosuchname</span><br><span class="line">ERROR: [Errno 8] nodename nor servname provided, or not known</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果能得到一个服务器的所有已知IP地址，客户端就可以实现其自己的负载平衡或故障恢复算法。</p>
<h3 id="socket-gethostbyaddr"><a href="#socket-gethostbyaddr" class="headerlink" title="socket.gethostbyaddr()"></a>socket.gethostbyaddr()</h3><p>&emsp;&emsp;如果得到一个服务器的地址，可以使用<code>gethostbyaddr()</code>完成一个逆向查找来得到主机名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import socket</span><br><span class="line">&gt;&gt;&gt; hostname, aliases, addresses = socket.gethostbyaddr(&apos;127.0.0.1&apos;)</span><br><span class="line">&gt;&gt;&gt; print &apos;Hostname: %s\nAliases: %s\nAddresses: %s&apos; % (hostname, aliases, addresses)</span><br><span class="line">Hostname: localhost</span><br><span class="line">Aliases: [&apos;1.0.0.127.in-addr.arpa&apos;]</span><br><span class="line">Addresses: [&apos;127.0.0.1&apos;]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;返回值是一个元组，其中包含完全主机名、所有别名、以及与这个名字关联的所有IP地址。</p>
<h2 id="查找服务信息"><a href="#查找服务信息" class="headerlink" title="查找服务信息"></a>查找服务信息</h2><p>&emsp;&emsp;除了IP地址之外，每个套接字地址还包括一个整数端口号（port number）。很多应用可以在用一个端口上运行并监听一个IP地址，不过一次只有一个套接字可以使用该地址端口。通过结合IP地址、协议和端口号，可以唯一的标识一个通信通道，确保通过一个套接字发送的消息可以到达正确的目标。</p>
<h3 id="socket-getservbyname"><a href="#socket-getservbyname" class="headerlink" title="socket.getservbyname()"></a>socket.getservbyname()</h3><p>&emsp;&emsp;有些端口号已经预先分配给某个特定的协议。例如，使用SMTP的 email 服务器使用 TCP 在端口25相互通信，Web 客户和服务器使用 80 作为 HTTP 的端口号。网络服务的端口号和标准名可以使用 <code>getservbyname()</code> 查找：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print socket.getservbyname(&apos;ftp&apos;)</span><br><span class="line">21</span><br><span class="line">&gt;&gt;&gt; print socket.getservbyname(&apos;https&apos;)</span><br><span class="line">443</span><br><span class="line">&gt;&gt;&gt; print socket.getservbyname(&apos;http&apos;)</span><br><span class="line">80</span><br><span class="line">&gt;&gt;&gt; print socket.getservbyname(&apos;smtp&apos;)</span><br><span class="line">25</span><br></pre></td></tr></table></figure>
<h3 id="socket-getservbyport"><a href="#socket-getservbyport" class="headerlink" title="socket.getservbyport()"></a>socket.getservbyport()</h3><p>要逆向完成服务端口查找，可以使用 <code>getservbyport</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print socket.getservbyport(80)</span><br><span class="line">http</span><br></pre></td></tr></table></figure>
<h3 id="socket-getprotobyname"><a href="#socket-getprotobyname" class="headerlink" title="socket.getprotobyname()"></a>socket.getprotobyname()</h3><p>可以使用 <code>getprotobyname()</code> 获取分配给一个传输协议的端口号：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print socket.getprotobyname(&apos;tcp&apos;)</span><br><span class="line">6</span><br><span class="line">&gt;&gt;&gt; print socket.getprotobyname(&apos;udp&apos;)</span><br><span class="line">17</span><br><span class="line">&gt;&gt;&gt; print socket.getprotobyname(&apos;icmp&apos;)</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>协议码值是标准化的，作为常量在 socket 中定义，这些协议码都有前缀 <code>IPPROTO_</code>：</p>
<ul>
<li>TCP - <code>socket.IPPROTO_TCP = 6</code></li>
<li>UDP - <code>socket.IPPROTO_UDP = 17</code></li>
<li>ICMP - <code>socket.IPPROTO_ICMP = 1</code> </li>
</ul>
<h2 id="查找服务器地址"><a href="#查找服务器地址" class="headerlink" title="查找服务器地址"></a>查找服务器地址</h2><h3 id="socket-getaddrinfo"><a href="#socket-getaddrinfo" class="headerlink" title="socket.getaddrinfo()"></a>socket.getaddrinfo()</h3><p><code>getaddrinfo()</code> 将一个服务的基本地址转换为一个元组列表，其中包含建立一个连接所需的全部信息。每个元组的内容会有变化，包含不同的网络簇或协议：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print socket.getaddrinfo(&apos;www.python.org&apos;, &apos;http&apos;)</span><br><span class="line">[(2, 2, 17, &apos;&apos;, (&apos;151.101.36.223&apos;, 80)), (2, 1, 6, &apos;&apos;, (&apos;151.101.36.223&apos;, 80))]</span><br></pre></td></tr></table></figure>
<p>下面的程序将解释上述元素的含义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">def get_constants(prefix):</span><br><span class="line">	return dict((getattr(socket, n), n) for n in dir(socket) if n.startswith(prefix))</span><br><span class="line"></span><br><span class="line">families = get_constants(&apos;AF_&apos;)</span><br><span class="line">types = get_constants(&apos;SOCK_&apos;)</span><br><span class="line">protocols = get_constants(&apos;IPPROTO_&apos;)</span><br><span class="line">response = socket.getaddrinfo(&apos;www.python.org&apos;, &apos;http&apos;)</span><br><span class="line">for family, socktype, proto, canonname, sockaddr in response:</span><br><span class="line">	print &apos;Family		:&apos;, families[family]</span><br><span class="line">	print &apos;Type		:&apos;, types[socktype]</span><br><span class="line">	print &apos;Protocol	:&apos;, protocols[proto]</span><br><span class="line">	print &apos;Canonical Name	:&apos;, canonname</span><br><span class="line">	print &apos;Socket Address	:&apos;, sockaddr</span><br><span class="line">	print</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Family		: AF_INET</span><br><span class="line">Type		: SOCK_DGRAM</span><br><span class="line">Protocol	: IPPROTO_UDP</span><br><span class="line">Canonical Name	:</span><br><span class="line">Socket Address	: (&apos;151.101.16.223&apos;, 80)</span><br><span class="line"></span><br><span class="line">Family		: AF_INET</span><br><span class="line">Type		: SOCK_STREAM</span><br><span class="line">Protocol	: IPPROTO_TCP</span><br><span class="line">Canonical Name	:</span><br><span class="line">Socket Address	: (&apos;151.101.16.223&apos;, 80)</span><br></pre></td></tr></table></figure>
<p><code>getaddrinfo()</code> 有多个参数来过滤结果列表。例子中给出的主机和端口值是必要参数。可选参数包括 family、socktype、proto 和 flags。这些可选值可以取 0 或 socket 定义的某个常量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = socket.getaddrinfo(&apos;www.python.org&apos;, &apos;http&apos;, socket.AF_INET, socket.SOCK_STREAM, socket.IPPROTO_TCP, socket.AI_CANONNAME)</span><br></pre></td></tr></table></figure>
<p>这一次由于标志（flags）包括 <code>AI_CONONNAME</code>，如果这个主机有别名，结果中会包含服务器的标准名（可能与查找所用的值不同）。如果没有这个标志，标准名值则为空。</p>
<h2 id="IP地址表示"><a href="#IP地址表示" class="headerlink" title="IP地址表示"></a>IP地址表示</h2><h3 id="socket-inet-aton-和socket-inet-ntoa"><a href="#socket-inet-aton-和socket-inet-ntoa" class="headerlink" title="socket.inet_aton()和socket.inet_ntoa()"></a>socket.inet_aton()和socket.inet_ntoa()</h3><p>用 C 编写的网络程序使用数据类型 struct sockaddr 将 IP 地址表示为二进制值（而不是Python程序中常见的地址）。要在 Python 表示和 C 表示之间转换 IPv4 地址，可以使用 <code>inet_aton()</code> 和 <code>inet_ntoa()</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import binascii</span><br><span class="line">import socket</span><br><span class="line">import struct</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">for string_address in [&apos;192.168.1.1&apos;, &apos;127.0.0.1&apos;]:</span><br><span class="line">    packed = socket.inet_aton(string_address)</span><br><span class="line">    print &apos;Original: &apos;, string_address</span><br><span class="line">    print &apos;Packed: &apos;, binascii.hexlify(packed)</span><br><span class="line">    print &apos;Unpacked: &apos;, socket.inet_ntoa(packed)</span><br><span class="line">    print</span><br></pre></td></tr></table></figure>
<p>数据包格式中的4个字节可以传递到C库、通过网络安全地传输，或者紧凑地保存在一个数据库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Original:  192.168.1.1</span><br><span class="line">Packed:  c0a80101</span><br><span class="line">Unpacked:  192.168.1.1</span><br><span class="line"></span><br><span class="line">Original:  127.0.0.1</span><br><span class="line">Packed:  7f000001</span><br><span class="line">Unpacked:  127.0.0.1</span><br></pre></td></tr></table></figure>
<h3 id="socket-inet-pton-和socket-inet-ntop"><a href="#socket-inet-pton-和socket-inet-ntop" class="headerlink" title="socket.inet_pton()和socket.inet_ntop()"></a>socket.inet_pton()和socket.inet_ntop()</h3><p>相关函数 <code>inet_pton()</code> 和 <code>inet_ntop()</code> 都能处理 IPv4 和 IPv6 地址，根据传入的地址簇参数生成适当的格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import binascii</span><br><span class="line">import socket</span><br><span class="line">import struct</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">string_address = &apos;2002:ac10:10a:1234:21e:52ff:fe74:40e&apos;</span><br><span class="line">packed = socket.inet_pton(socket.AF_INET6, string_address)</span><br><span class="line">print &apos;Original: &apos;, string_address</span><br><span class="line">print &apos;Packed: &apos;, binascii.hexlify(packed)</span><br><span class="line">print &apos;Unpacked: &apos;, socket.inet_ntop(socket.AF_INET6, packed)</span><br></pre></td></tr></table></figure>
<p>IPv6 地址已经是十六进制值，所以将打包版本转换为一个十六进制数系列时会生成一个与原值类似的串：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Original:  2002:ac10:10a:1234:21e:52ff:fe74:40e</span><br><span class="line">Packed:  2002ac10010a1234021e52fffe74040e</span><br><span class="line">Unpacked:  2002:ac10:10a:1234:21e:52ff:fe74:40e</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Python制作长图]]></title>
      <url>http://lizonghang.github.io/2016/07/14/Python%E5%88%B6%E4%BD%9C%E9%95%BF%E5%9B%BE/</url>
      <content type="html"><![CDATA[<p>代码功能将多张图片合并为一张长图，保持各子图比例相同。需要第三方库PIL和numpy。numpy是一个开源数字扩展库，可以用来处理大型矩阵。</p>
<h1 id="安装第三方库"><a href="#安装第三方库" class="headerlink" title="安装第三方库"></a>安装第三方库</h1><h2 id="安装PIL"><a href="#安装PIL" class="headerlink" title="安装PIL"></a>安装PIL</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install pillow</span><br></pre></td></tr></table></figure>
<h2 id="安装numpy"><a href="#安装numpy" class="headerlink" title="安装numpy"></a>安装numpy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install numpy</span><br></pre></td></tr></table></figure>
<h1 id="图片素材"><a href="#图片素材" class="headerlink" title="图片素材"></a>图片素材</h1><p>我们需要的图片素材有：</p>
<p><img src="/images/menbi1.jpg" alt=""><br><img src="/images/menbi2.jpg" alt=""><br><img src="/images/menbi3.jpg" alt=""><br><img src="/images/menbi4.jpg" alt=""><br><img src="/images/menbi5.jpg" alt=""><br><img src="/images/menbi6.jpg" alt=""><br><img src="/images/menbi7.jpg" alt=""></p>
<p>合成效果为：</p>
<p><img src="/images/MergeImage.jpg" alt=""></p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><p>假设文件名为merge.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># encoding: utf-8</span><br><span class="line">from PIL import Image</span><br><span class="line">import numpy</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">import random</span><br><span class="line">import argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(&apos;image_dir&apos;, help=&apos;Path to Image Direction&apos;)</span><br><span class="line">parser.add_argument(&apos;-w&apos;, help=&apos;Image Width&apos;, type=int, default=300)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">root = args.image_dir # 图片文件夹目录</span><br><span class="line">if root.split(&apos;/&apos;)[-1]:</span><br><span class="line">    root += &apos;/&apos;</span><br><span class="line">pxsize = args.w # 单张照片宽度</span><br><span class="line">images = [] # 存放所有照片路径</span><br><span class="line"></span><br><span class="line">def getPhotos():</span><br><span class="line">    &apos;&apos;&apos;获取所有照片的索引&apos;&apos;&apos;</span><br><span class="line">    image_num = 0</span><br><span class="line">    for im in os.listdir(root):</span><br><span class="line">        suffix = im.split(&apos;.&apos;)[-1]</span><br><span class="line">        if suffix == &apos;jpg&apos; or suffix == &apos;JPG&apos; or suffix == &apos;jpeg&apos; or suffix == &apos;png&apos;:</span><br><span class="line">            images.append(root + im)</span><br><span class="line">            image_num += 1</span><br><span class="line">    return image_num</span><br><span class="line"></span><br><span class="line">xnum = 1 # 行照片数目</span><br><span class="line">ynum = getPhotos() # 列照片数目</span><br><span class="line">if ynum &gt; 70:</span><br><span class="line">    print &apos;图片数目过多，最高70&apos;</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">def getTotalHeight():</span><br><span class="line">    &apos;&apos;&apos;获取合并图片总长&apos;&apos;&apos;</span><br><span class="line">    totalHeight = 0</span><br><span class="line">    for i in range(xnum):</span><br><span class="line">        for j in range(ynum): </span><br><span class="line">            totalHeight += len(transfer(images[j])) + 1</span><br><span class="line">    return totalHeight</span><br><span class="line"></span><br><span class="line">def transfer(img_path):</span><br><span class="line">    &apos;&apos;&apos;将图片尺寸等比例转换&apos;&apos;&apos;</span><br><span class="line">    im = Image.open(img_path)</span><br><span class="line">    rate = float(im.size[0]) / im.size[1]</span><br><span class="line">    target_width = pxsize</span><br><span class="line">    target_height = int(pxsize / rate)</span><br><span class="line">    im = im.resize((target_width, target_height))</span><br><span class="line">    return numpy.array(im)[:target_height, :target_width]</span><br><span class="line"></span><br><span class="line">def mergeImage():</span><br><span class="line">    &apos;&apos;&apos;合并图片&apos;&apos;&apos;</span><br><span class="line">    point = 0</span><br><span class="line">    I = numpy.array(Image.new(&apos;RGB&apos;, (pxsize, getTotalHeight()), (255,255,255)))</span><br><span class="line">    for i in range(xnum):</span><br><span class="line">        for j in range(ynum):</span><br><span class="line">            DA = transfer(images[j]) </span><br><span class="line">            I[point:point+len(DA), (i*pxsize):((i+1)*pxsize)] = DA</span><br><span class="line">            point += len(DA) + 1</span><br><span class="line">    Image.fromarray(I.astype(numpy.uint8)).save(&apos;MergeImage.jpg&apos;, &apos;JPEG&apos;)</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    getPhotos()</span><br><span class="line">    mergeImage()</span><br></pre></td></tr></table></figure>
<h1 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python merge.py &lt;path-to-image-file&gt; [-w width]</span><br></pre></td></tr></table></figure>
<ul>
<li>path-to-image-file - 必选，指向存放要合并的图片的文件夹</li>
<li>-w width - 可选，指定生成图片的宽度，默认为300px</li>
<li>默认生成图片存放路径为文件merge.py同级目录</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Python中执行JS命令]]></title>
      <url>http://lizonghang.github.io/2016/07/10/Python%E4%B8%AD%E6%89%A7%E8%A1%8CJS%E5%91%BD%E4%BB%A4/</url>
      <content type="html"><![CDATA[<ul>
<li>自动将Javascipt代码翻译成Python代码 - 支持全部ECMA Scipt 5.1</li>
<li>可使用<code>pyimport</code>语法从Javascript代码中导入Python库</li>
<li>解释速度快，可作为独立的JS解释器</li>
<li>友好的JS执行方式，<code>js2py.eval_js</code></li>
</ul>
<h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install js2py</span><br></pre></td></tr></table></figure>
<h1 id="Simple-Example"><a href="#Simple-Example" class="headerlink" title="Simple Example"></a>Simple Example</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import js2py</span><br><span class="line">&gt;&gt;&gt; js2py.eval_js(&apos;console.log(&quot;Hello World!&quot;)&apos;)</span><br><span class="line">&apos;Hello World!&apos;</span><br><span class="line">&gt;&gt;&gt; add = js2py.eval_js(&apos;function add(a,b)&#123;return a+b&#125;&apos;)</span><br><span class="line">&gt;&gt;&gt; add</span><br><span class="line">&apos;function add(a, b) &#123; [python code] &#125;&apos;</span><br><span class="line">&gt;&gt;&gt; add(1,2) + 3</span><br><span class="line">6</span><br><span class="line">&gt;&gt;&gt; add.constructor</span><br><span class="line">&apos;function Function() &#123; [python code] &#125;&apos;</span><br><span class="line">&gt;&gt;&gt; js2py.eval_js(&quot;Object.prototype.toString.call(Function(&apos;s&apos;, &apos;return s+arguments[1]&apos;)(new Date(), 7).__proto__)&quot;)</span><br><span class="line">&apos;[object String]&apos;</span><br></pre></td></tr></table></figure>
<h1 id="More-advanced-usage-example"><a href="#More-advanced-usage-example" class="headerlink" title="More advanced usage example"></a>More advanced usage example</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Adding Python built-in sum to the JS context:</span><br><span class="line">&gt;&gt;&gt; context = js2py.EvalJs(&#123;&apos;python_sum&apos;: sum&#125;)  </span><br><span class="line">&gt;&gt;&gt; js_code = &apos;&apos;&apos;</span><br><span class="line">var a = 10</span><br><span class="line">function f(x) &#123;return x*x&#125;</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">&gt;&gt;&gt; context.execute(js_code)</span><br><span class="line"># Get value of variable a:</span><br><span class="line">&gt;&gt;&gt; context.a</span><br><span class="line">10</span><br><span class="line"># context.f behaves just like js function so you can supply more than 1 argument. &apos;9&apos;*&apos;9&apos; in javascript is 81.</span><br><span class="line">&gt;&gt;&gt; context.f(&apos;9&apos;, 0)  </span><br><span class="line">81    </span><br><span class="line"># context.f has all attributes of normal JavaScript object</span><br><span class="line">&gt;&gt;&gt; context.f.toString()</span><br><span class="line">u&apos;function f(x) &#123; [python code] &#125;&apos;</span><br><span class="line">&gt;&gt;&gt; context.f.bind</span><br><span class="line">function bind(thisArg) &#123; [python code] &#125;</span><br><span class="line"># You can also add variables to the context:</span><br><span class="line">&gt;&gt;&gt; context.foo = [1,2,3]  # context.foo is now Js Array object and behaves just like javascript array!</span><br><span class="line">&gt;&gt;&gt; context.foo.push(4)  </span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt; context.foo.to_list() # convert to python list</span><br><span class="line">[1, 2, 3, 4]</span><br><span class="line"># You can use Python objects that you put inside the context!</span><br><span class="line">&gt;&gt;&gt; context.eval(&apos;python_sum(new Array(1, 2, 3))&apos;)</span><br><span class="line">6</span><br></pre></td></tr></table></figure>
<h1 id="Limitations"><a href="#Limitations" class="headerlink" title="Limitations"></a>Limitations</h1><ul>
<li>忽视了”strict mode”</li>
<li>不支持<code>with</code>语法</li>
<li><code>eval</code>的非直接调用会被当做直接调用</li>
</ul>
<h1 id="Other-Examples"><a href="#Other-Examples" class="headerlink" title="Other Examples"></a>Other Examples</h1><p>In Js2Py all JavaScript objects are a subclass of PyJs object. For example JS Number is represented by PyJsNumber class. js2py.eval_js and js2py.EvalJs automatically tries to convert PyJs type to builtin python type. So for example if you execute:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; js2py.eval_js(&apos;var a = &quot;hello&quot;; a&apos;)</span><br></pre></td></tr></table></figure>
<p>eval_js will return unicode type (u”hello”). However for complex types such conversion is impossible and JsObjectWrapper is returned. See the conversion table JsType -&gt; PyType:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Boolean -&gt; bool</span><br><span class="line">String -&gt; unicode (str in Python 3)</span><br><span class="line">Number -&gt; float (or int/long if whole number)</span><br><span class="line">undefined -&gt; None</span><br><span class="line">null -&gt; None</span><br><span class="line">OTHER -&gt; JsObjectWrapper</span><br></pre></td></tr></table></figure>
<p>JsObjectWrapper supports: getitem, getattr, setitem, setattr, repr and call. Moreover it has to_list and to_dict methods if you want to convert it to builtin python type.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; js = js2py.eval_js(&apos;d = &#123;a:1, b:2&#125;&apos;)</span><br><span class="line">&gt;&gt;&gt; js</span><br><span class="line">&#123;a: 1, b: 2&#125;  </span><br><span class="line">&gt;&gt;&gt; type(js)</span><br><span class="line">&lt;class &apos;js2py.base.JsObjectWrapper&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; js.a</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; js[&apos;a&apos;]</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; js.b = 20</span><br><span class="line">&gt;&gt;&gt; js</span><br><span class="line">&#123;a: 1, b: 20&#125;  </span><br><span class="line">&gt;&gt;&gt; js[&apos;c&apos;] = 30</span><br><span class="line">&gt;&gt;&gt; js.to_dict()</span><br><span class="line">&#123;u&apos;a&apos;: 1, &apos;c&apos;: 30, u&apos;b&apos;: 20&#125;</span><br></pre></td></tr></table></figure>
<p>Also, of course you can use Js2Py to parse (tree is the same as in esprima.js) and translate JavaScript</p>
<h1 id="Parsing"><a href="#Parsing" class="headerlink" title="Parsing"></a>Parsing</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; js2py.parse_js(&apos;var $ = 5&apos;)   </span><br><span class="line">&#123;&apos;body&apos;: [&#123;&apos;kind&apos;: &apos;var&apos;, &apos;declarations&apos;: [&#123;&apos;init&apos;: &#123;&apos;raw&apos;: None, &apos;type&apos;: u&apos;Literal&apos;, &apos;value&apos;: 5.0&#125;, &apos;type&apos;: u&apos;VariableDeclarator&apos;, &apos;id&apos;: &#123;&apos;type&apos;: u&apos;Identifier&apos;, &apos;name&apos;: u&apos;$&apos;&#125;&#125;], &apos;type&apos;: u&apos;VariableDeclaration&apos;&#125;], &apos;type&apos;: u&apos;Program&apos;&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Translating"><a href="#Translating" class="headerlink" title="Translating"></a>Translating</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print js2py.translate_js(&apos;var $ = 5&apos;)</span><br><span class="line">import js2py.pyjs, sys</span><br><span class="line">for m in sys.modules.keys():</span><br><span class="line">    if m.startswith(&apos;js2py&apos;):</span><br><span class="line">        del sys.modules[m]</span><br><span class="line">del js2py.pyjs</span><br><span class="line">del js2py</span><br><span class="line">from js2py.pyjs import *</span><br><span class="line"># setting scope</span><br><span class="line">var = Scope( JS_BUILTINS )</span><br><span class="line">set_global_object(var)</span><br><span class="line"># Code follows:</span><br><span class="line">var.registers([u&apos;$&apos;])</span><br><span class="line">var.put(u&apos;$&apos;, Js(5.0))</span><br></pre></td></tr></table></figure>
<h1 id="pyimport-statement"><a href="#pyimport-statement" class="headerlink" title="pyimport statement"></a>pyimport statement</h1><p>Finally, Js2Py also supports importing any Python code from JavaScript using ‘pyimport’ statement:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x = &quot;&quot;&quot;pyimport urllib;</span><br><span class="line">           var result = urllib.urlopen(&apos;https://www.google.com/&apos;).read();</span><br><span class="line">           console.log(result.length)</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">&gt;&gt;&gt; js2py.eval_js(x)</span><br><span class="line">18211</span><br><span class="line">undefined</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用pytesser破解简单验证码]]></title>
      <url>http://lizonghang.github.io/2016/07/10/%E4%BD%BF%E7%94%A8pytesser%E7%A0%B4%E8%A7%A3%E7%AE%80%E5%8D%95%E9%AA%8C%E8%AF%81%E7%A0%81/</url>
      <content type="html"><![CDATA[<p>Tesseract是一款开源 OCR（Optical Character Recognition，光学字符识别）软件。所谓OCR是图像识别领域中一个子领域，该领域专注于对图片中的文字信息进行识别并转换成能被常规文本编辑器编辑的文本。</p>
<p>Tesseract 已经有30年历史，开始它是惠普实验室的一款专利软件，然后在 2005 年开源，自 2006 年后由 Google 赞助进行后续的开发和维护。在 1995 年 Tesseract 曾是世界前三的 OCR 引擎，而且在现在的免费 OCR 引擎中，其识别精度也仍然是出类拔萃的。因为其免费与较好的效果，许多的个人开发者以及一些较小的团队在使用着 Tesseract ，诸如验证码识别、车牌号识别等应用中，不难见到 Tesseract 的身影。</p>
<p>测试图片如下，文件名为test.png :<br><img src="/images/20140811163359656.png" alt=""></p>
<h1 id="安装与错误信息"><a href="#安装与错误信息" class="headerlink" title="安装与错误信息"></a>安装与错误信息</h1><h2 id="安装PIL"><a href="#安装PIL" class="headerlink" title="安装PIL"></a>安装PIL</h2><p>详见<a href="/2016/07/05/快速入门PIL/">快速入门PIL</a></p>
<h2 id="安装pytesseract"><a href="#安装pytesseract" class="headerlink" title="安装pytesseract"></a>安装pytesseract</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install pytesseract</span><br></pre></td></tr></table></figure>
<p>此时直接使用会出现错误，如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from PIL import Image</span><br><span class="line">&gt;&gt;&gt; import pytesseract</span><br><span class="line">&gt;&gt;&gt; im = Image.open(&apos;test.png&apos;)</span><br><span class="line">&gt;&gt;&gt; print pytesseract.image_to_string(im)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">  File &quot;/usr/lib/python2.7/dist-packages/spyderlib/widgets/externalshell/sitecustomize.py&quot;, line 540, in runfile</span><br><span class="line">    execfile(filename, namespace)</span><br><span class="line">  File &quot;/home/chaitanya/pythonapp/localcopy.py&quot;, line 4, in &lt;module&gt;</span><br><span class="line">    print pytesseract.image_to_string(im)</span><br><span class="line">  File &quot;/usr/local/lib/python2.7/dist-packages/pytesseract/pytesseract.py&quot;, line 142, in image_to_string</span><br><span class="line">    config=config)</span><br><span class="line">  File &quot;/usr/local/lib/python2.7/dist-packages/pytesseract/pytesseract.py&quot;, line 75, in run_tesseract</span><br><span class="line">    stderr=subprocess.PIPE)</span><br><span class="line">  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 710, in __init__</span><br><span class="line">    errread, errwrite)</span><br><span class="line">  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 1327, in _execute_child</span><br><span class="line">    raise child_exception</span><br><span class="line">OSError: [Errno 2] No such file or directory</span><br></pre></td></tr></table></figure>
<p>原因是还没有安装tesseract-ocr</p>
<h2 id="安装tesseract-ocr"><a href="#安装tesseract-ocr" class="headerlink" title="安装tesseract-ocr"></a>安装tesseract-ocr</h2><p>Linux可使用<code>apt-get</code>直接安装:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tesseract-ocr</span><br></pre></td></tr></table></figure>
<p>如果想用 Tesseract 对图像进行识别，还需要对应的语言文件。所谓的语言文件是 Tesseract 识别某种语言的文字图像时需要的一些资源，这些东西也可以通过包管理器获取。比如我们需要识别英语和简体中文，那么使用命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tesseract-ocr-eng tesseract-ocr-chi-sim</span><br></pre></td></tr></table></figure>
<p>如果没有<code>apt-get</code>，需要的话可以使用编译安装的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://tesseract-ocr.googlecode.com/files/tesseract-ocr-3.02.02.tar.gz</span><br><span class="line">tar -xzvf tesseract-ocr-3.02.02.tar.gz</span><br></pre></td></tr></table></figure>
<p>编译需要<code>automake</code>、<code>autoconf</code>、<code>libtool</code>支持，如果有的话可以跳过该步骤，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install autoconf automake libtool</span><br></pre></td></tr></table></figure>
<p>然后进入文件夹 tesseract-ocr-3.02.02 编译安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>Tesseract还依赖一些图像库，你可以选择性安装，也可不安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ligjpeg62-dev libtiff4-dev libpng12-dev libleptonica-dev</span><br></pre></td></tr></table></figure>
<p>再运行测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from PIL import Image</span><br><span class="line">&gt;&gt;&gt; import pytesseract</span><br><span class="line">&gt;&gt;&gt; im = Image.open(&apos;test.png&apos;)</span><br><span class="line">&gt;&gt;&gt; print pytesseract.image_to_string(im)</span><br></pre></td></tr></table></figure>
<p>可能会出现’Leptonica not found’错误。如果出现该错误，下载安装Leptonica包即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://leptonica.googlecode.com/files/leptonica-1.69.tar.bz2</span><br></pre></td></tr></table></figure>
<h2 id="安装语言训练集"><a href="#安装语言训练集" class="headerlink" title="安装语言训练集"></a>安装语言训练集</h2><p>解压后进入目录执行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>如果没有出现上述错误，应该会出现<code>TesseractError</code>，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print pytesseract.image_to_string(im)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">  File &quot;/Library/Python/2.7/site-packages/pytesseract/pytesseract.py&quot;, line 164, in image_to_string</span><br><span class="line">    raise TesseractError(status, errors)</span><br><span class="line">pytesseract.pytesseract.TesseractError: (1, &apos;Error opening data file /usr/local/share/tessdata/eng.traineddata&apos;)</span><br></pre></td></tr></table></figure>
<p>这是由于没有下载语音训练集造成，你可以使用命令查看目前的语言训练集：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tesseract --list-langs</span><br></pre></td></tr></table></figure>
<p>训练集放置于/usr/local/share/目录中的tessdata文件夹中，你需要手动下载训练集并添加到这个文件夹，添加后可以使用上述命令查看。你可以从<a href="https://github.com/tesseract-ocr/tessdata" target="_blank" rel="external">Github</a>获取到训练集。</p>
<p>再次尝试运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from PIL import Image</span><br><span class="line">&gt;&gt;&gt; import pytesseract</span><br><span class="line">&gt;&gt;&gt; im = Image.open(&apos;test.png&apos;)</span><br><span class="line">&gt;&gt;&gt; print pytesseract.image_to_string(im)</span><br><span class="line">hoke</span><br></pre></td></tr></table></figure>
<h1 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h1><p>经测试，pytesser适用于比较规范的英文/数字，对于中文的识别能力较差，对于有干扰素的验证码图片性能较差，可以用来提取简单的英文/数字。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[随机数字图片验证码的原理、生成和破解]]></title>
      <url>http://lizonghang.github.io/2016/07/10/%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AD%97%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E5%8E%9F%E7%90%86%E3%80%81%E7%94%9F%E6%88%90%E5%92%8C%E7%A0%B4%E8%A7%A3/</url>
      <content type="html"><![CDATA[<p>验证码的功能一般是防止使用程序恶意注册、暴力破解或批量发帖而设置的。所谓验证码，就是将一串随机产生的数字或符号，生成一幅图片，图片里加上一些干扰象素（防止OCR），由用户肉眼识别其中的验证码信息，输入表单提交网站验证，验证成功后才能使用某项功能。学习验证码的破解/识别技术，不仅可以知道验证码的原理，而且可以让你知道怎样才能防止验证码被破解。</p>
<h1 id="常见验证码类型"><a href="#常见验证码类型" class="headerlink" title="常见验证码类型"></a>常见验证码类型</h1><p><img src="/images/authtype.png" alt=""></p>
<ol>
<li>图片背景和数字都使用相同的颜色，字符规整，字符位置统一</li>
<li>验证字符规整，颜色相同，排除干扰素容易，只要是非字符色素全部排除即可</li>
<li>处理背景色和干扰色一直变换，验证字符的颜色也在变化，各个字符的颜色也各不相同</li>
<li>在第三个基础上，在文字上加了两条直线干扰率，容易去掉</li>
</ol>
<h1 id="验证码识别步骤"><a href="#验证码识别步骤" class="headerlink" title="验证码识别步骤"></a>验证码识别步骤</h1><h2 id="取出干扰素"><a href="#取出干扰素" class="headerlink" title="取出干扰素"></a>取出干扰素</h2><p>干扰素的一个重要特征是不能影响验证码的显示效果，所以制作干扰素时它的RGB可能低于或高于某个特定值。比如例子中的图片，干扰素的RGB各项值小于125，依此很容易去掉干扰素。</p>
<h2 id="取出字模"><a href="#取出字模" class="headerlink" title="取出字模"></a>取出字模</h2><p>由于各个网站的验证码各不相同，最常见的方法是建立验证码的特征码库。取字模时，需要多收集几张图片，使这些图片中包括所有的字符。一般来说有0~9、a~z</p>
<h2 id="二值化"><a href="#二值化" class="headerlink" title="二值化"></a>二值化</h2><p>把图片上的验证字符上每个像素用一种数字表示1，其他部分用0表示。这样就可以计算每个数字字模，记录下这些字模当作key</p>
<h2 id="计算特征"><a href="#计算特征" class="headerlink" title="计算特征"></a>计算特征</h2><p>把要识别的图片进行二值化，得到图片特征</p>
<h2 id="对照样本"><a href="#对照样本" class="headerlink" title="对照样本"></a>对照样本</h2><p>把上一步图片特征码和验证码的字模进行对比，得到验证图片上的数字</p>
<h1 id="复杂验证码"><a href="#复杂验证码" class="headerlink" title="复杂验证码"></a>复杂验证码</h1><p>识别的目标验证码由字符和数字组成，验证码存在旋转，位置不固定，存在字符与字符之间的粘连，且验证码有更强的干扰素。以下图为例：</p>
<p><img src="/images/authexam.jpg" alt=""></p>
<h2 id="二值化-1"><a href="#二值化-1" class="headerlink" title="二值化"></a>二值化</h2><p>把验证码的部分用1表示，背景部分用0表示。识别方法为：打印出验证码图片的RGB，分辨出图片的R值大于120，G和B小于80的像素，依据这个规则把图片二值化。</p>
<p>常见验证码第三张图片中，验证码的图片每次背景色都不相同，且不是单色，各个验证码数字的颜色每次也各不相同。打印出其 RGB 值很容易就发现。无论验证数字颜色如何变化，该数字的 RGB 值总有一个值小于 125 ，所以通过判断<code> rgbarray[‘red’] &lt; 125 || rgbarray[‘green’] &lt; 125 || rgbarray[‘blue’] &lt; 125 </code>就很容易分辨出数字和背景。</p>
<p>这些规律的原因是，在制作验证码的干扰素时，为了使干扰素不影响数字的显示效果，必须使干扰素的 RGB 和数字的 RGB 相互独立，互不干扰。依照这个规律就容易实现二值化。</p>
<p>我们找到的 120 ， 80 ， 125 等阈值，可能和实际的 RGB 有出入，所以，有时二值化后，会有部分地方出现 1 ，对于验证码上固定位置显示数字，这种干扰没有太大意义。但是对于验证码位置不确定的图片来说，在我们切割字符时，很可能造成干扰。所以，在二值化后要进行去噪处理。</p>
<h2 id="去噪处理"><a href="#去噪处理" class="headerlink" title="去噪处理"></a>去噪处理</h2><p>去噪就是把孤立的有效值去掉。如果一个点为1，则判断这个点的周围一圈上的数字是否为1，若没有则认为是一个噪点，直接设置为0即可。</p>
<p><img src="/images/noise.jpg" alt=""></p>
<p>如图所示，红色方框部分的 1 为噪点，直接设置为 0 即可。有时候噪点可能是两个连续的 1 ，可以计算这个点 8 个方向上的值之和，判断和是否小于特定的阈值。</p>
<h2 id="切割字符"><a href="#切割字符" class="headerlink" title="切割字符"></a>切割字符</h2><p>切割方法有很多种，最简单的一种为竖直切割。先沿垂直方向切割为字符，然后再水平方向去掉多余的 0 。如下图所示</p>
<p><img src="/images/1336829447_7784.jpg" alt=""></p>
<p>第一步切割红线部分，第二步切割蓝线部分，就可以得到独立的字符了。但是像下面的情况：</p>
<p><img src="/images/1336829468_5425.jpg" alt=""></p>
<p>按上面的方法会把 dw 字符切割成一个字符，这是错误的切割，这里涉及到粘连字符的切割。</p>
<h2 id="粘连字符切割"><a href="#粘连字符切割" class="headerlink" title="粘连字符切割"></a>粘连字符切割</h2><p>制作验证码时，规则字符的粘连很容易分割开，如果字符本身有缩放，变形就很难处理。上述字符粘连是规则字符的粘连，完成分割操作后，不能马上确定分割的部分为一个字符，要进行验证。验证的关键是切割下来的字符的宽是否大于阈值。阈值的取舍标准是一个字符无论怎么旋转变形都不会大于这个阈值。若切割的块大于这个阈值，可以认为是一个粘连字符；如果大于两个阈值之和，认为是三个字符粘连，以此类推。如果发现粘连字符块，直接平分为两个或多个小块即可。为了更好的还原字符，一般采用平分±1对字符块部分进行适当的补充。</p>
<h2 id="匹配字符"><a href="#匹配字符" class="headerlink" title="匹配字符"></a>匹配字符</h2><p>最简单的方式是为所有的字符所有情况建立匹配库，目的是现有人工识别图片的验证码，处理后写入特征码库以便匹配。特征码库的图片数据越多，验证识别的准确性就越高。</p>
<h1 id="制作验证码的建议"><a href="#制作验证码的建议" class="headerlink" title="制作验证码的建议"></a>制作验证码的建议</h1><p>对于识别验证码的程序来说最难的部分是验证码字符的切割和特征码的建立。很多验证码加了很多干扰素和干扰线，不仅影响用户体验还达不到防止破解的很好的效果。若要使验证码难于被程序识别，需要注意：</p>
<ul>
<li>字符粘连，最后所有字符都有粘连的部分</li>
<li>不使用规则字符，验证码的各个部分使用不同比例的缩放或者旋转</li>
</ul>
<p>一般实现以上两点或这两点的变性，破解程序就很难识别。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Python破解验证码]]></title>
      <url>http://lizonghang.github.io/2016/07/09/Python%E7%A0%B4%E8%A7%A3%E9%AA%8C%E8%AF%81%E7%A0%81/</url>
      <content type="html"><![CDATA[<p>本项目使用<strong>PIL库</strong>及<strong>向量空间搜索引擎理论</strong>实现验证码破解。先下载实验用文件便于解释图片解析的原理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://labfile.oss.aliyuncs.com/courses/364/python_captcha.zip</span><br><span class="line">$ unzip python_captcha.zip</span><br></pre></td></tr></table></figure></p>
<p>或直接访问 <a href="http://labfile.oss.aliyuncs.com/courses/364/python_captcha.zip" target="_blank" rel="external">http://labfile.oss.aliyuncs.com/courses/364/python_captcha.zip</a> 并解压。python_captcha目录下的内容有:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python_captcha</span><br><span class="line">├── captcha.gif</span><br><span class="line">├── crack.py</span><br><span class="line">├── examples</span><br><span class="line">└── iconset</span><br><span class="line">    ├── 0~9</span><br><span class="line">    ├── a~z</span><br></pre></td></tr></table></figure></p>
<ul>
<li>captcha.gif - 试验用验证码图片</li>
<li>crack.py - 即将编写的实现验证码破解的程序</li>
<li>examples/ - 存放了其他可用于测试的验证码图片</li>
<li>iconset/ - 存放了训练集，即用于对比的单符号图片</li>
</ul>
<p>下图为试验用验证码图片:</p>
<p><img src="/images/captcha.gif" alt=""></p>
<h1 id="从文件中提取图片"><a href="#从文件中提取图片" class="headerlink" title="从文件中提取图片"></a>从文件中提取图片</h1><p>将图片转为8位P模式图片，输出其颜色直方图:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line">im = Image.open(&apos;captcha.gif&apos;).convert(&apos;P&apos;)</span><br><span class="line">print im.histogram()</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<pre>
[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 0, 1, 2, 0, 1, 0, 0, 1, 0, 2, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 3, 1, 3, 3, 0, 0, 0, 0, 0, 0, 1, 0, 3, 2, 132, 1, 1, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 15, 0, 1, 0, 1, 0, 0, 8, 1, 0, 0, 0, 0, 1, 6, 0, 2, 0, 0, 0, 0, 18, 1, 1, 1, 1, 1, 2, 365, 115, 0, 1, 0, 0, 0, 135, 186, 0, 0, 1, 0, 0, 0, 116, 3, 0, 0, 0, 0, 0, 21, 1, 1, 0, 0, 0, 2, 10, 2, 0, 0, 0, 0, 2, 10, 0, 0, 0, 0, 1, 0, 625]
</pre>

<p>颜色直方图的每一位数字都代表了在图片中含有对应位颜色像素的数量。每个像素点可表现256种颜色。从输出中可发现白点最多，白色像素序号为255，即最后一位，有625个像素。红像素在序号200左右，通过排序可以得到有用的颜色。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">his = im.histogram()</span><br><span class="line">values = &#123;&#125;</span><br><span class="line">for i in range(256):</span><br><span class="line">    values[i] = his[i] </span><br><span class="line">for index,count in sorted(values.items(), key=lambda d:d[1], reverse=True)[:10]:</span><br><span class="line">    print index,count</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">255 625</span><br><span class="line">212 365</span><br><span class="line">220 186</span><br><span class="line">219 135</span><br><span class="line">169 132</span><br><span class="line">227 116</span><br><span class="line">213 115</span><br><span class="line">234 21</span><br><span class="line">205 18</span><br><span class="line">184 15</span><br></pre></td></tr></table></figure>
<p>得到了图片中最多的10种颜色，其中index为220与227是需要的红色和灰色，通过这一信息构造黑白二值图片:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line">im = Image.open(&apos;captcha.gif&apos;).convert(&apos;P&apos;)</span><br><span class="line">im2 = Image.new(&apos;P&apos;, im.size, 255)</span><br><span class="line">for row in range(im.size[1]):</span><br><span class="line">    for col in range(im.size[0]):</span><br><span class="line">        pix = im.getpixel((col,row))</span><br><span class="line">        if pix == 220 or pix == 227:</span><br><span class="line">            im2.putpixel((col,row), 0)</span><br><span class="line">im2.show()</span><br></pre></td></tr></table></figure>
<p>得到黑白二值图片:</p>
<p><img src="/images/im2.gif" alt=""></p>
<h1 id="提取单个字符图片"><a href="#提取单个字符图片" class="headerlink" title="提取单个字符图片"></a>提取单个字符图片</h1><p>为了判断各个字符，需要将图片切割为单个字符的像素集合，对黑白二值图片进行纵向切割：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">inLetter = False</span><br><span class="line">foundLetter = False</span><br><span class="line">letterStart = 0</span><br><span class="line">letterEnd = 0</span><br><span class="line">letter_split = []</span><br><span class="line"></span><br><span class="line">for col in range(im2.size[0]):</span><br><span class="line">    for row in range(im2.size[1]):</span><br><span class="line">        pix = im2.getpixel((col,row))</span><br><span class="line">        if pix != 255:</span><br><span class="line">            inLetter = True</span><br><span class="line">    if foundLetter == False and inLetter == True:</span><br><span class="line">        foundLetter = True</span><br><span class="line">        letterStart = col</span><br><span class="line">    if foundLetter == True and inLetter == False:</span><br><span class="line">        foundLetter = False</span><br><span class="line">        letterEnd = col</span><br><span class="line">        letter_split.append((letterStart,letterEnd))</span><br><span class="line">    inLetter = False</span><br></pre></td></tr></table></figure>
<p>letter_split中记录了每个字符开始和结束的列序号:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(6, 14), (15, 25), (27, 35), (37, 46), (48, 56), (57, 67)]</span><br></pre></td></tr></table></figure>
<p>分割图片:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for letter in letter_split:</span><br><span class="line">    im_Letter = im2.crop((letter[0], 0, letter[1], im2.size[1]))</span><br><span class="line">    im_Letter.show()</span><br></pre></td></tr></table></figure>
<p>得到每个字符的图片。将这些图片与本地图片进行比较分析，匹配到相似度最高的字符。</p>
<h1 id="向量空间图形识别"><a href="#向量空间图形识别" class="headerlink" title="向量空间图形识别"></a>向量空间图形识别</h1><p>这里使用向量空间搜索引擎来做字符识别，它具有很多优点：</p>
<ul>
<li>不需要大量的训练迭代</li>
<li>不会训练过度</li>
<li>可以随时加入/移除错误的数据查看效果</li>
<li>很容易理解和编写成代码</li>
<li>提供分级结果，可以查看最接近的多个匹配</li>
<li>对于无法识别的东西只要加入到搜索引擎中就能识别</li>
</ul>
<p>但它分类的速度比神经网络慢很多，不能找到自己的方法解决问题。</p>
<p>原理可以参考<a href="/2016/07/07/向量空间搜索引擎基本理论/">向量空间搜索引擎</a></p>
<p>类VectorCompare实现向量空间:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import math</span><br><span class="line">class VectorCompare:</span><br><span class="line">    def magnitude(self, concordance):</span><br><span class="line">        total = 0</span><br><span class="line">        for word, count in concordance.iteritems():</span><br><span class="line">            total += count ** 2</span><br><span class="line">        return math.sqrt(total)</span><br><span class="line"></span><br><span class="line">    def relation(self, concordance1, concordance2):</span><br><span class="line">        relevance = 0</span><br><span class="line">        topvalue = 0</span><br><span class="line">        for word, count in concordance1.iteritems():</span><br><span class="line">            if concordance2.has_key(word):</span><br><span class="line">                topvalue += count * concordance2[word]</span><br><span class="line">        return topvalue / (self.magnitude(concordance1) * self.magnitude(concordance2))</span><br></pre></td></tr></table></figure>
<p>该类会比较两个字典并输出它们的相似度(0~1)</p>
<h1 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h1><p>还需要取大量的验证码提取出单个字符图片作为训练集合的工作，上文已经介绍。iconset目录下放的是训练集。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">def buildvector(im):</span><br><span class="line">    d1 = &#123;&#125;</span><br><span class="line">    count = 0</span><br><span class="line">    for i in im.getdata():</span><br><span class="line">        d1[count] = i</span><br><span class="line">        count += 1</span><br><span class="line">    return d1</span><br><span class="line"></span><br><span class="line">v = VectorCompare()</span><br><span class="line">iconset = [&apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;, &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;, &apos;f&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;, &apos;j&apos;, &apos;k&apos;, &apos;l&apos;, &apos;m&apos;, &apos;n&apos;, &apos;o&apos;, &apos;p&apos;, &apos;q&apos;, &apos;r&apos;, &apos;s&apos;, &apos;t&apos;, &apos;u&apos;, &apos;v&apos;, &apos;w&apos;, &apos;x&apos;, &apos;y&apos;, &apos;z&apos;]</span><br><span class="line"></span><br><span class="line"># 加载训练集</span><br><span class="line">imageset = []</span><br><span class="line">for letter in iconset:</span><br><span class="line">    for img in os.listdir(&apos;./iconset/%s/&apos; % letter):</span><br><span class="line">        temp = []</span><br><span class="line">        if img != &apos;Thumbs.db&apos; and img != &apos;.DS_Store&apos;:</span><br><span class="line">            temp.append(buildvector(Image.open(&apos;./iconset/%s/%s&apos; % (letter, img))))</span><br><span class="line">        imageset.append(&#123;letter: temp&#125;)</span><br><span class="line"></span><br><span class="line">count = 0</span><br><span class="line"># 切割验证码</span><br><span class="line">for letter in letter_split:</span><br><span class="line">    im_Letter = im2.crop((letter[0], 0, letter[1], im2.size[1]))</span><br><span class="line">    guess = []</span><br><span class="line">    # 将切割得到的验证码小片段与每个训练片段进行比较</span><br><span class="line">    for image in imageset:</span><br><span class="line">        for x,y in image.iteritems():</span><br><span class="line">            if len(y) != 0:</span><br><span class="line">                guess.append((v.relation(y[0], buildvector(im_Letter)), x))</span><br><span class="line">    guess.sort(reverse=True)</span><br><span class="line">    print guess[0]</span><br><span class="line">    count += 1</span><br></pre></td></tr></table></figure>
<h1 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># encoding: utf-8</span><br><span class="line">from PIL import Image</span><br><span class="line">import os</span><br><span class="line">import math</span><br><span class="line"></span><br><span class="line">class VectorCompare:</span><br><span class="line">    def magnitude(self, concordance):</span><br><span class="line">        total = 0</span><br><span class="line">        for word, count in concordance.iteritems():</span><br><span class="line">            total += count ** 2</span><br><span class="line">        return math.sqrt(total)</span><br><span class="line"></span><br><span class="line">    def relation(self, concordance1, concordance2):</span><br><span class="line">        relevance = 0</span><br><span class="line">        topvalue = 0</span><br><span class="line">        for word, count in concordance1.iteritems():</span><br><span class="line">            if concordance2.has_key(word):</span><br><span class="line">                topvalue += count * concordance2[word]</span><br><span class="line">        return topvalue / (self.magnitude(concordance1) * self.magnitude(concordance2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def buildvector(im):</span><br><span class="line">    d1 = &#123;&#125;</span><br><span class="line">    count = 0</span><br><span class="line">    for i in im.getdata():</span><br><span class="line">        d1[count] = i</span><br><span class="line">        count += 1</span><br><span class="line">    return d1</span><br><span class="line"></span><br><span class="line">v = VectorCompare()</span><br><span class="line">iconset = [&apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;, &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;, &apos;f&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;, &apos;j&apos;, &apos;k&apos;, &apos;l&apos;, &apos;m&apos;, &apos;n&apos;, &apos;o&apos;, &apos;p&apos;, &apos;q&apos;, &apos;r&apos;, &apos;s&apos;, &apos;t&apos;, &apos;u&apos;, &apos;v&apos;, &apos;w&apos;, &apos;x&apos;, &apos;y&apos;, &apos;z&apos;]</span><br><span class="line">image_set = []</span><br><span class="line"></span><br><span class="line">for letter in iconset:</span><br><span class="line">    for img in os.listdir(&apos;./iconset/%s/&apos; % letter):</span><br><span class="line">        temp = []</span><br><span class="line">        if img != &quot;Thumbs.db&quot; and img != &apos;.DS_Store&apos;:</span><br><span class="line">            temp.append(buildvector(Image.open(&apos;./iconset/%s/%s&apos; % (letter, img))))</span><br><span class="line">        image_set.append(&#123;letter: temp&#125;)</span><br><span class="line"></span><br><span class="line">im = Image.open(&apos;captcha.gif&apos;).convert(&apos;P&apos;)</span><br><span class="line">im2 = Image.new(&apos;P&apos;, im.size, 255)</span><br><span class="line">temp = &#123;&#125;</span><br><span class="line"></span><br><span class="line">for row in range(im.size[1]):</span><br><span class="line">    for col in range(im.size[0]):</span><br><span class="line">        pix = im.getpixel((col,row))</span><br><span class="line">        temp[pix] = pix</span><br><span class="line">        if pix == 220 or pix == 227:</span><br><span class="line">            im2.putpixel((col,row), 0)</span><br><span class="line"></span><br><span class="line">inLetter = False</span><br><span class="line">foundLetter = False</span><br><span class="line">letterStart = 0</span><br><span class="line">letterEnd = 0</span><br><span class="line">letter_split = []</span><br><span class="line"></span><br><span class="line">for col in range(im2.size[0]):</span><br><span class="line">    for row in range(im2.size[1]):</span><br><span class="line">        pix = im2.getpixel((col,row))</span><br><span class="line">        if pix != 255:</span><br><span class="line">            inLetter = True</span><br><span class="line">    if foundLetter == False and inLetter == True:</span><br><span class="line">        foundLetter = True</span><br><span class="line">        letterStart = col</span><br><span class="line">    if foundLetter == True and inLetter == False:</span><br><span class="line">        foundLetter = False</span><br><span class="line">        letterEnd = col</span><br><span class="line">        letter_split.append((letterStart,letterEnd))</span><br><span class="line">    inLetter = False</span><br><span class="line"></span><br><span class="line">count = 0</span><br><span class="line">for letter in letter_split:</span><br><span class="line">    im_Letter = im2.crop((letter[0], 0, letter[1], im2.size[1]))</span><br><span class="line">    guess = []</span><br><span class="line">    for image in image_set:</span><br><span class="line">        for x,y in image.iteritems():</span><br><span class="line">            if len(y) != 0:</span><br><span class="line">                guess.append((v.relation(y[0], buildvector(im_Letter)), x))</span><br><span class="line">    guess.sort(reverse=True)</span><br><span class="line">    print guess[0]</span><br><span class="line">    count += 1</span><br></pre></td></tr></table></figure>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>运行程序查看是否正常工作:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./crack.py</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(0.9637681159420289, &apos;7&apos;)</span><br><span class="line">(0.96234028545977, &apos;s&apos;)</span><br><span class="line">(0.9286884286888929, &apos;9&apos;)</span><br><span class="line">(0.9835037060984447, &apos;t&apos;)</span><br><span class="line">(0.9675116507250627, &apos;9&apos;)</span><br><span class="line">(0.9698971168877263, &apos;j&apos;)</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[向量空间搜索引擎基本理论]]></title>
      <url>http://lizonghang.github.io/2016/07/07/%E5%90%91%E9%87%8F%E7%A9%BA%E9%97%B4%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E5%9F%BA%E6%9C%AC%E7%90%86%E8%AE%BA/</url>
      <content type="html"><![CDATA[<h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>&emsp;&emsp;向量空间搜索引擎所运用的技术源自矩阵代数，它基于字符在文件中出现的频率来比较文件。<br>&emsp;&emsp;向量空间搜索引擎中第一个重要的元素是<code>项空间</code>的概念。简而言之，一个项空间由文件中出现的每个独立的词组成。<br>&emsp;&emsp;向量空间搜索引擎中第二个重要的元素是<code>项数</code>。项数就是文件中每个字符出现的次数。通常可由表的形式列出。<br>&emsp;&emsp;通过将项空间作为坐标空间，项数作为项空间中的坐标，我们可以为每个文件生成一个向量。以笛卡尔坐标系为例，点的刻画沿X,Y,Z轴。类似的，在我们的例子中一个项空间由三个独立项组成，我们把它们分别称作项1轴，项2轴，项3轴。（在向量空间搜索引擎理论中这些轴通常被称作<code>维数</code>。）通过计算文件中各项出现的次数，并沿各项轴画出坐标，就可确定出与文件所对应的项空间中的点。由这些点可生成该文件的向量。<br>&emsp;&emsp;一旦在项空间中画出该文件的向量，就可以计算向量的<code>大小</code>。把大小看做是原点（坐标（0，0，0）点）到当前文件点之间连线的距离。这样就可运用向量的长度通过计算夹角的余弦来比较不同的文件。例如，相同的文件夹角余弦为1，文件中含有类似项的夹角余弦会是正小数，文件中含有截然不同项的夹角余弦是0。</p>
<h1 id="一个简单的例子"><a href="#一个简单的例子" class="headerlink" title="一个简单的例子"></a>一个简单的例子</h1><p>&emsp;&emsp;假设我们有三个文件。每个文件分别是三个词：猫、狗和老鼠。这三个词就是项空间，那么我们可以说每个文件分别沿猫维、狗维和老鼠维上有坐标。这些坐标取决于每一项在文件中出现的次数。例如，以下表中的文件1就含有“猫-狗-老鼠”向量的坐标为（3，1，4）<br><img src="/images/table.png" alt="table"><br>&emsp;&emsp;用勾股定理来计算每个文件向量的大小，在该情况下向量维数高于二维，所以有以下公式<br><img src="/images/formula_1.png" alt="formula"><br>无论是多少维的向量，都可以用勾股定理来计算文件向量的大小。<br>&emsp;&emsp;即时对于不同的文件可能会有相同大小的文件向量。例如，对于两个文件向量分别为（1，2，3）和（3，2，1）的文件来说，它们的文件向量大小均为3.74165。这并不矛盾，文件的关联值（relevancy score）是基于要查询的询问项的维数，因此，即便是对于具有相同大小的文件向量的文件，它们的询问项不同。即是说项空间中的两条直线具有相同的长度，但可能不指向同一方向。</p>
<h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><p>&emsp;&emsp;为查询文件的索引，我们把查询向量投影到向量空间上，并计算查询向量与文件集中向量之间的余弦夹角。例如，查询项为“老鼠”，那么“猫-狗-老鼠”向量就是（0，0，1）。查询向量大小为<br><img src="/images/formula_2.png" alt=""><br>注：一个简单方法是查看询问项是否属于项空间，如果是，那么||Q||总为1。但这只对单项询问有效。对于多个查询项，计算它们在项空间出现的次数，然后对次数取方根。由于查询项的值总大于1，||Q||将会是某个整数的方根。但前提是每项在询问项中只出现一次。由于本文将要讨论的次干问题，该假设未必是个好假设。<br>&emsp;&emsp;计算查询向量与一文件向量的余弦夹角公式为<br><img src="/images/formula_3.png" alt=""><br>依次计算三个文件向量与查询项向量夹角的余弦值，并将文件按余弦值递减排序<br><img src="/images/formula_4.png" alt=""><br>可以看出文件2是和查询项“老鼠”最相关，该结论可从上面的列表中快速验证。与文件1有些相关，文件3因不含“老鼠”这一项，与查询项完全无关。<br>&emsp;&emsp;一个简单的考虑方法是余弦值越接近1，文件与查询项越相关。如果余弦值为0，文件向量与查询向量正交且完全无关。</p>
<h1 id="文件集索引处理"><a href="#文件集索引处理" class="headerlink" title="文件集索引处理"></a>文件集索引处理</h1><p>&emsp;&emsp;文件集的索引处理对于被索引的文件是很特殊的。向量空间搜索技术可用于任何有一定结构的信息中，因此它对文字、图像、密码钥匙，甚至DNA同样有效。但是，用户必须对所处理的信息做适当的构建，并可将其优化以提高索引处理效率。以检索一个小网站为例。<br>&emsp;&emsp;首先每个HTML文件必须先做预处理，然后索引为文件集合的一部分。（集合只能整体索引。在索引后添加额外的文件会改变项文件的维数并且否定已存文件向量的大小。）<br>&emsp;&emsp;先拆解所有HTML文件的内容，诸如空格、回车键，直到只留有单个词组成的项为止。<br>&emsp;&emsp;然后把间歇字（stop word）从正文中移出。间歇字是那些在英文中常用但总体上不对正文产生任何语义的词，比如’the’,’and’,’of’,’or’。这些词和实际的语义无关，如不去掉会增加项空间的维数，从而加长处理时间。另外，像’quickly’这样的副词因和实际语义无关也可以去掉。<br>&emsp;&emsp;下一步词干化（stem）文件中剩余的项。词干化是将每项简化成词根的形式。例如，词’runner’，’running’,’runs’都将被简化成’run’。<em>Porter Stemming Algorithm</em>的目的就是词干化。这进一步简化了项空间并保持了语义。<br>&emsp;&emsp;完成这三步后我们期望留下保持原文件语义的最少项。现在可以开始通过建立项空间和计算每个文件向量的大小来索引文件集。<br><img src="/images/step.png" alt=""><br>注：要注意的是解析器如何分解信息将直接影响查询结果。例如，如果索引的是一本书，那么索引时间和查询结果将取决于如何对书进行分割，是按章、页还是段落。需要对数据进行一定的试验以找到最优的分割。</p>
<h1 id="向量空间搜索引擎的局限"><a href="#向量空间搜索引擎的局限" class="headerlink" title="向量空间搜索引擎的局限"></a>向量空间搜索引擎的局限</h1><p>&emsp;&emsp;首先，它需要海量计算，因此计算速度极慢。由于是浮点运算，因此需要很长的处理时间，从而导致表现失常。高性能的表现需要在内存中执行优化过的代码。期望随着处理器速度的提高使之不再成为障碍。<br>&emsp;&emsp;其次，动态的文集对每一次文件的添加都需要再索引。这是由于当每次在项空间中引进一个新项时，对应的新矩阵会增加一维，从而所有的文件都要进行再索引，使得文件向量与新维数相对应。这样做使得实时查询几乎不可能，这可能是使该技术没有被广泛使用的主要原因。<br>&emsp;&emsp;第三，为了能发觉有潜在语义索引（Latent Semantic Indexing）的文件之间的额外联系，我们需对文件集做额外的数学变换。LSI可使文件之间在语义层上找到彼此之间的额外联系。它超出了本文的讨论范围，但对向量空间的搜索技术的下一步研究具有重要意义，同时也为实时查询增加了新的障碍。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[PIL中的概念]]></title>
      <url>http://lizonghang.github.io/2016/07/07/PIL%E4%B8%AD%E7%9A%84%E6%A6%82%E5%BF%B5/</url>
      <content type="html"><![CDATA[<h1 id="Bands-频段"><a href="#Bands-频段" class="headerlink" title="Bands(频段)"></a>Bands(频段)</h1><p>一张图片可以由一个或多个数据频段组成，PIL库支持在一张图片中存储多个频段，它们具有相同的尺寸和深度。要获取图像中频段的数量和名称，可使用<code>getbands()</code>方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; im = Image.open(&apos;lena.jpg&apos;)</span><br><span class="line">&gt;&gt;&gt; im.getbands()</span><br><span class="line">(&apos;R&apos;, &apos;G&apos;, &apos;B&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="Mode-模式"><a href="#Mode-模式" class="headerlink" title="Mode(模式)"></a>Mode(模式)</h1><p>图像的模式定义了图片中像素的类型和深度。最新发行版支持下列标准模式：</p>
<ul>
<li>1        - 1bit像素，黑白，每个字节存储一个像素</li>
<li>L        - 8bit像素，灰度</li>
<li>P        - 8bit像素，用调色盘索引到其他模式</li>
<li>RGB    - 3x8bit像素，真彩</li>
<li>RGBA    - 4x8bit像素，真彩，带透明遮罩</li>
<li>CMYK    - 4x8bit像素，分色</li>
<li>YCbCr    - 3x8bit像素，彩色视频格式</li>
<li>I        - 32bit有符号整数像素</li>
<li>F        - 32bit浮点像素</li>
</ul>
<p>PIL同时对一些特殊的模式提供有限的支持，包括LA，RGBX，RGBa，但PIL不支持用户自定义的模式。如果要处理其他模式，可使用图像对象序列。</p>
<h1 id="Size-大小"><a href="#Size-大小" class="headerlink" title="Size(大小)"></a>Size(大小)</h1><p>可以通过<code>size</code>属性获取图像大小。这是一个二元元组，含有水平像素尺寸和竖直像素尺寸。</p>
<h1 id="Coordinate-System-坐标系统"><a href="#Coordinate-System-坐标系统" class="headerlink" title="Coordinate System(坐标系统)"></a>Coordinate System(坐标系统)</h1><p>PIL使用了笛卡尔的像素坐标系统，左上角为坐标原点。坐标通常以二元元组的形式传递给库使用。矩形需要表示为四元元组，左上角的坐标优先给出。比如，一个包含有800x600像素的图片可写作(0,0,800,600)。</p>
<h1 id="Palette-调色盘"><a href="#Palette-调色盘" class="headerlink" title="Palette(调色盘)"></a>Palette(调色盘)</h1><p>调色盘模式P使用调色盘来定义每个像素实际的颜色。</p>
<h1 id="Info-信息"><a href="#Info-信息" class="headerlink" title="Info(信息)"></a>Info(信息)</h1><p>你可以使用<code>info</code>属性给图片添加辅助信息。这是一个字典对象。当加载或保存图像文件时能够处理多少信息决定于文件格式处理器。大多数处理器加载图像时给<code>info</code>添加属性，但在存储图片时会忽略掉。</p>
<h1 id="Filters-过滤器"><a href="#Filters-过滤器" class="headerlink" title="Filters(过滤器)"></a>Filters(过滤器)</h1><p>对于输入多个像素输出单个像素的几何操作，PIL库提供了四种不同的重取样过滤器。</p>
<p><code>NEAREST</code> - 取出与输入图像最相近的像素，忽略其他输入像素</p>
<p><code>BILINEAR</code> - 在输入图像中2x2环境下使用线性内插。在当前PIL版本，过滤器采样时使用一个固定的输入环境</p>
<p><code>BICUBIC</code> - 在输入图像中的4x4环境使用三次内插。在当前PIL版本，过滤器采样时使用一个固定的输入环境</p>
<p><code>ANTIALIAS</code> - 使用一个高质量的重采样过滤器计算所有可能对输出有影响的像素来得到输出像素。在当前PIL版本，过滤器只能被用在<code>resize()</code>和<code>thumbnail()</code>方法。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[快速入门PIL]]></title>
      <url>http://lizonghang.github.io/2016/07/05/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8PIL/</url>
      <content type="html"><![CDATA[<h1 id="使用Image类"><a href="#使用Image类" class="headerlink" title="使用Image类"></a>使用Image类</h1><p>PIL中最重要的类是<code>Image</code>类，可以通过多种方法创建这个类的实例。可以从文件加载图像，或者处理其他图像，或者从scratch创建。</p>
<p>要从文件加载图像，可使用<code>Image</code>模块的<code>open()</code>函数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from PIL import Image</span><br><span class="line">&gt;&gt;&gt; im = Image.open(&apos;lena.jpg&apos;)</span><br></pre></td></tr></table></figure>
<p>示例用的图片如下:</p>
<p><img src="/images/lena.jpg" alt="lena"></p>
<p>加载成功将返回一个<code>Image</code>对象。可以使用如下命令检查文件内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print im</span><br><span class="line">&lt;PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=500x750 at 0x10B9E3890&gt;</span><br><span class="line">&gt;&gt;&gt; print(im.format, im.size, im.mode)</span><br><span class="line">(&apos;JPEG&apos;, (500, 750), &apos;RGB&apos;)</span><br></pre></td></tr></table></figure>
<p><code>format</code>这个属性标识了图像来源。如果图像不是从文件读取那它的值为None。<code>size</code>属性是一个二元tuple，包含width和height(单位px)。<code>mode</code>属性定义了图像bands的数量和名称，以及像素类型和深度。常见的modes有“L”(luminance)表示灰度图像，“RGB”表示真彩色图像，“CMYK”表示出版图像。</p>
<p>如果文件打开错误，则返回<code>IOError</code>错误。</p>
<p>只要有了<code>Image</code>类的实例，就可以通过类的方法处理图像。比如下面的方法可以用来显示图像:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; im.show()</span><br></pre></td></tr></table></figure>
<pre>
注解：标准的<code>show()</code>效率不高，它需要保存图像到临时文件然后通过xv显示图像。
</pre>

<h1 id="读写图像"><a href="#读写图像" class="headerlink" title="读写图像"></a>读写图像</h1><p>PIL模块支持大量图片格式。使用在<code>Image</code>模块的<code>open()</code>函数从磁盘读取文件。不需要知道文件格式就能打开它，这个库能够根据文件内容自动确定文件格式。</p>
<p>要保存文件，使用<code>Image</code>类的<code>save()</code>方法。保存文件时文件名变得重要了。除非指定格式，否则这个库将会以文件名的扩展名作为格式保存。</p>
<h2 id="创建略缩图"><a href="#创建略缩图" class="headerlink" title="创建略缩图"></a>创建略缩图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from PIL import Image</span><br><span class="line">&gt;&gt;&gt; im = Image.open(&apos;lena.jpg&apos;)</span><br><span class="line">&gt;&gt;&gt; print im.size</span><br><span class="line">(500, 750)</span><br><span class="line">&gt;&gt;&gt; size = (250, 375)</span><br><span class="line">&gt;&gt;&gt; im.thumbnail(size)</span><br><span class="line">&gt;&gt;&gt; print im.size</span><br><span class="line">(250, 375)</span><br></pre></td></tr></table></figure>
<p>使用<code>thumbnail()</code>方法需要注意的是，指定的<code>size</code>应当比原尺寸小，且转换后的图片比例与原图片比例相同。</p>
<h2 id="保存图片"><a href="#保存图片" class="headerlink" title="保存图片"></a>保存图片</h2><p>继续执行下述步骤,将转换后的图片保存:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; im.save(&apos;lena_thumbnail.jpg&apos;, &apos;JPEG&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="剪切、粘贴、合并图像"><a href="#剪切、粘贴、合并图像" class="headerlink" title="剪切、粘贴、合并图像"></a>剪切、粘贴、合并图像</h1><p><code>Image</code>类包含的方法允许操作图像部分选区，使用<code>Image.crop()</code>方法获取图像的一个子矩形选区。</p>
<h2 id="从图像中复制出一个矩形选区"><a href="#从图像中复制出一个矩形选区" class="headerlink" title="从图像中复制出一个矩形选区"></a>从图像中复制出一个矩形选区</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print im.size</span><br><span class="line">(500, 750)</span><br><span class="line">&gt;&gt;&gt; box = (100, 100, 400, 400)</span><br><span class="line">&gt;&gt;&gt; region = im.crop(box)</span><br><span class="line">&gt;&gt;&gt; region.show()</span><br></pre></td></tr></table></figure>
<p>矩形选区有一个四元元组定义，分别表示左上、右下的坐标。这个库以左上角为坐标原点，单位是px，所以上述代码复制了一个 300x300 pixels 的矩形选区。这个选区现在可以被处理并且粘贴到原图。</p>
<p>剪下来的 300x300px 图片如下所示:</p>
<p><img src="/images/lena_cut.jpg" alt="lena_cut"></p>
<h2 id="处理复制的矩形选区并粘贴到原图"><a href="#处理复制的矩形选区并粘贴到原图" class="headerlink" title="处理复制的矩形选区并粘贴到原图"></a>处理复制的矩形选区并粘贴到原图</h2><p>继续上面的步骤:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; region = region.transpose(Image.ROTATE_180)</span><br><span class="line">&gt;&gt;&gt; im.paste(region, box)</span><br><span class="line">&gt;&gt;&gt; im.show()</span><br></pre></td></tr></table></figure>
<p>当粘贴矩形选区的时候必须保证尺寸一致。此外，矩形选区不能在图像外。然而不必保证矩形选区和原图的颜色模式一致，因为矩形选区会被自动转换颜色。</p>
<p>效果图如下:</p>
<p><img src="/images/lena_paste.jpg" alt="lena_paste"></p>
<h2 id="分离和合并颜色通道"><a href="#分离和合并颜色通道" class="headerlink" title="分离和合并颜色通道"></a>分离和合并颜色通道</h2><p>由于上面例子已经对im进行了改变，我们重新将im指向原图片:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; im = Image.open(&apos;lena.jpg&apos;)</span><br><span class="line">&gt;&gt;&gt; r, g, b = im.split()</span><br></pre></td></tr></table></figure>
<p>如果是单色通道的图片，使用<code>split()</code>之后会返回图片本身。你可以使用<code>r.show()</code>来查看分离颜色通道后的图片。</p>
<p><img src="/images/lena_split.jpg" alt="lena_split"></p>
<p>将分离的颜色合并为RGB可用<code>merge()</code>方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; img = Image.merge(&apos;RGB&apos;, (b, g, r))</span><br><span class="line">&gt;&gt;&gt; img.show()</span><br></pre></td></tr></table></figure>
<p>以b,g,r顺序合并成的图片如图所示:</p>
<p><img src="/images/lena_merge.jpg" alt="lena_merge"></p>
<h1 id="几何变换"><a href="#几何变换" class="headerlink" title="几何变换"></a>几何变换</h1><p><code>PIL.Image.Image</code>类包含了设置图像大小<code>resize()</code>和旋转图像<code>rotate()</code>的方法。<code>resize()</code>接收一个元组来指定新大小。<code>rotate()</code>接收一个逆时针的角度值。</p>
<h2 id="简单的几何变换"><a href="#简单的几何变换" class="headerlink" title="简单的几何变换"></a>简单的几何变换</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; print im.size</span><br><span class="line">(500, 750)</span><br><span class="line">&gt;&gt;&gt; im_resize = im.resize((250, 250))</span><br><span class="line">&gt;&gt;&gt; im_resize.show()</span><br><span class="line">&gt;&gt;&gt; im_rotate = im.rotate(45)</span><br><span class="line">&gt;&gt;&gt; im_rotate.show()</span><br></pre></td></tr></table></figure>
<p><code>im_resize.show()</code>效果图如下:</p>
<p><img src="/images/lena_resize.jpg" alt="lena_resize"></p>
<p><code>im_rotate.show()</code>效果图如下:</p>
<p><img src="/images/lena_rotate.jpg" alt="lena_rotate"></p>
<h2 id="旋转图像"><a href="#旋转图像" class="headerlink" title="旋转图像"></a>旋转图像</h2><p>如果要将图片旋转90°的整数倍，可以使用<code>rotate()</code>方法或者<code>transpose()</code>方法。<code>transpose()</code>还可以将图片按照其竖直或水平边缘翻转，由于图片过多不一一展示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">out = im.transpose(Image.FLIP_LEFT_RIGHT)</span><br><span class="line">out = im.transpose(Image.FLIP_TOP_BOTTOM)</span><br><span class="line">out = im.transpose(Image.ROTATE_90)</span><br><span class="line">out = im.transpose(Image.ROTATE_180)</span><br><span class="line">out = im.transpose(Image.ROTATE_270)</span><br></pre></td></tr></table></figure>
<p>使用<code>transpose(ROTATE)</code>和<code>rotate()</code>是没有区别的。更普遍的方法是使用<code>transform()</code>方法。</p>
<h1 id="颜色变换"><a href="#颜色变换" class="headerlink" title="颜色变换"></a>颜色变换</h1><p>Python Imaging Library可以使用<code>convert()</code>方法来实现像素的变换。</p>
<h2 id="颜色模式转换"><a href="#颜色模式转换" class="headerlink" title="颜色模式转换"></a>颜色模式转换</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; im.convert(&apos;L&apos;).show()</span><br></pre></td></tr></table></figure>
<p>PIL库支持各种不同模式之间的转换，比如“L”和“RGB”模式。为了转成其他的模式，需要用一张中间模式图像，典型的为RGB图片。</p>
<h1 id="颜色增强"><a href="#颜色增强" class="headerlink" title="颜色增强"></a>颜色增强</h1><p>PIL库提供了许多方法和模块可以用来增强图像</p>
<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><p><code>ImageFilter</code>模块包含了许多预定义的增强过滤器，通过<code>filter</code>方法调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from PIL import ImageFilter</span><br><span class="line">&gt;&gt;&gt; out = im.filter(ImageFilter.DETAIL)</span><br></pre></td></tr></table></figure>
<h2 id="点操作"><a href="#点操作" class="headerlink" title="点操作"></a>点操作</h2><p><code>point()</code>方法能够用来实现图片像素值的转换(比如图像对比度处理)。在大多数情况下，<code>point()</code>方法接收一个函数体作为参数，每一个像素都根据此函数处理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; out = im.point(lambda i: i * 1.2)</span><br></pre></td></tr></table></figure>
<p>效果图如下，相比原图有增强:</p>
<p><img src="/images/lena_point.jpg" alt="lena_point"></p>
<p>处理个别bands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># split the image into individual bands</span><br><span class="line">source = im.split()</span><br><span class="line"></span><br><span class="line">R, G, B = 0, 1, 2</span><br><span class="line"></span><br><span class="line"># select regions where red is less than 100</span><br><span class="line">mask = source[R].point(lambda i: i &lt; 100 and 255)</span><br><span class="line"></span><br><span class="line"># process the green band</span><br><span class="line">out = source[G].point(lambda i: i * 0.7)</span><br><span class="line"></span><br><span class="line"># paste the processed band back, but only where red was &lt; 100</span><br><span class="line">source[G].paste(out, None, mask)</span><br><span class="line"></span><br><span class="line"># build a new multiband image</span><br><span class="line">im = Image.merge(im.mode, source)</span><br></pre></td></tr></table></figure>
<p>效果和原图差异不大，就不上图了。需要注意的是这个语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imout = im.point(lambda i: expression and 255)</span><br></pre></td></tr></table></figure>
<p>如果expression的值为false/0，则and之后的不再检查，直接返回0。如果expression的值为true/非0，判断and之后的表达式，并返回最后一个检查的值，语句返回255。</p>
<h2 id="增强"><a href="#增强" class="headerlink" title="增强"></a>增强</h2><p>要使用更多先进的图片增强功能，可以使用模块<code>ImageEnhance</code>中的类。你可以通过它调整对比度、亮度、颜色平衡度和尖锐度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from PIL import ImageEnhance</span><br><span class="line"></span><br><span class="line">enh = ImageEnhance.Contrast(im)</span><br><span class="line">enh.enhance(0.5).show(&quot;50% less contrast&quot;)</span><br></pre></td></tr></table></figure>
<p>对比度降低50%后效果如下:</p>
<p><img src="/images/lena_contrast.jpg" alt="lena_contrast"></p>
<h1 id="多帧图像序列"><a href="#多帧图像序列" class="headerlink" title="多帧图像序列"></a>多帧图像序列</h1><p>PIL支持图像序列(动画格式)。支持的序列格式包括FLI/FLC,GIF等。TIFF文件也能包含许多帧。打开一个序列文件时，PIL自动装载序列的第一帧。你可以使用函数来移动帧。参考图片如下:</p>
<p><img src="/images/niko.gif" alt="niko"></p>
<h2 id="读取序列"><a href="#读取序列" class="headerlink" title="读取序列"></a>读取序列</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">im = Image.open(&quot;niko.gif&quot;)</span><br><span class="line">im.seek(0) # 跳到第一帧</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    while 1:</span><br><span class="line">        im.seek(im.tell()+1) # 跳到下一帧，tell()方法返回目前的帧序号</span><br><span class="line">        im.show()</span><br><span class="line">except EOFError:</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<p>以前的PIL库只允许seek到下一帧，如果要倒回去需要重新打开。而现在的PIL库你可以seek到任意帧。</p>
<h2 id="序列迭代类"><a href="#序列迭代类" class="headerlink" title="序列迭代类"></a>序列迭代类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">class ImageSequence:</span><br><span class="line">    def __init__(self, im):</span><br><span class="line">        self.im = im</span><br><span class="line">    def __getitem__(self, ix):</span><br><span class="line">        try:</span><br><span class="line">            if ix:</span><br><span class="line">                self.im.seek(ix)</span><br><span class="line">            return self.im</span><br><span class="line">        except EOFError:</span><br><span class="line">            raise IndexError</span><br><span class="line"></span><br><span class="line">im = Image.open(&apos;niko.gif&apos;)</span><br><span class="line">for frame in ImageSequence(im):</span><br><span class="line">    frame.show()</span><br></pre></td></tr></table></figure>
<h1 id="更多关于读取图像"><a href="#更多关于读取图像" class="headerlink" title="更多关于读取图像"></a>更多关于读取图像</h1><p><code>Image.open()</code>方法是用来打开一个图片文件的。大多数情况下可以简单的将图像文件名作参数传入:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">im = Image.open(&apos;lena.jpg&apos;)</span><br></pre></td></tr></table></figure>
<p>正常返回结果是一个<code>PIL.Image.Image</code>实例。否则会抛出<code>IOError</code>错误。</p>
<p>你可以传入一个类文件代替文件名。这个类文件必须实现<code>read()</code>，<code>seek()</code>，<code>tell()</code>方法，并且以二进制模式打开。</p>
<h2 id="从文件读取"><a href="#从文件读取" class="headerlink" title="从文件读取"></a>从文件读取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; fp = open(&apos;lena.jpg&apos;, &apos;rb&apos;)</span><br><span class="line">&gt;&gt;&gt; im = Image.open(fp)</span><br></pre></td></tr></table></figure>
<h2 id="从string读取"><a href="#从string读取" class="headerlink" title="从string读取"></a>从string读取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import urllib2</span><br><span class="line">&gt;&gt;&gt; import StringIO</span><br><span class="line">&gt;&gt;&gt; from PIL import Image</span><br><span class="line">&gt;&gt;&gt; headers = &#123;&apos;User-Agent&apos;: &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36&apos;&#125;</span><br><span class="line">&gt;&gt;&gt; req = urllib2.Request(&apos;http://tupian.enterdesk.com/2014/mxy/06/19/1/8.jpg&apos;, headers=headers)</span><br><span class="line">&gt;&gt;&gt; buffer = urllib2.urlopen(req).read()</span><br><span class="line">&gt;&gt;&gt; im = Image.open(StringIO.StringIO(buffer))</span><br><span class="line">&gt;&gt;&gt; im.show()</span><br></pre></td></tr></table></figure>
<p>使用的示例图片如下:</p>
<p><img src="/images/string_pic.jpg" alt=""></p>
<h2 id="从压缩包读取"><a href="#从压缩包读取" class="headerlink" title="从压缩包读取"></a>从压缩包读取</h2><p>为示范，先将一些文件例如”lena.jpg”和”niko.gif”打包，压缩包名假设为”Imaging.tar”。从压缩包中读取”lena.jpg”可使用<code>TarIO.TarIO()</code>方法获取图片，并交由<code>Image.open()</code>处理。(Linux/Unix系统下可以简单使用<code>tar -cvf Imaging.tar lena.jpg niko.gif </code>打包为tar压缩格式)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from PIL import Image, TarIO</span><br><span class="line">&gt;&gt;&gt; fp = TarIO.TarIO(&apos;Imaging.tar&apos;, &apos;lena.jpg&apos;)</span><br><span class="line">&gt;&gt;&gt; im = Image.open(fp)</span><br></pre></td></tr></table></figure>
<p>注意：对zip压缩包进行操作时可能会出现解码错误。</p>
<h1 id="控制解码器"><a href="#控制解码器" class="headerlink" title="控制解码器"></a>控制解码器</h1><p>部分解码器支持在读取图片文件的时候对图像进行处理，常用于创建略缩图时加速解码速度(当速度比质量重要时)和传输给单色激光打印机时()。<code>draft()</code>方法可以在图像尚未加载完时对其进行处理，所以给定的模式和大小尽可能的匹配。这是通过重新配置图像解码器完成的。</p>
<h2 id="在草稿模式读取"><a href="#在草稿模式读取" class="headerlink" title="在草稿模式读取"></a>在草稿模式读取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from PIL import Image</span><br><span class="line">&gt;&gt;&gt; im = Image.open(file)</span><br><span class="line">&gt;&gt;&gt; print(&quot;original =&quot;, im.mode, im.size)</span><br><span class="line">&gt;&gt;&gt; im.draft(&quot;L&quot;, (100, 100))</span><br><span class="line">&gt;&gt;&gt; print(&quot;draft =&quot;, im.mode, im.size)</span><br></pre></td></tr></table></figure>
<p>输出结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">original= RGB (500, 750)</span><br><span class="line">draft= L (125, 188)</span><br></pre></td></tr></table></figure>
<p>注意得到的图片可能不会完全的匹配给定的模式和大小。为了保证图像不比给定的大小大，使用<code>im.thumbnail()</code>方法来代替。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[基于Scrapy的天气数据采集]]></title>
      <url>http://lizonghang.github.io/2016/07/05/%E5%9F%BA%E4%BA%8EScrapy%E7%9A%84%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/</url>
      <content type="html"><![CDATA[<p>很多网站都提供了浏览者本地的天气信息，这些信息大多是利用某些网站提供的天气API获取的，也有利用爬虫采集的。本文介绍如何用Scrapy来采集天气信息。天气信息来源为<a href="http://weather.sina.com.cn/" target="_blank" rel="external">新浪天气频道</a>。本文提取“国内”栏目的天气信息。</p>
<p>Scrapy是Python开发的一个快速,高层次的屏幕抓取和web抓取框架，用于抓取web站点并从页面中提取结构化的数据。用途广泛，可以用于数据挖掘、监测和自动化测试。</p>
<p>如果你还没有安装Scrapy，请参考官方的<a href="http://doc.scrapy.org/en/latest/intro/install.html" target="_blank" rel="external">安装向导</a>或在网上查找安装方法。</p>
<h1 id="创建Scrapy项目"><a href="#创建Scrapy项目" class="headerlink" title="创建Scrapy项目"></a>创建Scrapy项目</h1><p>在开始爬取之前，需要创建一个scrapy项目。进入需要存储代码的目录，执行命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scrapy startproject weather</span><br></pre></td></tr></table></figure>
<p>正常初始化的文件内容应该是这样的:</p>
<p><img src="/images/weather_tree.png" alt="weather-dir"></p>
<h1 id="定义Item"><a href="#定义Item" class="headerlink" title="定义Item"></a>定义Item</h1><p>Item是保存爬取到的数据的容器，使用方法和Python字典相似，并且提供了额外的保护机制来避免拼写错误导致的未定义字段错误。</p>
<p>首先需要根据从<code><a href="http://weather.sina.com.cn/china/" target="_blank" rel="external">http://weather.sina.com.cn/china/</a></code>中获取到的数据对item进行建模。需要的内容如图:</p>
<p><img src="/images/item.png" alt="item"></p>
<p>编辑weather/items.py文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import scrapy</span><br><span class="line"></span><br><span class="line">class WeatherItem(scrapy.Item):</span><br><span class="line">    county = scrapy.Field() # 县/区</span><br><span class="line">    weather_day = scrapy.Field() # 白天天气</span><br><span class="line">    wind_day = scrapy.Field() # 白天风向</span><br><span class="line">    temperate_max = scrapy.Field() # 最高温度</span><br><span class="line">    weather_night = scrapy.Field() # 夜间天气</span><br><span class="line">    wind_night = scrapy.Field() # 夜间风向</span><br><span class="line">    temperate_min = scrapy.Field() # 最低温度</span><br></pre></td></tr></table></figure>
<h1 id="编写Spider"><a href="#编写Spider" class="headerlink" title="编写Spider"></a>编写Spider</h1><p>Spider是用户编写的用于从单个或多个网页中爬取数据的类。为了创建一个Spider，必须继承scrapy.Spider类，且定义以下三个属性:</p>
<ul>
<li>name - 用于区别Spider。该名字必须是唯一的，不可以给不同的Spider使用相同的名字。</li>
<li>start_urls - 包含了Spider在启动时爬取的url列表。是Spider第一轮爬取的链接。后续的URL则从初始URL获取到的数据中提取。</li>
<li>parse(self, response) - 被调用时，每个初始URL完成下载后生成的Response对象将会作为唯一的参数传递给该函数。该方法负责解析返回的数据，提取数据以及生成需要进一步处理的URL的Request对象。</li>
</ul>
<p>首先分析一下需要爬取的数据的位置和网页源代码:</p>
<p><img src="/images/province.png" alt="province"></p>
<p><img src="/images/province_code.png" alt="code"></p>
<p>我们可以看到，全国城市都位于一个<code>class=”wd_piC”</code>的<code>div</code>中的<code>a</code>标签中，于是我们可以使用如下代码来提取各省份的链接。保存于weather/spiders目录下的localweather.py文件中:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def parse(self, response):</span><br><span class="line">    selector = scrapy.Selector(response)</span><br><span class="line">    for num in selector.xpath(&apos;//div[@class=&quot;wd_piC&quot;]&apos;):</span><br><span class="line">        for province in num.xpath(&apos;a&apos;):</span><br><span class="line">            self.provinces.append(province.xpath(&apos;@href&apos;).extract()[0])</span><br><span class="line">    yield Request(self.provinces.pop(), callback=self.getCountyWeather)</span><br></pre></td></tr></table></figure>
<p>上述操作将所有省份的链接提取出来，存储到一个叫<code>provinces</code>的列表中，然后从中取出一个链接，进行下一次爬取。在编写回调函数getCountyWeather之前，先查看数据的位置和网页源代码:</p>
<p><img src="/images/county.png" alt="county"></p>
<p><img src="/images/county_code.png" alt="code"></p>
<p>我们需要的信息在多个<code>class=”wd_cm_table”</code>的<code>table</code>标签中，每条信息又在其中的多个<code>tr</code>标签中，最后标签<code>td</code>中含有我们需要的信息。</p>
<p>用于获取这些信息的方法getCountyWeather()代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def getCountyWeather(self, response):</span><br><span class="line">    item = WeatherItem()</span><br><span class="line">    selector = scrapy.Selector(response)</span><br><span class="line">    for table in selector.xpath(&apos;//table[@class=&quot;wd_cm_table&quot;]&apos;):</span><br><span class="line">        for each_row in table.xpath(&apos;tr&apos;):</span><br><span class="line">            tds = each_row.xpath(&apos;td&apos;)</span><br><span class="line">            item[&apos;county&apos;] = tds[0].xpath(&apos;a/text()&apos;).extract()[0]</span><br><span class="line">            item[&apos;weather_day&apos;] = tds[1].xpath(&apos;p/text()&apos;).extract()[0]</span><br><span class="line">            item[&apos;wind_day&apos;] = tds[2].xpath(&apos;text()&apos;).extract()[0]</span><br><span class="line">            item[&apos;temperate_max&apos;] = tds[3].xpath(&apos;text()&apos;).extract()[0]</span><br><span class="line">            item[&apos;weather_night&apos;] = tds[4].xpath(&apos;p/text()&apos;).extract()[0]</span><br><span class="line">            item[&apos;wind_night&apos;] = tds[5].xpath(&apos;text()&apos;).extract()[0]</span><br><span class="line">            item[&apos;temperate_min&apos;] = tds[6].xpath(&apos;text()&apos;).extract()[0]</span><br><span class="line">            yield item</span><br><span class="line">    if len(self.provinces) &gt; 0:</span><br><span class="line">        yield Request(self.provinces.pop(), callback=self.getCountyWeather)</span><br><span class="line">    else:</span><br><span class="line">        print &apos;The Spider Has Finished Its Work! Wish To Meet U Later!&apos;</span><br></pre></td></tr></table></figure>
<h1 id="整体代码"><a href="#整体代码" class="headerlink" title="整体代码"></a>整体代码</h1><p>localweather.py中的全部代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># encoding: utf-8</span><br><span class="line">import scrapy</span><br><span class="line">from scrapy.http import Request</span><br><span class="line">from weather.items import WeatherItem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class WeatherSpider(scrapy.Spider):</span><br><span class="line">    name = &apos;WeatherSpider&apos;</span><br><span class="line">    allowed_domains = [&apos;sina.com.cn&apos;]</span><br><span class="line">    start_urls = [&apos;http://weather.sina.com.cn/china/&apos;]</span><br><span class="line">    provinces = []</span><br><span class="line"></span><br><span class="line">    def parse(self, response):</span><br><span class="line">        selector = scrapy.Selector(response)</span><br><span class="line">        for num in selector.xpath(&apos;//div[@class=&quot;wd_piC&quot;]&apos;):</span><br><span class="line">            for province in num.xpath(&apos;a&apos;):</span><br><span class="line">                self.provinces.append(province.xpath(&apos;@href&apos;).extract()[0])</span><br><span class="line">        yield Request(self.provinces.pop(), callback=self.getCountyWeather)</span><br><span class="line"></span><br><span class="line">    def getCountyWeather(self, response):</span><br><span class="line">        item = WeatherItem()</span><br><span class="line">        selector = scrapy.Selector(response)</span><br><span class="line">        for table in selector.xpath(&apos;//table[@class=&quot;wd_cm_table&quot;]&apos;):</span><br><span class="line">            for each_row in table.xpath(&apos;tr&apos;):</span><br><span class="line">                tds = each_row.xpath(&apos;td&apos;)</span><br><span class="line">                item[&apos;county&apos;] = tds[0].xpath(&apos;a/text()&apos;).extract()[0]</span><br><span class="line">                item[&apos;weather_day&apos;] = tds[1].xpath(&apos;p/text()&apos;).extract()[0]</span><br><span class="line">                item[&apos;wind_day&apos;] = tds[2].xpath(&apos;text()&apos;).extract()[0]</span><br><span class="line">                item[&apos;temperate_max&apos;] = tds[3].xpath(&apos;text()&apos;).extract()[0]</span><br><span class="line">                item[&apos;weather_night&apos;] = tds[4].xpath(&apos;p/text()&apos;).extract()[0]</span><br><span class="line">                item[&apos;wind_night&apos;] = tds[5].xpath(&apos;text()&apos;).extract()[0]</span><br><span class="line">                item[&apos;temperate_min&apos;] = tds[6].xpath(&apos;text()&apos;).extract()[0]</span><br><span class="line">                yield item</span><br><span class="line">        if len(self.provinces) &gt; 0:</span><br><span class="line">            yield Request(self.provinces.pop(), callback=self.getCountyWeather)</span><br><span class="line">        else:</span><br><span class="line">            print &apos;The Spider Has Finished Its Work! Wish To Meet U Later!&apos;</span><br></pre></td></tr></table></figure>
<h1 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出"></a>数据导出</h1><p>存储到Item中的数据可以导出为JSON/JSON lines/CSV/XML格式的文件。以导出为CSV文件为例，其他的请参考<a href="http://doc.scrapy.org/en/1.1/topics/feed-exports.html" target="_blank" rel="external">官方说明</a>。需要修改weather/settings.py中的配置，在配置最后添加代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FEED_URI = u&apos;~/Desktop/Weather.csv&apos; # 存储csv文件的目录，可任意修改</span><br><span class="line">FEED_FORMAT = &apos;CSV&apos; # 存储格式为csv，可修改为json等其他格式</span><br></pre></td></tr></table></figure>
<p>随后，在项目的scrapt.cfg文件同级目录下使用命令，运行爬虫:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scrapy crawl WeatherSpider</span><br></pre></td></tr></table></figure>
<p>等待运行结束，得到一个csv文件如下所示，显示为乱码，这是由于编码问题造成的:</p>
<p><img src="/images/csverr.png" alt="csv"></p>
<p>将csv文件用Sublime Text打开，点击File-&gt;Save with Encoding-&gt;UTF-8 with BOM，再用Excel打开，即可恢复正常。该文件中包含了全国所有城市的天气情况。</p>
<p><img src="/images/csv1.png" alt="csv"></p>
<p>然而，csv文件中的顺序并不是按照Items.py中指定的顺序来的，可作如下修改:</p>
<p>第一步:在scrapy的spider同层目录下，新建CsvItemExporter.py文件夹，内容如下(文件名可修改):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from scrapy.conf import settings</span><br><span class="line">from scrapy.contrib.exporter import CsvItemExporter</span><br><span class="line"></span><br><span class="line">class ProjectCsvItemExporter(CsvItemExporter):</span><br><span class="line">    def __init__(self, *args, **kwargs):</span><br><span class="line">        kwargs[&apos;delimiter&apos;] = settings.get(&apos;CSV_DELIMITER&apos;, &apos;,&apos;)</span><br><span class="line">        if settings.get(&apos;FIELDS_TO_EXPORT&apos;, []):</span><br><span class="line">            kwargs[&apos;fields_to_export&apos;] = settings.get(&apos;FIELDS_TO_EXPORT&apos;, [])</span><br><span class="line"></span><br><span class="line">        super(ProjectCsvItemExporter, self).__init__(*args, **kwargs)</span><br></pre></td></tr></table></figure>
<p>第二步:在settings.py文件末新增如下内容，指定item的field顺序:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FEED_EXPORTERS = &#123;</span><br><span class="line">    # 项目名.文件名.类名</span><br><span class="line">    &apos;csv&apos;: &apos;weather.CsvItemExporter.ProjectCsvItemExporter&apos;, </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 导出字段顺序</span><br><span class="line">FIELDS_TO_EXPORT = [</span><br><span class="line">    &apos;county&apos;,</span><br><span class="line">    &apos;weather_day&apos;,</span><br><span class="line">    &apos;wind_day&apos;,</span><br><span class="line">    &apos;temperate_max&apos;,</span><br><span class="line">    &apos;weather_night&apos;,</span><br><span class="line">    &apos;wind_night&apos;,</span><br><span class="line">    &apos;temperate_min&apos;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>第三步:再次运行爬虫，获取的csv文件内容如下所示:</p>
<p><img src="/images/csv2.png" alt="csv"></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>关于为Item指定中文名的问题作者暂时还未找到类似django model中verbose_name参数的解决方法，若有需要可在程序末对csv文件进行文件IO处理，替换第一行。或者取代scrapy的文件导出，自行将数据导出到csv文件。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Python文本解释器]]></title>
      <url>http://lizonghang.github.io/2016/07/05/Python%E6%96%87%E6%9C%AC%E8%A7%A3%E9%87%8A%E5%99%A8/</url>
      <content type="html"><![CDATA[<p>实现了一个使用Python来解析纯文本文件来生成一个HTML页面的程序，即TXT文本转Markdown。功能不是很完善，其他转换可用类似的方法实现。</p>
<h1 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h1><h2 id="纯文本文件"><a href="#纯文本文件" class="headerlink" title="纯文本文件:"></a>纯文本文件:</h2><pre>
Welcome to ShiYanLou

ShiYanLou is the first experiment with IT as the core of online education platform.*Our aim is to do the experiment, easy to learn IT*.

Course

-Basic Course

-Project Course

-Evaluation Course

Contact us

-Web:http://www.shiyanlou.com

-QQ Group:241818371

-E-mail:support@shiyanlou.com

</pre>

<h2 id="解析后HTML页面"><a href="#解析后HTML页面" class="headerlink" title="解析后HTML页面:"></a>解析后HTML页面:</h2><p><img src="https://dn-anything-about-doc.qbox.me/python_markup/1.png" alt="test.html"></p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><h2 id="文本块生成器"><a href="#文本块生成器" class="headerlink" title="文本块生成器"></a>文本块生成器</h2><p>首先需要有一个文本块生成器把纯文本分成一个一个文本块，以便接下来对每一个文本块进行解析，util.py代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># encoding: utf-8</span><br><span class="line"></span><br><span class="line">def lines(file):</span><br><span class="line">    &apos;&apos;&apos;生成器，在文本最后加一空行&apos;&apos;&apos;</span><br><span class="line">    for line in file:</span><br><span class="line">        yield line</span><br><span class="line">    yield &apos;\n&apos;</span><br><span class="line"></span><br><span class="line">def blocks(file):</span><br><span class="line">    &apos;&apos;&apos;生成器，生成单独的文本块&apos;&apos;&apos;</span><br><span class="line">    block = []</span><br><span class="line">    for line in lines(file):</span><br><span class="line">        if line.strip():</span><br><span class="line">            block.append(line)</span><br><span class="line">        elif block:</span><br><span class="line">            yield &apos;&apos;.join(block).strip()</span><br><span class="line">            block = []</span><br></pre></td></tr></table></figure>
<h2 id="处理程序"><a href="#处理程序" class="headerlink" title="处理程序"></a>处理程序</h2><p>通过文本生成器得到了一个一个的文本块，然后需要有处理程序对不同的文本块添加相应的HTML标记，handlers.py代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># encoding: utf-8</span><br><span class="line"></span><br><span class="line">class Handler:</span><br><span class="line">    &apos;&apos;&apos;处理程序父类&apos;&apos;&apos;</span><br><span class="line">    def callback(self, prefix, name, *args):</span><br><span class="line">        method = getattr(self, prefix+name, None) # 检查是否有对应类型的方法</span><br><span class="line">        if callable(method): # 检查函数是否可调用，若可调用，执行调用函数并返回结果</span><br><span class="line">			return method(*args)</span><br><span class="line"></span><br><span class="line">	def start(self, name):</span><br><span class="line">		self.callback(&apos;start_&apos;, name)</span><br><span class="line"></span><br><span class="line">	def end(self, name):</span><br><span class="line">		self.callback(&apos;end_&apos;, name)</span><br><span class="line"></span><br><span class="line">    def sub(self, name):</span><br><span class="line">		def substitution(match):</span><br><span class="line">            result = self.callback(&apos;sub_&apos;, name, match) # 若有相应处理函数，就替换文本并返回给result</span><br><span class="line">            if result is None: # 否则给result赋原文</span><br><span class="line">				result = match.group(0)</span><br><span class="line">			return result</span><br><span class="line">		return substitution</span><br><span class="line"></span><br><span class="line">class HTMLRenderer(Handler):</span><br><span class="line">	&apos;&apos;&apos;HTML处理程序,给文本块加相应的HTML标记&apos;&apos;&apos;</span><br><span class="line">	def start_document(self):</span><br><span class="line">		print &apos;&lt;html&gt;&lt;head&gt;&lt;title&gt;TXT to Markdown&lt;/title&gt;&lt;/head&gt;&lt;/html&gt;&lt;body&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def end_document(self):</span><br><span class="line">		print &apos;&lt;/body&gt;&lt;/html&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def start_paragraph(self):</span><br><span class="line">		print &apos;&lt;p style=&quot;color: #444&quot;&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def end_paragraph(self):</span><br><span class="line">		print &apos;&lt;/p&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def start_heading(self):</span><br><span class="line">		print &apos;&lt;h2 style=&quot;color: #68BE5D;&quot;&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def end_heading(self):</span><br><span class="line">		print &apos;&lt;/h2&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def start_list(self):</span><br><span class="line">		print &apos;&lt;ul style=&quot;color: #363736;&quot;&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def end_list(self):</span><br><span class="line">		print &apos;&lt;/ul&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def start_listitem(self):</span><br><span class="line">		print &apos;&lt;li&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def end_listitem(self):</span><br><span class="line">		print &apos;&lt;/li&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def start_title(self):</span><br><span class="line">		print &apos;&lt;h1 style=&quot;color: #1ABC9C;&quot;&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def end_title(self):</span><br><span class="line">		print &apos;&lt;/h1&gt;&apos;</span><br><span class="line"></span><br><span class="line">	def sub_emphasis(self, match):</span><br><span class="line">		return &apos;&lt;em&gt;%s&lt;/em&gt;&apos; % match.group(1)</span><br><span class="line"></span><br><span class="line">	def sub_url(self, match):</span><br><span class="line">		return &apos;&lt;a target=&quot;_blank&quot; style=&quot;text-decoration: none;color: #BC1A4B;&quot; href=&quot;%s&quot;&gt;%s&lt;/a&gt;&apos; % (match.group(1), match.group(1))</span><br><span class="line"></span><br><span class="line">	def sub_mail(self, match):</span><br><span class="line">		return &apos;&lt;a style=&quot;text-decoration: none;color: #BC1A4B;&quot; href=&quot;mailto:%s&quot;&gt;%s&lt;/a&gt;&apos; % (match.group(1), match.group(1))</span><br><span class="line"></span><br><span class="line">	def feed(self, data):</span><br><span class="line">		print data</span><br></pre></td></tr></table></figure>
<h2 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h2><p>有了处理程序和文本块生成器，接下来就需要一定的规则来判断每个文本块交给处理程序时要加什么标记，rules.py代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># encoding: utf-8</span><br><span class="line"></span><br><span class="line">class Rule:</span><br><span class="line">    def action(self, block, handler): # 包装数据块</span><br><span class="line">		&apos;&apos;&apos;加标记&apos;&apos;&apos;</span><br><span class="line">        handler.start(self.type) # 标签头</span><br><span class="line">        handler.feed(block) # 数据块</span><br><span class="line">        handler.end(self.type) # 标签尾</span><br><span class="line">		return True</span><br><span class="line"></span><br><span class="line">class HeadingRule(Rule):</span><br><span class="line">	&apos;&apos;&apos;一号标题规则&apos;&apos;&apos;</span><br><span class="line">	type = &apos;heading&apos;</span><br><span class="line">	def condition(self, block):</span><br><span class="line">		&apos;&apos;&apos;判断文本块是否符合规则&apos;&apos;&apos;</span><br><span class="line">		return not &apos;\n&apos; in block and len(block) &lt;= 70 and not block[-1] == &apos;:&apos;</span><br><span class="line"></span><br><span class="line">class TitleRule(HeadingRule):</span><br><span class="line">	&apos;&apos;&apos;二号标题规则&apos;&apos;&apos;</span><br><span class="line">	type = &apos;title&apos;</span><br><span class="line">	first = True</span><br><span class="line">	def condition(self, block):</span><br><span class="line">		if not self.first:</span><br><span class="line">			return False</span><br><span class="line">		self.first = False;</span><br><span class="line">		return HeadingRule.condition(self, block)</span><br><span class="line"></span><br><span class="line">class ListItemRule(Rule):</span><br><span class="line">	&apos;&apos;&apos;列表项规则&apos;&apos;&apos;</span><br><span class="line">	type = &apos;listitem&apos;</span><br><span class="line">    def condition(self, block): # 以&apos;-&apos;开头的数据块是列表项</span><br><span class="line">		return block[0] == &apos;-&apos;</span><br><span class="line"></span><br><span class="line">    def action(self, block, handler): # 重写包装函数</span><br><span class="line">		handler.start(self.type)</span><br><span class="line">		handler.feed(block[1:].strip())</span><br><span class="line">		handler.end(self.type)</span><br><span class="line">		return True</span><br><span class="line"></span><br><span class="line">class ListRule(ListItemRule):</span><br><span class="line">	&apos;&apos;&apos;列表规则&apos;&apos;&apos;</span><br><span class="line">	type = &apos;list&apos;</span><br><span class="line">	inside = False</span><br><span class="line">	def condition(self, block):</span><br><span class="line">		return True</span><br><span class="line"></span><br><span class="line">	def action(self, block, handler):</span><br><span class="line">		if not self.inside and ListItemRule.condition(self, block):</span><br><span class="line">			handler.start(self.type)</span><br><span class="line">			self.inside = True</span><br><span class="line">		elif self.inside and not ListItemRule.condition(self, block):</span><br><span class="line">			handler.end(self.type)</span><br><span class="line">			self.inside = False</span><br><span class="line">		return False</span><br><span class="line"></span><br><span class="line">class ParagraphRule(Rule):</span><br><span class="line">	&apos;&apos;&apos;段落规则&apos;&apos;&apos;</span><br><span class="line">	type = &apos;paragraph&apos;</span><br><span class="line">	def condition(self, block):</span><br><span class="line">		return True</span><br></pre></td></tr></table></figure>
<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>最后就可以在主函数中进行解析了，markup.py代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># encoding: utf-8</span><br><span class="line"></span><br><span class="line">import sys, re</span><br><span class="line">from handlers import *</span><br><span class="line">from util import *</span><br><span class="line">from rules import *</span><br><span class="line"></span><br><span class="line">class Parser:</span><br><span class="line">	&apos;&apos;&apos;解析器父类&apos;&apos;&apos;</span><br><span class="line">	def __init__(self, handler):</span><br><span class="line">		self.handler = handler</span><br><span class="line">		self.rules = []</span><br><span class="line">		self.filters = []</span><br><span class="line"></span><br><span class="line">	def addRule(self, rule):</span><br><span class="line">		self.rules.append(rule)</span><br><span class="line"></span><br><span class="line">	def addFilter(self, pattern, name):</span><br><span class="line">		def filter(block, handler):</span><br><span class="line">			return re.sub(pattern, handler.sub(name), block)</span><br><span class="line">		self.filters.append(filter)</span><br><span class="line"></span><br><span class="line">	def parse(self, file):</span><br><span class="line">        self.handler.start(&apos;document&apos;) # 初始html部分</span><br><span class="line">		for block in blocks(file):</span><br><span class="line">			for filter in self.filters:</span><br><span class="line">                block = filter(block, self.handler) # 过滤block中的关键符号，em，url，email等</span><br><span class="line">			for rule in self.rules:</span><br><span class="line">                if rule.condition(block): # 如果满足替换规则，给block添加相应标签</span><br><span class="line">					last = rule.action(block, self.handler)</span><br><span class="line">					if last:	break</span><br><span class="line">        self.handler.end(&apos;document&apos;) # html结尾部分</span><br><span class="line"></span><br><span class="line">class BasicTextParser(Parser):</span><br><span class="line">	&apos;&apos;&apos;纯文本解析器&apos;&apos;&apos;</span><br><span class="line">	def __init__(self, handler):</span><br><span class="line">        Parser.__init__(self, handler) # 父类初始化</span><br><span class="line">        self.addRule(ListRule()) # 添加规则</span><br><span class="line">		self.addRule(ListItemRule())</span><br><span class="line">		self.addRule(TitleRule())</span><br><span class="line">		self.addRule(HeadingRule())</span><br><span class="line">		self.addRule(ParagraphRule())</span><br><span class="line">        self.addFilter(r&apos;\*(.+?)\*&apos;, &apos;emphasis&apos;) # 添加过滤器</span><br><span class="line">		self.addFilter(r&apos;(http://[\.a-zA-Z/]+)&apos;, &apos;url&apos;)</span><br><span class="line">		self.addFilter(r&apos;([\.a-zA-Z]+@[\.a-zA-Z]+[a-zA-Z]+)&apos;, &apos;mail&apos;)</span><br><span class="line"></span><br><span class="line"># 主程序</span><br><span class="line">handler = HTMLRenderer()</span><br><span class="line">parser = BasicTextParser(handler)</span><br><span class="line">parser.parse(sys.stdin)</span><br></pre></td></tr></table></figure>
<h1 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h1><p>假设纯文本文件为test.txt，生成HTML文件为test.html:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python markup.py &lt; test.txt &gt; test.html</span><br></pre></td></tr></table></figure>
<p>需要注意的是，命令中<code>&lt;和&gt;</code>是stdin和stdout的标识，而不是将test.txt扩起的意思。</p>
<p>可自行扩展其他的转换功能，以实现类似于Mou的功能。关于markdown的使用和说明可参考<a href="http://www.appinn.com/markdown/" target="_blank" rel="external">markdown语法说明(简明中文版)</a>。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[argparse模块]]></title>
      <url>http://lizonghang.github.io/2016/07/04/argparse%E6%A8%A1%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>argparse是命令行选项、参数和子命令的解析器。argparse使得我们更容易写出用户友好的命令行接口。程序决定了它需要的哪些参数，argparse会指出如何将那些参数从sys.argv中解析出来。当使用者给程序提供了无效的参数时，argparse模块能够自动的生成帮助信息、使用信息和错误信息提示使用者。</p>
<p>转自：<a href="https://docs.python.org/2/library/argparse.html#module-argparse" target="_blank" rel="external">《argparse - Parser for command-line options, arguments and sub-commands》</a></p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><p>下面的代码演示了程序求一系列整数的和或最大值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser(description=&apos;Process some integers.&apos;)</span><br><span class="line">parser.add_argument(&apos;integers&apos;, metavar=&apos;N&apos;, type=int, nargs=&apos;+&apos;,</span><br><span class="line">                    help=&apos;an integer for the accumulator&apos;)</span><br><span class="line">parser.add_argument(&apos;--sum&apos;, dest=&apos;accumulate&apos;, action=&apos;store_const&apos;,</span><br><span class="line">                    const=sum, default=max,</span><br><span class="line">                    help=&apos;sum the integers (default: find the max)&apos;)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line">print args.accumulate(args.integers)</span><br></pre></td></tr></table></figure>
<p>假设代码保存于文件<code>prog.py</code>，它能够在命令行运行并提供有用的帮助信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ python prog.py -h</span><br><span class="line">usage: prog.py [-h] [--sum] N [N ...]</span><br><span class="line"></span><br><span class="line">Process some integers.</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line"> N           an integer for the accumulator</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"> --sum       sum the integers (default: find the max)</span><br></pre></td></tr></table></figure>
<p>当输入合适的参数时，程序会打印出命令行参数的和或最大值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python prog.py 1 2 3 4</span><br><span class="line">4</span><br><span class="line"></span><br><span class="line">$ python prog.py 1 2 3 4 --sum</span><br><span class="line">10</span><br></pre></td></tr></table></figure>
<p>如果提供了无效的参数，程序给出错误信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python prog.py a b c</span><br><span class="line">usage: prog.py [-h] [--sum] N [N ...]</span><br><span class="line">prog.py: error: argument N: invalid int value: &apos;a&apos;</span><br></pre></td></tr></table></figure>
<h2 id="Creating-a-parser"><a href="#Creating-a-parser" class="headerlink" title="Creating a parser"></a>Creating a parser</h2><p>使用argparse的第一步是创建一个ArgumentParser实例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(description=&apos;Process some integers.&apos;)</span><br></pre></td></tr></table></figure>
<p>ArgumentParser实例会存储将命令行参数解析为Python数据类型的关键信息。</p>
<h2 id="Adding-Arguments"><a href="#Adding-Arguments" class="headerlink" title="Adding Arguments"></a>Adding Arguments</h2><p>为ArgumentParser实例添加关于程序参数的信息是通过方法<code>add_argument()</code>完成的。通常这些叫做，告诉ArgumentParser如何从命令行字符串中提取字符串并转换为实例。当<code>parse_args()</code>被调用时这些信息被存储并调用。例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;integers&apos;, metavar=&apos;N&apos;, type=int, nargs=&apos;+&apos;,</span><br><span class="line">...                     help=&apos;an integer for the accumulator&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--sum&apos;, dest=&apos;accumulate&apos;, action=&apos;store_const&apos;,</span><br><span class="line">...                     const=sum, default=max,</span><br><span class="line">...                     help=&apos;sum the integers (default: find the max)&apos;)</span><br></pre></td></tr></table></figure>
<p>随后，调用<code>parse_args()</code>会返回一个带有两个属性的对象：<code>integers</code>和<code>accumulate</code>。<code>integers</code>属性是一个或多个整数列表，<code>accumulate</code>属性是函数<code>sum()</code>(如果命令行指定了<code>—-sum</code>)或函数<code>max()</code>。</p>
<h2 id="Parsing-arguments"><a href="#Parsing-arguments" class="headerlink" title="Parsing arguments"></a>Parsing arguments</h2><p>ArgumentParser通过方法<code>parse_args()</code>解析参数。这会检查命令行，将每个命令行参数转换为合适的类型并引用合适的函数操作。在大多数情况下，这意味着一个<code>Namespace</code>实例会根据命令行解析出的属性建立起来:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser.parse_args([&apos;--sum&apos;, &apos;7&apos;, &apos;-1&apos;, &apos;42&apos;])</span><br><span class="line">Namespace(accumulate=&lt;built-in function sum&gt;, integers=[7, -1, 42])</span><br></pre></td></tr></table></figure>
<p>在脚本中，<code>parse_args()</code>调用时没有传入参数，那么ArgumentParser会自动的从<code>sys.argv</code>中决定命令行参数。</p>
<h1 id="ArgumentParser-Object"><a href="#ArgumentParser-Object" class="headerlink" title="ArgumentParser Object"></a>ArgumentParser Object</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">argparse.ArgumentParser(</span><br><span class="line">	prog=None, </span><br><span class="line">	usage=None, </span><br><span class="line">	description=None, </span><br><span class="line">	epilog=None, </span><br><span class="line">	parents=[], </span><br><span class="line">	formatter_class=argparse.HelpFormatter, </span><br><span class="line">	prefix_chars=&apos;-&apos;, </span><br><span class="line">	fromfile_prefix_chars=None, </span><br><span class="line">	argument_default=None, </span><br><span class="line">	conflict_handler=&apos;error&apos;, </span><br><span class="line">	add_help=True</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建一个ArgumentParser实例，所有的参量都被当成关键参数传递，每一个参量在下面都有详细介绍，简单的说有:</p>
<ul>
<li>prog - 程序的名称(default:sys.argv[0])</li>
<li>usage - 描述程序用法的字符串(default:从传递给parser的参数生成)</li>
<li>description - 在argument help之前显示的介绍文本(default: None)</li>
<li>epilog - 在argument help之后显示的结束文本(default: None)</li>
<li>parents - 一个ArgumentParser实例列表，它们的参数都应当被包含</li>
<li>formatter_class - 定制帮助输出格式的类</li>
<li>prefix_chars - 字符集合，用作可选参数的前缀(default: ‘-‘)</li>
<li>fromfile_prefix_chars - 前缀文件的字符集，从中读取额外的参数(default: None)</li>
<li>argument_default - 参数的默认值(default: None)</li>
<li>conflict_handler - 解决选项冲突的策略，通常是不必要的</li>
<li>add_help - 为解析器增加一个 -h/–help 选项(default: True)</li>
</ul>
<h2 id="prog"><a href="#prog" class="headerlink" title="prog"></a>prog</h2><p>默认情况下ArgumentParser实例使用<code>sys.args[0]</code>来决定如何在帮助信息中显示程序名称。这个默认设置常常是令人满意的，因为它让帮助信息中的程序名称和程序在命令行中的引用名称相匹配。例如，考虑一个名称为<code>myprogram.py</code>的文件，文件内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(&apos;--foo&apos;, help=&apos;foo help&apos;)</span><br><span class="line">args = parser.parse_args()</span><br></pre></td></tr></table></figure>
<p>这个程序的帮助信息会显示<code>myprogram.py</code>作为程序的名称(无论程序是从哪里引用的):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ python myprogram.py --help</span><br><span class="line">usage: myprogram.py [-h] [--foo FOO]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"> --foo FOO   foo help</span><br><span class="line">$ cd ..</span><br><span class="line">$ python subdir\myprogram.py --help</span><br><span class="line">usage: myprogram.py [-h] [--foo FOO]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"> --foo FOO   foo help</span><br></pre></td></tr></table></figure>
<p>要改变这个默认行为，可以给ArgumentParser的<code>prog=</code>参数赋予其他的值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;myprogram&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: myprogram [-h]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br></pre></td></tr></table></figure>
<p>程序名无论是<code>sys.args[0]</code>还是<code>prog=</code>决定，都可以用<code>%(prog)s</code>在帮助信息中的其他位置显示程序名称:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;myprogram&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, help=&apos;foo of the %(prog)s program&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: myprogram [-h] [--foo FOO]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"> --foo FOO   foo of the myprogram program</span><br></pre></td></tr></table></figure>
<h2 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h2><p>默认情况下，ArgumentParser根据它包含的参量来生成使用信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;PROG&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, nargs=&apos;?&apos;, help=&apos;foo help&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;bar&apos;, nargs=&apos;+&apos;, help=&apos;bar help&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: PROG [-h] [--foo [FOO]] bar [bar ...]</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line"> bar          bar help</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help   show this help message and exit</span><br><span class="line"> --foo [FOO]  foo help</span><br></pre></td></tr></table></figure>
<p>这些默认的信息可以通过<code>usage=</code>关键词来重写:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;PROG&apos;, usage=&apos;%(prog)s [options]&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, nargs=&apos;?&apos;, help=&apos;foo help&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;bar&apos;, nargs=&apos;+&apos;, help=&apos;bar help&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: PROG [options]</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line"> bar          bar help</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help   show this help message and exit</span><br><span class="line"> --foo [FOO]  foo help</span><br></pre></td></tr></table></figure>
<h2 id="description"><a href="#description" class="headerlink" title="description"></a>description</h2><p>大多数情况下对ArgumentParser构造器的调用会使用到<code>description=</code>关键字。这个关键字会给出一个关于程序做什么和怎么做的简短的描述。在帮助信息中，这段描述出现在使用信息和各参数的帮助信息之间:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(description=&apos;A foo that bars&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: argparse.py [-h]</span><br><span class="line"></span><br><span class="line">A foo that bars</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br></pre></td></tr></table></figure>
<p>默认情况下，这段描述自动换行以适应给定的空间。要改变这个行为，参考<a href="#formatter-class">formatter_class</a>参量。</p>
<h2 id="epilog"><a href="#epilog" class="headerlink" title="epilog"></a>epilog</h2><p>一些程序喜欢在参量描述之后显示额外的描述信息。这些文本可以通过ArgumentParser的<code>epilog=</code>关键字指定:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(</span><br><span class="line">...     description=&apos;A foo that bars&apos;,</span><br><span class="line">...     epilog=&quot;And that&apos;s how you&apos;d foo a bar&quot;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: argparse.py [-h]</span><br><span class="line"></span><br><span class="line">A foo that bars</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"></span><br><span class="line">And that&apos;s how you&apos;d foo a bar</span><br></pre></td></tr></table></figure>
<p>和description一样，epilog也是自动换行的，可以通过<a href="#formatter-class">formatter_class</a>改变。</p>
<h2 id="parents"><a href="#parents" class="headerlink" title="parents"></a>parents</h2><p>有时一些解析器会共享一个参数集合。比起重复定义这些参数，用一个简单的解析器来包含所有的这些需要共享的参数，然后其他解析器可以通过关键字<code>parent=</code>获取到这些共享的参数。<code>parent=</code>参数可以赋予一个ArgumentParser列表，并从这些列表中收集所有的固定项和可选项。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parent_parser = argparse.ArgumentParser(add_help=False)</span><br><span class="line">&gt;&gt;&gt; parent_parser.add_argument(&apos;--parent&apos;, type=int)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; foo_parser = argparse.ArgumentParser(parents=[parent_parser])</span><br><span class="line">&gt;&gt;&gt; foo_parser.add_argument(&apos;foo&apos;)</span><br><span class="line">&gt;&gt;&gt; foo_parser.parse_args([&apos;--parent&apos;, &apos;2&apos;, &apos;XXX&apos;])</span><br><span class="line">Namespace(foo=&apos;XXX&apos;, parent=2)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; bar_parser = argparse.ArgumentParser(parents=[parent_parser])</span><br><span class="line">&gt;&gt;&gt; bar_parser.add_argument(&apos;--bar&apos;)</span><br><span class="line">&gt;&gt;&gt; bar_parser.parse_args([&apos;--bar&apos;, &apos;YYY&apos;])</span><br><span class="line">Namespace(bar=&apos;YYY&apos;, parent=None)</span><br></pre></td></tr></table></figure>
<p>注意，大多数父类解析器会指定<code>add_help=False</code>。不然，ArgumentParser就会得到两个<code>-h/—-help</code>可选项(一个在父类一个在子类)并抛出错误。</p>
<pre>
注意：在使用<code>parent=</code>传递父类解析器之前必须完全初始化这些解析器。如果父类解析器改变，这些改变不会在子类中出现。
</pre>

<h2 id="formatter-class"><a href="#formatter-class" class="headerlink" title="formatter_class"></a>formatter_class</h2><p>ArgumentParser实例允许通过指定格式类来自定义帮助信息的格式。目前有三种这样的类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class argparse.RawDescriptionHelpFormatter</span><br><span class="line">class argparse.RawTextHelpFormatter</span><br><span class="line">class argparse.ArgumentDefaultsHelpFormatter</span><br></pre></td></tr></table></figure>
<p>前两个类支持对文本描述显示更多的控制方法，第三个自动添加关于参数默认值的信息。</p>
<p>默认情况下，ArgumentParser实例将帮助信息中description和epilog文本自动换行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(</span><br><span class="line">...     prog=&apos;PROG&apos;,</span><br><span class="line">...     description=&apos;&apos;&apos;this description</span><br><span class="line">...         was indented weird</span><br><span class="line">...             but that is okay&apos;&apos;&apos;,</span><br><span class="line">...     epilog=&apos;&apos;&apos;</span><br><span class="line">...             likewise for this epilog whose whitespace will</span><br><span class="line">...         be cleaned up and whose words will be wrapped</span><br><span class="line">...         across a couple lines&apos;&apos;&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: PROG [-h]</span><br><span class="line"></span><br><span class="line">this description was indented weird but that is okay</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"></span><br><span class="line">likewise for this epilog whose whitespace will be cleaned up and whose words</span><br><span class="line">will be wrapped across a couple lines</span><br></pre></td></tr></table></figure>
<p>将类<code>RawDescriptionHelpFormatter</code>作为<code>formatter_class=</code>的值传递，然后description和epilog就会被格式化，并且不再自动换行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(</span><br><span class="line">...     prog=&apos;PROG&apos;,</span><br><span class="line">...     formatter_class=argparse.RawDescriptionHelpFormatter,</span><br><span class="line">...     description=textwrap.dedent(&apos;&apos;&apos;\</span><br><span class="line">...         Please do not mess up this text!</span><br><span class="line">...         --------------------------------</span><br><span class="line">...             I have indented it</span><br><span class="line">...             exactly the way</span><br><span class="line">...             I want it</span><br><span class="line">...         &apos;&apos;&apos;))</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: PROG [-h]</span><br><span class="line"></span><br><span class="line">Please do not mess up this text!</span><br><span class="line">--------------------------------</span><br><span class="line">   I have indented it</span><br><span class="line">   exactly the way</span><br><span class="line">   I want it</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br></pre></td></tr></table></figure>
<p>另一个格式类<code>ArgumentDefaultsHelpFormatter</code>会增加显示参数的默认值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(</span><br><span class="line">...     prog=&apos;PROG&apos;,</span><br><span class="line">...     formatter_class=argparse.ArgumentDefaultsHelpFormatter)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, type=int, default=42, help=&apos;FOO!&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;bar&apos;, nargs=&apos;*&apos;, default=[1, 2, 3], help=&apos;BAR!&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: PROG [-h] [--foo FOO] [bar [bar ...]]</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line"> bar         BAR! (default: [1, 2, 3])</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"> --foo FOO   FOO! (default: 42)</span><br></pre></td></tr></table></figure>
<h2 id="prefix-chars"><a href="#prefix-chars" class="headerlink" title="prefix_chars"></a>prefix_chars</h2><p>大多数命令行选项会使用<code>‘-‘</code>作为前缀，比如<code>-f/—-foo</code>。如果解析器需要额外的前缀符，可以通过参数<code>prefix_chars=</code>来指定这些字符:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;PROG&apos;, prefix_chars=&apos;-+&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;+f&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;++bar&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args(&apos;+f X ++bar Y&apos;.split())</span><br><span class="line">Namespace(bar=&apos;Y&apos;, f=&apos;X&apos;)</span><br></pre></td></tr></table></figure>
<p><code>prefix_chars=</code>默认值为<code>‘-‘</code>。如果提供了一个没有包含<code>‘-‘</code>前缀字符集，将导致<code>-f/—-foo</code>选项不可用。</p>
<h2 id="fromfile-prefix-chars"><a href="#fromfile-prefix-chars" class="headerlink" title="fromfile_prefix_chars"></a>fromfile_prefix_chars</h2><p>有时候如果处理一个很长的参数列表，把这个参数列表写在文件中比写在命令行中更为明智。如果参数<code>fromfile_prefix_chars=</code>给定，那么以给定字符集开头的参数都会被作为文件，并被文件中的参数所替换。比如说:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; with open(&apos;args.txt&apos;, &apos;w&apos;) as fp:</span><br><span class="line">...     fp.write(&apos;-f\nbar&apos;)</span><br><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(fromfile_prefix_chars=&apos;@&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;-f&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args([&apos;-f&apos;, &apos;foo&apos;, &apos;@args.txt&apos;])</span><br><span class="line">Namespace(f=&apos;bar&apos;)</span><br></pre></td></tr></table></figure>
<p>参数<code>fromfile_prefix_chars=</code>的默认值为<code>None</code>，意味着默认情况下参数不会被当做是文件引用。</p>
<h2 id="argument-default"><a href="#argument-default" class="headerlink" title="argument_default"></a>argument_default</h2><p>通常参数默认值被指定有两种方式，一种是通过传递默认值给<code>add_argument()</code>方法，另一种是调用函数<code>set_defaults()</code>并提供键值对的集合。然而有时候，指定一个解析器的默认值是有用的。这可以使用<code>argument_default=</code>关键字实现。比如，要全面禁止<code>parse_args()</code>调用时赋默认值，可以指定<code>argument_default=SUPPRESS</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(argument_default=argparse.SUPPRESS)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;bar&apos;, nargs=&apos;?&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args([&apos;--foo&apos;, &apos;1&apos;, &apos;BAR&apos;])</span><br><span class="line">Namespace(bar=&apos;BAR&apos;, foo=&apos;1&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args([])</span><br><span class="line">Namespace()</span><br></pre></td></tr></table></figure>
<h2 id="conflict-handler"><a href="#conflict-handler" class="headerlink" title="conflict_handler"></a>conflict_handler</h2><p>ArgumentParser对象不允许使用相同的可选项执行两个动作。默认情况下，如果用户企图创建一个已经存在的可选项时，ArgumentParser会抛出错误:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;PROG&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;-f&apos;, &apos;--foo&apos;, help=&apos;old foo help&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, help=&apos;new foo help&apos;)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"> ..</span><br><span class="line">ArgumentError: argument --foo: conflicting option string(s): --foo</span><br></pre></td></tr></table></figure>
<p>有时(例如使用<code>parent</code>)覆盖旧版的可选参数是很有用的。为了实现覆盖防止冲突，可以将值<code>‘resolve’</code>传给<code>conflict_handler=</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;PROG&apos;, conflict_handler=&apos;resolve&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;-f&apos;, &apos;--foo&apos;, help=&apos;old foo help&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, help=&apos;new foo help&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: PROG [-h] [-f FOO] [--foo FOO]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"> -f FOO      old foo help</span><br><span class="line"> --foo FOO   new foo help</span><br></pre></td></tr></table></figure>
<p>ArgumentParser对象只删除被覆盖的旧版参数。在上述例子中，<code>-f</code>没有被覆盖所以被保留。</p>
<h2 id="add-help"><a href="#add-help" class="headerlink" title="add_help"></a>add_help</h2><p>默认情况下，ArgumentParser对象增加了一个可选项，用于显示解析器的帮助信息。比如，考虑一个叫myprogram.py的文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(&apos;--foo&apos;, help=&apos;foo help&apos;)</span><br><span class="line">args = parser.parse_args()</span><br></pre></td></tr></table></figure>
<p>如果在命令行中提供了<code>-h</code>或<code>—-help</code>，那么ArgumentParser会这么显示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python myprogram.py --help</span><br><span class="line">usage: myprogram.py [-h] [--foo FOO]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"> --foo FOO   foo help</span><br></pre></td></tr></table></figure>
<p>偶尔可能需要关闭这项附加的选项，这可以通过在ArgumentParser中提供<code>add_help=False</code>来实现:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;PROG&apos;, add_help=False)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, help=&apos;foo help&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: PROG [--foo FOO]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line"> --foo FOO  foo help</span><br></pre></td></tr></table></figure>
<p>典型的帮助选项是<code>-h/—-help</code>，一个错误是如果<code>prefix_chars=</code>被指定且没有包含<code>‘-‘</code>，那么<code>-h</code>和<code>—-help</code>都是无效的选项。这时，<code>prefix_chars=</code>的字符集中的第一个字符被作为帮助选项的前缀:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;PROG&apos;, prefix_chars=&apos;+/&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.print_help()</span><br><span class="line">usage: PROG [+h]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  +h, ++help  show this help message and exit</span><br></pre></td></tr></table></figure>
<h1 id="The-add-argument-method"><a href="#The-add-argument-method" class="headerlink" title="The add_argument() method"></a>The add_argument() method</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArgumentParser.add_argument(name or flags...[, action][, nargs][, const][, default][, type][, choices][, required][, help][, metavar][, dest])</span><br></pre></td></tr></table></figure>
<p>这些参数定义了一个命令行参数应该怎样被解释。每一个参数都有详细说明，简单的说为：</p>
<ul>
<li>name or flags - 一个名称或可选字符串列表，比如<code>foo</code>或<code>-f,--foo</code></li>
<li>action - 当命令行输入参数后执行的动作</li>
<li>nargs - 命令行应该提供的参数数量</li>
<li>const - 一个action或nargs需要的常量</li>
<li>default - 命令行未提供值时参数的默认值</li>
<li>type - 命令行参数应当被转换成哪种数据类型</li>
<li>choices - 参数的有效值容器</li>
<li>required - 命令行选项是否能被遗漏</li>
<li>help - 对参数功能的简要描述</li>
<li>metavar - 在使用信息中显示的参数名称</li>
<li>dest - <code>parse_args()</code>返回的属性名称</li>
</ul>
<h2 id="name-or-flags"><a href="#name-or-flags" class="headerlink" title="name or flags"></a>name or flags</h2><p><code>add_argument()</code>方法需要知道某个可选项(如<code>-f,--foo</code>)或必选项(如文件名列表)是否是期望的。第一个传给<code>add_argument()</code>的参数必须是一系列<code>flag</code>或一个<code>name</code>。比如，一个可选参数可以这样创建:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;-f&apos;, &apos;--foo&apos;)</span><br></pre></td></tr></table></figure>
<p>必选参数可以这样创建:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;bar)</span><br></pre></td></tr></table></figure>
<p>当<code>parse_args()</code>被调用时，可选参数通过前缀<code>‘-‘</code>识别，剩余的参数会被当作必选的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;PROG&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;-f&apos;, &apos;--foo&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;bar&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args([&apos;BAR&apos;])</span><br><span class="line">Namespace(bar=&apos;BAR&apos;, foo=None)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args([&apos;BAR&apos;, &apos;--foo&apos;, &apos;FOO&apos;])</span><br><span class="line">Namespace(bar=&apos;BAR&apos;, foo=&apos;FOO&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args([&apos;--foo&apos;, &apos;FOO&apos;])</span><br><span class="line">usage: PROG [-h] [-f FOO] bar</span><br><span class="line">PROG: error: too few arguments</span><br></pre></td></tr></table></figure>
<h2 id="action"><a href="#action" class="headerlink" title="action"></a>action</h2><p>ArgumentParser将命令行参数和执行动作联系在一起。这些动作几乎能够完成命令行参数和它们关联的任何事，但大多数动作仅仅在<code>parse_args()</code>返回值中添加了一个属性。<code>action</code>关键字指定命令行参数如何被处理。提供的动作有:</p>
<ul>
<li><code>‘store’</code> - 仅仅存储参数值。这是默认的动作。例如:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser()</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args(&apos;--foo 1&apos;.split())</span><br><span class="line">Namespace(foo=&apos;1&apos;)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>‘store_const’</code> - 存储被<code>const</code>关键字指定的值。<code>‘store_const’</code>动作大多时候被用作可选参数，用于指定一些标志。例如:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser()</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, action=&apos;store_const&apos;, const=42)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args([&apos;--foo&apos;])</span><br><span class="line">Namespace(foo=42)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>‘store_true’</code>和<code>‘store_false’</code> - 它们是<code>‘store_const’</code>的两种特殊情况，分别用于存储值<code>True</code>和<code>False</code>。除此之外，它们还分别提供<code>False</code>和<code>True</code>作默认值。例如:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser()</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, action=&apos;store_true&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--bar&apos;, action=&apos;store_false&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--baz&apos;, action=&apos;store_false&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args(&apos;--foo --bar&apos;.split())</span><br><span class="line">Namespace(bar=False, baz=True, foo=True)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>‘append’</code> - 存储一个列表，并将每个参数值都添加入列表。支持某个可选项多次指定。例如：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser()</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, action=&apos;append&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args(&apos;--foo 1 --foo 2&apos;.split())</span><br><span class="line">Namespace(foo=[&apos;1&apos;, &apos;2&apos;])</span><br></pre></td></tr></table></figure>
<ul>
<li><code>‘append_const’</code> - 存储一个列表，将关键字<code>const</code>指定值添加到列表。(<code>const</code>的默认值为<code>None</code>)。当多个参数需要存储常量到相同的列表时<code>‘append_const’</code>很有用。例如:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser()</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--str&apos;, dest=&apos;types&apos;, action=&apos;append_const&apos;, const=str)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--int&apos;, dest=&apos;types&apos;, action=&apos;append_const&apos;, const=int)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args(&apos;--str --int&apos;.split())</span><br><span class="line">Namespace(types=[&lt;type &apos;str&apos;&gt;, &lt;type &apos;int&apos;&gt;])</span><br></pre></td></tr></table></figure>
<ul>
<li><code>‘count’</code> - 计算关键参数出现的次数：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser()</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--verbose&apos;, &apos;-v&apos;, action=&apos;count&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args([&apos;-vvv&apos;])</span><br><span class="line">Namespace(verbose=3)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>‘help’</code> - 打印出当前解释器所有可选项的全部帮助信息后退出。默认情况下解析器带有该行为。</p>
</li>
<li><p><code>‘version’</code> - 在调用 <code>add_argument()</code> 时传入 <code>version=</code>关键参数后，打印出版本信息后退出：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import argparse</span><br><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser(prog=&apos;PROG&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--version&apos;, action=&apos;version&apos;, version=&apos;%(prog)s 2.0&apos;)</span><br><span class="line">&gt;&gt;&gt; parser.parse_args([&apos;--version&apos;])</span><br><span class="line">PROG 2.0</span><br></pre></td></tr></table></figure>
<p>你可以通过传递子类行为或其他实现相同接口的对象来指定任意的行为。这样做的建议方法是扩展 <code>Action</code>，重载 <code>__call__</code> 方法和 <code>__init__</code> 方法（可选）。</p>
<p>一个简单例子如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; class FooAction(argparse.Action):</span><br><span class="line">...     def __init__(self, option_strings, dest, nargs=None, **kwargs):</span><br><span class="line">...         if nargs is not None:</span><br><span class="line">...             raise ValueError(&quot;nargs not allowed&quot;)</span><br><span class="line">...         super(FooAction, self).__init__(option_strings, dest, **kwargs)</span><br><span class="line">...     def __call__(self, parser, namespace, values, option_string=None):</span><br><span class="line">...         print &apos;%r %r %r&apos; % (namespace, values, option_string)</span><br><span class="line">...         setattr(namespace, self.dest, values)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; parser = argparse.ArgumentParser()</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;--foo&apos;, action=FooAction)</span><br><span class="line">&gt;&gt;&gt; parser.add_argument(&apos;bar&apos;, action=FooAction)</span><br><span class="line">&gt;&gt;&gt; args = parser.parse_args(&apos;1 --foo 2&apos;.split())</span><br><span class="line">Namespace(bar=None, foo=None) &apos;1&apos; None</span><br><span class="line">Namespace(bar=&apos;1&apos;, foo=None) &apos;2&apos; &apos;--foo&apos;</span><br><span class="line">&gt;&gt;&gt; args</span><br><span class="line">Namespace(bar=&apos;1&apos;, foo=&apos;2&apos;)</span><br></pre></td></tr></table></figure>
<h2 id="nargs"><a href="#nargs" class="headerlink" title="nargs"></a>nargs</h2><p><a href="file:///Users/mac/Desktop/python-2.7.11-docs-html/library/argparse.html?highlight=argparse#nargs" target="_blank" rel="external">nargs</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[添加Google统计]]></title>
      <url>http://lizonghang.github.io/2016/07/03/%E6%B7%BB%E5%8A%A0Google%E7%BB%9F%E8%AE%A1/</url>
      <content type="html"><![CDATA[<p>步骤一:</p>
<p>注册Google账户，登陆后访问<a href="https://analytics.google.com" target="_blank" rel="external">Google Analytics</a>，按照提示填写网站信息开通GA服务，获取统计ID。</p>
<p>步骤二:</p>
<p>编辑主题配置文件，找到字段google_analytics，删除注释并填写统计ID:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">google_analytics: your-analytics-id</span><br></pre></td></tr></table></figure>
<p>步骤三:</p>
<p>进入GA数据查看页查看会话数、用户数、浏览量、平均会话时长、跳出率等信息</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[设置侧边栏社交链接]]></title>
      <url>http://lizonghang.github.io/2016/07/03/%E8%AE%BE%E7%BD%AE%E4%BE%A7%E8%BE%B9%E6%A0%8F%E7%A4%BE%E4%BA%A4%E9%93%BE%E6%8E%A5/</url>
      <content type="html"><![CDATA[<p>编辑主题配置文件_config.yml，找到字段social，删除注释并添加社交站点名称与地址，如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Social links</span><br><span class="line">social:</span><br><span class="line">  github: https://github.com/your-user-name</span><br><span class="line">  twitter: https://twitter.com/your-user-name</span><br><span class="line">  weibo: http://weibo.com/your-user-name</span><br><span class="line">  douban: http://douban.com/people/your-user-name</span><br><span class="line">  zhihu: http://www.zhihu.com/people/your-user-name</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[创建about页面]]></title>
      <url>http://lizonghang.github.io/2016/07/03/%E5%88%9B%E5%BB%BAabout%E9%A1%B5%E9%9D%A2/</url>
      <content type="html"><![CDATA[<p>创建“关于我”页面</p>
<p>新建一个about页面:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page &apos;about&apos;</span><br></pre></td></tr></table></figure>
<p>修改主题配置文件，将menu下的about:/about/注释取消即可:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: /</span><br><span class="line">  archives: /archives</span><br><span class="line">  tags: /tags</span><br><span class="line">  about: /about</span><br></pre></td></tr></table></figure>
<p>更改menu中项目的顺序可更改在菜单中显示的顺序。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[创建分类页面]]></title>
      <url>http://lizonghang.github.io/2016/07/03/%E5%88%9B%E5%BB%BA%E5%88%86%E7%B1%BB%E9%A1%B5%E9%9D%A2/</url>
      <content type="html"><![CDATA[<p>为Hexo添加分类页面的index.html，并在其菜单中显示各分类的链接</p>
<p>第一步:新建一个页面，命名为categories:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page categories</span><br></pre></td></tr></table></figure>
<p>第二步:编辑新建的md文件，将页面类型设置为”categories”，主题将自动为这个页面显示所有的分类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">title: 分类</span><br><span class="line">date: 2014-12-22 12:39:04</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>注意: 如果有启动多说或Disqus评论，默认的页面也会带有评论。如果需要关闭可以将字段comments设置为false:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title: 分类</span><br><span class="line">date: 2014-12-22 12:39:04</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line">comments: false</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>第三步:编辑主题配置文件_config.yml，将menu中的categories:/categories注释去掉:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: /</span><br><span class="line">  categories: /categories</span><br><span class="line">  archives: /archives</span><br><span class="line">  tags: /tags</span><br></pre></td></tr></table></figure>
<p>第四步:清空缓存、生成静态文件、发布/预览:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo generate</span><br><span class="line">$ hexo deploy	# 发布</span><br><span class="line">$ hexo server	# 打开本地服务器在页面上预览</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Python图片转字符画]]></title>
      <url>http://lizonghang.github.io/2016/07/03/Python%E5%9B%BE%E7%89%87%E8%BD%AC%E5%AD%97%E7%AC%A6%E7%94%BB/</url>
      <content type="html"><![CDATA[<p>使用Python处理图片，将图片转换为用特定字符组成的字符画</p>
<p>第一步:安装pillow(PIL)库:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install pillow</span><br></pre></td></tr></table></figure>
<p>第二步:获取实验用图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://labfile.oss.aliyuncs.com/courses/370/ascii_dora.png</span><br></pre></td></tr></table></figure>
<p><img src="http://labfile.oss.aliyuncs.com/courses/370/ascii_dora.png" alt="哆啦A梦"></p>
<p>第三步:编写程序,假设文件名为ascii.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"># coding=utf-8</span><br><span class="line">from PIL import Image</span><br><span class="line">import argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line"></span><br><span class="line">parser.add_argument(&apos;file&apos;)     # 输入文件</span><br><span class="line">parser.add_argument(&apos;-o&apos;, &apos;--output&apos;)   # 输出文件</span><br><span class="line">parser.add_argument(&apos;--width&apos;, type=int, default=80)    # 输出字符画宽</span><br><span class="line">parser.add_argument(&apos;--height&apos;, type=int, default=80)   # 输出字符画高</span><br><span class="line"></span><br><span class="line"># 获取参数</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">IMG = args.file</span><br><span class="line">WIDTH = args.width</span><br><span class="line">HEIGHT = args.height</span><br><span class="line">OUTPUT = args.output</span><br><span class="line"></span><br><span class="line"># 字符是比较大块的像素,字符种类越多可以表现的颜色也越多,图片更有层次感.下面字符集使用了70个字符</span><br><span class="line">ascii_char = list(&quot;$@B%8&amp;WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\|()1&#123;&#125;[]?-_+~&lt;&gt;i!lI;:,\&quot;^`&apos;. &quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 灰度值指黑白图像中点的颜色深度,范围一般从0到255,白色为255,黑色为0,故黑白图片也称灰度图像</span><br><span class="line"># 灰度值公式 = 0.2126 * r + 0.7152 * g + 0.0722 * b</span><br><span class="line"></span><br><span class="line"># RGB转字符</span><br><span class="line">def RGB2Char(r, b, g, alpha=256):</span><br><span class="line">    if alpha == 0:</span><br><span class="line">        return &apos; &apos;</span><br><span class="line">    length = len(ascii_char)</span><br><span class="line">    gray = int(0.2126 * r + 0.7152 * g + 0.0722 * b)</span><br><span class="line"></span><br><span class="line">    unit = (256.0 + 1) / length</span><br><span class="line">    return ascii_char[int(gray / unit)]</span><br><span class="line"></span><br><span class="line"># 主函数</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    img = Image.open(IMG)</span><br><span class="line">    img = img.resize((WIDTH, HEIGHT), Image.NEAREST)</span><br><span class="line"></span><br><span class="line">    txt = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    for i in range(HEIGHT):</span><br><span class="line">        for j in range(WIDTH):</span><br><span class="line">            txt += RGB2Char(*img.getpixel((j, i)))</span><br><span class="line">        txt += &apos;\n&apos;</span><br><span class="line"></span><br><span class="line">    print txt</span><br><span class="line"></span><br><span class="line">    # 字符画输出到文件</span><br><span class="line">    if OUTPUT:</span><br><span class="line">        with open(OUTPUT, &apos;w&apos;) as f:</span><br><span class="line">            f.write(txt)</span><br></pre></td></tr></table></figure>
<p>第四步:查看运行效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python ascii.py dora.png -o ascii_dora.txt</span><br></pre></td></tr></table></figure>
<p>看到的效果应该是这样的:</p>
<p><img src="https://dn-anything-about-doc.qbox.me/document-uid8834labid1191timestamp1437128425410.png?watermark/1/image/aHR0cDovL3N5bC1zdGF0aWMucWluaXVkbi5jb20vaW1nL3dhdGVybWFyay5wbmc=/dissolve/60/gravity/SouthEast/dx/0/dy/10" alt="哆啦A梦字符图"></p>
<p>然而，并不是对所有图片都有良好的效果，由于采用的字符集只有70个，并且密度分布不均，难以用于转换色彩层次多或内容丰富的图片。需要探索更合理的字符集实现更好的转换效果。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用Hexo搭建Github Page]]></title>
      <url>http://lizonghang.github.io/2016/06/30/%E4%BD%BF%E7%94%A8Hexo%E6%90%AD%E5%BB%BAGithub-Page/</url>
      <content type="html"><![CDATA[<h1 id="创建Github-io"><a href="#创建Github-io" class="headerlink" title="创建Github.io"></a>创建Github.io</h1><p>本文默认的前提为你会使用Git，如不会使用Git或没有Github账号，请参考<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="external">廖雪峰的Git教程</a></p>
<p>要在github上搭建github pages，需要在你的github下新建一个名为[username].github.io的仓库，其中username是你的用户名(或组织名称)。注意: 如果username与你的用户名不同将无法成功。</p>
<p>在电脑自定义的位置新建一个文件夹如github.io，然后进入github.io文件夹执行git初始化命令并克隆github.io仓库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br><span class="line">$ git clone https://github.com/username/username.github.io</span><br></pre></td></tr></table></figure>
<p>进入项目文件夹并增加一个index.html文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd username.github.io</span><br><span class="line">$ echo &quot;Hello World&quot; &gt; index.html</span><br></pre></td></tr></table></figure>
<p>将你的github.com/username/username.github.io设置一个名称，假设为blog:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add blog git@github.com:username/username.github.io.git</span><br></pre></td></tr></table></figure>
<p>执行add,commit操作并push到你的blog仓库，注意，请确认你是否push到了正确的仓库:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add -A</span><br><span class="line">$ git commit -m &quot;Initial Commit&quot;</span><br><span class="line">$ git push blog master</span><br></pre></td></tr></table></figure>
<p>如果出现错误，不能push，请尝试先进行pull，再进行push操作:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git pull blog master</span><br></pre></td></tr></table></figure>
<p>当你的username.github.io仓库中存在index.html时，访问你的博客页面，如username.github.io，可以看到页面上出现“Hello World”，你就拥有了一个自己的github博客。</p>
<h1 id="使用Hexo作博客模板"><a href="#使用Hexo作博客模板" class="headerlink" title="使用Hexo作博客模板"></a>使用Hexo作博客模板</h1><p>当然不是每个人都有时间去写博客页面或管理自己的博客，此时即可借助Hexo来帮你管理和生成你的博客。</p>
<p>在安装Hexo之前，请确保你的电脑中安装有node.js，否则可能出现错误:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init env: node: No such file or directory</span><br></pre></td></tr></table></figure>
<p>若电脑中没有node.js，前往<a href="https://nodejs.org/en/" target="_blank" rel="external">nodejs的官方网站</a>下载，本人使用的是<a href="https://nodejs.org/dist/v4.4.7/node-v4.4.7.pkg" target="_blank" rel="external">v4.4.7 LTS版本</a>。下载完成后，运行安装程序即可完成安装，安装node.js后也安装好了npm。</p>
<h2 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm install -g hexo</span><br></pre></td></tr></table></figure>
<h2 id="部署Hexo"><a href="#部署Hexo" class="headerlink" title="部署Hexo"></a>部署Hexo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init</span><br></pre></td></tr></table></figure>
<p>这个命令会初始化博客目录，执行命令时在你想要创建的目录下执行，此时该目录下会生成以下文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">   ├── .deploy</span><br><span class="line">   ├── public</span><br><span class="line">   ├── scaffolds</span><br><span class="line">   ├── scripts</span><br><span class="line">   ├── source</span><br><span class="line">   |   ├── _drafts</span><br><span class="line">   |   └── _posts</span><br><span class="line">   ├── themes</span><br><span class="line">   ├── _config.yml</span><br><span class="line">   └── package.json</span><br></pre></td></tr></table></figure>
<p>文件说明:</p>
<ul>
<li>.deploy：执行hexo deploy命令部署到GitHub上的内容目录</li>
<li>public：执行hexo generate命令，输出的静态网页内容目录</li>
<li>scaffolds：layout模板文件目录，其中的md文件可以添加编辑</li>
<li>scripts：扩展脚本目录，这里可以自定义一些javascript脚本</li>
<li>source：文章源码目录，该目录下的markdown和html文件均会被hexo处理。该页面对应repo的根目录，404文件、favicon.ico文件，CNAME文件等都应该放这里，该目录下可新建页面目录。</li>
<li>_drafts：草稿文章</li>
<li>_posts：发布文章</li>
<li>themes：主题文件目录</li>
<li>_config.yml：全局配置文件，大多数的设置都在这里</li>
<li>package.json：应用程序数据，指明hexo的版本等信息，类似于一般软件中的关于按钮</li>
</ul>
<p>你可以尝试使用运行hexo服务器并<a href="127.0.0.1:4000" target="_blank" rel="external">在浏览器中打开</a>来检查Hexo是否正常工作:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<h2 id="将Hexo的模板应用到github-io"><a href="#将Hexo的模板应用到github-io" class="headerlink" title="将Hexo的模板应用到github.io"></a>将Hexo的模板应用到github.io</h2><p>在hexo中有两个_config.yml文件，一个位于hexo的根目录下，我们称之为全局配置文件，另一个位于/themes/landscape/_config.yml，称之为主题配置文件。</p>
<p>打开全局配置文件_config.yml，你需要注意的配置有:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">title: title    #博客名</span><br><span class="line">subtitle: subtitle  #博客副标题</span><br><span class="line">description:          #网站描述, 用于爬虫抓取的关键词</span><br><span class="line">author: author    #作者名称</span><br><span class="line">email: email  #作者邮箱</span><br><span class="line">language: zh-CN       #网页编码,中文</span><br><span class="line">root: /			# 一定要从/开始，否则与github.io不能同步路径</span><br><span class="line">deploy:</span><br><span class="line">  type: github    #部署类型Github</span><br><span class="line">  repository: git@github.com:username/username.github.io.git </span><br><span class="line">  branch: master   #部署分支,一般使用master主分支</span><br></pre></td></tr></table></figure>
<p>保存设置后执行命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p>随后将hexo下的模板文件同步到github:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>
<p>稍等片刻，打开你的username.github.io，应当可以看到hexo的模板页面。</p>
<h1 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h1><h2 id="新增文章"><a href="#新增文章" class="headerlink" title="新增文章"></a>新增文章</h2><p>使用如下命令后在hexo根目录中/source/_posts/目录下新增一个new-article.md文本:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new &apos;new-article&apos;</span><br></pre></td></tr></table></figure>
<p>编辑该文件，以markdown格式书写自己的博文。关于markdown的使用方法请参考<a href="http://www.appinn.com/markdown/" target="_blank" rel="external">Markdown语法说明(简体中文版)</a>。编辑时，可启动hexo本地服务器实时查看<a href="127.0.0.1:4000" target="_blank" rel="external">页面效果</a>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>编辑完成后，使用如下命令发布到github上:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean		# 清理原有文件，以防与新文件冲突</span><br><span class="line">$ hexo generate		# 生成静态站点文件</span><br><span class="line">$ hexo deploy		# 发布到github pages上</span><br></pre></td></tr></table></figure>
<p>完成操作后，稍等十秒(github pages更新有延迟)，刷新github pages页面查看页面效果</p>
<h2 id="删除文章"><a href="#删除文章" class="headerlink" title="删除文章"></a>删除文章</h2><p>直接删除本地hexo目录下/source/_posts/中的md文件，再执行清理、生成静态站点文件、发布操作即可。命令参考”新增文章”。</p>
<h1 id="更换模板"><a href="#更换模板" class="headerlink" title="更换模板"></a>更换模板</h1><p>官方默认的主题为landscape主题，主题存放于themes文件夹中，可以更改全局配置文件来更换为需要的主题。</p>
<h2 id="选择主题"><a href="#选择主题" class="headerlink" title="选择主题"></a>选择主题</h2><p>官方提供了许多<a href="https://hexo.io/themes/" target="_blank" rel="external">主题</a>，可自行选择喜欢的主题并下载。以我使用的是<a href="https://github.com/iissnan/hexo-theme-next/releases" target="_blank" rel="external">next</a>主题为例。首先需要将主题文件下载下来(在Downloads分类下)，解压后存放于themes目录下，并将文件夹名称简化为next。</p>
<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>打开全局配置文件，找到theme字段，将其更改为next，<a href="127.0.0.1:4000" target="_blank" rel="external">验证主题</a>是否启动:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s --debug</span><br></pre></td></tr></table></figure>
<h3 id="选择-Scheme"><a href="#选择-Scheme" class="headerlink" title="选择 Scheme"></a>选择 Scheme</h3><p>NexT通过Scheme提供主题中的主题。Mist是NexT的第一款Scheme。启用Mist仅需在主题配置文件中将 #scheme: Mist 前面的#注释去掉即可。</p>
<h3 id="语言设置"><a href="#语言设置" class="headerlink" title="语言设置"></a>语言设置</h3><p>编辑全局配置文件，将 language 设置成需要的语言。例如选用正体中文，则配置为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">language: zh-Hans</span><br></pre></td></tr></table></figure>
<p>可用的语言如以下表格所示：</p>
<table>
<thead>
<tr>
<th>语言</th>
<th>代码</th>
<th>设定值</th>
</tr>
</thead>
<tbody>
<tr>
<td>English</td>
<td>en</td>
<td>language: en</td>
</tr>
<tr>
<td>简体中文</td>
<td>zh-Hans</td>
<td>language: zh-Hans</td>
</tr>
<tr>
<td>French</td>
<td>fr-FR</td>
<td>language: fr-FR</td>
</tr>
<tr>
<td>正体中文</td>
<td>zh-hk/zh-tw</td>
<td>language: zh-hk</td>
</tr>
<tr>
<td>Russian</td>
<td>ru</td>
<td>language: ru</td>
</tr>
<tr>
<td>German</td>
<td>de</td>
<td>language: de</td>
</tr>
</tbody>
</table>
<h3 id="菜单配置"><a href="#菜单配置" class="headerlink" title="菜单配置"></a>菜单配置</h3><p>菜单配置在主题配置文件的menu。若站点运行在子目录中，请将链接前缀的/去掉。默认支持的菜单项有：</p>
<table>
<thead>
<tr>
<th>键值</th>
<th>设定值</th>
<th>comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>home</td>
<td>home:/</td>
<td>主页</td>
</tr>
<tr>
<td>archives</td>
<td>archives: /archives</td>
<td>归档页</td>
</tr>
<tr>
<td>categories</td>
<td>categories: /categories</td>
<td>分类页（需手动创建）</td>
</tr>
<tr>
<td>tags</td>
<td>tags: /tags</td>
<td>标签页（需手动创建）</td>
</tr>
<tr>
<td>about</td>
<td>about: /about</td>
<td>关于页面 （需手动创建）</td>
</tr>
<tr>
<td>commonweal</td>
<td>commonweal: /404.html</td>
<td>公益 404 （需手动创建）</td>
</tr>
</tbody>
</table>
<p>菜单配置示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: /</span><br><span class="line">  archives: /archives</span><br><span class="line">  #about: /about</span><br><span class="line">  #categories: /categories</span><br><span class="line">  tags: /tags</span><br><span class="line">  #commonweal: /404.html</span><br></pre></td></tr></table></figure>
<h3 id="侧栏设置"><a href="#侧栏设置" class="headerlink" title="侧栏设置"></a>侧栏设置</h3><p>默认情况下，侧栏仅在文章页面（拥有目录列表）时才显示。可以通过修改主题配置文件中的 sidebar 字段来控制侧栏的行为。</p>
<p>支持的选项有：</p>
<p>post - 默认行为，在文章页面（拥有目录列表）时显示<br>always - 在所有页面中都显示<br>hide - 在所有页面中都隐藏（可以手动展开）</p>
<p>侧栏示例配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sidebar: post</span><br></pre></td></tr></table></figure>
<h3 id="头像设置"><a href="#头像设置" class="headerlink" title="头像设置"></a>头像设置</h3><p>编辑主题配置文件，新增字段 avatar，值设置成头像的链接地址。</p>
<p>其中，头像的链接地址可以是完整网络图片url，或站内文件。其中站内文件的url与图片放置位置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/uploads/avatar.jpg - 需要将头像图片放置在站点的source/uploads/（可能需要新建uploads目录）</span><br><span class="line">/images/avatar.jpg - 需要将头像图片放置在主题的source/images/目录下|</span><br></pre></td></tr></table></figure>
<p>头像配置示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">avatar: https://avatars1.githubusercontent.com/u/32269?v=3&amp;s=460</span><br></pre></td></tr></table></figure>
<h3 id="作者名称"><a href="#作者名称" class="headerlink" title="作者名称"></a>作者名称</h3><p>编辑全局配置文件，设置 author 为作者的昵称。</p>
<h3 id="站点描述设置"><a href="#站点描述设置" class="headerlink" title="站点描述设置"></a>站点描述设置</h3><p>编辑全局配置文件，设置 description 字段为你的站点描述。</p>
]]></content>
    </entry>
    
  
  
</search>
